/**
 * This file is part of ReSampled SoundBox.
 *
 * Based on SoundBox by Marcus Geelnard (c) 2011-2013
 * 2015 pointofpresence
 * ReSampled.SoundBox (resampled-sound-box) - Online music tracker
 *
 * @version v0.0.1
 * @build Tue Aug 04 2015 20:18:39
 * @link https://github.com/pointofpresence/resampled-sound-box
 * @license GPL-3.0
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 * 1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 * 2. Altered source versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 * 3. This notice may not be removed or altered from any source
 *    distribution.
 */
function rle_encode(e){var t,n,i,r,o="";for(t=0;t<e.length;){for(i=e.charCodeAt(t),n=1;255>n&&t+n<e.length&&(r=e.charCodeAt(t+n),r==i);n++);n>3?(o+=String.fromCharCode(254),o+=String.fromCharCode(n),o+=String.fromCharCode(i)):(o+=String.fromCharCode(i),254==i&&(o+=String.fromCharCode(0)),n=1),t+=n}return o}function rle_decode(e){var t,n,i,r,o="";for(t=0;t<e.length;){if(i=e.charCodeAt(t++),254===i){if(1>t)break;if(r=e.charCodeAt(t++),0!=r){if(1>t)break;for(i=e.charCodeAt(t++),n=0;r>n;n++)o+=String.fromCharCode(i);continue}}o+=String.fromCharCode(i)}return o}function gui_init(){try{var e=new CGUI;e.init()}catch(t){alert("Unexpected error: "+t.message)}}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={},n=Math.max,i=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var i;for(i in t)n.o[i]=t[i];n._carve().init(),n._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var i=e(this);n.i[t]=i,n.v[t]=n.o.parse(i.val()),i.bind("change blur",function(){var e={};e[t]=i.val(),n.val(n._validate(e))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var i=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return this.t=t.c.t(e),i(e),t.c.d.bind("touchmove.k",i).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var i=function(e){var t=n.xy2val(e.pageX,e.pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return i(e),t.c.d.bind("mousemove.k",i).bind("keyup.k",function(e){if(27===e.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(e){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){var t=~~((0>e?-.5:.5)+e/this.o.step)*this.o.step;return Math.round(100*t)/100},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){return null==e?this.v:(e=this.o.parse(e),void(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1||(this.cv=this.o.stopper?n(i(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())))},this.xy2val=function(e,t){var r,o;return r=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(r=this.angleArc-r-this.PI2),this.angleArc!=this.PI2&&0>r&&r>-.5?r=0:0>r&&(r+=this.PI2),o=r*(this.o.max-this.o.min)/this.angleArc+this.o.min,this.o.stopper&&(o=n(i(o,this.o.max),this.o.min)),o},this.listen=function(){var t,r,o,a,s=this,d=function(e){e.preventDefault();var o=e.originalEvent,a=o.detail||o.wheelDeltaX,d=o.detail||o.wheelDeltaY,c=s._validate(s.o.parse(s.$.val()))+(a>0||d>0?s.o.step:0>a||0>d?-s.o.step:0);c=n(i(c,s.o.max),s.o.min),s.val(c,!1),s.rH&&(clearTimeout(t),t=setTimeout(function(){s.rH(c),t=null},100),r||(r=setTimeout(function(){t&&s.rH(c),r=null},200)))},c=1,l={37:-s.o.step,38:s.o.step,39:s.o.step,40:-s.o.step};this.$.bind("keydown",function(t){var r=t.keyCode;if(r>=96&&105>=r&&(r=t.keyCode=r-48),o=parseInt(String.fromCharCode(r)),isNaN(o)&&(13!==r&&8!==r&&9!==r&&189!==r&&(190!==r||s.$.val().match(/\./))&&t.preventDefault(),e.inArray(r,[37,38,39,40])>-1)){t.preventDefault();var d=s.o.parse(s.$.val())+l[r]*c;s.o.stopper&&(d=n(i(d,s.o.max),s.o.min)),s.change(s._validate(d)),s._draw(),a=window.setTimeout(function(){c*=2},30)}}).bind("keyup",function(e){isNaN(o)?a&&(window.clearTimeout(a),a=null,c=1,s.val(s.$.val())):s.$.val()>s.o.max&&s.$.val(s.o.max)||s.$.val()<s.o.min&&s.$.val(s.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",d),this.$.bind("mousewheel DOMMouseScroll",d)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e,t=this.g,n=this.arc(this.cv),i=1;t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,"none"!==this.o.bgColor&&(t.beginPath(),t.strokeStyle=this.o.bgColor,t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),t.stroke()),this.o.displayPrevious&&(e=this.arc(this.v),t.beginPath(),t.strokeStyle=this.pColor,t.arc(this.xy,this.xy,this.radius,e.s,e.e,e.d),t.stroke(),i=this.cv==this.v),t.beginPath(),t.strokeStyle=i?this.o.fgColor:this.fgColor,t.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),t.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var i=new t.Dial;i.o=n,i.$=e(this),i.run()}).parent()}}),function(e){var t={change:e.noop},n={change:function(t){e(this).on("change",function(){e(this).next("output").val(e(this).val()),t()})},init:function(n){var i=e.extend(t,n||{});return this.each(function(){{var t=e(this),n=t.data("config")||{};e.extend(i,n)}t.wrap(e("<div/>",{"class":"rs-slider"})),t.after(e("<output/>",{"class":"rangevalue"})),t.next("output").val(parseInt(t.val()))})}};e.fn.rsSlider=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist in jQuery.rsSlider"):n.init.apply(this,arguments)}}(jQuery),gDemoSongs=[{name:"sway",description:" SWAY by m @ Bits'n'Bites, from the 4k demo <a href=\"http://pouet.net/prod.php?which=59203\">SWAY</a>",data:String.fromCharCode(83,66,111,120,8,2,237,154,65,107,19,65,20,199,255,179,51,179,141,166,49,197,82,161,66,48,80,164,122,235,65,177,7,193,67,114,244,86,61,89,232,161,158,84,12,38,177,32,107,183,75,65,171,165,39,167,244,32,4,161,244,27,120,20,84,122,243,43,120,242,27,120,241,30,103,179,219,180,221,100,119,74,117,179,89,120,191,201,236,219,183,111,19,94,38,111,231,237,155,236,251,25,224,170,245,216,3,255,225,65,99,87,112,40,24,159,253,214,250,163,236,7,182,100,22,211,112,161,165,110,192,68,33,104,246,5,12,195,113,182,60,221,55,221,117,215,27,182,143,148,153,54,216,23,12,246,88,255,177,170,173,171,177,239,107,32,117,138,37,195,9,215,78,248,225,68,252,114,144,15,154,161,116,35,122,211,109,56,77,119,45,245,248,41,197,30,239,181,98,37,198,94,197,77,84,48,91,206,58,126,74,197,233,114,130,185,172,125,124,145,96,63,140,139,159,213,156,196,79,195,129,211,208,175,56,57,246,241,239,194,109,234,87,84,182,61,120,109,52,95,129,32,146,232,190,100,232,62,7,131,176,231,124,221,186,196,216,252,125,169,247,88,15,171,191,119,44,135,162,250,91,53,68,87,99,63,16,138,98,129,32,8,130,200,37,59,65,191,43,46,214,241,69,130,253,222,66,245,153,156,18,58,111,91,220,226,194,207,238,220,111,128,236,33,204,217,112,55,162,143,34,75,154,234,214,185,179,101,115,21,241,95,141,234,78,36,85,255,149,82,227,238,127,214,119,82,38,255,235,103,26,123,117,180,81,81,61,15,241,67,16,68,62,177,190,123,186,239,92,6,158,182,182,241,78,50,171,176,60,179,184,43,31,22,120,176,170,62,216,98,62,169,145,243,145,104,230,220,255,172,199,255,138,193,44,147,237,139,116,45,18,4,65,156,15,142,13,240,250,6,216,79,33,110,176,59,130,89,181,214,235,175,53,123,222,95,68,247,243,54,15,165,159,193,153,240,27,55,215,85,42,131,154,252,127,16,239,191,82,121,241,61,207,36,196,15,253,249,65,16,4,17,199,35,15,88,241,38,129,73,212,122,69,122,183,140,234,18,127,43,122,25,156,7,25,60,148,128,144,34,174,182,250,164,39,219,143,186,119,122,114,175,175,239,135,122,218,79,94,73,211,242,98,45,217,156,228,127,71,111,221,49,255,33,51,31,127,227,61,163,201,255,125,28,4,82,139,253,1,61,109,76,225,51,107,176,119,66,127,59,161,191,81,61,99,254,241,234,32,8,98,172,107,242,15,59,96,191,60,61,205,46,99,133,127,150,140,95,223,186,87,219,227,29,187,127,138,95,151,7,213,121,144,197,99,166,228,104,166,216,28,241,55,41,26,150,119,151,13,115,213,155,211,234,246,201,204,189,62,10,255,13,182,149,4,123,5,217,63,163,110,90,93,191,101,200,36,38,255,183,13,246,118,138,227,15,195,248,15,137,159,1,76,119,130,107,52,25,17,4,113,94,186,79,152,238,96,144,19,7,65,77,14,107,106,73,222,62,122,68,253,248,81,245,193,35,167,160,229,79,130,32,8,130,24,61,127,1)},{name:"rechord",description:" re:chord by m @ Bits'n'Bites, from the 4k demo <a href=\"http://www.pouet.net/prod.php?which=60915\">re:chord</a>",base64:"U0JveAgC7ZpRa9NQFMfPzU0ycZ0gOEWYo6CC4AaDPakPPgk-TPDBtz34oEMRQcZkdJTZMEdLSUhDQrexSV_9AH6BoU9-Cz-DH8B6bpKmN0nTTGVNiueXnp5zc9v03Jvb_O9N254HWFR-GaD0jSsA2vICIEoFKuv32COFJTauii2IYAQ1OcJH3Y_rMIjKzrYc4WPTj7dgWqjBW9mw099hz0e2PdlsKpXx5cvL6fIb7PbIsPs38Bxs4Bl45Vux-SdJ5k8QBFEc_Csq-anB8dpVvQvPZhiff8iqK3xJlVXcf6WqoYIHcfCcxszxTsLbCe_l-LHXXj6-vmrkH6Od4c2MfK3Qd0LvJryTKJ8npuM5MbM9W7Zz175_fH_bdu2YWY4lzOy4HWFl_yYV3f85wz8aq1l0j3vHMTv6dCTs8KR3IoyulQRRXlDF0d4zgCdX15QdnSkLvVurDXVFHSj2UM2Hqj5KyWuJ8qRX4nM59QdnXpMHbIZ-q6D853LyX6PBSxAEQQglBwNVHJerfQ2u-1P7_k-4MahlyugNa7IP6XmpJbR3plV1SYjy90Q82OXRWCEIgiBKSR_X4_0PqMyqfseX9kug3Lx9MVTyELFfioGNEPJWjk0rQf6tFg0VgiAIopRr8pcG8O-GBqDp9-GbzvgiKEuevqMHK_JgZS7fWc_6lbyBeufAYczbki87u9DEPLuS3wcLfQPLnSnInyAIgvhPldy1gP0w_L_LPOdfNMYftNRrB9zQQ9Xmvo7zQL1VTdX0GbGlj-RkfIK4LW1PoCWzOfXrf3i8LmYeWDEqPpvTtgs5beuiTdP8wwEzGkMi8grs77-hjaPcjfW_gzNBMad1cSbolr7_90MLqOMMNo18Y2pvRL2Z8dpJsOfPxofzciOMPmbkPGhrU9rXjJ3PdJsIoqyw09cMnr4A9liFz0LPFZ3pq7vRZY1Jz0GU3CMrNkEQBEEQk-U3"},{name:"spacedust",description:" Space Dust by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,154,79,107,19,65,24,198,159,249,179,187,145,52,22,69,161,32,74,160,74,35,30,75,209,67,123,170,244,228,69,208,91,15,241,28,197,67,23,33,68,210,96,13,41,161,151,176,233,178,49,13,1,79,138,31,64,240,32,185,121,240,11,136,159,192,111,161,179,219,77,92,154,29,247,160,197,157,240,254,178,79,158,77,38,153,188,51,236,206,203,187,155,147,21,224,6,175,186,96,19,183,0,44,99,21,27,130,241,157,143,27,247,14,197,129,180,109,238,48,198,69,82,18,176,66,71,10,94,224,191,9,252,227,64,231,56,103,74,25,237,119,50,218,253,225,96,52,28,4,67,157,35,231,244,252,126,224,247,61,95,231,121,143,191,131,70,164,69,164,219,239,4,121,143,241,127,159,191,197,140,19,120,121,53,223,199,127,81,173,64,197,200,147,251,145,135,35,43,149,112,19,75,106,231,130,146,133,91,8,23,81,134,181,240,171,21,165,219,32,136,191,64,76,92,165,22,7,94,84,134,124,199,98,188,248,238,210,122,77,28,56,97,107,156,193,229,84,22,108,156,238,207,247,212,232,152,61,19,205,174,217,241,215,219,139,21,127,207,55,43,126,195,15,127,52,105,49,36,8,99,225,213,35,165,150,196,21,199,217,196,35,155,137,171,159,156,7,95,228,19,153,200,228,243,74,233,169,49,219,204,172,173,154,179,173,137,174,129,235,90,125,182,213,209,14,61,166,141,30,70,120,79,135,58,65,16,196,162,242,211,101,74,96,144,118,116,249,138,95,100,172,188,98,253,46,218,25,103,124,234,179,71,74,71,94,134,242,142,62,118,83,70,160,27,151,217,241,19,4,65,16,89,236,158,106,83,58,215,163,50,252,199,87,148,159,90,142,156,182,51,22,93,75,231,44,129,38,103,120,113,238,155,119,207,228,76,98,122,252,4,65,16,196,34,35,182,92,136,215,225,125,242,146,93,139,106,242,37,20,30,62,179,171,118,242,83,225,159,221,166,178,52,61,141,207,188,30,197,126,18,61,251,248,96,64,77,110,50,111,53,243,63,136,231,63,239,244,52,239,135,227,48,225,222,64,214,125,242,6,8,130,32,206,41,147,99,31,226,254,62,216,119,41,43,236,174,202,213,219,123,47,63,111,219,107,103,235,110,161,74,113,62,85,86,54,212,121,238,171,239,20,31,143,35,55,54,209,155,30,63,65,16,4,145,193,164,165,116,116,25,223,106,123,93,118,104,51,94,216,189,86,238,91,143,11,127,250,82,90,50,127,158,241,67,175,104,174,9,130,32,8,226,159,243,11)},{name:"8bit",description:" 8 Bit One by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,219,49,107,219,64,20,7,240,119,58,217,130,144,216,201,226,146,33,32,98,74,218,177,93,186,52,99,200,84,58,36,75,72,134,102,78,178,9,99,227,202,85,13,65,180,8,19,115,56,24,211,16,98,2,249,16,89,252,141,2,25,187,56,119,82,228,154,243,112,14,4,91,46,255,31,247,116,122,150,100,206,135,204,227,140,220,120,67,84,224,3,143,248,32,32,34,103,185,36,183,100,13,137,220,109,190,97,51,139,89,234,133,180,55,17,151,189,81,107,181,133,140,206,168,253,138,90,157,80,157,35,35,237,155,50,90,99,253,188,181,59,221,81,139,90,237,110,116,33,70,45,148,113,174,206,145,145,246,106,206,162,177,30,0,0,96,30,172,192,35,235,135,87,36,218,43,255,228,77,89,191,223,221,89,238,65,238,208,73,106,184,170,226,106,203,141,239,20,106,121,83,203,235,250,5,149,108,205,196,185,150,7,90,94,211,47,240,178,53,254,208,112,188,142,155,29,0,224,255,172,228,223,60,21,43,68,199,31,191,179,223,14,227,111,247,45,55,180,143,248,75,43,121,207,144,95,107,249,149,150,247,181,252,102,198,51,209,53,228,250,120,255,24,198,123,61,227,241,247,12,199,77,227,233,227,203,0,0,176,144,248,223,136,248,167,128,211,26,95,125,79,123,114,77,254,120,203,118,190,228,215,243,234,232,191,74,110,126,167,122,178,14,111,80,195,151,251,141,120,201,237,171,165,108,173,42,247,107,153,159,137,90,178,14,247,201,175,203,125,63,94,114,203,207,84,165,106,69,238,87,113,171,0,0,64,54,13,61,38,131,24,217,249,114,188,72,47,48,230,166,7,153,68,86,188,53,18,73,196,77,76,230,98,81,39,40,249,28,66,224,86,1,0,128,108,10,146,248,108,47,109,210,125,142,216,67,72,238,105,110,213,78,43,121,98,154,146,39,198,67,76,228,0,0,0,240,234,226,39,222,130,160,72,228,20,182,232,216,102,252,67,143,206,78,236,175,246,243,170,252,249,247,245,41,10,57,158,93,7,0,0,152,189,129,151,4,57,165,221,184,180,171,127,161,97,90,0,0,0,22,195,19)},{name:"4chordsong",description:" 4 Chord Song by m @ Bits'n'Bites, chord test inspired by <a href=\"http://www.youtube.com/watch?v=5pidokakU4I\">Axis of Awsome</a>",data:String.fromCharCode(83,66,111,120,8,2,237,153,65,107,19,81,16,199,231,189,151,77,2,105,14,90,8,138,72,115,80,170,168,24,76,3,70,237,161,164,90,176,74,245,166,168,72,169,199,80,2,45,24,66,36,123,168,49,100,27,82,210,96,212,196,80,20,36,8,222,252,0,30,252,22,130,31,64,4,63,130,190,236,190,109,195,146,237,174,77,163,151,255,111,102,24,246,205,16,102,103,55,12,239,237,167,179,68,19,252,134,78,124,81,23,68,39,194,115,52,45,24,127,190,196,227,122,224,36,39,98,140,9,226,140,145,47,74,125,89,43,229,10,36,101,181,176,86,36,41,185,98,46,79,82,178,249,156,65,150,148,149,84,148,108,40,169,43,169,42,177,243,237,188,134,146,154,18,59,223,206,139,202,26,246,179,139,210,230,165,37,165,101,164,205,12,248,57,31,245,239,119,239,27,213,202,22,141,72,212,99,61,229,18,207,140,220,127,11,247,254,91,184,247,127,175,206,225,22,221,237,127,70,245,255,186,180,132,122,30,9,185,122,158,0,0,0,28,20,241,109,155,248,186,30,36,10,70,22,104,94,78,242,196,179,200,185,219,193,227,65,198,184,226,112,38,249,184,239,196,158,24,110,126,153,110,209,85,229,211,202,95,51,253,34,93,246,81,127,163,213,54,181,241,242,181,169,205,86,219,212,102,171,99,234,184,38,185,205,2,94,86,0,0,0,67,224,73,185,39,191,160,203,105,157,138,117,233,81,136,137,163,211,20,79,104,179,26,27,192,207,48,47,41,95,80,190,168,124,94,249,178,195,87,28,222,222,219,85,29,215,198,238,158,209,162,230,184,182,55,195,17,151,186,236,245,83,46,241,148,163,126,55,202,30,113,195,35,94,247,136,71,60,226,15,240,178,2,0,0,24,2,251,162,247,141,17,77,76,94,162,87,26,19,167,219,137,116,86,36,133,25,101,150,249,161,108,212,77,45,87,107,166,86,140,186,169,21,99,203,84,231,164,207,57,38,61,0,0,0,0,254,30,241,93,151,195,116,157,104,50,44,166,232,67,128,241,99,119,143,172,220,209,158,6,213,164,231,140,11,30,240,241,75,239,149,239,42,191,163,124,103,96,189,165,178,186,244,209,244,77,149,213,161,222,200,119,18,243,56,158,94,153,58,88,253,61,31,245,247,232,243,184,31,84,204,35,62,243,191,251,239,245,117,32,59,226,153,70,11,127,86,0,0,24,62,201,223,173,50,246,88,238,203,179,20,222,161,165,16,19,247,223,240,248,25,109,205,26,222,76,217,8,108,163,201,0,0,0,192,24,217,180,236,119,183,219,165,164,220,129,95,249,69,203,247,216,91,245,105,156,249,30,228,47,208,74,0,0,0,224,223,211,63,93,255,33,247,228,244,53,242,147,102,195,196,181,205,155,233,39,218,195,208,94,138,191,89,238,117,58,90,66,175,1,0,0,128,67,231,15)}],gInstrumentPresets=[{name:"====[LEADS]===="},{name:"Softy",i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,195,6,1,2,135,0,0,32,147,6,121,6]},{name:"Classic 8-bit",i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,69,3,1,1,23,167,0,32,77,6,25,6]},{name:"Square",i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,2,255,0,0,32,47,3,146,2]},{name:"Bell",i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,2,255,0,0,32,47,3,157,2]},{name:"Filter Bass 1",i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,195,4,1,3,50,184,119,244,147,6,84,6]},{name:"====[PADS]===="},{name:"Base string",i:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,2,5,0,0,32,0,0,24,8]},{name:"Base string (dist)",i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,136,5,1,2,8,92,21,32,148,5,85,8]},{name:"Evil brass",i:[3,146,140,0,1,224,128,3,0,0,92,0,95,3,179,5,1,2,124,135,11,32,150,3,157,6]},{name:"====[DRUMS]===="},{name:"Bass drum 1",i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,2,14,0,0,32,0,0,0,0]},{name:"Bass drum 2",i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,1,39,76,5,0,0]},{name:"Bass drum 3",i:[0,255,116,1,0,255,116,0,1,14,4,6,45,0,0,0,0,2,136,15,0,32,0,0,66,6]},{name:"Base tom",i:[0,192,104,1,0,80,99,0,0,0,4,0,66,3,0,0,0,1,0,1,2,32,37,4,0,0]},{name:"Snare 1",i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,60,4,1,2,255,0,0,32,61,5,32,6]},{name:"Snare 2",i:[0,221,128,1,0,210,128,0,1,255,4,6,62,0,64,7,1,3,255,15,0,32,20,0,24,6]},{name:"Snare 3",i:[3,0,128,0,3,68,128,0,1,218,4,4,40,1,55,4,1,2,67,115,124,190,67,6,39,1]},{name:"Hihat 1",i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,187,5,0,1,239,135,0,32,108,5,16,4]},{name:"Hihat 2",i:[2,40,140,1,0,0,140,0,0,255,5,0,48,0,0,0,0,3,161,192,0,32,0,0,71,1]},{name:"Open hihat",i:[0,0,128,0,0,0,128,0,0,125,0,1,59,0,0,0,0,1,193,171,0,29,39,3,88,3]},{name:"Smash",i:[0,214,104,1,0,204,104,0,1,229,4,40,21,0,231,6,1,3,183,15,0,32,232,4,74,6]},{name:"Pipe hit",i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,96,3,1,3,94,79,0,32,84,2,12,4]},{name:"====[F/X]===="},{name:"Wind",i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,51,2,1,2,58,239,0,32,88,1,157,2]},{name:"Long beat",i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,2,255,0,2,32,83,5,25,1]},{name:"Siren",i:[1,0,128,0,1,0,128,0,0,255,158,100,158,3,67,4,1,3,57,254,85,171,88,1,157,2]}];var CPlayer=function(){var e,t,n=new Worker("tracker/js/player-worker.js");n.onmessage=function(n){"progress"===n.data.cmd&&(t=n.data.buffer,e&&e(n.data.progress))},this.generate=function(t,i,r){e=r,n.postMessage({cmd:"generate",song:t,opts:i})},this.createWave=function(){var e=t,n=e.length,i=2*n-8,r=i-36,o=44,a=new Uint8Array(o+2*n);a.set([82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&r,r>>8&255,r>>16&255,r>>24&255]);for(var s=0,d=o;n>s;++s){var c=e[s];c=-32767>c?-32767:c>32767?32767:c,a[d++]=255&c,a[d++]=c>>8&255}return a},this.getData=function(e,n){for(var i=2*Math.floor(44100*e),r=new Array(n),o=t,a=0;2*n>a;a+=1){var s=i+a;r[a]=e>0&&s<o.length?o[s]/32768:0}return r}},CJammer=function(){var e,t,n,i,r,o,a,s,d,c=8,l=[],u=131072,f=function(e){return Math.sin(6.283184*e)},h=function(e){return 2*(e%1)-1},p=function(e){return.5>e%1?1:-1},m=function(e){var t=e%1*4;return 2>t?t-1:3-t},g=function(e){return 174.614115728/s*Math.pow(2,(e-128)/12)},v=[f,p,h,m],w=function(o,a){var h,p,m,g,w,E,y,_=a.length;for(m=0;_>m;++m)o[m]=0,a[m]=0;for(h=0;c>h;++h){var B=l[h];if(void 0!=B){var I=v[B.instr[0]],b=B.instr[1],L=B.instr[3],x=v[B.instr[4]],T=B.instr[5],C=B.instr[8],D=B.instr[9],U=Math.round(B.instr[10]*B.instr[10]*4*d),k=Math.round(B.instr[11]*B.instr[11]*4*d),S=Math.round(B.instr[12]*B.instr[12]*4*d),M=1/S,Y=B.o1f,A=B.o2f,P=B.o1t,O=B.o2t,R=U+k+S-B.env;for(_>=R?l[h]=void 0:R=_,p=B.env,m=0;R>m;p++,m++)w=1,U>p?w=p/U:p>=U+k&&(w-=(p-U-k)*M),g=Y,L&&(g*=w*w),P+=g,E=I(P)*b,g=A,C&&(g*=w*w),O+=g,E+=x(O)*T,D&&(E+=(2*Math.random()-1)*D),a[m]+=.002441481*E*w;B.env=p,B.o1t=P,B.o2t=O}}var N,z,$,q=n.pos,j=n.low,H=n.band,F=n.filterActive,X=n.dlyPos,W=u-1,J=v[e[13]],G=e[14]/512,V=Math.pow(2,e[15]-9)/t,Q=e[16],Z=e[17],K=43.23529*e[18]*3.141592/s,ee=1-e[19]/255,te=1e-5*e[20]*32767,ne=e[21]/32,ie=e[22]/512,re=6.283184*Math.pow(2,e[23]-9)/t,oe=e[24]/255,ae=e[25]*t>>1;for(ae>=u&&(ae=u-1),p=0;_>p;p++)m=2*(q+p),E=a[p],E||F?(y=K,Q&&(y*=J(V*m)*G+.5),y=1.5*Math.sin(y),j+=y*H,z=ee*(E-H)-j,H+=y*z,E=3==Z?H:1==Z?z:j,te&&(E*=te,E=1>E?E>-1?f(.25*E):-1:1,E/=te),E*=ne,F=E*E>1e-5,g=Math.sin(re*m)*ie+.5,N=E*(1-g),E*=g):N=0,$=X-ae&W,N+=r[$]*oe,E+=i[$]*oe,i[X]=N,r[X]=E,X=X+1&W,o[p]=N,a[p]=E;for(q+=_;q>2048*t;)q-=2048*t;n.pos=q,n.low=j,n.band=H,n.filterActive=F,n.dlyPos=X};this.start=function(){if(window.AudioContext)o=new AudioContext;else{if(!window.webkitAudioContext)return void(o=void 0);o=new webkitAudioContext,o.createScriptProcessor=o.createJavaScriptNode}s=o.sampleRate,d=s/44100,n={pos:0,low:0,band:0,filterActive:!1,dlyPos:0},i=new Float32Array(u),r=new Float32Array(u),a=o.createScriptProcessor(2048,0,2),a.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);w(t,n)},a.connect(o.destination)},this.stop=function(){},this.updateInstr=function(t){e=[];for(var n=0;n<t.length;++n)e.push(t[n])},this.updateRowLen=function(e){t=Math.round(e*d)},this.addNote=function(t){var n,i=(new Date).getTime(),r={startT:i,env:0,o1t:0,o2t:0,o1f:g(t+e[2]-128),o2f:g(t+e[6]-128)*(1+8e-4*e[7]),instr:new Array(13)};for(n=0;13>n;++n)r.instr[n]=e[n];var o=0,a=-100;for(n=0;c>n;++n){if(void 0==l[n])return void(l[n]=r);var s=i-l[n].startT;s>a&&(o=n,a=s)}l[o]=r}};if(function(){function e(){this.fc=0,this.dl=0}function t(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function n(e,t,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i}function i(){this.next=null,this.len=0,this.ptr=[],this.off=0}function r(n){var i;if(n?1>n?n=1:n>9&&(n=9):n=Je,pe=n,F=!1,le=!1,null===xt){for(q=j=H=null,xt=[],G=[],V=[],Q=[],Z=[],ve=[],i=0;bt>i;i++)ve[i]=new e;for(we=[],i=0;2*Et+1>i;i++)we[i]=new e;for(Ee=[],i=0;wt+2>i;i++)Ee[i]=new e;for(ye=[],i=0;Et>i;i++)ye[i]=new e;for(_e=[],i=0;2*yt+1>i;i++)_e[i]=new e;Be=new t,Ie=new t,be=new t,Le=[],xe=[],De=[],Ue=[],ke=[],Se=[],Me=[],Ye=[]}}function o(e){e.next=q,q=e}function a(){var e;return null!==q?(e=q,q=q.next):e=new i,e.next=null,e.len=e.off=0,e}function s(e){return Z[He+e]}function d(e,t){return Z[He+e]=t}function c(e){xt[W+X++]=e,W+X===Qe&&z()}function l(e){e&=65535,Qe-2>W+X?(xt[W+X++]=255&e,xt[W+X++]=e>>>8):(c(255&e),c(e>>>8))}function u(){ne=(ne<<Lt^255&G[de+Ke-1])&at,ie=s(ne),Z[de&st]=ie,d(ne,de)}function f(e,t){O(t[e].fc,t[e].dl)}function h(e){return 255&(256>e?ke[e]:ke[256+(e>>7)])}function p(e,t,n){return e[t].fc<e[n].fc||e[t].fc===e[n].fc&&De[t]<=De[n]}function m(e,t,n){var i;for(i=0;n>i&&je<qe.length;i++)e[t+i]=255&qe[je++];return i}function g(){var e;for(e=0;ot>e;e++)Z[He+e]=0;if(he=kt[pe].max_lazy,me=kt[pe].good_length,Ge||(ge=kt[pe].nice_length),fe=kt[pe].max_chain,de=0,te=0,ue=m(G,0,2*He),0>=ue)return le=!0,void(ue=0);for(le=!1;lt>ue&&!le;)w();for(ne=0,e=0;Ke-1>e;e++)ne=(ne<<Lt^255&G[e])&at}function v(e){var t,n,i,r,o=fe,a=de,s=se,d=de>ut?de-ut:dt,c=de+et,l=G[a+s-1],u=G[a+s];se>=me&&(o>>=2);do if(t=e,G[t+s]===u&&G[t+s-1]===l&&G[t]===G[a]&&G[++t]===G[a+1]){for(a+=2,t++;c>a;){for(r=!1,i=0;8>i;i+=1)if(a+=1,t+=1,G[a]!==G[t]){r=!0;break}if(r)break}if(n=et-(c-a),a=c-et,n>s){if(ce=e,s=n,Ge){if(n>=et)break}else if(n>=ge)break;l=G[a+s-1],u=G[a+s]}}while((e=Z[e&st])>d&&0!==--o);return s}function w(){var e,t,n=Ze-ue-de;if(-1===n)n--;else if(de>=He+ut){for(e=0;He>e;e++)G[e]=G[e+He];for(ce-=He,de-=He,te-=He,e=0;ot>e;e++)t=s(e),d(e,t>=He?t-He:dt);for(e=0;He>e;e++)t=Z[e],Z[e]=t>=He?t-He:dt;n+=He}le||(e=m(G,de+ue,n),0>=e?le=!0:ue+=e)}function E(){for(;0!==ue&&null===j;){var e;if(u(),ie!==dt&&ut>=de-ie&&(ae=v(ie),ae>ue&&(ae=ue)),ae>=Ke)if(e=A(de-ce,ae-Ke),ue-=ae,he>=ae){ae--;do de++,u();while(0!==--ae);de++}else de+=ae,ae=0,ne=255&G[de],ne=(ne<<Lt^255&G[de+1])&at;else e=A(0,255&G[de]),ue--,de++;for(e&&(Y(0),te=de);lt>ue&&!le;)w()}}function y(){for(;0!==ue&&null===j;){if(u(),se=ae,re=ce,ae=Ke-1,ie!==dt&&he>se&&ut>=de-ie&&(ae=v(ie),ae>ue&&(ae=ue),ae===Ke&&de-ce>ct&&ae--),se>=Ke&&se>=ae){var e;e=A(de-1-re,se-Ke),ue-=se-1,se-=2;do de++,u();while(0!==--se);oe=!1,ae=Ke-1,de++,e&&(Y(0),te=de)}else oe?(A(0,255&G[de-1])&&(Y(0),te=de),de++,ue--):(oe=!0,de++,ue--);for(;lt>ue&&!le;)w()}}function _(){le||(K=0,ee=0,b(),g(),j=null,X=0,W=0,3>=pe?(se=Ke-1,ae=0):(ae=Ke-1,oe=!1),J=!1)}function B(e,t,n){var i;return F||(_(),F=!0,0!==ue)?(i=I(e,t,n),i===n?n:J?i:(3>=pe?E():y(),0===ue&&(oe&&A(0,255&G[de-1]),Y(1),J=!0),i+I(e,i+t,n-i))):(J=!0,0)}function I(e,t,n){var i,r,a;for(i=0;null!==j&&n>i;){for(r=n-i,r>j.len&&(r=j.len),a=0;r>a;a++)e[t+i+a]=j.ptr[j.off+a];if(j.off+=r,j.len-=r,i+=r,0===j.len){var s;s=j,j=j.next,o(s)}}if(i===n)return i;if(X>W){for(r=n-i,r>X-W&&(r=X-W),a=0;r>a;a++)e[t+i+a]=xt[W+a];W+=r,i+=r,X===W&&(X=W=0)}return i}function b(){var e,t,n,i,r;if(0===ye[0].dl){for(Be.dyn_tree=ve,Be.static_tree=Ee,Be.extra_bits=Tt,Be.extra_base=gt+1,Be.elems=wt,Be.max_length=ht,Be.max_code=0,Ie.dyn_tree=we,Ie.static_tree=ye,Ie.extra_bits=Ct,Ie.extra_base=0,Ie.elems=Et,Ie.max_length=ht,Ie.max_code=0,be.dyn_tree=_e,be.static_tree=null,be.extra_bits=Dt,be.extra_base=0,be.elems=yt,be.max_length=pt,be.max_code=0,n=0,i=0;mt-1>i;i++)for(Se[i]=n,e=0;e<1<<Tt[i];e++)Ue[n++]=i;for(Ue[n-1]=i,r=0,i=0;16>i;i++)for(Me[i]=r,e=0;e<1<<Ct[i];e++)ke[r++]=i;for(r>>=7;Et>i;i++)for(Me[i]=r<<7,e=0;e<1<<Ct[i]-7;e++)ke[256+r++]=i;for(t=0;ht>=t;t++)Le[t]=0;for(e=0;143>=e;)Ee[e++].dl=8,Le[8]++;for(;255>=e;)Ee[e++].dl=9,Le[9]++;for(;279>=e;)Ee[e++].dl=7,Le[7]++;for(;287>=e;)Ee[e++].dl=8,
Le[8]++;for(C(Ee,wt+1),e=0;Et>e;e++)ye[e].dl=5,ye[e].fc=R(e,5);L()}}function L(){var e;for(e=0;wt>e;e++)ve[e].fc=0;for(e=0;Et>e;e++)we[e].fc=0;for(e=0;yt>e;e++)_e[e].fc=0;ve[vt].fc=1,ze=$e=0,Ae=Pe=Oe=0,Re=0,Ne=1}function x(e,t){for(var n=xe[t],i=t<<1;Te>=i&&(Te>i&&p(e,xe[i+1],xe[i])&&i++,!p(e,n,xe[i]));)xe[t]=xe[i],t=i,i<<=1;xe[t]=n}function T(e){var t,n,i,r,o,a,s=e.dyn_tree,d=e.extra_bits,c=e.extra_base,l=e.max_code,u=e.max_length,f=e.static_tree,h=0;for(r=0;ht>=r;r++)Le[r]=0;for(s[xe[Ce]].dl=0,t=Ce+1;bt>t;t++)n=xe[t],r=s[s[n].dl].dl+1,r>u&&(r=u,h++),s[n].dl=r,n>l||(Le[r]++,o=0,n>=c&&(o=d[n-c]),a=s[n].fc,ze+=a*(r+o),null!==f&&($e+=a*(f[n].dl+o)));if(0!==h){do{for(r=u-1;0===Le[r];)r--;Le[r]--,Le[r+1]+=2,Le[u]--,h-=2}while(h>0);for(r=u;0!==r;r--)for(n=Le[r];0!==n;)i=xe[--t],i>l||(s[i].dl!==r&&(ze+=(r-s[i].dl)*s[i].fc,s[i].fc=r),n--)}}function C(e,t){var n,i,r=[],o=0;for(n=1;ht>=n;n++)o=o+Le[n-1]<<1,r[n]=o;for(i=0;t>=i;i++){var a=e[i].dl;0!==a&&(e[i].fc=R(r[a]++,a))}}function D(e){var t,n,i=e.dyn_tree,r=e.static_tree,o=e.elems,a=-1,s=o;for(Te=0,Ce=bt,t=0;o>t;t++)0!==i[t].fc?(xe[++Te]=a=t,De[t]=0):i[t].dl=0;for(;2>Te;){var d=xe[++Te]=2>a?++a:0;i[d].fc=1,De[d]=0,ze--,null!==r&&($e-=r[d].dl)}for(e.max_code=a,t=Te>>1;t>=1;t--)x(i,t);do t=xe[ft],xe[ft]=xe[Te--],x(i,ft),n=xe[ft],xe[--Ce]=t,xe[--Ce]=n,i[s].fc=i[t].fc+i[n].fc,De[s]=De[t]>De[n]+1?De[t]:De[n]+1,i[t].dl=i[n].dl=s,xe[ft]=s++,x(i,ft);while(Te>=2);xe[--Ce]=xe[ft],T(e),C(i,a)}function U(e,t){var n,i,r=-1,o=e[0].dl,a=0,s=7,d=4;for(0===o&&(s=138,d=3),e[t+1].dl=65535,n=0;t>=n;n++)i=o,o=e[n+1].dl,++a<s&&i===o||(d>a?_e[i].fc+=a:0!==i?(i!==r&&_e[i].fc++,_e[_t].fc++):10>=a?_e[Bt].fc++:_e[It].fc++,a=0,r=i,0===o?(s=138,d=3):i===o?(s=6,d=3):(s=7,d=4))}function k(e,t){var n,i,r=-1,o=e[0].dl,a=0,s=7,d=4;for(0===o&&(s=138,d=3),n=0;t>=n;n++)if(i=o,o=e[n+1].dl,!(++a<s&&i===o)){if(d>a){do f(i,_e);while(0!==--a)}else 0!==i?(i!==r&&(f(i,_e),a--),f(_t,_e),O(a-3,2)):10>=a?(f(Bt,_e),O(a-3,3)):(f(It,_e),O(a-11,7));a=0,r=i,0===o?(s=138,d=3):i===o?(s=6,d=3):(s=7,d=4)}}function S(){var e;for(U(ve,Be.max_code),U(we,Ie.max_code),D(be),e=yt-1;e>=3&&0===_e[Ut[e]].dl;e--);return ze+=3*(e+1)+5+5+4,e}function M(e,t,n){var i;for(O(e-257,5),O(t-1,5),O(n-4,4),i=0;n>i;i++)O(_e[Ut[i]].dl,3);k(ve,e-1),k(we,t-1)}function Y(e){var t,n,i,r,o;if(r=de-te,Ye[Oe]=Re,D(Be),D(Ie),i=S(),t=ze+3+7>>3,n=$e+3+7>>3,t>=n&&(t=n),t>=r+4&&te>=0)for(O((Fe<<1)+e,3),N(),l(r),l(~r),o=0;r>o;o++)c(G[te+o]);else n===t?(O((Xe<<1)+e,3),P(Ee,ye)):(O((We<<1)+e,3),M(Be.max_code+1,Ie.max_code+1,i+1),P(ve,we));L(),0!==e&&N()}function A(e,t){if(Q[Ae++]=t,0===e?ve[t].fc++:(e--,ve[Ue[t]+gt+1].fc++,we[h(e)].fc++,V[Pe++]=e,Re|=Ne),Ne<<=1,0===(7&Ae)&&(Ye[Oe++]=Re,Re=0,Ne=1),pe>2&&0===(4095&Ae)){var n,i=8*Ae,r=de-te;for(n=0;Et>n;n++)i+=we[n].fc*(5+Ct[n]);if(i>>=3,Pe<parseInt(Ae/2,10)&&i<parseInt(r/2,10))return!0}return Ae===nt-1||Pe===rt}function P(e,t){var n,i,r,o,a=0,s=0,d=0,c=0;if(0!==Ae)do 0===(7&a)&&(c=Ye[d++]),i=255&Q[a++],0===(1&c)?f(i,e):(r=Ue[i],f(r+gt+1,e),o=Tt[r],0!==o&&(i-=Se[r],O(i,o)),n=V[s++],r=h(n),f(r,t),o=Ct[r],0!==o&&(n-=Me[r],O(n,o))),c>>=1;while(Ae>a);f(vt,e)}function O(e,t){ee>St-t?(K|=e<<ee,l(K),K=e>>St-ee,ee+=t-St):(K|=e<<ee,ee+=t)}function R(e,t){var n=0;do n|=1&e,e>>=1,n<<=1;while(--t>0);return n>>1}function N(){ee>8?l(K):ee>0&&c(K),K=0,ee=0}function z(){var e,t;if(0!==X){for(e=a(),null===j?j=H=e:H=H.next=e,e.len=X-W,t=0;t<e.len;t++)e.ptr[t]=xt[W+t];X=W=0}}function $(e,t){var n,i,o;if("string"==typeof e)for(o=e,e=[],n=0;n<o.length;n++)e[n]=o.charCodeAt(n);qe=e,je=0,"undefined"==typeof t&&(t=Je),r(t),i=[];do n=B(i,i.length,1024);while(n>0);for(qe=null,o="",n=0;n<i.length;n++)o+=String.fromCharCode(i[n]);return o}var q,j,H,F,X,W,J,G,V,Q,Z,K,ee,te,ne,ie,re,oe,ae,se,de,ce,le,ue,fe,he,pe,me,ge,ve,we,Ee,ye,_e,Be,Ie,be,Le,xe,Te,Ce,De,Ue,ke,Se,Me,Ye,Ae,Pe,Oe,Re,Ne,ze,$e,qe,je,He=32768,Fe=0,Xe=1,We=2,Je=6,Ge=!1,Ve=32768,Qe=8192,Ze=2*He,Ke=3,et=258,tt=16,nt=8192,it=15,rt=nt,ot=1<<it,at=ot-1,st=He-1,dt=0,ct=4096,lt=et+Ke+1,ut=He-lt,ft=1,ht=15,pt=7,mt=29,gt=256,vt=256,wt=gt+1+mt,Et=30,yt=19,_t=16,Bt=17,It=18,bt=2*wt+1,Lt=parseInt((it+Ke-1)/Ke,10),xt=null;nt>Ve&&console.error("error: INBUFSIZ is too small"),He<<1>1<<tt&&console.error("error: WSIZE is too large"),it>tt-1&&console.error("error: HASH_BITS is too large"),(8>it||258!==et)&&console.error("error: Code too clever");var Tt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ct=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Dt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],kt=[new n(0,0,0,0),new n(4,4,8,4),new n(4,5,16,8),new n(4,6,32,32),new n(4,4,16,16),new n(8,16,32,32),new n(8,16,128,128),new n(8,32,128,256),new n(32,128,258,1024),new n(32,258,258,4096)],St=16;window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.deflate=$}(),function(){function e(){this.next=null,this.list=null}function t(){this.e=0,this.b=0,this.n=0,this.t=null}function n(n,i,r,o,a,s){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var d,c,l,u,f,h,p,m,g,v,w,E,y,_,B,I,b,L=[],x=[],T=new t,C=[],D=[],U=[];for(b=this.root=null,h=0;h<this.BMAX+1;h++)L[h]=0;for(h=0;h<this.BMAX+1;h++)x[h]=0;for(h=0;h<this.BMAX;h++)C[h]=null;for(h=0;h<this.N_MAX;h++)D[h]=0;for(h=0;h<this.BMAX+1;h++)U[h]=0;c=i>256?n[256]:this.BMAX,g=n,v=0,h=i;do L[g[v]]++,v++;while(--h>0);if(L[0]===i)return this.root=null,this.m=0,void(this.status=0);for(p=1;p<=this.BMAX&&0===L[p];p++);for(m=p,p>s&&(s=p),h=this.BMAX;0!==h&&0===L[h];h--);for(u=h,s>h&&(s=h),_=1<<p;h>p;p++,_<<=1)if((_-=L[p])<0)return this.status=2,void(this.m=s);if((_-=L[h])<0)return this.status=2,void(this.m=s);for(L[h]+=_,U[1]=p=0,g=L,v=1,y=2;--h>0;)U[y++]=p+=g[v++];g=n,v=0,h=0;do 0!==(p=g[v++])&&(D[U[p]++]=h);while(++h<i);for(i=U[u],U[0]=h=0,g=D,v=0,f=-1,E=x[0]=0,w=null,B=0,null;u>=m;m++)for(d=L[m];d-->0;){for(;m>E+x[1+f];){if(E+=x[1+f],f++,B=(B=u-E)>s?s:B,(l=1<<(p=m-E))>d+1)for(l-=d+1,y=m;++p<B&&!((l<<=1)<=L[++y]);)l-=L[y];for(E+p>c&&c>E&&(p=c-E),B=1<<p,x[1+f]=p,w=[],I=0;B>I;I++)w[I]=new t;b=b?b.next=new e:this.root=new e,b.next=null,b.list=w,C[f]=w,f>0&&(U[f]=h,T.b=x[f],T.e=16+p,T.t=w,p=(h&(1<<E)-1)>>E-x[f],C[f-1][p].e=T.e,C[f-1][p].b=T.b,C[f-1][p].n=T.n,C[f-1][p].t=T.t)}for(T.b=m-E,v>=i?T.e=99:g[v]<r?(T.e=g[v]<256?16:15,T.n=g[v++]):(T.e=a[g[v]-r],T.n=o[g[v++]-r]),l=1<<m-E,p=h>>E;B>p;p+=l)w[p].e=T.e,w[p].b=T.b,w[p].n=T.n,w[p].t=T.t;for(p=1<<m-1;0!==(h&p);p>>=1)h^=p;for(h^=p;(h&(1<<E)-1)!==U[f];)E-=x[f],f--}this.m=x[1],this.status=0!==_&&1!==u?1:0}function i(){return D.length===U?-1:255&D[U++]}function r(e){for(;e>y;)E|=i()<<y,y+=8}function o(e){return E&R[e]}function a(e){E>>=e,y-=e}function s(e,t,n){var i,s,d;if(0===n)return 0;for(d=0;;){for(r(T),s=L.list[o(T)],i=s.e;i>16;){if(99===i)return-1;a(s.b),i-=16,r(i),s=s.t[o(i)],i=s.e}if(a(s.b),16!==i){if(15===i)break;for(r(i),I=s.n+o(i),a(i),r(C),s=x.list[o(C)],i=s.e;i>16;){if(99===i)return-1;a(s.b),i-=16,r(i),s=s.t[o(i)],i=s.e}for(a(s.b),r(i),b=m-s.n-o(i),a(i);I>0&&n>d;)I--,b&=k-1,m&=k-1,e[t+d++]=p[m++]=p[b++];if(d===n)return n}else if(m&=k-1,e[t+d++]=p[m++]=s.n,d===n)return n}return _=-1,d}function d(e,t,n){var i;if(i=7&y,a(i),r(16),i=o(16),a(16),r(16),i!==(65535&~E))return-1;for(a(16),I=i,i=0;I>0&&n>i;)I--,m&=k-1,r(8),e[t+i++]=p[m++]=o(8),a(8);return 0===I&&(_=-1),i}function c(e,t,i){if(!O){var r,o,a=[];for(r=0;144>r;r++)a[r]=8;for(null;256>r;r++)a[r]=9;for(null;280>r;r++)a[r]=7;for(null;288>r;r++)a[r]=8;if(v=7,o=new n(a,288,257,N,z,v),0!==o.status)return console.error("HufBuild error: "+o.status),-1;for(O=o.root,v=o.m,r=0;30>r;r++)a[r]=5;if(w=5,o=new n(a,30,0,$,q,w),o.status>1)return O=null,console.error("HufBuild error: "+o.status),-1;g=o.root,w=o.m}return L=O,x=g,T=v,C=w,s(e,t,i)}function l(e,t,i){var d,c,l,u,f,h,p,m,g,v=[];for(d=0;316>d;d++)v[d]=0;if(r(5),p=257+o(5),a(5),r(5),m=1+o(5),a(5),r(4),h=4+o(4),a(4),p>286||m>30)return-1;for(c=0;h>c;c++)r(3),v[j[c]]=o(3),a(3);for(null;19>c;c++)v[j[c]]=0;if(T=7,g=new n(v,19,19,null,null,T),0!==g.status)return-1;for(L=g.root,T=g.m,u=p+m,d=l=0;u>d;)if(r(T),f=L.list[o(T)],c=f.b,a(c),c=f.n,16>c)v[d++]=l=c;else if(16===c){if(r(2),c=3+o(2),a(2),d+c>u)return-1;for(;c-->0;)v[d++]=l}else if(17===c){if(r(3),c=3+o(3),a(3),d+c>u)return-1;for(;c-->0;)v[d++]=0;l=0}else{if(r(7),c=11+o(7),a(7),d+c>u)return-1;for(;c-->0;)v[d++]=0;l=0}if(T=A,g=new n(v,p,257,N,z,T),0===T&&(g.status=1),0!==g.status&&1!==g.status)return-1;for(L=g.root,T=g.m,d=0;m>d;d++)v[d]=v[d+p];return C=P,g=new n(v,m,0,$,q,C),x=g.root,C=g.m,0===C&&p>257?-1:0!==g.status?-1:s(e,t,i)}function u(){p||(p=[]),m=0,E=0,y=0,_=-1,B=!1,I=b=0,L=null}function f(e,t,n){var i,u;for(i=0;n>i;){if(B&&-1===_)return i;if(I>0){if(_!==S)for(;I>0&&n>i;)I--,b&=k-1,m&=k-1,e[t+i++]=p[m++]=p[b++];else{for(;I>0&&n>i;)I--,m&=k-1,r(8),e[t+i++]=p[m++]=o(8),a(8);0===I&&(_=-1)}if(i===n)return i}if(-1===_){if(B)break;r(1),0!==o(1)&&(B=!0),a(1),r(2),_=o(2),a(2),L=null,I=0}switch(_){case S:u=d(e,t+i,n-i);break;case M:u=L?s(e,t+i,n-i):c(e,t+i,n-i);break;case Y:u=L?s(e,t+i,n-i):l(e,t+i,n-i);break;default:u=-1}if(-1===u)return B?0:-1;i+=u}return i}function h(e){var t,n,i=[];if("string"==typeof e)for(n=e,e=[],t=0;t<n.length;t++)e[t]=n.charCodeAt(t);u(),D=e,U=0;do t=f(i,i.length,1024);while(t>0);for(D=null,n="",t=0;t<i.length;t++)n+=String.fromCharCode(i[t]);return n}var p,m,g,v,w,E,y,_,B,I,b,L,x,T,C,D,U,k=32768,S=0,M=1,Y=2,A=9,P=6,O=null,R=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],$=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.inflate=h}(),"function"!=typeof Blob||"undefined"==typeof URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},r=n.prototype,o=i.prototype,a=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},d="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=d.length,l=e.URL||e.webkitURL||e,u=l.createObjectURL,f=l.revokeObjectURL,h=l,p=e.btoa,m=e.atob,g=!1,v=function(e){g=!e},w=e.ArrayBuffer,E=e.Uint8Array;for(i.fake=o.fake=!0;c--;)s.prototype[d[c]]=c+1;try{E&&v.apply(0,new E(3528e4))}catch(y){}return l.createObjectURL||(h=e.URL={}),h.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):p?t+";base64,"+p(e.data):t+","+encodeURIComponent(e.data)):u?u.call(l,e):void 0},h.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&f&&f.call(l,e)},r.append=function(e){var n=this.data;if(E&&(e instanceof w||e instanceof E))if(g)n.push(String.fromCharCode.apply(String,new E(e)));else{for(var r="",o=new E(e),d=0,c=o.length;c>d;d++)r+=String.fromCharCode(o[d]);n.push(r)}else if("Blob"===t(e)||"File"===t(e)){if(!a)throw new s("NOT_READABLE_ERR");var l=new a;n.push(l.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&m?n.push(m(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},r.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},r.toString=function(){return"[object BlobBuilder]"},o.slice=function(e,t,n){var r=arguments.length;return 3>r&&(n=null),new i(this.data.slice(e,r>1?t:this.data.length),n,this.encoding)},o.toString=function(){return"[object Blob]"},n}(e);return function(e,n){var i=n?n.type||"":"",r=new t;if(e)for(var o=0,a=e.length;a>o;o++)r.append(e[o]);return r.getBlob(i)}}(self);var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,a=function(n){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},s=e.webkitRequestFileSystem,d=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",u=0,f=[],h=function(){for(var e=f.length;e--;){var t=f[e];"string"==typeof t?i.revokeObjectURL(t):t.remove()}f.length=0},p=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var r=e["on"+t[i]];if("function"==typeof r)try{r.call(e,n||e)}catch(o){c(o)}}},m=function(t,i){var c,h,m,g=this,v=t.type,w=!1,E=function(){var e=n().createObjectURL(t);return f.push(e),e},y=function(){p(g,"writestart progress write writeend".split(" "))},_=function(){(w||!c)&&(c=E(t)),h?h.location.href=c:window.open(c,"_blank"),g.readyState=g.DONE,y()},B=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},I={create:!0,exclusive:!1};return g.readyState=g.INIT,i||(i="download"),o?(c=E(t),r.href=c,r.download=i,a(r),g.readyState=g.DONE,void y()):(e.chrome&&v&&v!==l&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,l),w=!0),s&&"download"!==i&&(i+=".download"),(v===l||s)&&(h=e),d?(u+=t.size,void d(e.TEMPORARY,u,B(function(e){e.root.getDirectory("saved",I,B(function(e){var n=function(){e.getFile(i,I,B(function(e){e.createWriter(B(function(n){n.onwriteend=function(t){h.location.href=e.toURL(),f.push(e),g.readyState=g.DONE,p(g,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&_()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=g["on"+e]}),n.write(t),g.abort=function(){n.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),_)}),_)};e.getFile(i,{create:!1},B(function(e){e.remove(),n()}),B(function(e){e.code===e.NOT_FOUND_ERR?n():_()}))}),_)}),_)):void _())},g=m.prototype,v=function(e,t){return new m(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",h,!1),v}(self);!function(e){"use strict";function t(){}function n(){this.inputInUse=!1,this.outputInUse=!1;var e=document.createElement("object");e.id="_Jazz"+Math.random()+"ie",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",this.activeX=e;var t=document.createElement("object");t.id="_Jazz"+Math.random(),t.type="audio/x-jazz",e.appendChild(t),this.objRef=t;var n=document.createElement("p");n.appendChild(document.createTextNode("This page requires the "));var i=document.createElement("a");i.appendChild(document.createTextNode("Jazz plugin")),i.href="http://jazz-soft.net/",n.appendChild(i),n.appendChild(document.createTextNode(".")),t.appendChild(n);var r=document.getElementById("MIDIPlugin");if(!r){var r=document.createElement("div");r.id="MIDIPlugin",r.style.position="absolute",r.style.visibility="hidden",r.style.left="-9999px",r.style.top="-9999px",document.body.appendChild(r)}r.appendChild(e),this._Jazz=this.objRef.isJazz?this.objRef:this.activeX.isJazz?this.activeX:null,this._Jazz&&(this._Jazz._jazzTimeZero=this._Jazz.Time(),this._Jazz._perfTimeZero=window.performance.now())}function i(){this._jazzInstances=new Array,this._jazzInstances.push(new n),this._promise=new t,this._jazzInstances[0]._Jazz?(this._Jazz=this._jazzInstances[0]._Jazz,window.setTimeout(s.bind(this),3)):window.setTimeout(r.bind(this),3)}function r(){this._promise&&this._promise.fail({code:1})}function o(){this.jazz.MidiOutLong(this.data)}var a,i,s,d,c,l;t.prototype.then=function(e,t){this.accept=e,this.reject=t},t.prototype.succeed=function(e){this.accept&&this.accept(e)},t.prototype.fail=function(e){this.reject&&this.reject(e)},a=function(){var e=new i;return e._promise},s=function(){this._promise&&this._promise.succeed(this)},i.prototype.inputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiInList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new d(this,e[n],n);return t},i.prototype.outputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiOutList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new c(this,e[n],n);return t},d=function(e,t,i){this._listeners=[],this._midiAccess=e,this._index=i,this._inLongSysexMessage=!1,this._sysexBuffer=new Uint8Array,this.id=""+i+"."+t,this.manufacturer="",this.name=t,this.type="input",this.version="",this.onmidimessage=null;for(var r=null,o=0;o<e._jazzInstances.length&&!r;o++)e._jazzInstances[o].inputInUse||(r=e._jazzInstances[o]);r||(r=new n,e._jazzInstances.push(r)),r.inputInUse=!0,this._jazzInstance=r._Jazz,this._input=this._jazzInstance.MidiInOpen(this._index,l.bind(this))},d.prototype.addEventListener=function(e,t,n){if("midimessage"===e){for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]==t)return;this._listeners.push(t)}},d.prototype.removeEventListener=function(e,t,n){if("midimessage"===e)for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]==t)return void this._listeners.splice(i,1)},d.prototype.preventDefault=function(){this._pvtDef=!0},d.prototype.dispatchEvent=function(e){this._pvtDef=!1;for(var t=0;t<this._listeners.length;t++)this._listeners[t].handleEvent?this._listeners[t].handleEvent.bind(this)(e):this._listeners[t].bind(this)(e);return this.onmidimessage&&this.onmidimessage(e),this._pvtDef},d.prototype.appendToSysexBuffer=function(e){var t=this._sysexBuffer.length,n=new Uint8Array(t+e.length);n.set(this._sysexBuffer),n.set(e,t),this._sysexBuffer=n},d.prototype.bufferLongSysex=function(e,t){for(var n=t;n<e.length;){if(247==e[n])return n++,this.appendToSysexBuffer(e.slice(t,n)),n;n++}return this.appendToSysexBuffer(e.slice(t,n)),this._inLongSysexMessage=!0,n},l=function(e,t){var n,i=0,r=!1;for(n=0;n<t.length;n+=i){if(this._inLongSysexMessage){if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;r=!0}else switch(r=!1,240&t[n]){case 128:case 144:case 160:case 176:case 224:i=3;break;case 192:case 208:i=2;break;case 240:switch(t[n]){case 240:if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;r=!0;break;case 241:case 243:i=2;break;case 242:i=3;break;default:i=1}}var o=document.createEvent("Event");o.initEvent("midimessage",!1,!1),o.receivedTime=parseFloat(e.toString())+this._jazzInstance._perfTimeZero,r||this._inLongSysexMessage?(o.data=new Uint8Array(this._sysexBuffer),this._sysexBuffer.length=0,this._inLongSysexMessage=!1):o.data=new Uint8Array(t.slice(n,i+n)),this.dispatchEvent(o)}},c=function(e,t,i){this._listeners=[],this._midiAccess=e,this._index=i,this.id=""+i+"."+t,this.manufacturer="",this.name=t,this.type="output",this.version="";for(var r=null,o=0;o<e._jazzInstances.length&&!r;o++)e._jazzInstances[o].outputInUse||(r=e._jazzInstances[o]);r||(r=new n,e._jazzInstances.push(r)),r.outputInUse=!0,this._jazzInstance=r._Jazz,this._jazzInstance.MidiOutOpen(this.name)},c.prototype.send=function(e,t){var n=0;if(0===e.length)return!1;if(t&&(n=Math.floor(t-window.performance.now())),t&&n>1){var i=new Object;i.jazz=this._jazzInstance,i.data=e,window.setTimeout(o.bind(i),n)}else this._jazzInstance.MidiOutLong(e);return!0},window.navigator.requestMIDIAccess||(window.navigator.requestMIDIAccess=a)}(window),function(e){function t(){for(var t=["moz","webkit","o","ms"],n=t.length,i={value:function(e){return function(){return Date.now()-e}}(Date.now())};n>=0;n--)if(t[n]+"Now"in e.performance)return i.value=function(t){return function(){e.performance[t]()}}(t[n]+"Now"),i;return"timing"in e.performance&&"connectStart"in e.performance.timing&&(i.value=function(e){return function(){Date.now()-e}}(e.performance.timing.connectStart)),i}var n,i={};"performance"in e&&"now"in e.performance||("performance"in e||Object.defineProperty(e,"performance",{get:function(){return i}}),n=t(),Object.defineProperty(e.performance,"now",n))}(window);var CBinParser=function(e){var t=e,n=0;this.getUBYTE=function(){return 255&t.charCodeAt(n++)},this.getUSHORT=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8;return n+=2,e},this.getULONG=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;return n+=4,e},this.getFLOAT=function(){var e=this.getULONG();if(0==e)return 0;var t=2147483648&e,n=e>>23&255,i=1+(8388607&e)/8388608,r=i*Math.pow(2,n-127);return t?-r:r},this.getTail=function(){var e=t.slice(n);return n=t.length,e}},CBinWriter=function(){var e="";this.putUBYTE=function(t){e+=String.fromCharCode(t)},this.putUSHORT=function(t){e+=String.fromCharCode(255&t,t>>8&255)},this.putULONG=function(t){e+=String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},this.putFLOAT=function(e){var t=0;if(0!=e){var n=0;0>e&&(n=2147483648,e=-e);for(var i=150;8388608>e;)e*=2,i--;for(;e>=16777216;)e/=2,i++;t=n|(255&i)<<23|8388607&e}this.putULONG(t)},this.append=function(t){e+=t},this.getData=function(){return e}},CAudioTimer=function(){var e=null,t=0,n=[0,0,0,0,0,0],i=0;this.setAudioElement=function(t){e=t},this.currentTime=function(){if(!e)return 0;var r,o=.001*(new Date).getTime(),a=o-t,s=e.currentTime,d=s-a;if(.01>s||d>.2||-.2>d)for(a=s,t=o-a,r=0;r<n.length;r++)n[r]=0;var c=0;for(r=0;r<n.length;r++)c+=n[r];return c/=n.length,n[i]=d,i=(i+1)%n.length,a+c},this.reset=function(){t=.001*(new Date).getTime();for(var e=0;e<n.length;e++)n[e]=0}},CGUI=function(){var e,t,n,i,r,o="tracker/image/gui/",a=0,s=1,d=2,c=3,l=128,u=36,f=d,h=5,p=0,m=0,g=0,v=0,w=0,E=0,y=0,_=0,B=0,I=0,b=!1,L=!1,x=!1,T=[],C=[],D=[],U=[],k={},S=null,M=new CAudioTimer,Y=new CPlayer,A=new Image,P=new Image,O=new Image,R=new CJammer,N=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],z=[26,1,63,3,116,6,150,8,184,10,238,13,274,15,327,18,362,20,394,22],q=[],j=function(e){var t=e.indexOf("?");return e.slice(0,t>=0?t:e.length)},H=function(e){var t=e.indexOf("?")+1,n=e.indexOf("#")+1||e.length+1,i=e.slice(t,n-1),r={};if(i===e||""===i)return r;for(var o=i.replace(/\+/g," ").split("&"),a=0;a<o.length;a++){var s=o[a].split("="),d=decodeURIComponent(s[0]),c=decodeURIComponent(s[1]);d in r||(r[d]=[]),r[d].push(2===s.length?c:null)}return r},F=function(e){var t=void 0;if(e){var n=e,i="";if(0==n.indexOf("data:")){var r=n.indexOf("base64,");r>0&&(i=n.substr(r+7))}else for(var o=0;o<n.length;++o){var a=n[o];"-"===a&&(a="+"),"_"===a&&(a="/"),i+=a}try{t=atob(i)}catch(s){t=void 0}}return t},X=function(t){for(var n=btoa(t),i="",r=0;r<n.length;++r){var o=n[r];"+"===o&&(o="-"),"/"===o&&(o="_"),"="===o&&(o=""),i+=o}return e+"?data="+i},W=function(e){return Math.round(661500/e)},J=function(){return Math.round(661500/k.rowLen)},G=0,V=1,Q=2,Z=3,K=4,ee=5,te=6,ne=7,ie=8,re=9,oe=10,ae=11,se=12,de=13,ce=14,le=15,ue=16,fe=17,he=18,pe=19,me=20,ge=21,ve=22,we=23,Ee=24,ye=25,_e=function(){var e,t,n,i,r,o={};o.rowLen=W(120),o.endPattern=2,o.patternLen=32;var a;for(e=0;e<gInstrumentPresets.length;++e)if(gInstrumentPresets[e].i){a=gInstrumentPresets[e];break}for(o.songData=[],e=0;8>e;e++){for(i={},i.i=[],t=0;t<=a.i.length;++t)i.i[t]=a.i[t];for(i.p=[],t=0;l>t;t++)i.p[t]=0;for(i.c=[],t=0;u>t;t++){for(r={},r.n=[],n=0;n<4*o.patternLen;n++)r.n[n]=0;for(r.f=[],n=0;n<2*o.patternLen;n++)r.f[n]=0;i.c[t]=r}o.songData[e]=i}return o.songData[0].p[0]=1,o},Be=function(e){var t=new CBinWriter;t.putULONG(e.rowLen),t.putUBYTE(e.endPattern-2),t.putUBYTE(e.patternLen);var n,i,r,o,a;for(n=0;8>n;n++){for(o=e.songData[n],t.putUBYTE(o.i[G]),t.putUBYTE(o.i[V]),t.putUBYTE(o.i[Q]),t.putUBYTE(o.i[Z]),t.putUBYTE(o.i[K]),t.putUBYTE(o.i[ee]),t.putUBYTE(o.i[te]),t.putUBYTE(o.i[ne]),t.putUBYTE(o.i[ie]),t.putUBYTE(o.i[re]),t.putUBYTE(o.i[oe]),t.putUBYTE(o.i[ae]),t.putUBYTE(o.i[se]),t.putUBYTE(o.i[de]),t.putUBYTE(o.i[ce]),t.putUBYTE(o.i[le]),t.putUBYTE(o.i[ue]),t.putUBYTE(o.i[fe]),t.putUBYTE(o.i[he]),t.putUBYTE(o.i[pe]),t.putUBYTE(o.i[me]),t.putUBYTE(o.i[ge]),t.putUBYTE(o.i[ve]),t.putUBYTE(o.i[we]),t.putUBYTE(o.i[Ee]),t.putUBYTE(o.i[ye]),i=0;l>i;i++)t.putUBYTE(o.p[i]);for(i=0;u>i;i++){for(a=o.c[i],r=0;r<4*e.patternLen;r++)t.putUBYTE(a.n[r]);for(r=0;r<2*e.patternLen;r++)t.putUBYTE(a.f[r])}}var s,d,c=t.getData(),f=0;for(n=9;n>0;n--)if(s=RawDeflate.deflate(c,n),d=RawDeflate.inflate(s),c===d){f=2;break}return 0==f&&(s=rle_encode(t.getData()),d=rle_decode(s),c===d?f=1:s=c),t=new CBinWriter,t.putULONG(2020557395),t.putUBYTE(10),t.putUBYTE(f),t.append(s),t.getData()},Ie=function(e){var t=new CBinParser(e),n={},i=t.getULONG(),r=t.getUBYTE();if(2020557395!=i||1>r||r>10)return void 0;if(r>=8){var o,a=t.getUBYTE(),s=t.getTail();switch(a){default:case 0:o=s;break;case 1:o=rle_decode(s);break;case 2:o=RawDeflate.inflate(s)}t=new CBinParser(o)}n.rowLen=t.getULONG(),n.endPattern=t.getUBYTE()+2,n.patternLen=r>=10?t.getUBYTE():32,n.songData=[];var d,c,f,h,p;for(d=0;8>d;d++){h={},h.i=[],6>r?(h.i[Q]=t.getUBYTE(),h.i[Z]=t.getUBYTE(),h.i[V]=t.getUBYTE(),h.i[G]=t.getUBYTE()):(h.i[G]=t.getUBYTE(),h.i[V]=t.getUBYTE(),h.i[Q]=t.getUBYTE(),h.i[Z]=t.getUBYTE()),6>r?(h.i[te]=t.getUBYTE(),h.i[ne]=t.getUBYTE(),h.i[ie]=t.getUBYTE(),h.i[ee]=t.getUBYTE(),h.i[K]=t.getUBYTE()):(h.i[K]=t.getUBYTE(),h.i[ee]=t.getUBYTE(),h.i[te]=t.getUBYTE(),h.i[ne]=t.getUBYTE(),h.i[ie]=t.getUBYTE()),h.i[re]=t.getUBYTE(),5>r?(h.i[oe]=Math.round(Math.sqrt(t.getULONG())/2),h.i[ae]=Math.round(Math.sqrt(t.getULONG())/2),h.i[se]=Math.round(Math.sqrt(t.getULONG())/2)):(h.i[oe]=t.getUBYTE(),h.i[ae]=t.getUBYTE(),h.i[se]=t.getUBYTE()),6>r?(h.i[fe]=t.getUBYTE(),h.i[he]=5>r?Math.round(t.getUSHORT()/43.23529):t.getUBYTE(),h.i[pe]=t.getUBYTE(),h.i[ye]=t.getUBYTE(),h.i[Ee]=t.getUBYTE(),h.i[we]=t.getUBYTE(),h.i[ve]=t.getUBYTE(),h.i[me]=t.getUBYTE(),h.i[ge]=t.getUBYTE(),h.i[ue]=t.getUBYTE(),h.i[le]=t.getUBYTE(),h.i[ce]=t.getUBYTE(),h.i[de]=t.getUBYTE()):(h.i[de]=t.getUBYTE(),h.i[ce]=t.getUBYTE(),h.i[le]=t.getUBYTE(),h.i[ue]=t.getUBYTE(),h.i[fe]=t.getUBYTE(),h.i[he]=t.getUBYTE(),h.i[pe]=t.getUBYTE(),h.i[me]=t.getUBYTE(),h.i[ge]=t.getUBYTE(),h.i[ve]=t.getUBYTE(),h.i[we]=t.getUBYTE(),h.i[Ee]=t.getUBYTE(),h.i[ye]=t.getUBYTE());var m=9>r?48:l;for(h.p=[],c=0;m>c;c++)h.p[c]=t.getUBYTE();for(c=m;l>c;c++)h.p[c]=0;var g=9>r?10:u;for(h.c=[],c=0;g>c;c++){if(p={},p.n=[],1==r)for(f=0;f<n.patternLen;f++)p.n[f]=t.getUBYTE(),p.n[f+n.patternLen]=0,p.n[f+2*n.patternLen]=0,p.n[f+3*n.patternLen]=0;else for(f=0;f<4*n.patternLen;f++)p.n[f]=t.getUBYTE();if(p.f=[],4>r)for(f=0;f<2*n.patternLen;f++)p.f[f]=0;else for(f=0;f<2*n.patternLen;f++)p.f[f]=t.getUBYTE();h.c[c]=p}for(c=g;u>c;c++){for(p={},p.n=[],f=0;f<4*n.patternLen;f++)p.n[f]=0;for(p.f=[],f=0;f<2*n.patternLen;f++)p.f[f]=0;h.c[c]=p}3>r&&(2==h.i[G]&&(h.i[V]=Math.round(h.i[V]/2)),2==h.i[K]&&(h.i[ee]=Math.round(h.i[ee]/2)),2==h.i[de]&&(h.i[ce]=Math.round(h.i[ce]/2)),h.i[ge]=h.i[ge]<224?h.i[ge]+32:255),7>r&&(h.i[pe]=255-h.i[pe]),n.songData[d]=h}return n},be=function(e){if(3333!=e.length)return void 0;if((255&e.charCodeAt(3332))>48)return void 0;var t=new CBinParser(e),n={};n.rowLen=t.getULONG(),n.patternLen=32,n.songData=[];var i,r,o,a,s,d;for(i=0;8>i;i++){for(a={},a.i=[],a.i[Q]=12*(t.getUBYTE()-8)+128,a.i[Q]+=t.getUBYTE(),t.getUBYTE(),a.i[Z]=t.getUBYTE(),a.i[V]=t.getUBYTE(),a.i[G]=t.getUBYTE(),a.i[te]=12*(t.getUBYTE()-8)+128,a.i[te]+=t.getUBYTE(),a.i[ne]=t.getUBYTE(),a.i[ie]=t.getUBYTE(),a.i[ee]=t.getUBYTE(),a.i[K]=t.getUBYTE(),a.i[re]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),a.i[oe]=Math.round(Math.sqrt(t.getULONG())/2),a.i[ae]=Math.round(Math.sqrt(t.getULONG())/2),a.i[se]=Math.round(Math.sqrt(t.getULONG())/2),d=t.getUBYTE(),a.i[fe]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),a.i[he]=Math.round(t.getFLOAT()/43.23529),a.i[pe]=255-t.getUBYTE(),a.i[ye]=t.getUBYTE(),a.i[Ee]=t.getUBYTE(),a.i[we]=t.getUBYTE(),a.i[ve]=t.getUBYTE(),a.i[me]=0,a.i[ge]=32,t.getUBYTE(),a.i[ue]=t.getUBYTE(),a.i[le]=t.getUBYTE(),a.i[ce]=t.getUBYTE(),a.i[de]=t.getUBYTE(),a.p=[],r=0;48>r;r++)a.p[r]=t.getUBYTE();for(r=48;l>r;r++)a.p[r]=0;for(a.c=[],r=0;10>r;r++){for(s={},s.n=[],o=0;32>o;o++)s.n[o]=t.getUBYTE(),s.n[o+32]=0,s.n[o+64]=0,s.n[o+96]=0;for(s.f=[],o=0;64>o;o++)s.f[o]=0;a.c[r]=s}for(r=10;u>r;r++){for(s={},s.n=[],o=0;128>o;o++)s.n[o]=0;for(s.f=[],o=0;64>o;o++)s.f[o]=0;a.c[r]=s}t.getUBYTE(),t.getUBYTE(),(a.i[fe]<1||a.i[fe]>3)&&(a.i[fe]=2,a.i[he]=255),a.i[V]*=d/255,a.i[ee]*=d/255,a.i[re]*=d/255,2==a.i[G]&&(a.i[V]/=2),2==a.i[K]&&(a.i[ee]/=2),2==a.i[de]&&(a.i[ce]/=2),a.i[V]=Math.round(a.i[V]),a.i[ee]=Math.round(a.i[ee]),a.i[re]=Math.round(a.i[re]),a.i[ce]=Math.round(a.i[ce]),n.songData[i]=a}return n.endPattern=t.getUBYTE()+2,n},Le=function(e){var t=Ie(e);return t||(t=be(e)),t?t:void alert("Song format not recognized.")},xe=function(e){var t,n,i,r,o="";for(o+="    // This music has been exported by SoundBox. You can use it with\n",o+="    // http://sb.bitsnbites.eu/player-small.js in your own product.\n\n",o+="    // See http://sb.bitsnbites.eu/demo.html for an example of how to\n",o+="    // use it in a demo.\n\n",o+="    // Song data\n",o+="    var song = {\n",o+="      songData: [\n",t=0;8>t;t++){var a=e.songData[t];o+="        { // Instrument "+t+"\n",o+="          i: [\n",o+="          "+a.i[G]+", // OSC1_WAVEFORM\n",o+="          "+a.i[V]+", // OSC1_VOL\n",o+="          "+a.i[Q]+", // OSC1_SEMI\n",o+="          "+a.i[Z]+", // OSC1_XENV\n",o+="          "+a.i[K]+", // OSC2_WAVEFORM\n",o+="          "+a.i[ee]+", // OSC2_VOL\n",o+="          "+a.i[te]+", // OSC2_SEMI\n",o+="          "+a.i[ne]+", // OSC2_DETUNE\n",o+="          "+a.i[ie]+", // OSC2_XENV\n",o+="          "+a.i[re]+", // NOISE_VOL\n",o+="          "+a.i[oe]+", // ENV_ATTACK\n",o+="          "+a.i[ae]+", // ENV_SUSTAIN\n",o+="          "+a.i[se]+", // ENV_RELEASE\n",o+="          "+a.i[de]+", // LFO_WAVEFORM\n",o+="          "+a.i[ce]+", // LFO_AMT\n",o+="          "+a.i[le]+", // LFO_FREQ\n",o+="          "+a.i[ue]+", // LFO_FX_FREQ\n",o+="          "+a.i[fe]+", // FX_FILTER\n",o+="          "+a.i[he]+", // FX_FREQ\n",o+="          "+a.i[pe]+", // FX_RESONANCE\n",o+="          "+a.i[me]+", // FX_DIST\n",o+="          "+a.i[ge]+", // FX_DRIVE\n",o+="          "+a.i[ve]+", // FX_PAN_AMT\n",o+="          "+a.i[we]+", // FX_PAN_FREQ\n",o+="          "+a.i[Ee]+", // FX_DELAY_AMT\n",o+="          "+a.i[ye]+" // FX_DELAY_TIME\n",o+="          ],\n",o+="          // Patterns\n",o+="          p: [";var s=e.endPattern-2,d=0,c=0;for(n=0;s>=n;n++)r=a.p[n],r>d&&(d=r),r&&(c=n);for(n=0;c>=n;n++)r=a.p[n],r&&(o+=r),c>n&&(o+=",");for(o+="],\n",o+="          // Columns\n",o+="          c: [\n",n=0;d>n;n++){for(o+="            {n: [",c=0,i=0;i<4*e.patternLen;i++)a.c[n].n[i]&&(c=i);for(i=0;c>=i;i++){var l=a.c[n].n[i];l&&(o+=l),c>i&&(o+=",")}for(o+="],\n",o+="             f: [",c=0,i=0;i<2*e.patternLen;i++)a.c[n].f[i]&&(c=i);for(i=0;c>=i;i++){var u=a.c[n].f[i];u&&(o+=u),c>i&&(o+=",")}o+="]}",d-1>n&&(o+=","),o+="\n"}o+="          ]\n",o+="        }",7>t&&(o+=","),o+="\n"}return o+="      ],\n",o+="      rowLen: "+e.rowLen+",   // In sample lengths\n",o+="      patternLen: "+e.patternLen+",  // Rows per pattern\n",o+="      endPattern: "+e.endPattern+"  // End pattern\n",o+="    };\n"},Te=function(e){var t=e.data[0]>>4,n=15&e.data[0],i=e.data[1],r=e.data[2];9!=n&&9==t&&r>0&&Ve(i-12)},Ce=function(e){r=i.inputs()[n.selectedIndex],r.onmidimessage=Te},De=function(e){i=e;var t,o="function"==typeof i.inputs?i.inputs():[],a=0;for(t=0;t<o.length;t++){var s=o[t].name.toString().toLowerCase();if(-1!=s.indexOf("keyboard")){a=t;break}}if(n.options.length=0,o.length){for(t=0;t<o.length;t++)n.options[t]=new Option(o[t].name,o[t].fingerprint,t==a,t==a);r=o[a],r.onmidimessage=Te,n.onchange=Ce,n.style.display="inline"}},Ue=function(e){},ke=function(){navigator.requestMIDIAccess&&(n=document.getElementById("midiInput"),
navigator.requestMIDIAccess().then(De,Ue))},Se=function(e){var t=new Image;t.src=e,q.push(t)},Me=function(){for(var e,t,n=document.getElementById("instrPreset"),i=0;i<gInstrumentPresets.length;++i)t=gInstrumentPresets[i],e=document.createElement("option"),e.value=t.i?""+i:"",e.appendChild(document.createTextNode(t.name)),n.appendChild(e)},Ye=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},Ae=function(e){var t=null;return e||(e=window.event),e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t},Pe=function(e,t){var n=[0,0];if(e.pageX&&e.pageY?n=[e.pageX,e.pageY]:e.clientX&&e.clientY?n=[e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.clientY+document.body.scrollTop+document.documentElement.scrollTop]:e.touches&&e.touches.length>0&&(n=[e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop]),!t)return n;var i=Ye(Ae(e));return[n[0]-i[0],n[1]-i[1]]},Oe=function(){document.getElementById("bpm").blur(),document.getElementById("rpp").blur(),document.getElementById("instrPreset").blur()},Re=function(e){e!==f&&(f=e,document.getElementById("sequencer").className=f==s?"edit":"",document.getElementById("pattern").className=f==d?"edit":"",document.getElementById("fxtrack").className=f==c?"edit":"",f!=a&&(Oe(),tt(),it()))},Ne=function(){document.getElementById("bpm").value=J(),document.getElementById("rpp").value=k.patternLen},ze=function(e,t){for(var n,i=0;l>i;++i)for(var r=0;8>r;++r){if(n=document.getElementById("sc"+r+"r"+i),!t){var o=k.songData[r].p[i];n.innerHTML=o>0?""+(10>=o?o-1:String.fromCharCode(64+o-10)):""}n.className=i>=E&&_>=i&&r>=w&&y>=r?"selected":""}if(e&&(n=document.getElementById("spr"+E),n.scrollIntoView)){var a=document.getElementById("sequencer"),s=n.offsetTop-a.scrollTop;(0>s||s+10>a.offsetHeight)&&n.scrollIntoView(0>s)}},$e=function(e,t){Un();for(var n,i=w==y&&E==_,r=i?k.songData[w].p[E]-1:-1,o=0;o<k.patternLen;++o)for(var a=0;4>a;++a){if(n=document.getElementById("pc"+a+"r"+o),!t){var s="";if(r>=0){var d=k.songData[w].c[r].n[o+a*k.patternLen]-87;d>0&&(s=N[d%12]+Math.floor(d/12))}n.innerHTML!=s&&(n.innerHTML=s)}n.className=o>=m&&v>=o&&a>=p&&g>=a?"selected":""}if(e&i&&(n=document.getElementById("pc0r"+m),n.scrollIntoView)){var c=document.getElementById("pattern"),l=n.offsetTop-c.scrollTop;(0>l||l+10>c.offsetHeight)&&n.scrollIntoView(0>l)}},qe=function(e,t){for(var n=e.toString(16).toUpperCase(),i=t-n.length,r=0;i>r;++r)n="0"+n;return n},je=function(e,t){kn();for(var n,i=w==y&&E==_,r=i?k.songData[w].p[E]-1:-1,o=0;o<k.patternLen;++o){if(n=document.getElementById("fxr"+o),!t){var a=":";if(r>=0){var s=k.songData[w].c[r].f[o];if(s){var d=k.songData[w].c[r].f[o+k.patternLen];a=qe(s,2)+":"+qe(d,2)}}n.innerHTML!=a&&(n.innerHTML=a)}n.className=o>=B&&I>=o?"selected":""}if(e&i&&(n=document.getElementById("fxr"+B),n.scrollIntoView)){var c=document.getElementById("fxtrack"),l=n.offsetTop-c.scrollTop;(0>l||l+10>c.offsetHeight)&&n.scrollIntoView(0>l)}},He=function(e,t){p=e,m=t,g=e,v=t;for(var n=0;n<k.patternLen;++n)for(var i=0;4>i;++i){var r=document.getElementById("pc"+i+"r"+n);r.className=n==t&&i==e?"selected":""}$e(!0,!0)},Fe=function(e,t){g=e>=p?e:p,v=t>=m?t:m;for(var n=0;n<k.patternLen;++n)for(var i=0;4>i;++i){var r=document.getElementById("pc"+i+"r"+n);r.className=n>=m&&v>=n&&i>=p&&g>=i?"selected":""}$e(!1,!0)},Xe=function(e,t){w=e,E=t,y=e,_=t,ze(!0,!0)},We=function(e,t){y=e>=w?e:w,_=t>=E?t:E,ze(!1,!0)},Je=function(e){B=e,I=e;for(var t=0;t<k.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=B&&I>=t?"selected":""}je(!0,!0)},Ge=function(e){I=e>=B?e:B;for(var t=0;t<k.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=B&&I>=t?"selected":""}je(!1,!0)},Ve=function(e){var t=e+87;if(R.addNote(t),f==d&&w==y&&E==_&&p==g&&m==v){var n=k.songData[w].p[E]-1;if(n>=0)return k.songData[w].c[n].n[m+p*k.patternLen]=t,He(p,(m+1)%k.patternLen),$e(),!0}return!1},Qe=function(e,t,n){var i=e.sliderProps,r=(t-i.min)/(i.max-i.min);r=0>r?0:r>1?1:r,i.nonLinear&&(r=Math.sqrt(r)),n||(e.value=t)},Ze=function(e,t){e.src=t?o+"box-check.png":o+"box-uncheck.png"},Ke=function(){var e=document.getElementById("instrPreset");e.selectedIndex=0},et=function(e){var t=k.songData[w];document.getElementById("osc1_wave_sin").src=0==t.i[G]?o+"wave-sin-sel.png":o+"wave-sin.png",document.getElementById("osc1_wave_sqr").src=1==t.i[G]?o+"wave-sqr-sel.png":o+"wave-sqr.png",document.getElementById("osc1_wave_saw").src=2==t.i[G]?o+"wave-saw-sel.png":o+"wave-saw.png",document.getElementById("osc1_wave_tri").src=3==t.i[G]?o+"wave-tri-sel.png":o+"/wave-tri.png",Qe(document.getElementById("osc1_vol"),t.i[V]),Qe(document.getElementById("osc1_semi"),t.i[Q]),Ze(document.getElementById("osc1_xenv"),t.i[Z]),document.getElementById("osc2_wave_sin").src=0==t.i[K]?o+"wave-sin-sel.png":o+"wave-sin.png",document.getElementById("osc2_wave_sqr").src=1==t.i[K]?o+"wave-sqr-sel.png":o+"wave-sqr.png",document.getElementById("osc2_wave_saw").src=2==t.i[K]?o+"wave-saw-sel.png":o+"wave-saw.png",document.getElementById("osc2_wave_tri").src=3==t.i[K]?o+"wave-tri-sel.png":o+"wave-tri.png",Qe(document.getElementById("osc2_vol"),t.i[ee]),Qe(document.getElementById("osc2_semi"),t.i[te]),Qe(document.getElementById("osc2_det"),t.i[ne]),Ze(document.getElementById("osc2_xenv"),t.i[ie]),Qe(document.getElementById("noise_vol"),t.i[re]),Qe(document.getElementById("env_att"),t.i[oe]),Qe(document.getElementById("env_sust"),t.i[ae]),Qe(document.getElementById("env_rel"),t.i[se]),document.getElementById("lfo_wave_sin").src=0==t.i[de]?o+"wave-sin-sel.png":o+"wave-sin.png",document.getElementById("lfo_wave_sqr").src=1==t.i[de]?o+"wave-sqr-sel.png":o+"wave-sqr.png",document.getElementById("lfo_wave_saw").src=2==t.i[de]?o+"wave-saw-sel.png":o+"wave-saw.png",document.getElementById("lfo_wave_tri").src=3==t.i[de]?o+"wave-tri-sel.png":o+"wave-tri.png",Qe(document.getElementById("lfo_amt"),t.i[ce]),Qe(document.getElementById("lfo_freq"),t.i[le]),Ze(document.getElementById("lfo_fxfreq"),t.i[ue]),document.getElementById("fx_filt_lp").src=2==t.i[fe]?o+"filt-lp-sel.png":o+"filt-lp.png",document.getElementById("fx_filt_hp").src=1==t.i[fe]?o+"filt-hp-sel.png":o+"filt-hp.png",document.getElementById("fx_filt_bp").src=3==t.i[fe]?o+"filt-bp-sel.png":o+"filt-bp.png",Qe(document.getElementById("fx_freq"),t.i[he]),Qe(document.getElementById("fx_res"),t.i[pe]),Qe(document.getElementById("fx_dly_amt"),t.i[Ee]),Qe(document.getElementById("fx_dly_time"),t.i[ye]),Qe(document.getElementById("fx_pan_amt"),t.i[ve]),Qe(document.getElementById("fx_pan_freq"),t.i[we]),Qe(document.getElementById("fx_dist"),t.i[me]),Qe(document.getElementById("fx_drive"),t.i[ge]),e&&Ke(),R.updateInstr(t.i)},tt=function(){var e=parseInt(document.getElementById("bpm").value);e&&e>=10&&1e3>=e&&(k.rowLen=W(e),R.updateRowLen(k.rowLen))},nt=function(e){if(k.patternLen!==e){yt();var t,n,i,r,o,a;for(t=0;8>t;t++)for(n=0;u>n;n++){for(r=k.songData[t].c[n],o=[],a=[],i=0;4*e>i;i++)o[i]=0;for(i=0;2*e>i;i++)a[i]=0;for(i=0;i<Math.min(k.patternLen,e);i++)o[i]=r.n[i],o[i+e]=r.n[i+k.patternLen],o[i+2*e]=r.n[i+2*k.patternLen],o[i+3*e]=r.n[i+3*k.patternLen],a[i]=r.f[i],a[i+e]=r.f[i+k.patternLen];r.n=o,r.f=a}k.patternLen=e}},it=function(){var e=parseInt(document.getElementById("rpp").value);e&&e>=1&&256>=e&&(nt(e),Un(),kn(),$e(),je())},rt=function(){var e,t,n;for(k.endPattern=l+1,e=l-1;e>=0;--e){for(n=!0,t=0;8>t;++t)if(k.songData[t].p[e]>0){n=!1;break}if(!n)break;k.endPattern--}tt()},ot=function(){var e=document.getElementById("cover");e.style.visibility="visible",e=document.getElementById("dialog"),e.style.visibility="visible",xn()},at=function(){var e=document.getElementById("cover");e.style.visibility="hidden",e=document.getElementById("dialog"),e.style.visibility="hidden",Ln()},st=function(e){var t=document.getElementById("dialog");t.innerHTML="";var n,i;n=document.createElement("img"),n.src=o+"progress.gif",t.appendChild(n),n=document.createTextNode(e),t.appendChild(n),n=document.createElement("div"),n.id="progressBarParent",t.appendChild(n),i=document.createElement("div"),i.id="progressBar",n.appendChild(i),ot()},dt=function(e){var t=Le(e);t&&(yt(),k=t,Ne(),ze(),$e(),je(),et(!0))},ct=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("h3"),t.appendChild(document.createTextNode("Open song")),e.appendChild(t),e.appendChild(document.createElement("br"));var n=document.createElement("form"),i=document.createElement("div");i.style.textAlign="left",i.style.marginLeft="30px",i.style.lineHeight="1.8em";for(var r=[],o=0;o<gDemoSongs.length;o++)t=document.createElement("input"),t.type="radio",t.name="radiogroup1",t.value=gDemoSongs[o].name,0===o&&(t.checked=!0),r.push(t),i.appendChild(t),t=document.createElement("span"),t.innerHTML=gDemoSongs[o].description,i.appendChild(t),i.appendChild(document.createElement("br"));var a=document.createElement("input");a.type="radio",a.name="radiogroup1",a.value="custom",i.appendChild(a),i.appendChild(document.createTextNode(" Data URL: "));var s=document.createElement("input");s.type="text",s.size="45",s.title="Paste a saved song data URL here",s.onchange=function(){a.checked=!0},s.onkeydown=s.onchange,s.onclick=s.onchange,i.appendChild(s),n.appendChild(i),t=document.createElement("p"),t.appendChild(document.createTextNode("Hint: You can also drag'n'drop binary files into the editor.")),n.appendChild(t),n.appendChild(document.createElement("br")),t=document.createElement("input"),t.type="submit",t.value="Open",t.title="Open song",t.onclick=function(e){e.preventDefault();var t=null;if(a.checked){var n=H(s.value);t=F(n&&n.data&&n.data[0])}else for(var i=0;i<r.length;i++)if(e=r[i],e.checked){for(var o=0;o<gDemoSongs.length;o++)if(gDemoSongs[o].name===e.value){t=gDemoSongs[o].data?gDemoSongs[o].data:F(gDemoSongs[o].base64);break}break}t&&dt(t),at()},n.appendChild(t),n.appendChild(document.createTextNode(" ")),t=document.createElement("input"),t.type="submit",t.value="Cancel",t.onclick=function(){return at(),!1},n.appendChild(t),e.appendChild(n),ot()},lt=function(){var e=document.getElementById("dialog");e.innerHTML="";var t,n;t=document.createElement("h3"),t.appendChild(document.createTextNode("Save song")),e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("Data URL (copy/paste, bookmark, mail etc):")),e.appendChild(t),t=document.createElement("p"),n=document.createElement("a");var i=X(Be(k)),r=i.length<70?i:i.slice(0,67)+"...";n.href=i,n.title=i,n.appendChild(document.createTextNode(r)),t.appendChild(n),e.appendChild(t);var o=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Save binary",t.title="Save the song as a binary file.",t.onclick=function(){var e="data:application/octet-stream;base64,"+btoa(Be(k));return window.open(e),at(),!1},o.appendChild(t),t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return at(),!1},o.appendChild(t),e.appendChild(o),ot()},ut=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("img"),t.src=o+"logo-big.png",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("an HTML5 synth music tracker")),e.appendChild(t),t=document.createElement("p"),t.innerHTML='Licensed under the <a href="LICENSE">GPL v3</a> license (get the <a href="http://gitorious.org/soundbox/soundbox">source</a>).',t.style.fontStyle="italic",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("To get started, open a demo song.")),e.appendChild(t),t=document.createElement("a"),t.href="help.html",t.appendChild(document.createTextNode("Help")),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createElement("br"));var n=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return at(),!1},n.appendChild(t),e.appendChild(n),ot()},ft=function(e){e.preventDefault(),ut()},ht=function(e){return k=_e(),Ne(),ze(),$e(),je(),et(),Re(d),He(0,0),Xe(0,0),Je(0),!1},pt=function(e){e.preventDefault(),ct()},mt=function(e){rt(),lt(),e.preventDefault()},gt=function(e){e.preventDefault(),rt();var t=function(e){var t=new Blob([e],{type:"application/octet-stream"});saveAs(t,"SoundBox-music.wav")};Et(t)},vt=function(e){rt();var t="data:text/javascript;base64,"+btoa(xe(k));return window.open(t),!1},wt=function(e){document.getElementById("statusText").innerHTML=e},Et=function(e,t){st("Generating sound...");var n=new Date;Y=new CPlayer,Y.generate(k,t,function(t){var i=document.getElementById("progressBar");if(i.style.width=Math.floor(200*t)+"px",t>=1){var r=Y.createWave(),o=new Date;wt("Generation time: "+(o.getTime()-n.getTime())/1e3+"s"),at(),e(r)}})},yt=function(){Mt(),S&&(S.pause(),M.reset())},_t=-1,Bt=0,It=0,bt=0,Lt=0,xt=!1,Tt=0,Ct=0,Dt=function(e,t){for(var n=44100*e/k.rowLen,i=Math.floor(n),r=Math.floor(i/k.patternLen)+Bt,o=i%k.patternLen,a=0;a<k.patternLen;++a){for(var s=r,d=o-a;0>d;){if(--s,Bt>s)return-1;d+=k.patternLen}for(var c=k.songData[t].p[s]-1,l=0;4>l;l++)if(c>=0&&k.songData[t].c[c].n[d+l*k.patternLen]>0)return(a+(n-i))*k.rowLen}return-1},Ut=function(e){var t=document.getElementById("playGfxCanvas"),n=A.width>0?A.width:t.width,i=A.height>0?A.height:51,r=t.getContext("2d");if(r){r.drawImage(A,0,0);var o=0,a=0;if(xt&&e>=0){var s,d,c,l=Y.getData(e,1e3),u=0,f=0,h=0,p=0;for(s=1;s<l.length;s+=2)d=l[s-1],c=l[s],u=.8*d+.1*u-.3*h,f=.8*c+.1*f-.3*p,h=d,p=c,o+=u*u,a+=f*f;o=.2*Math.sqrt(o/l.length)+.8*Tt,a=.2*Math.sqrt(a/l.length)+.8*Ct,Tt=o,Ct=a}var m=o>0?1.3+.5*Math.log(o):-1e3;m=-1>m?-1:m>1?1:m,m*=.57;var g=a>0?1.3+.5*Math.log(a):-1e3;for(g=-1>g?-1:g>1?1:g,g*=.57,r.strokeStyle="rgb(0,0,0)",r.beginPath(),r.moveTo(.25*n,2.1*i),r.lineTo(.25*n+1.8*i*Math.sin(m),2.1*i-1.8*i*Math.cos(m)),r.stroke(),r.beginPath(),r.moveTo(.75*n,2.1*i),r.lineTo(.75*n+1.8*i*Math.sin(g),2.1*i-1.8*i*Math.cos(g)),r.stroke(),r.fillStyle="rgb(0,0,0)",r.fillRect(0,i,n,20),s=0;8>s;++s){var v=Math.round(26+23*s);if(r.drawImage(P,v,i),s>=bt&&Lt>=s){var w=k.songData[s].i[oe],E=k.songData[s].i[ae],y=k.songData[s].i[se];w=w*w*4,y=E*E*4+y*y*4;var _=w+y;1e4>_&&(_=1e4,y=_-w);var B=Dt(e,s);if(B>=0&&_>B){var I;I=w>B?B/w:1-(B-w)/y,r.globalAlpha=I*I,r.drawImage(O,v,i),r.globalAlpha=1}}}}},kt=function(){if(null!=S){var e,t,n=M.currentTime();if(S.ended||S.duration&&S.duration-n<.1)return Mt(),m=0,v=0,$e(),B=0,I=0,void je();var i=Math.floor(44100*n/k.rowLen),r=Math.floor(i/k.patternLen)+Bt,o=i%k.patternLen,a=r!=E,s=a||o!=m;if(a)for(r>=0&&(E=r,_=r,ze(!0,!0)),e=0;l>e;++e)t=document.getElementById("spr"+e),t.className=e==r?"playpos":"";if(s)for(o>=0&&(m=o,v=o,$e(!0,!a),B=o,I=o,je(!0,!a)),e=0;e<k.patternLen;++e)t=document.getElementById("ppr"+e),t.className=e==o?"playpos":"";Ut(n)}},St=function(){E=Bt,_=Bt,y=w,ze(!0,!0),$e(),je(),xt=!0,_t=setInterval(kt,16)},Mt=function(){if(xt){-1!==_t&&(clearInterval(_t),_t=-1);var e;for(e=0;l>e;++e)document.getElementById("spr"+e).className="";for(e=0;e<k.patternLen;++e)document.getElementById("ppr"+e).className="";Ut(-1),xt=!1}},Yt=function(e){e||(e=window.event),e.preventDefault(),yt(),rt(),Bt=0,It=k.endPattern-2,bt=0,Lt=7;var t=function(e){if(null==S)return void alert("Audio element unavailable.");try{St(),S.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),M.reset(),S.play()}catch(t){alert("Error playing: "+t.message)}};Et(t)},At=function(e){e||(e=window.event),e.preventDefault(),yt(),rt();var t={firstRow:E,lastRow:_,firstCol:w,lastCol:y};Bt=E,It=_,bt=w,Lt=y;var n=function(e){if(null==S)return void alert("Audio element unavailable.");try{St(),S.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),S.play(),M.reset()}catch(t){alert("Error playing: "+t.message)}};Et(n,t)},Pt=function(e){return e||(e=window.event),e.preventDefault(),null==S?void alert("Audio element unavailable."):void yt()},Ot=function(e){return Re(a),!0},Rt=function(e){return Re(a),!0},Nt=function(e){return Re(a),!0},zt=function(e){if(e=e||window.event,e.preventDefault(),w==y){U=[];for(var t=k.songData[w],n=0;n<=t.i.length;++n)U[n]=t.i[n]}},$t=function(e){if(e=e||window.event,e.preventDefault(),w==y&&U.length>0){var t=k.songData[w];t.i=[];for(var n=0;n<=U.length;++n)t.i[n]=U[n]}et(!0)},qt=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){C=[];for(var n=m;v>=n;++n){for(var i=[],r=p;g>=r;++r)i.push(k.songData[w].c[t].n[n+r*k.patternLen]);C.push(i)}}}},jt=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){for(var n=m,i=0;n<k.patternLen&&i<C.length;++n,++i)for(var r=p,o=0;4>r&&o<C[i].length;++r,++o)k.songData[w].c[t].n[n+r*k.patternLen]=C[i][o];$e()}}},Ht=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){for(var n=m;v>=n;++n)for(var i=p;g>=i;++i){var r=k.songData[w].c[t].n[n+i*k.patternLen];r>0&&(k.songData[w].c[t].n[n+i*k.patternLen]=r+1)}$e()}}},Ft=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){for(var n=m;v>=n;++n)for(var i=p;g>=i;++i){var r=k.songData[w].c[t].n[n+i*k.patternLen];r>1&&(k.songData[w].c[t].n[n+i*k.patternLen]=r-1)}$e()}}},Xt=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){for(var n=m;v>=n;++n)for(var i=p;g>=i;++i){var r=k.songData[w].c[t].n[n+i*k.patternLen];r>0&&(k.songData[w].c[t].n[n+i*k.patternLen]=r+12)}$e()}}},Wt=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){for(var n=m;v>=n;++n)for(var i=p;g>=i;++i){var r=k.songData[w].c[t].n[n+i*k.patternLen];r>12&&(k.songData[w].c[t].n[n+i*k.patternLen]=r-12)}$e()}}},Jt=function(e){e=e||window.event,e.preventDefault(),T=[];for(var t=E;_>=t;++t){for(var n=[],i=w;y>=i;++i)n.push(k.songData[i].p[t]);T.push(n)}},Gt=function(e){e=e||window.event,e.preventDefault();for(var t=E,n=0;l>t&&n<T.length;++t,++n)for(var i=w,r=0;8>i&&r<T[n].length;++i,++r)k.songData[i].p[t]=T[n][r];ze()},Vt=function(e){e=e||window.event,e.preventDefault();for(var t=E;_>=t;++t)for(var n=w;y>=n;++n){var i=k.songData[n].p[t];u>i&&(k.songData[n].p[t]=i+1)}ze(),$e(),je()},Qt=function(e){e=e||window.event,e.preventDefault();for(var t=E;_>=t;++t)for(var n=w;y>=n;++n){var i=k.songData[n].p[t];i>0&&(k.songData[n].p[t]=i-1)}ze(),$e(),je()},Zt=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){D=[];for(var n=B;I>=n;++n){var i=[];i.push(k.songData[w].c[t].f[n]),i.push(k.songData[w].c[t].f[n+k.patternLen]),D.push(i)}}}},Kt=function(e){if(e=e||window.event,e.preventDefault(),E==_&&w==y){var t=k.songData[w].p[E]-1;if(t>=0){for(var n=B,i=0;n<k.patternLen&&i<D.length;++n,++i){var r=D[i];k.songData[w].c[t].f[n]=r[0],k.songData[w].c[t].f[n+k.patternLen]=r[1]}je()}}},en=function(e){if(e=e||window.event,e.preventDefault(),w==y){var t=Ae(e),n=-1;"osc1_xenv"===t.id?n=Z:"osc2_xenv"===t.id?n=ie:"lfo_fxfreq"===t.id&&(n=ue);var i;if(n>=0&&(i=+$(t).is(":checked"),k.songData[w].i[n]=i),f==c&&E==_&&B==I&&n){var r=k.songData[w].p[E]-1;r>=0&&(k.songData[w].c[r].f[B]=n+1,k.songData[w].c[r].f[B+k.patternLen]=i,je())}et(!0),Oe()}},tn=function(e){if(e=e||window.event,e.preventDefault(),w==y){var t=Ae(e),n=0;if("osc1_wave_sin"===t.id?n=0:"osc1_wave_sqr"===t.id?n=1:"osc1_wave_saw"===t.id?n=2:"osc1_wave_tri"===t.id&&(n=3),f==c&&E==_&&B==I){var i=k.songData[w].p[E]-1;i>=0&&(k.songData[w].c[i].f[B]=G+1,k.songData[w].c[i].f[B+k.patternLen]=n,je())}k.songData[w].i[G]=n,et(),Oe()}},nn=function(e){if(e=e||window.event,e.preventDefault(),w==y){var t=Ae(e),n=0;if("osc2_wave_sin"===t.id?n=0:"osc2_wave_sqr"===t.id?n=1:"osc2_wave_saw"===t.id?n=2:"osc2_wave_tri"===t.id&&(n=3),f==c&&E==_&&B==I){var i=k.songData[w].p[E]-1;i>=0&&(k.songData[w].c[i].f[B]=K+1,k.songData[w].c[i].f[B+k.patternLen]=n,je())}k.songData[w].i[K]=n,et(!0),Oe()}},rn=function(e){if(e=e||window.event,e.preventDefault(),w==y){var t=Ae(e),n=0;if("lfo_wave_sin"===t.id?n=0:"lfo_wave_sqr"===t.id?n=1:"lfo_wave_saw"===t.id?n=2:"lfo_wave_tri"===t.id&&(n=3),f==c&&E==_&&B==I){var i=k.songData[w].p[E]-1;i>=0&&(k.songData[w].c[i].f[B]=de+1,k.songData[w].c[i].f[B+k.patternLen]=n,je())}k.songData[w].i[de]=n,et(!0),Oe()}},on=function(e){if(e=e||window.event,e.preventDefault(),w==y){var t=Ae(e),n=2;if("fx_filt_hp"===t.id?n=1:"fx_filt_lp"===t.id?n=2:"fx_filt_bp"===t.id&&(n=3),f==c&&E==_&&B==I){var i=k.songData[w].p[E]-1;i>=0&&(k.songData[w].c[i].f[B]=fe+1,k.songData[w].c[i].f[B+k.patternLen]=n,je())}k.songData[w].i[fe]=n,et(!0),Oe()}},an=function(e){e=e||window.event,e.preventDefault(),8>h&&(h++,document.getElementById("keyboardOctave").innerHTML=""+h)},sn=function(e){e=e||window.event,e.preventDefault(),h>1&&(h--,document.getElementById("keyboardOctave").innerHTML=""+h)},dn=function(e){if(e=e||window.event,e.preventDefault(),w==y){var t=Ae(e),n=t.options[t.selectedIndex].value;if(""!==n&&(n=parseInt(n))){for(var i=gInstrumentPresets[n],r=0;r<i.i.length;++r)k.songData[w].i[r]=i.i[r];et(!1)}}},cn=function(e){e=e||window.event;var t=Pe(e,!0),n=0;if(t[1]<68)for(var i=0;i<z.length;i+=2)if(t[0]>=z[i]-10&&t[0]<=z[i]+10){n=z[i+1];break}if(!n){n=2*Math.floor(14*t[0]/420);var r=0;n>=20&&r++,n>=14&&r++,n>=6&&r++,n-=r}Ve(n+12*h)&&e.preventDefault()},ln=function(e){if(e||(e=window.event),e.preventDefault(),!xt){var t=Ae(e),n=parseInt(t.id.slice(3));Je(n),x=!0}Re(c)},un=function(e){if(x){e=e||window.event,e.preventDefault();var t=Ae(e),n=parseInt(t.id.slice(3));Ge(n)}},fn=function(e){if(x){e=e||window.event,e.preventDefault();var t=Ae(e),n=parseInt(t.id.slice(3));Ge(n),x=!1}},hn=function(e){if(e=e||window.event,e.preventDefault(),!xt){var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));He(n,i),L=!0}Re(d)},pn=function(e){if(L){e=e||window.event,e.preventDefault();var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Fe(n,i)}},mn=function(e){if(L){e=e||window.event,e.preventDefault();var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Fe(n,i),L=!1}},gn=function(e){e=e||window.event,e.preventDefault();var t,n=Ae(e),i=parseInt(n.id.slice(2,3));t=xt?E:parseInt(n.id.slice(4));var r=i!=w||w!=y;Xe(i,t),xt||(b=!0),Re(s),$e(),je(),et(r)},vn=function(e){if(b){e=e||window.event,e.preventDefault();var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));We(n,i),$e(),je(),et(!0)}},wn=function(e){if(b){e=e||window.event,e.preventDefault();var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4)),r=n!=y||w!=y;We(n,i),b=!1,$e(),je(),et(r)}},En=null,yn=function(e){w==y&&(e=e||window.event,En=Ae(e),Oe())},_n=function(e){if(e=e||window.event,e.preventDefault(),En){var t=Pe(e,!1),n=Ye(En.parentNode),i=t[0]-6-n[0];i=0>i?0:i>191?1:i/191,En.sliderProps.nonLinear&&(i*=i);var r=En.sliderProps.min,o=En.sliderProps.max;i=Math.round(r+(o-r)*i),"INPUT"==En.tagName&&(i=En.value);var a=-1;"osc1_vol"==En.id?a=V:"osc1_semi"==En.id?a=Q:"osc2_vol"==En.id?a=ee:"osc2_semi"==En.id?a=te:"osc2_det"==En.id?a=ne:"noise_vol"==En.id?a=re:"env_att"==En.id?a=oe:"env_sust"==En.id?a=ae:"env_rel"==En.id?a=se:"lfo_amt"==En.id?a=ce:"lfo_freq"==En.id?a=le:"fx_freq"==En.id?a=he:"fx_res"==En.id?a=pe:"fx_dist"==En.id?a=me:"fx_drive"==En.id?a=ge:"fx_pan_amt"==En.id?a=ve:"fx_pan_freq"==En.id?a=we:"fx_dly_amt"==En.id?a=Ee:"fx_dly_time"==En.id&&(a=ye);var s=k.songData[w];if(f==c&&B==I&&E==_&&w==y){var d=k.songData[w].p[E]-1;d>=0&&(k.songData[w].c[d].f[B]=a+1,k.songData[w].c[d].f[B+k.patternLen]=i,je())}a>=0&&(s.i[a]=i),R.updateInstr(s.i),Ke()}},Bn=function(e){},In=function(e){e=e||window.event;var t,n,i,r=document.activeElement===document.getElementById("bpm")||document.activeElement===document.getElementById("rpp");if(f==s&&w==y&&E==_){if(e.keyCode>=48&&e.keyCode<=57)return k.songData[w].p[E]=e.keyCode-47,ze(),$e(),je(),!1;if(e.keyCode>=64&&e.keyCode<=90)return k.songData[w].p[E]=e.keyCode-54,ze(),$e(),je(),!1}if(f!=s&&!r){switch(i=-1,e.keyCode){case 90:i=0;break;case 83:i=1;break;case 88:i=2;break;case 68:i=3;break;case 67:i=4;break;case 86:i=5;break;case 71:i=6;break;case 66:i=7;break;case 72:i=8;break;case 78:i=9;break;case 74:i=10;break;case 77:i=11;break;case 188:i=12;break;case 76:i=13;break;case 190:i=14;break;case 186:i=15;break;case 191:i=16;break;case 81:i=12;break;case 50:i=13;break;case 87:i=14;break;case 51:i=15;break;case 69:i=16;break;case 82:i=17;break;case 53:i=18;break;case 84:i=19;break;case 54:i=20;break;case 89:i=21;break;case 55:i=22;break;case 85:i=23;break;case 73:i=24;break;case 57:i=25;break;case 79:i=26;break;case 48:i=27;break;case 80:i=28}if(i>=0&&Ve(i+12*h))return!1}var o;switch(e.keyCode){case 39:if(f==s)return Xe((w+1)%8,E),$e(),je(),et(!0),!1;if(f==d)return He((p+1)%4,m),!1;break;case 37:if(f==s)return Xe((w-1+8)%8,E),$e(),je(),et(!0),!1;if(f==d)return He((p-1+4)%4,m),!1;break;case 40:if(f==s)return Xe(w,(E+1)%l),$e(),je(),!1;if(f==d)return He(p,(m+1)%k.patternLen),!1;if(f==c)return Je((B+1)%k.patternLen),!1;break;case 38:if(f==s)return Xe(w,(E-1+l)%l),$e(),je(),!1;if(f==d)return He(p,(m-1+k.patternLen)%k.patternLen),!1;if(f==c)return Je((B-1+k.patternLen)%k.patternLen),!1;break;case 36:if(f==s)return Xe(w,0),$e(),je(),!1;if(f==d)return He(p,0),!1;if(f==c)return Je(0),!1;break;case 35:if(f==s)return Xe(w,l-1),$e(),je(),!1;if(f==d)return He(p,k.patternLen-1),!1;if(f==c)return Je(k.patternLen-1),!1;break;case 32:if(f!=a)return At(e),!1;break;case 8:case 46:if(f==s){for(t=E;_>=t;++t)for(n=w;y>=n;++n)k.songData[n].p[t]=0;return ze(),$e(),je(),!1}if(f==d){if(E==_&&w==y){if(o=k.songData[w].p[E]-1,o>=0){for(t=m;v>=t;++t)for(n=p;g>=n;++n)k.songData[w].c[o].n[t+n*k.patternLen]=0;m==v&&He(p,(m+1)%k.patternLen),$e()}return!1}}else if(f==c&&E==_&&w==y){if(o=k.songData[w].p[E]-1,o>=0){for(t=B;I>=t;++t)k.songData[w].c[o].f[t]=0,k.songData[w].c[o].f[t+k.patternLen]=0;B==I&&Je((B+1)%k.patternLen),je()}return!1}break;case 13:r&&(tt(),it(),document.getElementById("bpm").blur(),document.getElementById("rpp").blur())}return!0},bn=function(e){e=e||window.event,e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;if(t.length&&1!=t.length)return void alert("Only open one file at a time.");var n=t[0],i=new FileReader;i.onload=function(e){dt(F(e.target.result))},i.readAsDataURL(n)},Ln=function(){document.onmousedown=null,document.addEventListener("mousemove",_n,!1),document.addEventListener("touchmove",_n,!1),document.addEventListener("mouseup",Bn,!1),document.addEventListener("touchend",Bn,!1),document.onkeydown=In;var e=document.body.parentNode;e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("drop",bn,!1)},xn=function(){document.onmousedown=function(){return!0},document.onmousemove=null,document.onmouseup=null,document.onkeydown=null},Tn=function(){for(var e,t,n,i=document.getElementById("sequencer-table"),r=0;l>r;r++){e=document.createElement("tr"),r%4===0&&(e.className="beat"),t=document.createElement("th"),t.id="spr"+r,t.textContent=""+r,e.appendChild(t);for(var o=0;8>o;o++)n=document.createElement("td"),n.id="sc"+o+"r"+r,n.textContent=" ",n.addEventListener("mousedown",gn,!1),n.addEventListener("mouseover",vn,!1),n.addEventListener("mouseup",wn,!1),e.appendChild(n);i.appendChild(e)}},Cn=function(e){for(var t=1;t<e.children.length&&"beat"!==e.children[t].className;)t++;return t},Dn=function(){var e=J(),t=4;return k.patternLen%3===0?t=3:k.patternLen%4===0?t=4:k.patternLen%2===0?t=2:k.patternLen%5===0&&(t=5),e/t>=40&&k.patternLen>24&&k.patternLen%(2*t)===0&&(t*=2),t},Un=function(){var e=Dn(),t=document.getElementById("pattern-table");if(t.children.length!==k.patternLen||Cn(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,i,r,o=0;o<k.patternLen;o++){n=document.createElement("tr"),o%e===0&&(n.className="beat"),i=document.createElement("th"),i.id="ppr"+o,i.textContent=""+o,n.appendChild(i);for(var a=0;4>a;a++)r=document.createElement("td"),r.id="pc"+a+"r"+o,r.textContent=" ",r.addEventListener("mousedown",hn,!1),r.addEventListener("mouseover",pn,!1),r.addEventListener("mouseup",mn,!1),n.appendChild(r);t.appendChild(n)}}},kn=function(){var e=Dn(),t=document.getElementById("fxtrack-table");if(t.children.length!==k.patternLen||Cn(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,i,r=0;r<k.patternLen;r++)n=document.createElement("tr"),r%e===0&&(n.className="beat"),i=document.createElement("td"),i.id="fxr"+r,i.textContent=String.fromCharCode(160),i.addEventListener("mousedown",ln,!1),i.addEventListener("mouseover",un,!1),i.addEventListener("mouseup",fn,!1),n.appendChild(i),t.appendChild(n)}};this.init=function(){$(".knob").knob({inline:!1,width:50,height:50,bgColor:"#2b3e50",fgColor:"#df691a",inputColor:"#ebebeb",angleOffset:-125,angleArc:250,cursor:10}),$("input[type=range]").rsSlider({}),e=j(window.location.href),t=H(window.location.href),Se(o+"progress.gif"),Se(o+"wave-sin.png"),Se(o+"wave-sin-sel.png"),Se(o+"wave-saw.png"),Se(o+"wave-saw-sel.png"),Se(o+"wave-sqr.png"),Se(o+"wave-sqr-sel.png"),Se(o+"wave-tri.png"),Se(o+"wave-tri-sel.png"),Se(o+"filt-lp.png"),Se(o+"filt-lp-sel.png"),Se(o+"filt-hp.png"),Se(o+"filt-hp-sel.png"),Se(o+"filt-bp.png"),Se(o+"filt-bp-sel.png"),Se(o+"filt-n.png"),Se(o+"filt-n-sel.png"),Me(),A.onload=function(){Ut(-1)},P.onload=function(){Ut(-1)},A.src=o+"playGfxBg.png",P.src=o+"led-off.png",O.src=o+"led-on.png",Tn(),document.getElementById("osc1_vol").sliderProps={min:0,max:255},document.getElementById("osc1_semi").sliderProps={min:92,max:164},document.getElementById("osc2_vol").sliderProps={min:0,max:255},document.getElementById("osc2_semi").sliderProps={min:92,max:164},document.getElementById("osc2_det").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("noise_vol").sliderProps={min:0,max:255},document.getElementById("env_att").sliderProps={min:0,max:255},document.getElementById("env_sust").sliderProps={min:0,max:255},document.getElementById("env_rel").sliderProps={min:0,max:255},document.getElementById("lfo_amt").sliderProps={min:0,max:255},document.getElementById("lfo_freq").sliderProps={min:0,max:16},document.getElementById("fx_freq").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_res").sliderProps={min:0,max:254},document.getElementById("fx_dist").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_drive").sliderProps={min:0,max:255},document.getElementById("fx_pan_amt").sliderProps={min:0,max:255},document.getElementById("fx_pan_freq").sliderProps={min:0,max:16},document.getElementById("fx_dly_amt").sliderProps={min:0,max:255},document.getElementById("fx_dly_time").sliderProps={min:0,max:16};try{S=new Audio,M.setAudioElement(S),S.addEventListener("canplay",function(){this.play()},!0)}catch(n){S=null}var i=F(t&&t.data&&t.data[0]),r=i?Le(i):null;k=r?r:_e(),Ne(),ze(),$e(),je(),et(!0),Re(d),Xe(0,0),He(0,0),document.getElementById("logo").onmousedown=ft,document.getElementById("newSong").onmousedown=ht,document.getElementById("openSong").onmousedown=pt,document.getElementById("saveSong").onmousedown=mt,document.getElementById("exportJS").onmousedown=vt,document.getElementById("exportWAV").onmousedown=gt,document.getElementById("playSong").onmousedown=Yt,document.getElementById("playRange").onmousedown=At,document.getElementById("stopPlaying").onmousedown=Pt,document.getElementById("about").onmousedown=ft,document.getElementById("bpm").onfocus=Ot,document.getElementById("rpp").onfocus=Rt,document.getElementById("sequencerCopy").onmousedown=Jt,document.getElementById("sequencerPaste").onmousedown=Gt,document.getElementById("sequencerPatUp").onmousedown=Vt,document.getElementById("sequencerPatDown").onmousedown=Qt,document.getElementById("patternCopy").onmousedown=qt,document.getElementById("patternPaste").onmousedown=jt,document.getElementById("patternNoteUp").onmousedown=Ht,
document.getElementById("patternNoteDown").onmousedown=Ft,document.getElementById("patternOctaveUp").onmousedown=Xt,document.getElementById("patternOctaveDown").onmousedown=Wt,document.getElementById("fxCopy").onmousedown=Zt,document.getElementById("fxPaste").onmousedown=Kt,document.getElementById("instrPreset").onfocus=Nt,document.getElementById("instrPreset").onchange=dn,document.getElementById("osc1_wave_sin").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_sin").addEventListener("touchstart",tn,!1),document.getElementById("osc1_wave_sqr").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_sqr").addEventListener("touchstart",tn,!1),document.getElementById("osc1_wave_saw").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_saw").addEventListener("touchstart",tn,!1),document.getElementById("osc1_wave_tri").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_tri").addEventListener("touchstart",tn,!1),$("#osc1_vol").rsSlider("change",yn),$("#osc1_semi").rsSlider("change",yn),$("#osc1_xenv").on("change",en),document.getElementById("osc2_wave_sin").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_sin").addEventListener("touchstart",nn,!1),document.getElementById("osc2_wave_sqr").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_sqr").addEventListener("touchstart",nn,!1),document.getElementById("osc2_wave_saw").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_saw").addEventListener("touchstart",nn,!1),document.getElementById("osc2_wave_tri").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_tri").addEventListener("touchstart",nn,!1),$("#osc2_vol").rsSlider("change",yn),$("#osc2_semi").rsSlider("change",yn),$("#osc2_det").rsSlider("change",yn),$("#osc2_xenv").on("change",en),$("#noise_vol").rsSlider("change",yn),$("#env_att").rsSlider("change",yn),$("#env_sust").rsSlider("change",yn),$("#env_rel").rsSlider("change",yn),document.getElementById("lfo_wave_sin").addEventListener("mousedown",rn,!1),document.getElementById("lfo_wave_sin").addEventListener("touchstart",rn,!1),document.getElementById("lfo_wave_sqr").addEventListener("mousedown",rn,!1),document.getElementById("lfo_wave_sqr").addEventListener("touchstart",rn,!1),document.getElementById("lfo_wave_saw").addEventListener("mousedown",rn,!1),document.getElementById("lfo_wave_saw").addEventListener("touchstart",rn,!1),document.getElementById("lfo_wave_tri").addEventListener("mousedown",rn,!1),document.getElementById("lfo_wave_tri").addEventListener("touchstart",rn,!1),$("#lfo_amt").rsSlider("change",yn),$("#lfo_freq").rsSlider("change",yn),$("#lfo_fxfreq").on("change",en),document.getElementById("fx_filt_lp").addEventListener("mousedown",on,!1),document.getElementById("fx_filt_lp").addEventListener("touchstart",on,!1),document.getElementById("fx_filt_hp").addEventListener("mousedown",on,!1),document.getElementById("fx_filt_hp").addEventListener("touchstart",on,!1),document.getElementById("fx_filt_bp").addEventListener("mousedown",on,!1),document.getElementById("fx_filt_bp").addEventListener("touchstart",on,!1),$("#fx_freq").rsSlider("change",yn),$("#fx_res").rsSlider("change",yn),$("#fx_dly_amt").rsSlider("change",yn),$("#fx_dly_time").rsSlider("change",yn),$("#fx_pan_amt").rsSlider("change",yn),$("#fx_pan_freq").rsSlider("change",yn),$("#fx_dist").rsSlider("change",yn),$("#fx_drive").rsSlider("change",yn),document.getElementById("octaveDown").addEventListener("mousedown",sn,!1),document.getElementById("octaveDown").addEventListener("touchstart",sn,!1),document.getElementById("octaveUp").addEventListener("mousedown",an,!1),document.getElementById("octaveUp").addEventListener("touchstart",an,!1),document.getElementById("keyboard").addEventListener("mousedown",cn,!1),document.getElementById("keyboard").addEventListener("touchstart",cn,!1),document.getElementById("instrCopy").onmousedown=zt,document.getElementById("instrPaste").onmousedown=$t,ke(),Ln(),i||ut(),R.start(),R.updateRowLen(k.rowLen)}};