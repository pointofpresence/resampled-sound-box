/**
 * This file is part of ReSampled SoundBox.
 *
 * Based on SoundBox by Marcus Geelnard (c) 2011-2013
 * 2015 pointofpresence
 * ReSampled.SoundBox (resampled-sound-box) - Online music tracker
 * @version v0.0.1
 * @build Tue Jul 28 2015 21:53:13
 * @link https://github.com/pointofpresence/resampled-sound-box
 * @license GPL-3.0
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 * 1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 * 2. Altered source versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 * 3. This notice may not be removed or altered from any source
 *    distribution.
 */
function rle_encode(e){var t,n,i,o,r="";for(t=0;t<e.length;){for(i=e.charCodeAt(t),n=1;255>n&&t+n<e.length&&(o=e.charCodeAt(t+n),o==i);n++);n>3?(r+=String.fromCharCode(254),r+=String.fromCharCode(n),r+=String.fromCharCode(i)):(r+=String.fromCharCode(i),254==i&&(r+=String.fromCharCode(0)),n=1),t+=n}return r}function rle_decode(e){var t,n,i,o,r="";for(t=0;t<e.length;){if(i=e.charCodeAt(t++),254===i){if(1>t)break;if(o=e.charCodeAt(t++),0!=o){if(1>t)break;for(i=e.charCodeAt(t++),n=0;o>n;n++)r+=String.fromCharCode(i);continue}}r+=String.fromCharCode(i)}return r}function gui_init(){try{var e=new CGUI;e.init()}catch(t){alert("Unexpected error: "+t.message)}}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={},n=Math.max,i=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var i;for(i in t)n.o[i]=t[i];n._carve().init(),n._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var i=e(this);n.i[t]=i,n.v[t]=n.o.parse(i.val()),i.bind("change blur",function(){var e={};e[t]=i.val(),n.val(n._validate(e))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var i=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return this.t=t.c.t(e),i(e),t.c.d.bind("touchmove.k",i).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var i=function(e){var t=n.xy2val(e.pageX,e.pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return i(e),t.c.d.bind("mousemove.k",i).bind("keyup.k",function(e){if(27===e.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(e){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){var t=~~((0>e?-.5:.5)+e/this.o.step)*this.o.step;return Math.round(100*t)/100},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){return null==e?this.v:(e=this.o.parse(e),void(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1||(this.cv=this.o.stopper?n(i(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())))},this.xy2val=function(e,t){var o,r;return o=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(o=this.angleArc-o-this.PI2),this.angleArc!=this.PI2&&0>o&&o>-.5?o=0:0>o&&(o+=this.PI2),r=o*(this.o.max-this.o.min)/this.angleArc+this.o.min,this.o.stopper&&(r=n(i(r,this.o.max),this.o.min)),r},this.listen=function(){var t,o,r,a,s=this,d=function(e){e.preventDefault();var r=e.originalEvent,a=r.detail||r.wheelDeltaX,d=r.detail||r.wheelDeltaY,c=s._validate(s.o.parse(s.$.val()))+(a>0||d>0?s.o.step:0>a||0>d?-s.o.step:0);c=n(i(c,s.o.max),s.o.min),s.val(c,!1),s.rH&&(clearTimeout(t),t=setTimeout(function(){s.rH(c),t=null},100),o||(o=setTimeout(function(){t&&s.rH(c),o=null},200)))},c=1,u={37:-s.o.step,38:s.o.step,39:s.o.step,40:-s.o.step};this.$.bind("keydown",function(t){var o=t.keyCode;if(o>=96&&105>=o&&(o=t.keyCode=o-48),r=parseInt(String.fromCharCode(o)),isNaN(r)&&(13!==o&&8!==o&&9!==o&&189!==o&&(190!==o||s.$.val().match(/\./))&&t.preventDefault(),e.inArray(o,[37,38,39,40])>-1)){t.preventDefault();var d=s.o.parse(s.$.val())+u[o]*c;s.o.stopper&&(d=n(i(d,s.o.max),s.o.min)),s.change(s._validate(d)),s._draw(),a=window.setTimeout(function(){c*=2},30)}}).bind("keyup",function(e){isNaN(r)?a&&(window.clearTimeout(a),a=null,c=1,s.val(s.$.val())):s.$.val()>s.o.max&&s.$.val(s.o.max)||s.$.val()<s.o.min&&s.$.val(s.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",d),this.$.bind("mousewheel DOMMouseScroll",d)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e,t=this.g,n=this.arc(this.cv),i=1;t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,"none"!==this.o.bgColor&&(t.beginPath(),t.strokeStyle=this.o.bgColor,t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),t.stroke()),this.o.displayPrevious&&(e=this.arc(this.v),t.beginPath(),t.strokeStyle=this.pColor,t.arc(this.xy,this.xy,this.radius,e.s,e.e,e.d),t.stroke(),i=this.cv==this.v),t.beginPath(),t.strokeStyle=i?this.o.fgColor:this.fgColor,t.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),t.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var i=new t.Dial;i.o=n,i.$=e(this),i.run()}).parent()}}),gDemoSongs=[{name:"sway",description:" SWAY by m @ Bits'n'Bites, from the 4k demo <a href=\"http://pouet.net/prod.php?which=59203\">SWAY</a>",data:String.fromCharCode(83,66,111,120,8,2,237,154,65,107,19,65,20,199,255,179,51,179,141,166,49,197,82,161,66,48,80,164,122,235,65,177,7,193,67,114,244,86,61,89,232,161,158,84,12,38,177,32,107,183,75,65,171,165,39,167,244,32,4,161,244,27,120,20,84,122,243,43,120,242,27,120,241,30,103,179,219,180,221,100,119,74,117,179,89,120,191,201,236,219,183,111,19,94,38,111,231,237,155,236,251,25,224,170,245,216,3,255,225,65,99,87,112,40,24,159,253,214,250,163,236,7,182,100,22,211,112,161,165,110,192,68,33,104,246,5,12,195,113,182,60,221,55,221,117,215,27,182,143,148,153,54,216,23,12,246,88,255,177,170,173,171,177,239,107,32,117,138,37,195,9,215,78,248,225,68,252,114,144,15,154,161,116,35,122,211,109,56,77,119,45,245,248,41,197,30,239,181,98,37,198,94,197,77,84,48,91,206,58,126,74,197,233,114,130,185,172,125,124,145,96,63,140,139,159,213,156,196,79,195,129,211,208,175,56,57,246,241,239,194,109,234,87,84,182,61,120,109,52,95,129,32,146,232,190,100,232,62,7,131,176,231,124,221,186,196,216,252,125,169,247,88,15,171,191,119,44,135,162,250,91,53,68,87,99,63,16,138,98,129,32,8,130,200,37,59,65,191,43,46,214,241,69,130,253,222,66,245,153,156,18,58,111,91,220,226,194,207,238,220,111,128,236,33,204,217,112,55,162,143,34,75,154,234,214,185,179,101,115,21,241,95,141,234,78,36,85,255,149,82,227,238,127,214,119,82,38,255,235,103,26,123,117,180,81,81,61,15,241,67,16,68,62,177,190,123,186,239,92,6,158,182,182,241,78,50,171,176,60,179,184,43,31,22,120,176,170,62,216,98,62,169,145,243,145,104,230,220,255,172,199,255,138,193,44,147,237,139,116,45,18,4,65,156,15,142,13,240,250,6,216,79,33,110,176,59,130,89,181,214,235,175,53,123,222,95,68,247,243,54,15,165,159,193,153,240,27,55,215,85,42,131,154,252,127,16,239,191,82,121,241,61,207,36,196,15,253,249,65,16,4,17,199,35,15,88,241,38,129,73,212,122,69,122,183,140,234,18,127,43,122,25,156,7,25,60,148,128,144,34,174,182,250,164,39,219,143,186,119,122,114,175,175,239,135,122,218,79,94,73,211,242,98,45,217,156,228,127,71,111,221,49,255,33,51,31,127,227,61,163,201,255,125,28,4,82,139,253,1,61,109,76,225,51,107,176,119,66,127,59,161,191,81,61,99,254,241,234,32,8,98,172,107,242,15,59,96,191,60,61,205,46,99,133,127,150,140,95,223,186,87,219,227,29,187,127,138,95,151,7,213,121,144,197,99,166,228,104,166,216,28,241,55,41,26,150,119,151,13,115,213,155,211,234,246,201,204,189,62,10,255,13,182,149,4,123,5,217,63,163,110,90,93,191,101,200,36,38,255,183,13,246,118,138,227,15,195,248,15,137,159,1,76,119,130,107,52,25,17,4,113,94,186,79,152,238,96,144,19,7,65,77,14,107,106,73,222,62,122,68,253,248,81,245,193,35,167,160,229,79,130,32,8,130,24,61,127,1)},{name:"rechord",description:" re:chord by m @ Bits'n'Bites, from the 4k demo <a href=\"http://www.pouet.net/prod.php?which=60915\">re:chord</a>",base64:"U0JveAgC7ZpRa9NQFMfPzU0ycZ0gOEWYo6CC4AaDPakPPgk-TPDBtz34oEMRQcZkdJTZMEdLSUhDQrexSV_9AH6BoU9-Cz-DH8B6bpKmN0nTTGVNiueXnp5zc9v03Jvb_O9N254HWFR-GaD0jSsA2vICIEoFKuv32COFJTauii2IYAQ1OcJH3Y_rMIjKzrYc4WPTj7dgWqjBW9mw099hz0e2PdlsKpXx5cvL6fIb7PbIsPs38Bxs4Bl45Vux-SdJ5k8QBFEc_Csq-anB8dpVvQvPZhiff8iqK3xJlVXcf6WqoYIHcfCcxszxTsLbCe_l-LHXXj6-vmrkH6Od4c2MfK3Qd0LvJryTKJ8npuM5MbM9W7Zz175_fH_bdu2YWY4lzOy4HWFl_yYV3f85wz8aq1l0j3vHMTv6dCTs8KR3IoyulQRRXlDF0d4zgCdX15QdnSkLvVurDXVFHSj2UM2Hqj5KyWuJ8qRX4nM59QdnXpMHbIZ-q6D853LyX6PBSxAEQQglBwNVHJerfQ2u-1P7_k-4MahlyugNa7IP6XmpJbR3plV1SYjy90Q82OXRWCEIgiBKSR_X4_0PqMyqfseX9kug3Lx9MVTyELFfioGNEPJWjk0rQf6tFg0VgiAIopRr8pcG8O-GBqDp9-GbzvgiKEuevqMHK_JgZS7fWc_6lbyBeufAYczbki87u9DEPLuS3wcLfQPLnSnInyAIgvhPldy1gP0w_L_LPOdfNMYftNRrB9zQQ9Xmvo7zQL1VTdX0GbGlj-RkfIK4LW1PoCWzOfXrf3i8LmYeWDEqPpvTtgs5beuiTdP8wwEzGkMi8grs77-hjaPcjfW_gzNBMad1cSbolr7_90MLqOMMNo18Y2pvRL2Z8dpJsOfPxofzciOMPmbkPGhrU9rXjJ3PdJsIoqyw09cMnr4A9liFz0LPFZ3pq7vRZY1Jz0GU3CMrNkEQBEEQk-U3"},{name:"spacedust",description:" Space Dust by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,154,79,107,19,65,24,198,159,249,179,187,145,52,22,69,161,32,74,160,74,35,30,75,209,67,123,170,244,228,69,208,91,15,241,28,197,67,23,33,68,210,96,13,41,161,151,176,233,178,49,13,1,79,138,31,64,240,32,185,121,240,11,136,159,192,111,161,179,219,77,92,154,29,247,160,197,157,240,254,178,79,158,77,38,153,188,51,236,206,203,187,155,147,21,224,6,175,186,96,19,183,0,44,99,21,27,130,241,157,143,27,247,14,197,129,180,109,238,48,198,69,82,18,176,66,71,10,94,224,191,9,252,227,64,231,56,103,74,25,237,119,50,218,253,225,96,52,28,4,67,157,35,231,244,252,126,224,247,61,95,231,121,143,191,131,70,164,69,164,219,239,4,121,143,241,127,159,191,197,140,19,120,121,53,223,199,127,81,173,64,197,200,147,251,145,135,35,43,149,112,19,75,106,231,130,146,133,91,8,23,81,134,181,240,171,21,165,219,32,136,191,64,76,92,165,22,7,94,84,134,124,199,98,188,248,238,210,122,77,28,56,97,107,156,193,229,84,22,108,156,238,207,247,212,232,152,61,19,205,174,217,241,215,219,139,21,127,207,55,43,126,195,15,127,52,105,49,36,8,99,225,213,35,165,150,196,21,199,217,196,35,155,137,171,159,156,7,95,228,19,153,200,228,243,74,233,169,49,219,204,172,173,154,179,173,137,174,129,235,90,125,182,213,209,14,61,166,141,30,70,120,79,135,58,65,16,196,162,242,211,101,74,96,144,118,116,249,138,95,100,172,188,98,253,46,218,25,103,124,234,179,71,74,71,94,134,242,142,62,118,83,70,160,27,151,217,241,19,4,65,16,89,236,158,106,83,58,215,163,50,252,199,87,148,159,90,142,156,182,51,22,93,75,231,44,129,38,103,120,113,238,155,119,207,228,76,98,122,252,4,65,16,196,34,35,182,92,136,215,225,125,242,146,93,139,106,242,37,20,30,62,179,171,118,242,83,225,159,221,166,178,52,61,141,207,188,30,197,126,18,61,251,248,96,64,77,110,50,111,53,243,63,136,231,63,239,244,52,239,135,227,48,225,222,64,214,125,242,6,8,130,32,206,41,147,99,31,226,254,62,216,119,41,43,236,174,202,213,219,123,47,63,111,219,107,103,235,110,161,74,113,62,85,86,54,212,121,238,171,239,20,31,143,35,55,54,209,155,30,63,65,16,4,145,193,164,165,116,116,25,223,106,123,93,118,104,51,94,216,189,86,238,91,143,11,127,250,82,90,50,127,158,241,67,175,104,174,9,130,32,8,226,159,243,11)},{name:"8bit",description:" 8 Bit One by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,219,49,107,219,64,20,7,240,119,58,217,130,144,216,201,226,146,33,32,98,74,218,177,93,186,52,99,200,84,58,36,75,72,134,102,78,178,9,99,227,202,85,13,65,180,8,19,115,56,24,211,16,98,2,249,16,89,252,141,2,25,187,56,119,82,228,154,243,112,14,4,91,46,255,31,247,116,122,150,100,206,135,204,227,140,220,120,67,84,224,3,143,248,32,32,34,103,185,36,183,100,13,137,220,109,190,97,51,139,89,234,133,180,55,17,151,189,81,107,181,133,140,206,168,253,138,90,157,80,157,35,35,237,155,50,90,99,253,188,181,59,221,81,139,90,237,110,116,33,70,45,148,113,174,206,145,145,246,106,206,162,177,30,0,0,96,30,172,192,35,235,135,87,36,218,43,255,228,77,89,191,223,221,89,238,65,238,208,73,106,184,170,226,106,203,141,239,20,106,121,83,203,235,250,5,149,108,205,196,185,150,7,90,94,211,47,240,178,53,254,208,112,188,142,155,29,0,224,255,172,228,223,60,21,43,68,199,31,191,179,223,14,227,111,247,45,55,180,143,248,75,43,121,207,144,95,107,249,149,150,247,181,252,102,198,51,209,53,228,250,120,255,24,198,123,61,227,241,247,12,199,77,227,233,227,203,0,0,176,144,248,223,136,248,167,128,211,26,95,125,79,123,114,77,254,120,203,118,190,228,215,243,234,232,191,74,110,126,167,122,178,14,111,80,195,151,251,141,120,201,237,171,165,108,173,42,247,107,153,159,137,90,178,14,247,201,175,203,125,63,94,114,203,207,84,165,106,69,238,87,113,171,0,0,64,54,13,61,38,131,24,217,249,114,188,72,47,48,230,166,7,153,68,86,188,53,18,73,196,77,76,230,98,81,39,40,249,28,66,224,86,1,0,128,108,10,146,248,108,47,109,210,125,142,216,67,72,238,105,110,213,78,43,121,98,154,146,39,198,67,76,228,0,0,0,240,234,226,39,222,130,160,72,228,20,182,232,216,102,252,67,143,206,78,236,175,246,243,170,252,249,247,245,41,10,57,158,93,7,0,0,152,189,129,151,4,57,165,221,184,180,171,127,161,97,90,0,0,0,22,195,19)},{name:"4chordsong",description:" 4 Chord Song by m @ Bits'n'Bites, chord test inspired by <a href=\"http://www.youtube.com/watch?v=5pidokakU4I\">Axis of Awsome</a>",data:String.fromCharCode(83,66,111,120,8,2,237,153,65,107,19,81,16,199,231,189,151,77,2,105,14,90,8,138,72,115,80,170,168,24,76,3,70,237,161,164,90,176,74,245,166,168,72,169,199,80,2,45,24,66,36,123,168,49,100,27,82,210,96,212,196,80,20,36,8,222,252,0,30,252,22,130,31,64,4,63,130,190,236,190,109,195,146,237,174,77,163,151,255,111,102,24,246,205,16,102,103,55,12,239,237,167,179,68,19,252,134,78,124,81,23,68,39,194,115,52,45,24,127,190,196,227,122,224,36,39,98,140,9,226,140,145,47,74,125,89,43,229,10,36,101,181,176,86,36,41,185,98,46,79,82,178,249,156,65,150,148,149,84,148,108,40,169,43,169,42,177,243,237,188,134,146,154,18,59,223,206,139,202,26,246,179,139,210,230,165,37,165,101,164,205,12,248,57,31,245,239,119,239,27,213,202,22,141,72,212,99,61,229,18,207,140,220,127,11,247,254,91,184,247,127,175,206,225,22,221,237,127,70,245,255,186,180,132,122,30,9,185,122,158,0,0,0,28,20,241,109,155,248,186,30,36,10,70,22,104,94,78,242,196,179,200,185,219,193,227,65,198,184,226,112,38,249,184,239,196,158,24,110,126,153,110,209,85,229,211,202,95,51,253,34,93,246,81,127,163,213,54,181,241,242,181,169,205,86,219,212,102,171,99,234,184,38,185,205,2,94,86,0,0,0,67,224,73,185,39,191,160,203,105,157,138,117,233,81,136,137,163,211,20,79,104,179,26,27,192,207,48,47,41,95,80,190,168,124,94,249,178,195,87,28,222,222,219,85,29,215,198,238,158,209,162,230,184,182,55,195,17,151,186,236,245,83,46,241,148,163,126,55,202,30,113,195,35,94,247,136,71,60,226,15,240,178,2,0,0,24,2,251,162,247,141,17,77,76,94,162,87,26,19,167,219,137,116,86,36,133,25,101,150,249,161,108,212,77,45,87,107,166,86,140,186,169,21,99,203,84,231,164,207,57,38,61,0,0,0,0,254,30,241,93,151,195,116,157,104,50,44,166,232,67,128,241,99,119,143,172,220,209,158,6,213,164,231,140,11,30,240,241,75,239,149,239,42,191,163,124,103,96,189,165,178,186,244,209,244,77,149,213,161,222,200,119,18,243,56,158,94,153,58,88,253,61,31,245,247,232,243,184,31,84,204,35,62,243,191,251,239,245,117,32,59,226,153,70,11,127,86,0,0,24,62,201,223,173,50,246,88,238,203,179,20,222,161,165,16,19,247,223,240,248,25,109,205,26,222,76,217,8,108,163,201,0,0,0,192,24,217,180,236,119,183,219,165,164,220,129,95,249,69,203,247,216,91,245,105,156,249,30,228,47,208,74,0,0,0,224,223,211,63,93,255,33,247,228,244,53,242,147,102,195,196,181,205,155,233,39,218,195,208,94,138,191,89,238,117,58,90,66,175,1,0,0,128,67,231,15)}],gInstrumentPresets=[{name:"====[LEADS]===="},{name:"Softy",i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,195,6,1,2,135,0,0,32,147,6,121,6]},{name:"Classic 8-bit",i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,69,3,1,1,23,167,0,32,77,6,25,6]},{name:"Square",i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,2,255,0,0,32,47,3,146,2]},{name:"Bell",i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,2,255,0,0,32,47,3,157,2]},{name:"Filter Bass 1",i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,195,4,1,3,50,184,119,244,147,6,84,6]},{name:"====[PADS]===="},{name:"Base string",i:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,2,5,0,0,32,0,0,24,8]},{name:"Base string (dist)",i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,136,5,1,2,8,92,21,32,148,5,85,8]},{name:"Evil brass",i:[3,146,140,0,1,224,128,3,0,0,92,0,95,3,179,5,1,2,124,135,11,32,150,3,157,6]},{name:"====[DRUMS]===="},{name:"Bass drum 1",i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,2,14,0,0,32,0,0,0,0]},{name:"Bass drum 2",i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,1,39,76,5,0,0]},{name:"Bass drum 3",i:[0,255,116,1,0,255,116,0,1,14,4,6,45,0,0,0,0,2,136,15,0,32,0,0,66,6]},{name:"Base tom",i:[0,192,104,1,0,80,99,0,0,0,4,0,66,3,0,0,0,1,0,1,2,32,37,4,0,0]},{name:"Snare 1",i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,60,4,1,2,255,0,0,32,61,5,32,6]},{name:"Snare 2",i:[0,221,128,1,0,210,128,0,1,255,4,6,62,0,64,7,1,3,255,15,0,32,20,0,24,6]},{name:"Snare 3",i:[3,0,128,0,3,68,128,0,1,218,4,4,40,1,55,4,1,2,67,115,124,190,67,6,39,1]},{name:"Hihat 1",i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,187,5,0,1,239,135,0,32,108,5,16,4]},{name:"Hihat 2",i:[2,40,140,1,0,0,140,0,0,255,5,0,48,0,0,0,0,3,161,192,0,32,0,0,71,1]},{name:"Open hihat",i:[0,0,128,0,0,0,128,0,0,125,0,1,59,0,0,0,0,1,193,171,0,29,39,3,88,3]},{name:"Smash",i:[0,214,104,1,0,204,104,0,1,229,4,40,21,0,231,6,1,3,183,15,0,32,232,4,74,6]},{name:"Pipe hit",i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,96,3,1,3,94,79,0,32,84,2,12,4]},{name:"====[F/X]===="},{name:"Wind",i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,51,2,1,2,58,239,0,32,88,1,157,2]},{name:"Long beat",i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,2,255,0,2,32,83,5,25,1]},{name:"Siren",i:[1,0,128,0,1,0,128,0,0,255,158,100,158,3,67,4,1,3,57,254,85,171,88,1,157,2]}];var CPlayer=function(){var e,t,n=new Worker("tracker/js/player-worker.js");n.onmessage=function(n){"progress"===n.data.cmd&&(t=n.data.buffer,e&&e(n.data.progress))},this.generate=function(t,i,o){e=o,n.postMessage({cmd:"generate",song:t,opts:i})},this.createWave=function(){var e=t,n=e.length,i=2*n-8,o=i-36,r=44,a=new Uint8Array(r+2*n);a.set([82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&o,o>>8&255,o>>16&255,o>>24&255]);for(var s=0,d=r;n>s;++s){var c=e[s];c=-32767>c?-32767:c>32767?32767:c,a[d++]=255&c,a[d++]=c>>8&255}return a},this.getData=function(e,n){for(var i=2*Math.floor(44100*e),o=new Array(n),r=t,a=0;2*n>a;a+=1){var s=i+a;o[a]=e>0&&s<r.length?r[s]/32768:0}return o}},CJammer=function(){var e,t,n,i,o,r,a,s,d,c=8,u=[],l=131072,f=function(e){return Math.sin(6.283184*e)},h=function(e){return 2*(e%1)-1},m=function(e){return.5>e%1?1:-1},p=function(e){var t=e%1*4;return 2>t?t-1:3-t},v=function(e){return 174.614115728/s*Math.pow(2,(e-128)/12)},g=[f,m,h,p],E=function(r,a){var h,m,p,v,E,w,y,_=a.length;for(p=0;_>p;++p)r[p]=0,a[p]=0;for(h=0;c>h;++h){var B=u[h];if(void 0!=B){var I=g[B.instr[0]],b=B.instr[1],L=B.instr[3],x=g[B.instr[4]],C=B.instr[5],T=B.instr[8],D=B.instr[9],U=Math.round(B.instr[10]*B.instr[10]*4*d),k=Math.round(B.instr[11]*B.instr[11]*4*d),M=Math.round(B.instr[12]*B.instr[12]*4*d),S=1/M,Y=B.o1f,A=B.o2f,P=B.o1t,O=B.o2t,R=U+k+M-B.env;for(_>=R?u[h]=void 0:R=_,m=B.env,p=0;R>p;m++,p++)E=1,U>m?E=m/U:m>=U+k&&(E-=(m-U-k)*S),v=Y,L&&(v*=E*E),P+=v,w=I(P)*b,v=A,T&&(v*=E*E),O+=v,w+=x(O)*C,D&&(w+=(2*Math.random()-1)*D),a[p]+=.002441481*w*E;B.env=m,B.o1t=P,B.o2t=O}}var z,N,$,q=n.pos,j=n.low,H=n.band,F=n.filterActive,X=n.dlyPos,W=l-1,J=g[e[13]],G=e[14]/512,V=Math.pow(2,e[15]-9)/t,Q=e[16],Z=e[17],K=43.23529*e[18]*3.141592/s,ee=1-e[19]/255,te=1e-5*e[20]*32767,ne=e[21]/32,ie=e[22]/512,oe=6.283184*Math.pow(2,e[23]-9)/t,re=e[24]/255,ae=e[25]*t>>1;for(ae>=l&&(ae=l-1),m=0;_>m;m++)p=2*(q+m),w=a[m],w||F?(y=K,Q&&(y*=J(V*p)*G+.5),y=1.5*Math.sin(y),j+=y*H,N=ee*(w-H)-j,H+=y*N,w=3==Z?H:1==Z?N:j,te&&(w*=te,w=1>w?w>-1?f(.25*w):-1:1,w/=te),w*=ne,F=w*w>1e-5,v=Math.sin(oe*p)*ie+.5,z=w*(1-v),w*=v):z=0,$=X-ae&W,z+=o[$]*re,w+=i[$]*re,i[X]=z,o[X]=w,X=X+1&W,r[m]=z,a[m]=w;for(q+=_;q>2048*t;)q-=2048*t;n.pos=q,n.low=j,n.band=H,n.filterActive=F,n.dlyPos=X};this.start=function(){if(window.AudioContext)r=new AudioContext;else{if(!window.webkitAudioContext)return void(r=void 0);r=new webkitAudioContext,r.createScriptProcessor=r.createJavaScriptNode}s=r.sampleRate,d=s/44100,n={pos:0,low:0,band:0,filterActive:!1,dlyPos:0},i=new Float32Array(l),o=new Float32Array(l),a=r.createScriptProcessor(2048,0,2),a.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);E(t,n)},a.connect(r.destination)},this.stop=function(){},this.updateInstr=function(t){e=[];for(var n=0;n<t.length;++n)e.push(t[n])},this.updateRowLen=function(e){t=Math.round(e*d)},this.addNote=function(t){var n,i=(new Date).getTime(),o={startT:i,env:0,o1t:0,o2t:0,o1f:v(t+e[2]-128),o2f:v(t+e[6]-128)*(1+8e-4*e[7]),instr:new Array(13)};for(n=0;13>n;++n)o.instr[n]=e[n];var r=0,a=-100;for(n=0;c>n;++n){if(void 0==u[n])return void(u[n]=o);var s=i-u[n].startT;s>a&&(r=n,a=s)}u[r]=o}};if(function(){function e(){this.fc=0,this.dl=0}function t(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function n(e,t,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i}function i(){this.next=null,this.len=0,this.ptr=[],this.off=0}function o(n){var i;if(n?1>n?n=1:n>9&&(n=9):n=Je,me=n,F=!1,ue=!1,null===xt){for(q=j=H=null,xt=[],G=[],V=[],Q=[],Z=[],ge=[],i=0;bt>i;i++)ge[i]=new e;for(Ee=[],i=0;2*wt+1>i;i++)Ee[i]=new e;for(we=[],i=0;Et+2>i;i++)we[i]=new e;for(ye=[],i=0;wt>i;i++)ye[i]=new e;for(_e=[],i=0;2*yt+1>i;i++)_e[i]=new e;Be=new t,Ie=new t,be=new t,Le=[],xe=[],De=[],Ue=[],ke=[],Me=[],Se=[],Ye=[]}}function r(e){e.next=q,q=e}function a(){var e;return null!==q?(e=q,q=q.next):e=new i,e.next=null,e.len=e.off=0,e}function s(e){return Z[He+e]}function d(e,t){return Z[He+e]=t}function c(e){xt[W+X++]=e,W+X===Qe&&N()}function u(e){e&=65535,Qe-2>W+X?(xt[W+X++]=255&e,xt[W+X++]=e>>>8):(c(255&e),c(e>>>8))}function l(){ne=(ne<<Lt^255&G[de+Ke-1])&at,ie=s(ne),Z[de&st]=ie,d(ne,de)}function f(e,t){O(t[e].fc,t[e].dl)}function h(e){return 255&(256>e?ke[e]:ke[256+(e>>7)])}function m(e,t,n){return e[t].fc<e[n].fc||e[t].fc===e[n].fc&&De[t]<=De[n]}function p(e,t,n){var i;for(i=0;n>i&&je<qe.length;i++)e[t+i]=255&qe[je++];return i}function v(){var e;for(e=0;rt>e;e++)Z[He+e]=0;if(he=kt[me].max_lazy,pe=kt[me].good_length,Ge||(ve=kt[me].nice_length),fe=kt[me].max_chain,de=0,te=0,le=p(G,0,2*He),0>=le)return ue=!0,void(le=0);for(ue=!1;ut>le&&!ue;)E();for(ne=0,e=0;Ke-1>e;e++)ne=(ne<<Lt^255&G[e])&at}function g(e){var t,n,i,o,r=fe,a=de,s=se,d=de>lt?de-lt:dt,c=de+et,u=G[a+s-1],l=G[a+s];se>=pe&&(r>>=2);do if(t=e,G[t+s]===l&&G[t+s-1]===u&&G[t]===G[a]&&G[++t]===G[a+1]){for(a+=2,t++;c>a;){for(o=!1,i=0;8>i;i+=1)if(a+=1,t+=1,G[a]!==G[t]){o=!0;break}if(o)break}if(n=et-(c-a),a=c-et,n>s){if(ce=e,s=n,Ge){if(n>=et)break}else if(n>=ve)break;u=G[a+s-1],l=G[a+s]}}while((e=Z[e&st])>d&&0!==--r);return s}function E(){var e,t,n=Ze-le-de;if(-1===n)n--;else if(de>=He+lt){for(e=0;He>e;e++)G[e]=G[e+He];for(ce-=He,de-=He,te-=He,e=0;rt>e;e++)t=s(e),d(e,t>=He?t-He:dt);for(e=0;He>e;e++)t=Z[e],Z[e]=t>=He?t-He:dt;n+=He}ue||(e=p(G,de+le,n),0>=e?ue=!0:le+=e)}function w(){for(;0!==le&&null===j;){var e;if(l(),ie!==dt&&lt>=de-ie&&(ae=g(ie),ae>le&&(ae=le)),ae>=Ke)if(e=A(de-ce,ae-Ke),le-=ae,he>=ae){ae--;do de++,l();while(0!==--ae);de++}else de+=ae,ae=0,ne=255&G[de],ne=(ne<<Lt^255&G[de+1])&at;else e=A(0,255&G[de]),le--,de++;for(e&&(Y(0),te=de);ut>le&&!ue;)E()}}function y(){for(;0!==le&&null===j;){if(l(),se=ae,oe=ce,ae=Ke-1,ie!==dt&&he>se&&lt>=de-ie&&(ae=g(ie),ae>le&&(ae=le),ae===Ke&&de-ce>ct&&ae--),se>=Ke&&se>=ae){var e;e=A(de-1-oe,se-Ke),le-=se-1,se-=2;do de++,l();while(0!==--se);re=!1,ae=Ke-1,de++,e&&(Y(0),te=de)}else re?(A(0,255&G[de-1])&&(Y(0),te=de),de++,le--):(re=!0,de++,le--);for(;ut>le&&!ue;)E()}}function _(){ue||(K=0,ee=0,b(),v(),j=null,X=0,W=0,3>=me?(se=Ke-1,ae=0):(ae=Ke-1,re=!1),J=!1)}function B(e,t,n){var i;return F||(_(),F=!0,0!==le)?(i=I(e,t,n),i===n?n:J?i:(3>=me?w():y(),0===le&&(re&&A(0,255&G[de-1]),Y(1),J=!0),i+I(e,i+t,n-i))):(J=!0,0)}function I(e,t,n){var i,o,a;for(i=0;null!==j&&n>i;){for(o=n-i,o>j.len&&(o=j.len),a=0;o>a;a++)e[t+i+a]=j.ptr[j.off+a];if(j.off+=o,j.len-=o,i+=o,0===j.len){var s;s=j,j=j.next,r(s)}}if(i===n)return i;if(X>W){for(o=n-i,o>X-W&&(o=X-W),a=0;o>a;a++)e[t+i+a]=xt[W+a];W+=o,i+=o,X===W&&(X=W=0)}return i}function b(){var e,t,n,i,o;if(0===ye[0].dl){for(Be.dyn_tree=ge,Be.static_tree=we,Be.extra_bits=Ct,Be.extra_base=vt+1,Be.elems=Et,Be.max_length=ht,Be.max_code=0,Ie.dyn_tree=Ee,Ie.static_tree=ye,Ie.extra_bits=Tt,Ie.extra_base=0,Ie.elems=wt,Ie.max_length=ht,Ie.max_code=0,be.dyn_tree=_e,be.static_tree=null,be.extra_bits=Dt,be.extra_base=0,be.elems=yt,be.max_length=mt,be.max_code=0,n=0,i=0;pt-1>i;i++)for(Me[i]=n,e=0;e<1<<Ct[i];e++)Ue[n++]=i;for(Ue[n-1]=i,o=0,i=0;16>i;i++)for(Se[i]=o,e=0;e<1<<Tt[i];e++)ke[o++]=i;for(o>>=7;wt>i;i++)for(Se[i]=o<<7,e=0;e<1<<Tt[i]-7;e++)ke[256+o++]=i;for(t=0;ht>=t;t++)Le[t]=0;for(e=0;143>=e;)we[e++].dl=8,Le[8]++;for(;255>=e;)we[e++].dl=9,Le[9]++;for(;279>=e;)we[e++].dl=7,Le[7]++;for(;287>=e;)we[e++].dl=8,Le[8]++;for(T(we,Et+1),e=0;wt>e;e++)ye[e].dl=5,ye[e].fc=R(e,5);L()}}function L(){var e;for(e=0;Et>e;e++)ge[e].fc=0;for(e=0;wt>e;e++)Ee[e].fc=0;for(e=0;yt>e;e++)_e[e].fc=0;ge[gt].fc=1,Ne=$e=0,Ae=Pe=Oe=0,Re=0,ze=1}function x(e,t){for(var n=xe[t],i=t<<1;Ce>=i&&(Ce>i&&m(e,xe[i+1],xe[i])&&i++,!m(e,n,xe[i]));)xe[t]=xe[i],t=i,i<<=1;xe[t]=n}function C(e){var t,n,i,o,r,a,s=e.dyn_tree,d=e.extra_bits,c=e.extra_base,u=e.max_code,l=e.max_length,f=e.static_tree,h=0;for(o=0;ht>=o;o++)Le[o]=0;for(s[xe[Te]].dl=0,t=Te+1;bt>t;t++)n=xe[t],o=s[s[n].dl].dl+1,o>l&&(o=l,h++),s[n].dl=o,n>u||(Le[o]++,r=0,n>=c&&(r=d[n-c]),
a=s[n].fc,Ne+=a*(o+r),null!==f&&($e+=a*(f[n].dl+r)));if(0!==h){do{for(o=l-1;0===Le[o];)o--;Le[o]--,Le[o+1]+=2,Le[l]--,h-=2}while(h>0);for(o=l;0!==o;o--)for(n=Le[o];0!==n;)i=xe[--t],i>u||(s[i].dl!==o&&(Ne+=(o-s[i].dl)*s[i].fc,s[i].fc=o),n--)}}function T(e,t){var n,i,o=[],r=0;for(n=1;ht>=n;n++)r=r+Le[n-1]<<1,o[n]=r;for(i=0;t>=i;i++){var a=e[i].dl;0!==a&&(e[i].fc=R(o[a]++,a))}}function D(e){var t,n,i=e.dyn_tree,o=e.static_tree,r=e.elems,a=-1,s=r;for(Ce=0,Te=bt,t=0;r>t;t++)0!==i[t].fc?(xe[++Ce]=a=t,De[t]=0):i[t].dl=0;for(;2>Ce;){var d=xe[++Ce]=2>a?++a:0;i[d].fc=1,De[d]=0,Ne--,null!==o&&($e-=o[d].dl)}for(e.max_code=a,t=Ce>>1;t>=1;t--)x(i,t);do t=xe[ft],xe[ft]=xe[Ce--],x(i,ft),n=xe[ft],xe[--Te]=t,xe[--Te]=n,i[s].fc=i[t].fc+i[n].fc,De[s]=De[t]>De[n]+1?De[t]:De[n]+1,i[t].dl=i[n].dl=s,xe[ft]=s++,x(i,ft);while(Ce>=2);xe[--Te]=xe[ft],C(e),T(i,a)}function U(e,t){var n,i,o=-1,r=e[0].dl,a=0,s=7,d=4;for(0===r&&(s=138,d=3),e[t+1].dl=65535,n=0;t>=n;n++)i=r,r=e[n+1].dl,++a<s&&i===r||(d>a?_e[i].fc+=a:0!==i?(i!==o&&_e[i].fc++,_e[_t].fc++):10>=a?_e[Bt].fc++:_e[It].fc++,a=0,o=i,0===r?(s=138,d=3):i===r?(s=6,d=3):(s=7,d=4))}function k(e,t){var n,i,o=-1,r=e[0].dl,a=0,s=7,d=4;for(0===r&&(s=138,d=3),n=0;t>=n;n++)if(i=r,r=e[n+1].dl,!(++a<s&&i===r)){if(d>a){do f(i,_e);while(0!==--a)}else 0!==i?(i!==o&&(f(i,_e),a--),f(_t,_e),O(a-3,2)):10>=a?(f(Bt,_e),O(a-3,3)):(f(It,_e),O(a-11,7));a=0,o=i,0===r?(s=138,d=3):i===r?(s=6,d=3):(s=7,d=4)}}function M(){var e;for(U(ge,Be.max_code),U(Ee,Ie.max_code),D(be),e=yt-1;e>=3&&0===_e[Ut[e]].dl;e--);return Ne+=3*(e+1)+5+5+4,e}function S(e,t,n){var i;for(O(e-257,5),O(t-1,5),O(n-4,4),i=0;n>i;i++)O(_e[Ut[i]].dl,3);k(ge,e-1),k(Ee,t-1)}function Y(e){var t,n,i,o,r;if(o=de-te,Ye[Oe]=Re,D(Be),D(Ie),i=M(),t=Ne+3+7>>3,n=$e+3+7>>3,t>=n&&(t=n),t>=o+4&&te>=0)for(O((Fe<<1)+e,3),z(),u(o),u(~o),r=0;o>r;r++)c(G[te+r]);else n===t?(O((Xe<<1)+e,3),P(we,ye)):(O((We<<1)+e,3),S(Be.max_code+1,Ie.max_code+1,i+1),P(ge,Ee));L(),0!==e&&z()}function A(e,t){if(Q[Ae++]=t,0===e?ge[t].fc++:(e--,ge[Ue[t]+vt+1].fc++,Ee[h(e)].fc++,V[Pe++]=e,Re|=ze),ze<<=1,0===(7&Ae)&&(Ye[Oe++]=Re,Re=0,ze=1),me>2&&0===(4095&Ae)){var n,i=8*Ae,o=de-te;for(n=0;wt>n;n++)i+=Ee[n].fc*(5+Tt[n]);if(i>>=3,Pe<parseInt(Ae/2,10)&&i<parseInt(o/2,10))return!0}return Ae===nt-1||Pe===ot}function P(e,t){var n,i,o,r,a=0,s=0,d=0,c=0;if(0!==Ae)do 0===(7&a)&&(c=Ye[d++]),i=255&Q[a++],0===(1&c)?f(i,e):(o=Ue[i],f(o+vt+1,e),r=Ct[o],0!==r&&(i-=Me[o],O(i,r)),n=V[s++],o=h(n),f(o,t),r=Tt[o],0!==r&&(n-=Se[o],O(n,r))),c>>=1;while(Ae>a);f(gt,e)}function O(e,t){ee>Mt-t?(K|=e<<ee,u(K),K=e>>Mt-ee,ee+=t-Mt):(K|=e<<ee,ee+=t)}function R(e,t){var n=0;do n|=1&e,e>>=1,n<<=1;while(--t>0);return n>>1}function z(){ee>8?u(K):ee>0&&c(K),K=0,ee=0}function N(){var e,t;if(0!==X){for(e=a(),null===j?j=H=e:H=H.next=e,e.len=X-W,t=0;t<e.len;t++)e.ptr[t]=xt[W+t];X=W=0}}function $(e,t){var n,i,r;if("string"==typeof e)for(r=e,e=[],n=0;n<r.length;n++)e[n]=r.charCodeAt(n);qe=e,je=0,"undefined"==typeof t&&(t=Je),o(t),i=[];do n=B(i,i.length,1024);while(n>0);for(qe=null,r="",n=0;n<i.length;n++)r+=String.fromCharCode(i[n]);return r}var q,j,H,F,X,W,J,G,V,Q,Z,K,ee,te,ne,ie,oe,re,ae,se,de,ce,ue,le,fe,he,me,pe,ve,ge,Ee,we,ye,_e,Be,Ie,be,Le,xe,Ce,Te,De,Ue,ke,Me,Se,Ye,Ae,Pe,Oe,Re,ze,Ne,$e,qe,je,He=32768,Fe=0,Xe=1,We=2,Je=6,Ge=!1,Ve=32768,Qe=8192,Ze=2*He,Ke=3,et=258,tt=16,nt=8192,it=15,ot=nt,rt=1<<it,at=rt-1,st=He-1,dt=0,ct=4096,ut=et+Ke+1,lt=He-ut,ft=1,ht=15,mt=7,pt=29,vt=256,gt=256,Et=vt+1+pt,wt=30,yt=19,_t=16,Bt=17,It=18,bt=2*Et+1,Lt=parseInt((it+Ke-1)/Ke,10),xt=null;nt>Ve&&console.error("error: INBUFSIZ is too small"),He<<1>1<<tt&&console.error("error: WSIZE is too large"),it>tt-1&&console.error("error: HASH_BITS is too large"),(8>it||258!==et)&&console.error("error: Code too clever");var Ct=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Tt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Dt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],kt=[new n(0,0,0,0),new n(4,4,8,4),new n(4,5,16,8),new n(4,6,32,32),new n(4,4,16,16),new n(8,16,32,32),new n(8,16,128,128),new n(8,32,128,256),new n(32,128,258,1024),new n(32,258,258,4096)],Mt=16;window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.deflate=$}(),function(){function e(){this.next=null,this.list=null}function t(){this.e=0,this.b=0,this.n=0,this.t=null}function n(n,i,o,r,a,s){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var d,c,u,l,f,h,m,p,v,g,E,w,y,_,B,I,b,L=[],x=[],C=new t,T=[],D=[],U=[];for(b=this.root=null,h=0;h<this.BMAX+1;h++)L[h]=0;for(h=0;h<this.BMAX+1;h++)x[h]=0;for(h=0;h<this.BMAX;h++)T[h]=null;for(h=0;h<this.N_MAX;h++)D[h]=0;for(h=0;h<this.BMAX+1;h++)U[h]=0;c=i>256?n[256]:this.BMAX,v=n,g=0,h=i;do L[v[g]]++,g++;while(--h>0);if(L[0]===i)return this.root=null,this.m=0,void(this.status=0);for(m=1;m<=this.BMAX&&0===L[m];m++);for(p=m,m>s&&(s=m),h=this.BMAX;0!==h&&0===L[h];h--);for(l=h,s>h&&(s=h),_=1<<m;h>m;m++,_<<=1)if((_-=L[m])<0)return this.status=2,void(this.m=s);if((_-=L[h])<0)return this.status=2,void(this.m=s);for(L[h]+=_,U[1]=m=0,v=L,g=1,y=2;--h>0;)U[y++]=m+=v[g++];v=n,g=0,h=0;do 0!==(m=v[g++])&&(D[U[m]++]=h);while(++h<i);for(i=U[l],U[0]=h=0,v=D,g=0,f=-1,w=x[0]=0,E=null,B=0,null;l>=p;p++)for(d=L[p];d-->0;){for(;p>w+x[1+f];){if(w+=x[1+f],f++,B=(B=l-w)>s?s:B,(u=1<<(m=p-w))>d+1)for(u-=d+1,y=p;++m<B&&!((u<<=1)<=L[++y]);)u-=L[y];for(w+m>c&&c>w&&(m=c-w),B=1<<m,x[1+f]=m,E=[],I=0;B>I;I++)E[I]=new t;b=b?b.next=new e:this.root=new e,b.next=null,b.list=E,T[f]=E,f>0&&(U[f]=h,C.b=x[f],C.e=16+m,C.t=E,m=(h&(1<<w)-1)>>w-x[f],T[f-1][m].e=C.e,T[f-1][m].b=C.b,T[f-1][m].n=C.n,T[f-1][m].t=C.t)}for(C.b=p-w,g>=i?C.e=99:v[g]<o?(C.e=v[g]<256?16:15,C.n=v[g++]):(C.e=a[v[g]-o],C.n=r[v[g++]-o]),u=1<<p-w,m=h>>w;B>m;m+=u)E[m].e=C.e,E[m].b=C.b,E[m].n=C.n,E[m].t=C.t;for(m=1<<p-1;0!==(h&m);m>>=1)h^=m;for(h^=m;(h&(1<<w)-1)!==U[f];)w-=x[f],f--}this.m=x[1],this.status=0!==_&&1!==l?1:0}function i(){return D.length===U?-1:255&D[U++]}function o(e){for(;e>y;)w|=i()<<y,y+=8}function r(e){return w&R[e]}function a(e){w>>=e,y-=e}function s(e,t,n){var i,s,d;if(0===n)return 0;for(d=0;;){for(o(C),s=L.list[r(C)],i=s.e;i>16;){if(99===i)return-1;a(s.b),i-=16,o(i),s=s.t[r(i)],i=s.e}if(a(s.b),16!==i){if(15===i)break;for(o(i),I=s.n+r(i),a(i),o(T),s=x.list[r(T)],i=s.e;i>16;){if(99===i)return-1;a(s.b),i-=16,o(i),s=s.t[r(i)],i=s.e}for(a(s.b),o(i),b=p-s.n-r(i),a(i);I>0&&n>d;)I--,b&=k-1,p&=k-1,e[t+d++]=m[p++]=m[b++];if(d===n)return n}else if(p&=k-1,e[t+d++]=m[p++]=s.n,d===n)return n}return _=-1,d}function d(e,t,n){var i;if(i=7&y,a(i),o(16),i=r(16),a(16),o(16),i!==(65535&~w))return-1;for(a(16),I=i,i=0;I>0&&n>i;)I--,p&=k-1,o(8),e[t+i++]=m[p++]=r(8),a(8);return 0===I&&(_=-1),i}function c(e,t,i){if(!O){var o,r,a=[];for(o=0;144>o;o++)a[o]=8;for(null;256>o;o++)a[o]=9;for(null;280>o;o++)a[o]=7;for(null;288>o;o++)a[o]=8;if(g=7,r=new n(a,288,257,z,N,g),0!==r.status)return console.error("HufBuild error: "+r.status),-1;for(O=r.root,g=r.m,o=0;30>o;o++)a[o]=5;if(E=5,r=new n(a,30,0,$,q,E),r.status>1)return O=null,console.error("HufBuild error: "+r.status),-1;v=r.root,E=r.m}return L=O,x=v,C=g,T=E,s(e,t,i)}function u(e,t,i){var d,c,u,l,f,h,m,p,v,g=[];for(d=0;316>d;d++)g[d]=0;if(o(5),m=257+r(5),a(5),o(5),p=1+r(5),a(5),o(4),h=4+r(4),a(4),m>286||p>30)return-1;for(c=0;h>c;c++)o(3),g[j[c]]=r(3),a(3);for(null;19>c;c++)g[j[c]]=0;if(C=7,v=new n(g,19,19,null,null,C),0!==v.status)return-1;for(L=v.root,C=v.m,l=m+p,d=u=0;l>d;)if(o(C),f=L.list[r(C)],c=f.b,a(c),c=f.n,16>c)g[d++]=u=c;else if(16===c){if(o(2),c=3+r(2),a(2),d+c>l)return-1;for(;c-->0;)g[d++]=u}else if(17===c){if(o(3),c=3+r(3),a(3),d+c>l)return-1;for(;c-->0;)g[d++]=0;u=0}else{if(o(7),c=11+r(7),a(7),d+c>l)return-1;for(;c-->0;)g[d++]=0;u=0}if(C=A,v=new n(g,m,257,z,N,C),0===C&&(v.status=1),0!==v.status&&1!==v.status)return-1;for(L=v.root,C=v.m,d=0;p>d;d++)g[d]=g[d+m];return T=P,v=new n(g,p,0,$,q,T),x=v.root,T=v.m,0===T&&m>257?-1:0!==v.status?-1:s(e,t,i)}function l(){m||(m=[]),p=0,w=0,y=0,_=-1,B=!1,I=b=0,L=null}function f(e,t,n){var i,l;for(i=0;n>i;){if(B&&-1===_)return i;if(I>0){if(_!==M)for(;I>0&&n>i;)I--,b&=k-1,p&=k-1,e[t+i++]=m[p++]=m[b++];else{for(;I>0&&n>i;)I--,p&=k-1,o(8),e[t+i++]=m[p++]=r(8),a(8);0===I&&(_=-1)}if(i===n)return i}if(-1===_){if(B)break;o(1),0!==r(1)&&(B=!0),a(1),o(2),_=r(2),a(2),L=null,I=0}switch(_){case M:l=d(e,t+i,n-i);break;case S:l=L?s(e,t+i,n-i):c(e,t+i,n-i);break;case Y:l=L?s(e,t+i,n-i):u(e,t+i,n-i);break;default:l=-1}if(-1===l)return B?0:-1;i+=l}return i}function h(e){var t,n,i=[];if("string"==typeof e)for(n=e,e=[],t=0;t<n.length;t++)e[t]=n.charCodeAt(t);l(),D=e,U=0;do t=f(i,i.length,1024);while(t>0);for(D=null,n="",t=0;t<i.length;t++)n+=String.fromCharCode(i[t]);return n}var m,p,v,g,E,w,y,_,B,I,b,L,x,C,T,D,U,k=32768,M=0,S=1,Y=2,A=9,P=6,O=null,R=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],z=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],$=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.inflate=h}(),"function"!=typeof Blob||"undefined"==typeof URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},o=n.prototype,r=i.prototype,a=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},d="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=d.length,u=e.URL||e.webkitURL||e,l=u.createObjectURL,f=u.revokeObjectURL,h=u,m=e.btoa,p=e.atob,v=!1,g=function(e){v=!e},E=e.ArrayBuffer,w=e.Uint8Array;for(i.fake=r.fake=!0;c--;)s.prototype[d[c]]=c+1;try{w&&g.apply(0,new w(3528e4))}catch(y){}return u.createObjectURL||(h=e.URL={}),h.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):l?l.call(u,e):void 0},h.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&f&&f.call(u,e)},o.append=function(e){var n=this.data;if(w&&(e instanceof E||e instanceof w))if(v)n.push(String.fromCharCode.apply(String,new w(e)));else{for(var o="",r=new w(e),d=0,c=r.length;c>d;d++)o+=String.fromCharCode(r[d]);n.push(o)}else if("Blob"===t(e)||"File"===t(e)){if(!a)throw new s("NOT_READABLE_ERR");var u=new a;n.push(u.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&p?n.push(p(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},r.slice=function(e,t,n){var o=arguments.length;return 3>o&&(n=null),new i(this.data.slice(e,o>1?t:this.data.length),n,this.encoding)},r.toString=function(){return"[object Blob]"},n}(e);return function(e,n){var i=n?n.type||"":"",o=new t;if(e)for(var r=0,a=e.length;a>r;r++)o.append(e[r]);return o.getBlob(i)}}(self);var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=e.URL||e.webkitURL||e,o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,a=function(n){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},s=e.webkitRequestFileSystem,d=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",l=0,f=[],h=function(){for(var e=f.length;e--;){var t=f[e];"string"==typeof t?i.revokeObjectURL(t):t.remove()}f.length=0},m=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,n||e)}catch(r){c(r)}}},p=function(t,i){var c,h,p,v=this,g=t.type,E=!1,w=function(){var e=n().createObjectURL(t);return f.push(e),e},y=function(){m(v,"writestart progress write writeend".split(" "))},_=function(){(E||!c)&&(c=w(t)),h?h.location.href=c:window.open(c,"_blank"),v.readyState=v.DONE,y()},B=function(e){return function(){return v.readyState!==v.DONE?e.apply(this,arguments):void 0}},I={create:!0,exclusive:!1};return v.readyState=v.INIT,i||(i="download"),r?(c=w(t),o.href=c,o.download=i,a(o),v.readyState=v.DONE,void y()):(e.chrome&&g&&g!==u&&(p=t.slice||t.webkitSlice,t=p.call(t,0,t.size,u),E=!0),s&&"download"!==i&&(i+=".download"),(g===u||s)&&(h=e),d?(l+=t.size,void d(e.TEMPORARY,l,B(function(e){e.root.getDirectory("saved",I,B(function(e){var n=function(){e.getFile(i,I,B(function(e){e.createWriter(B(function(n){n.onwriteend=function(t){h.location.href=e.toURL(),f.push(e),v.readyState=v.DONE,m(v,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&_()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=v["on"+e]}),n.write(t),v.abort=function(){n.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),_)}),_)};e.getFile(i,{create:!1},B(function(e){e.remove(),n()}),B(function(e){e.code===e.NOT_FOUND_ERR?n():_()}))}),_)}),_)):void _())},v=p.prototype,g=function(e,t){return new p(e,t)};return v.abort=function(){var e=this;e.readyState=e.DONE,m(e,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,e.addEventListener("unload",h,!1),g}(self);!function(e){"use strict";function t(){}function n(){this.inputInUse=!1,this.outputInUse=!1;var e=document.createElement("object");e.id="_Jazz"+Math.random()+"ie",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",this.activeX=e;var t=document.createElement("object");t.id="_Jazz"+Math.random(),t.type="audio/x-jazz",e.appendChild(t),this.objRef=t;var n=document.createElement("p");n.appendChild(document.createTextNode("This page requires the "));var i=document.createElement("a");i.appendChild(document.createTextNode("Jazz plugin")),i.href="http://jazz-soft.net/",n.appendChild(i),n.appendChild(document.createTextNode(".")),t.appendChild(n);var o=document.getElementById("MIDIPlugin");if(!o){var o=document.createElement("div");o.id="MIDIPlugin",o.style.position="absolute",o.style.visibility="hidden",o.style.left="-9999px",o.style.top="-9999px",document.body.appendChild(o)}o.appendChild(e),this._Jazz=this.objRef.isJazz?this.objRef:this.activeX.isJazz?this.activeX:null,this._Jazz&&(this._Jazz._jazzTimeZero=this._Jazz.Time(),this._Jazz._perfTimeZero=window.performance.now())}function i(){this._jazzInstances=new Array,this._jazzInstances.push(new n),this._promise=new t,this._jazzInstances[0]._Jazz?(this._Jazz=this._jazzInstances[0]._Jazz,window.setTimeout(s.bind(this),3)):window.setTimeout(o.bind(this),3)}function o(){this._promise&&this._promise.fail({code:1})}function r(){this.jazz.MidiOutLong(this.data)}var a,i,s,d,c,u;t.prototype.then=function(e,t){this.accept=e,this.reject=t},t.prototype.succeed=function(e){this.accept&&this.accept(e)},t.prototype.fail=function(e){this.reject&&this.reject(e)},a=function(){var e=new i;return e._promise},s=function(){this._promise&&this._promise.succeed(this)},i.prototype.inputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiInList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new d(this,e[n],n);return t},i.prototype.outputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiOutList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new c(this,e[n],n);return t},d=function(e,t,i){this._listeners=[],this._midiAccess=e,this._index=i,this._inLongSysexMessage=!1,this._sysexBuffer=new Uint8Array,this.id=""+i+"."+t,this.manufacturer="",this.name=t,this.type="input",this.version="",this.onmidimessage=null;for(var o=null,r=0;r<e._jazzInstances.length&&!o;r++)e._jazzInstances[r].inputInUse||(o=e._jazzInstances[r]);o||(o=new n,e._jazzInstances.push(o)),o.inputInUse=!0,this._jazzInstance=o._Jazz,this._input=this._jazzInstance.MidiInOpen(this._index,u.bind(this))},d.prototype.addEventListener=function(e,t,n){if("midimessage"===e){for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]==t)return;this._listeners.push(t)}},d.prototype.removeEventListener=function(e,t,n){if("midimessage"===e)for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]==t)return void this._listeners.splice(i,1)},d.prototype.preventDefault=function(){this._pvtDef=!0},d.prototype.dispatchEvent=function(e){this._pvtDef=!1;for(var t=0;t<this._listeners.length;t++)this._listeners[t].handleEvent?this._listeners[t].handleEvent.bind(this)(e):this._listeners[t].bind(this)(e);return this.onmidimessage&&this.onmidimessage(e),this._pvtDef},d.prototype.appendToSysexBuffer=function(e){var t=this._sysexBuffer.length,n=new Uint8Array(t+e.length);n.set(this._sysexBuffer),n.set(e,t),this._sysexBuffer=n},d.prototype.bufferLongSysex=function(e,t){for(var n=t;n<e.length;){if(247==e[n])return n++,this.appendToSysexBuffer(e.slice(t,n)),n;n++}return this.appendToSysexBuffer(e.slice(t,n)),this._inLongSysexMessage=!0,n},u=function(e,t){var n,i=0,o=!1;for(n=0;n<t.length;n+=i){if(this._inLongSysexMessage){if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;o=!0}else switch(o=!1,240&t[n]){case 128:case 144:case 160:case 176:case 224:i=3;break;case 192:case 208:i=2;break;case 240:switch(t[n]){case 240:if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;o=!0;break;case 241:case 243:i=2;break;case 242:i=3;break;default:i=1}}var r=document.createEvent("Event");r.initEvent("midimessage",!1,!1),r.receivedTime=parseFloat(e.toString())+this._jazzInstance._perfTimeZero,o||this._inLongSysexMessage?(r.data=new Uint8Array(this._sysexBuffer),this._sysexBuffer.length=0,this._inLongSysexMessage=!1):r.data=new Uint8Array(t.slice(n,i+n)),this.dispatchEvent(r)}},c=function(e,t,i){this._listeners=[],this._midiAccess=e,this._index=i,this.id=""+i+"."+t,this.manufacturer="",this.name=t,this.type="output",this.version="";for(var o=null,r=0;r<e._jazzInstances.length&&!o;r++)e._jazzInstances[r].outputInUse||(o=e._jazzInstances[r]);o||(o=new n,e._jazzInstances.push(o)),o.outputInUse=!0,this._jazzInstance=o._Jazz,this._jazzInstance.MidiOutOpen(this.name)},c.prototype.send=function(e,t){var n=0;if(0===e.length)return!1;if(t&&(n=Math.floor(t-window.performance.now())),t&&n>1){var i=new Object;i.jazz=this._jazzInstance,i.data=e,window.setTimeout(r.bind(i),n)}else this._jazzInstance.MidiOutLong(e);return!0},window.navigator.requestMIDIAccess||(window.navigator.requestMIDIAccess=a)}(window),function(e){function t(){for(var t=["moz","webkit","o","ms"],n=t.length,i={value:function(e){return function(){return Date.now()-e}}(Date.now())};n>=0;n--)if(t[n]+"Now"in e.performance)return i.value=function(t){return function(){e.performance[t]()}}(t[n]+"Now"),i;return"timing"in e.performance&&"connectStart"in e.performance.timing&&(i.value=function(e){return function(){Date.now()-e}}(e.performance.timing.connectStart)),i}var n,i={};"performance"in e&&"now"in e.performance||("performance"in e||Object.defineProperty(e,"performance",{get:function(){return i}}),n=t(),Object.defineProperty(e.performance,"now",n))}(window);var CBinParser=function(e){var t=e,n=0;this.getUBYTE=function(){return 255&t.charCodeAt(n++)},this.getUSHORT=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8;return n+=2,e},this.getULONG=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;return n+=4,e},this.getFLOAT=function(){var e=this.getULONG();if(0==e)return 0;var t=2147483648&e,n=e>>23&255,i=1+(8388607&e)/8388608,o=i*Math.pow(2,n-127);return t?-o:o},this.getTail=function(){var e=t.slice(n);return n=t.length,e}},CBinWriter=function(){var e="";this.putUBYTE=function(t){e+=String.fromCharCode(t)},this.putUSHORT=function(t){e+=String.fromCharCode(255&t,t>>8&255)},this.putULONG=function(t){e+=String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},this.putFLOAT=function(e){var t=0;if(0!=e){var n=0;0>e&&(n=2147483648,e=-e);for(var i=150;8388608>e;)e*=2,i--;for(;e>=16777216;)e/=2,i++;t=n|(255&i)<<23|8388607&e}this.putULONG(t)},this.append=function(t){e+=t},this.getData=function(){return e}},CAudioTimer=function(){var e=null,t=0,n=[0,0,0,0,0,0],i=0;this.setAudioElement=function(t){e=t},this.currentTime=function(){if(!e)return 0;var o,r=.001*(new Date).getTime(),a=r-t,s=e.currentTime,d=s-a;if(.01>s||d>.2||-.2>d)for(a=s,t=r-a,o=0;o<n.length;o++)n[o]=0;var c=0;for(o=0;o<n.length;o++)c+=n[o];return c/=n.length,n[i]=d,i=(i+1)%n.length,a+c},this.reset=function(){t=.001*(new Date).getTime();for(var e=0;e<n.length;e++)n[e]=0}},CGUI=function(){var e,t,n,i,o,r="tracker/image/gui/",a=0,s=1,d=2,c=3,u=128,l=36,f=d,h=5,m=0,p=0,v=0,g=0,E=0,w=0,y=0,_=0,B=0,I=0,b=!1,L=!1,x=!1,C=[],T=[],D=[],U=[],k={},M=null,S=new CAudioTimer,Y=new CPlayer,A=new Image,P=new Image,O=new Image,R=new CJammer,z=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],N=[26,1,63,3,116,6,150,8,184,10,238,13,274,15,327,18,362,20,394,22],q=[],j=function(e){var t=e.indexOf("?");return e.slice(0,t>=0?t:e.length)},H=function(e){var t=e.indexOf("?")+1,n=e.indexOf("#")+1||e.length+1,i=e.slice(t,n-1),o={};if(i===e||""===i)return o;for(var r=i.replace(/\+/g," ").split("&"),a=0;a<r.length;a++){var s=r[a].split("="),d=decodeURIComponent(s[0]),c=decodeURIComponent(s[1]);d in o||(o[d]=[]),o[d].push(2===s.length?c:null)}return o},F=function(e){var t=void 0;if(e){var n=e,i="";if(0==n.indexOf("data:")){var o=n.indexOf("base64,");o>0&&(i=n.substr(o+7))}else for(var r=0;r<n.length;++r){var a=n[r];"-"===a&&(a="+"),"_"===a&&(a="/"),i+=a}try{t=atob(i)}catch(s){t=void 0}}return t},X=function(t){for(var n=btoa(t),i="",o=0;o<n.length;++o){var r=n[o];"+"===r&&(r="-"),"/"===r&&(r="_"),"="===r&&(r=""),i+=r}return e+"?data="+i},W=function(e){return Math.round(661500/e)},J=function(){return Math.round(661500/k.rowLen)},G=0,V=1,Q=2,Z=3,K=4,ee=5,te=6,ne=7,ie=8,oe=9,re=10,ae=11,se=12,de=13,ce=14,ue=15,le=16,fe=17,he=18,me=19,pe=20,ve=21,ge=22,Ee=23,we=24,ye=25,_e=function(){var e,t,n,i,o,r={};r.rowLen=W(120),r.endPattern=2,r.patternLen=32;var a;for(e=0;e<gInstrumentPresets.length;++e)if(gInstrumentPresets[e].i){a=gInstrumentPresets[e];break}for(r.songData=[],e=0;8>e;e++){for(i={},i.i=[],t=0;t<=a.i.length;++t)i.i[t]=a.i[t];for(i.p=[],t=0;u>t;t++)i.p[t]=0;for(i.c=[],t=0;l>t;t++){for(o={},o.n=[],n=0;n<4*r.patternLen;n++)o.n[n]=0;for(o.f=[],n=0;n<2*r.patternLen;n++)o.f[n]=0;i.c[t]=o}r.songData[e]=i}return r.songData[0].p[0]=1,r},Be=function(e){var t=new CBinWriter;t.putULONG(e.rowLen),t.putUBYTE(e.endPattern-2),t.putUBYTE(e.patternLen);var n,i,o,r,a;for(n=0;8>n;n++){for(r=e.songData[n],t.putUBYTE(r.i[G]),t.putUBYTE(r.i[V]),t.putUBYTE(r.i[Q]),t.putUBYTE(r.i[Z]),t.putUBYTE(r.i[K]),t.putUBYTE(r.i[ee]),t.putUBYTE(r.i[te]),t.putUBYTE(r.i[ne]),t.putUBYTE(r.i[ie]),t.putUBYTE(r.i[oe]),t.putUBYTE(r.i[re]),t.putUBYTE(r.i[ae]),t.putUBYTE(r.i[se]),t.putUBYTE(r.i[de]),t.putUBYTE(r.i[ce]),t.putUBYTE(r.i[ue]),t.putUBYTE(r.i[le]),t.putUBYTE(r.i[fe]),t.putUBYTE(r.i[he]),t.putUBYTE(r.i[me]),t.putUBYTE(r.i[pe]),t.putUBYTE(r.i[ve]),t.putUBYTE(r.i[ge]),t.putUBYTE(r.i[Ee]),t.putUBYTE(r.i[we]),t.putUBYTE(r.i[ye]),i=0;u>i;i++)t.putUBYTE(r.p[i]);for(i=0;l>i;i++){for(a=r.c[i],o=0;o<4*e.patternLen;o++)t.putUBYTE(a.n[o]);for(o=0;o<2*e.patternLen;o++)t.putUBYTE(a.f[o])}}var s,d,c=t.getData(),f=0;for(n=9;n>0;n--)if(s=RawDeflate.deflate(c,n),d=RawDeflate.inflate(s),c===d){f=2;break}return 0==f&&(s=rle_encode(t.getData()),d=rle_decode(s),c===d?f=1:s=c),t=new CBinWriter,t.putULONG(2020557395),t.putUBYTE(10),t.putUBYTE(f),t.append(s),t.getData()},Ie=function(e){var t=new CBinParser(e),n={},i=t.getULONG(),o=t.getUBYTE();if(2020557395!=i||1>o||o>10)return void 0;if(o>=8){var r,a=t.getUBYTE(),s=t.getTail();switch(a){default:case 0:r=s;break;case 1:r=rle_decode(s);break;case 2:r=RawDeflate.inflate(s)}t=new CBinParser(r)}n.rowLen=t.getULONG(),n.endPattern=t.getUBYTE()+2,n.patternLen=o>=10?t.getUBYTE():32,n.songData=[];var d,c,f,h,m;for(d=0;8>d;d++){h={},h.i=[],6>o?(h.i[Q]=t.getUBYTE(),h.i[Z]=t.getUBYTE(),h.i[V]=t.getUBYTE(),h.i[G]=t.getUBYTE()):(h.i[G]=t.getUBYTE(),h.i[V]=t.getUBYTE(),h.i[Q]=t.getUBYTE(),h.i[Z]=t.getUBYTE()),6>o?(h.i[te]=t.getUBYTE(),h.i[ne]=t.getUBYTE(),h.i[ie]=t.getUBYTE(),h.i[ee]=t.getUBYTE(),h.i[K]=t.getUBYTE()):(h.i[K]=t.getUBYTE(),h.i[ee]=t.getUBYTE(),h.i[te]=t.getUBYTE(),h.i[ne]=t.getUBYTE(),h.i[ie]=t.getUBYTE()),h.i[oe]=t.getUBYTE(),5>o?(h.i[re]=Math.round(Math.sqrt(t.getULONG())/2),h.i[ae]=Math.round(Math.sqrt(t.getULONG())/2),h.i[se]=Math.round(Math.sqrt(t.getULONG())/2)):(h.i[re]=t.getUBYTE(),h.i[ae]=t.getUBYTE(),h.i[se]=t.getUBYTE()),6>o?(h.i[fe]=t.getUBYTE(),h.i[he]=5>o?Math.round(t.getUSHORT()/43.23529):t.getUBYTE(),h.i[me]=t.getUBYTE(),h.i[ye]=t.getUBYTE(),h.i[we]=t.getUBYTE(),h.i[Ee]=t.getUBYTE(),h.i[ge]=t.getUBYTE(),h.i[pe]=t.getUBYTE(),h.i[ve]=t.getUBYTE(),h.i[le]=t.getUBYTE(),h.i[ue]=t.getUBYTE(),h.i[ce]=t.getUBYTE(),h.i[de]=t.getUBYTE()):(h.i[de]=t.getUBYTE(),h.i[ce]=t.getUBYTE(),h.i[ue]=t.getUBYTE(),h.i[le]=t.getUBYTE(),h.i[fe]=t.getUBYTE(),h.i[he]=t.getUBYTE(),h.i[me]=t.getUBYTE(),h.i[pe]=t.getUBYTE(),h.i[ve]=t.getUBYTE(),h.i[ge]=t.getUBYTE(),h.i[Ee]=t.getUBYTE(),h.i[we]=t.getUBYTE(),h.i[ye]=t.getUBYTE());var p=9>o?48:u;for(h.p=[],c=0;p>c;c++)h.p[c]=t.getUBYTE();for(c=p;u>c;c++)h.p[c]=0;var v=9>o?10:l;for(h.c=[],c=0;v>c;c++){if(m={},m.n=[],1==o)for(f=0;f<n.patternLen;f++)m.n[f]=t.getUBYTE(),m.n[f+n.patternLen]=0,m.n[f+2*n.patternLen]=0,m.n[f+3*n.patternLen]=0;else for(f=0;f<4*n.patternLen;f++)m.n[f]=t.getUBYTE();if(m.f=[],4>o)for(f=0;f<2*n.patternLen;f++)m.f[f]=0;else for(f=0;f<2*n.patternLen;f++)m.f[f]=t.getUBYTE();h.c[c]=m}for(c=v;l>c;c++){for(m={},m.n=[],f=0;f<4*n.patternLen;f++)m.n[f]=0;for(m.f=[],f=0;f<2*n.patternLen;f++)m.f[f]=0;h.c[c]=m}3>o&&(2==h.i[G]&&(h.i[V]=Math.round(h.i[V]/2)),2==h.i[K]&&(h.i[ee]=Math.round(h.i[ee]/2)),2==h.i[de]&&(h.i[ce]=Math.round(h.i[ce]/2)),h.i[ve]=h.i[ve]<224?h.i[ve]+32:255),7>o&&(h.i[me]=255-h.i[me]),n.songData[d]=h}return n},be=function(e){if(3333!=e.length)return void 0;if((255&e.charCodeAt(3332))>48)return void 0;var t=new CBinParser(e),n={};n.rowLen=t.getULONG(),n.patternLen=32,n.songData=[];var i,o,r,a,s,d;for(i=0;8>i;i++){for(a={},a.i=[],a.i[Q]=12*(t.getUBYTE()-8)+128,a.i[Q]+=t.getUBYTE(),t.getUBYTE(),a.i[Z]=t.getUBYTE(),a.i[V]=t.getUBYTE(),a.i[G]=t.getUBYTE(),a.i[te]=12*(t.getUBYTE()-8)+128,a.i[te]+=t.getUBYTE(),a.i[ne]=t.getUBYTE(),a.i[ie]=t.getUBYTE(),a.i[ee]=t.getUBYTE(),a.i[K]=t.getUBYTE(),a.i[oe]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),a.i[re]=Math.round(Math.sqrt(t.getULONG())/2),a.i[ae]=Math.round(Math.sqrt(t.getULONG())/2),a.i[se]=Math.round(Math.sqrt(t.getULONG())/2),d=t.getUBYTE(),a.i[fe]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),a.i[he]=Math.round(t.getFLOAT()/43.23529),a.i[me]=255-t.getUBYTE(),a.i[ye]=t.getUBYTE(),a.i[we]=t.getUBYTE(),a.i[Ee]=t.getUBYTE(),a.i[ge]=t.getUBYTE(),a.i[pe]=0,a.i[ve]=32,t.getUBYTE(),a.i[le]=t.getUBYTE(),a.i[ue]=t.getUBYTE(),a.i[ce]=t.getUBYTE(),a.i[de]=t.getUBYTE(),a.p=[],o=0;48>o;o++)a.p[o]=t.getUBYTE();for(o=48;u>o;o++)a.p[o]=0;for(a.c=[],o=0;10>o;o++){for(s={},s.n=[],r=0;32>r;r++)s.n[r]=t.getUBYTE(),s.n[r+32]=0,s.n[r+64]=0,s.n[r+96]=0;for(s.f=[],r=0;64>r;r++)s.f[r]=0;a.c[o]=s}for(o=10;l>o;o++){for(s={},s.n=[],r=0;128>r;r++)s.n[r]=0;for(s.f=[],r=0;64>r;r++)s.f[r]=0;a.c[o]=s}t.getUBYTE(),t.getUBYTE(),(a.i[fe]<1||a.i[fe]>3)&&(a.i[fe]=2,a.i[he]=255),a.i[V]*=d/255,a.i[ee]*=d/255,a.i[oe]*=d/255,2==a.i[G]&&(a.i[V]/=2),2==a.i[K]&&(a.i[ee]/=2),2==a.i[de]&&(a.i[ce]/=2),a.i[V]=Math.round(a.i[V]),a.i[ee]=Math.round(a.i[ee]),a.i[oe]=Math.round(a.i[oe]),a.i[ce]=Math.round(a.i[ce]),n.songData[i]=a}return n.endPattern=t.getUBYTE()+2,n},Le=function(e){var t=Ie(e);return t||(t=be(e)),t?t:void alert("Song format not recognized.")},xe=function(e){var t,n,i,o,r="";for(r+="    // This music has been exported by SoundBox. You can use it with\n",r+="    // http://sb.bitsnbites.eu/player-small.js in your own product.\n\n",r+="    // See http://sb.bitsnbites.eu/demo.html for an example of how to\n",r+="    // use it in a demo.\n\n",r+="    // Song data\n",r+="    var song = {\n",r+="      songData: [\n",t=0;8>t;t++){var a=e.songData[t];r+="        { // Instrument "+t+"\n",r+="          i: [\n",r+="          "+a.i[G]+", // OSC1_WAVEFORM\n",r+="          "+a.i[V]+", // OSC1_VOL\n",r+="          "+a.i[Q]+", // OSC1_SEMI\n",r+="          "+a.i[Z]+", // OSC1_XENV\n",r+="          "+a.i[K]+", // OSC2_WAVEFORM\n",r+="          "+a.i[ee]+", // OSC2_VOL\n",r+="          "+a.i[te]+", // OSC2_SEMI\n",r+="          "+a.i[ne]+", // OSC2_DETUNE\n",r+="          "+a.i[ie]+", // OSC2_XENV\n",r+="          "+a.i[oe]+", // NOISE_VOL\n",r+="          "+a.i[re]+", // ENV_ATTACK\n",r+="          "+a.i[ae]+", // ENV_SUSTAIN\n",r+="          "+a.i[se]+", // ENV_RELEASE\n",r+="          "+a.i[de]+", // LFO_WAVEFORM\n",r+="          "+a.i[ce]+", // LFO_AMT\n",r+="          "+a.i[ue]+", // LFO_FREQ\n",r+="          "+a.i[le]+", // LFO_FX_FREQ\n",r+="          "+a.i[fe]+", // FX_FILTER\n",r+="          "+a.i[he]+", // FX_FREQ\n",r+="          "+a.i[me]+", // FX_RESONANCE\n",r+="          "+a.i[pe]+", // FX_DIST\n",r+="          "+a.i[ve]+", // FX_DRIVE\n",r+="          "+a.i[ge]+", // FX_PAN_AMT\n",r+="          "+a.i[Ee]+", // FX_PAN_FREQ\n",r+="          "+a.i[we]+", // FX_DELAY_AMT\n",r+="          "+a.i[ye]+" // FX_DELAY_TIME\n",r+="          ],\n",r+="          // Patterns\n",r+="          p: [";var s=e.endPattern-2,d=0,c=0;for(n=0;s>=n;n++)o=a.p[n],o>d&&(d=o),o&&(c=n);for(n=0;c>=n;n++)o=a.p[n],o&&(r+=o),c>n&&(r+=",");for(r+="],\n",r+="          // Columns\n",r+="          c: [\n",n=0;d>n;n++){for(r+="            {n: [",c=0,i=0;i<4*e.patternLen;i++)a.c[n].n[i]&&(c=i);for(i=0;c>=i;i++){var u=a.c[n].n[i];u&&(r+=u),c>i&&(r+=",")}for(r+="],\n",r+="             f: [",c=0,i=0;i<2*e.patternLen;i++)a.c[n].f[i]&&(c=i);for(i=0;c>=i;i++){var l=a.c[n].f[i];l&&(r+=l),c>i&&(r+=",")}r+="]}",d-1>n&&(r+=","),r+="\n"}r+="          ]\n",r+="        }",7>t&&(r+=","),r+="\n"}return r+="      ],\n",r+="      rowLen: "+e.rowLen+",   // In sample lengths\n",r+="      patternLen: "+e.patternLen+",  // Rows per pattern\n",r+="      endPattern: "+e.endPattern+"  // End pattern\n",r+="    };\n"},Ce=function(e){var t=e.data[0]>>4,n=15&e.data[0],i=e.data[1],o=e.data[2];9!=n&&9==t&&o>0&&Ve(i-12)},Te=function(e){o=i.inputs()[n.selectedIndex],o.onmidimessage=Ce},De=function(e){i=e;var t,r="function"==typeof i.inputs?i.inputs():[],a=0;for(t=0;t<r.length;t++){var s=r[t].name.toString().toLowerCase();if(-1!=s.indexOf("keyboard")){a=t;break}}if(n.options.length=0,r.length){for(t=0;t<r.length;t++)n.options[t]=new Option(r[t].name,r[t].fingerprint,t==a,t==a);o=r[a],o.onmidimessage=Ce,n.onchange=Te,n.style.display="inline"}},Ue=function(e){},ke=function(){navigator.requestMIDIAccess&&(n=document.getElementById("midiInput"),navigator.requestMIDIAccess().then(De,Ue))},Me=function(e){var t=new Image;t.src=e,q.push(t)},Se=function(){for(var e,t,n=document.getElementById("instrPreset"),i=0;i<gInstrumentPresets.length;++i)t=gInstrumentPresets[i],e=document.createElement("option"),e.value=t.i?""+i:"",e.appendChild(document.createTextNode(t.name)),n.appendChild(e)},Ye=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},Ae=function(e){var t=null;return e||(e=window.event),e.target?t=e.target:e.srcElement&&(t=e.srcElement),
3==t.nodeType&&(t=t.parentNode),t},Pe=function(e,t){var n=[0,0];if(e.pageX&&e.pageY?n=[e.pageX,e.pageY]:e.clientX&&e.clientY?n=[e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.clientY+document.body.scrollTop+document.documentElement.scrollTop]:e.touches&&e.touches.length>0&&(n=[e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop]),!t)return n;var i=Ye(Ae(e));return[n[0]-i[0],n[1]-i[1]]},Oe=function(){document.getElementById("bpm").blur(),document.getElementById("rpp").blur(),document.getElementById("instrPreset").blur()},Re=function(e){e!==f&&(f=e,document.getElementById("sequencer").className=f==s?"edit":"",document.getElementById("pattern").className=f==d?"edit":"",document.getElementById("fxtrack").className=f==c?"edit":"",f!=a&&(Oe(),tt(),it()))},ze=function(){document.getElementById("bpm").value=J(),document.getElementById("rpp").value=k.patternLen},Ne=function(e,t){for(var n,i=0;u>i;++i)for(var o=0;8>o;++o){if(n=document.getElementById("sc"+o+"r"+i),!t){var r=k.songData[o].p[i];n.innerHTML=r>0?""+(10>=r?r-1:String.fromCharCode(64+r-10)):""}n.className=i>=w&&_>=i&&o>=E&&y>=o?"selected":""}if(e&&(n=document.getElementById("spr"+w),n.scrollIntoView)){var a=document.getElementById("sequencer"),s=n.offsetTop-a.scrollTop;(0>s||s+10>a.offsetHeight)&&n.scrollIntoView(0>s)}},$e=function(e,t){Un();for(var n,i=E==y&&w==_,o=i?k.songData[E].p[w]-1:-1,r=0;r<k.patternLen;++r)for(var a=0;4>a;++a){if(n=document.getElementById("pc"+a+"r"+r),!t){var s="";if(o>=0){var d=k.songData[E].c[o].n[r+a*k.patternLen]-87;d>0&&(s=z[d%12]+Math.floor(d/12))}n.innerHTML!=s&&(n.innerHTML=s)}n.className=r>=p&&g>=r&&a>=m&&v>=a?"selected":""}if(e&i&&(n=document.getElementById("pc0r"+p),n.scrollIntoView)){var c=document.getElementById("pattern"),u=n.offsetTop-c.scrollTop;(0>u||u+10>c.offsetHeight)&&n.scrollIntoView(0>u)}},qe=function(e,t){for(var n=e.toString(16).toUpperCase(),i=t-n.length,o=0;i>o;++o)n="0"+n;return n},je=function(e,t){kn();for(var n,i=E==y&&w==_,o=i?k.songData[E].p[w]-1:-1,r=0;r<k.patternLen;++r){if(n=document.getElementById("fxr"+r),!t){var a=":";if(o>=0){var s=k.songData[E].c[o].f[r];if(s){var d=k.songData[E].c[o].f[r+k.patternLen];a=qe(s,2)+":"+qe(d,2)}}n.innerHTML!=a&&(n.innerHTML=a)}n.className=r>=B&&I>=r?"selected":""}if(e&i&&(n=document.getElementById("fxr"+B),n.scrollIntoView)){var c=document.getElementById("fxtrack"),u=n.offsetTop-c.scrollTop;(0>u||u+10>c.offsetHeight)&&n.scrollIntoView(0>u)}},He=function(e,t){m=e,p=t,v=e,g=t;for(var n=0;n<k.patternLen;++n)for(var i=0;4>i;++i){var o=document.getElementById("pc"+i+"r"+n);o.className=n==t&&i==e?"selected":""}$e(!0,!0)},Fe=function(e,t){v=e>=m?e:m,g=t>=p?t:p;for(var n=0;n<k.patternLen;++n)for(var i=0;4>i;++i){var o=document.getElementById("pc"+i+"r"+n);o.className=n>=p&&g>=n&&i>=m&&v>=i?"selected":""}$e(!1,!0)},Xe=function(e,t){E=e,w=t,y=e,_=t,Ne(!0,!0)},We=function(e,t){y=e>=E?e:E,_=t>=w?t:w,Ne(!1,!0)},Je=function(e){B=e,I=e;for(var t=0;t<k.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=B&&I>=t?"selected":""}je(!0,!0)},Ge=function(e){I=e>=B?e:B;for(var t=0;t<k.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=B&&I>=t?"selected":""}je(!1,!0)},Ve=function(e){var t=e+87;if(R.addNote(t),f==d&&E==y&&w==_&&m==v&&p==g){var n=k.songData[E].p[w]-1;if(n>=0)return k.songData[E].c[n].n[p+m*k.patternLen]=t,He(m,(p+1)%k.patternLen),$e(),!0}return!1},Qe=function(e,t){var n=e.sliderProps,i=(t-n.min)/(n.max-n.min);i=0>i?0:i>1?1:i,n.nonLinear&&(i=Math.sqrt(i)),e.style.marginLeft=Math.round(191*i)+"px"},Ze=function(e,t){e.src=t?r+"box-check.png":r+"box-uncheck.png"},Ke=function(){var e=document.getElementById("instrPreset");e.selectedIndex=0},et=function(e){var t=k.songData[E];document.getElementById("osc1_wave_sin").src=0==t.i[G]?r+"wave-sin-sel.png":r+"wave-sin.png",document.getElementById("osc1_wave_sqr").src=1==t.i[G]?r+"wave-sqr-sel.png":r+"wave-sqr.png",document.getElementById("osc1_wave_saw").src=2==t.i[G]?r+"wave-saw-sel.png":r+"wave-saw.png",document.getElementById("osc1_wave_tri").src=3==t.i[G]?r+"wave-tri-sel.png":r+"/wave-tri.png",Qe(document.getElementById("osc1_vol"),t.i[V]),Qe(document.getElementById("osc1_semi"),t.i[Q]),Ze(document.getElementById("osc1_xenv"),t.i[Z]),document.getElementById("osc2_wave_sin").src=0==t.i[K]?r+"wave-sin-sel.png":r+"wave-sin.png",document.getElementById("osc2_wave_sqr").src=1==t.i[K]?r+"wave-sqr-sel.png":r+"wave-sqr.png",document.getElementById("osc2_wave_saw").src=2==t.i[K]?r+"wave-saw-sel.png":r+"wave-saw.png",document.getElementById("osc2_wave_tri").src=3==t.i[K]?r+"wave-tri-sel.png":r+"wave-tri.png",Qe(document.getElementById("osc2_vol"),t.i[ee]),Qe(document.getElementById("osc2_semi"),t.i[te]),Qe(document.getElementById("osc2_det"),t.i[ne]),Ze(document.getElementById("osc2_xenv"),t.i[ie]),Qe(document.getElementById("noise_vol"),t.i[oe]),Qe(document.getElementById("env_att"),t.i[re]),Qe(document.getElementById("env_sust"),t.i[ae]),Qe(document.getElementById("env_rel"),t.i[se]),document.getElementById("lfo_wave_sin").src=0==t.i[de]?r+"wave-sin-sel.png":r+"wave-sin.png",document.getElementById("lfo_wave_sqr").src=1==t.i[de]?r+"wave-sqr-sel.png":r+"wave-sqr.png",document.getElementById("lfo_wave_saw").src=2==t.i[de]?r+"wave-saw-sel.png":r+"wave-saw.png",document.getElementById("lfo_wave_tri").src=3==t.i[de]?r+"wave-tri-sel.png":r+"wave-tri.png",Qe(document.getElementById("lfo_amt"),t.i[ce]),Qe(document.getElementById("lfo_freq"),t.i[ue]),Ze(document.getElementById("lfo_fxfreq"),t.i[le]),document.getElementById("fx_filt_lp").src=2==t.i[fe]?r+"filt-lp-sel.png":r+"filt-lp.png",document.getElementById("fx_filt_hp").src=1==t.i[fe]?r+"filt-hp-sel.png":r+"filt-hp.png",document.getElementById("fx_filt_bp").src=3==t.i[fe]?r+"filt-bp-sel.png":r+"filt-bp.png",Qe(document.getElementById("fx_freq"),t.i[he]),Qe(document.getElementById("fx_res"),t.i[me]),Qe(document.getElementById("fx_dly_amt"),t.i[we]),Qe(document.getElementById("fx_dly_time"),t.i[ye]),Qe(document.getElementById("fx_pan_amt"),t.i[ge]),Qe(document.getElementById("fx_pan_freq"),t.i[Ee]),Qe(document.getElementById("fx_dist"),t.i[pe]),Qe(document.getElementById("fx_drive"),t.i[ve]),e&&Ke(),R.updateInstr(t.i)},tt=function(){var e=parseInt(document.getElementById("bpm").value);e&&e>=10&&1e3>=e&&(k.rowLen=W(e),R.updateRowLen(k.rowLen))},nt=function(e){if(k.patternLen!==e){yt();var t,n,i,o,r,a;for(t=0;8>t;t++)for(n=0;l>n;n++){for(o=k.songData[t].c[n],r=[],a=[],i=0;4*e>i;i++)r[i]=0;for(i=0;2*e>i;i++)a[i]=0;for(i=0;i<Math.min(k.patternLen,e);i++)r[i]=o.n[i],r[i+e]=o.n[i+k.patternLen],r[i+2*e]=o.n[i+2*k.patternLen],r[i+3*e]=o.n[i+3*k.patternLen],a[i]=o.f[i],a[i+e]=o.f[i+k.patternLen];o.n=r,o.f=a}k.patternLen=e}},it=function(){var e=parseInt(document.getElementById("rpp").value);e&&e>=1&&256>=e&&(nt(e),Un(),kn(),$e(),je())},ot=function(){var e,t,n;for(k.endPattern=u+1,e=u-1;e>=0;--e){for(n=!0,t=0;8>t;++t)if(k.songData[t].p[e]>0){n=!1;break}if(!n)break;k.endPattern--}tt()},rt=function(){var e=document.getElementById("cover");e.style.visibility="visible",e=document.getElementById("dialog"),e.style.visibility="visible",xn()},at=function(){var e=document.getElementById("cover");e.style.visibility="hidden",e=document.getElementById("dialog"),e.style.visibility="hidden",Ln()},st=function(e){var t=document.getElementById("dialog");t.innerHTML="";var n,i;n=document.createElement("img"),n.src=r+"progress.gif",t.appendChild(n),n=document.createTextNode(e),t.appendChild(n),n=document.createElement("div"),n.id="progressBarParent",t.appendChild(n),i=document.createElement("div"),i.id="progressBar",n.appendChild(i),rt()},dt=function(e){var t=Le(e);t&&(yt(),k=t,ze(),Ne(),$e(),je(),et(!0))},ct=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("h3"),t.appendChild(document.createTextNode("Open song")),e.appendChild(t),e.appendChild(document.createElement("br"));var n=document.createElement("form"),i=document.createElement("div");i.style.textAlign="left",i.style.marginLeft="30px",i.style.lineHeight="1.8em";for(var o=[],r=0;r<gDemoSongs.length;r++)t=document.createElement("input"),t.type="radio",t.name="radiogroup1",t.value=gDemoSongs[r].name,0===r&&(t.checked=!0),o.push(t),i.appendChild(t),t=document.createElement("span"),t.innerHTML=gDemoSongs[r].description,i.appendChild(t),i.appendChild(document.createElement("br"));var a=document.createElement("input");a.type="radio",a.name="radiogroup1",a.value="custom",i.appendChild(a),i.appendChild(document.createTextNode(" Data URL: "));var s=document.createElement("input");s.type="text",s.size="45",s.title="Paste a saved song data URL here",s.onchange=function(){a.checked=!0},s.onkeydown=s.onchange,s.onclick=s.onchange,i.appendChild(s),n.appendChild(i),t=document.createElement("p"),t.appendChild(document.createTextNode("Hint: You can also drag'n'drop binary files into the editor.")),n.appendChild(t),n.appendChild(document.createElement("br")),t=document.createElement("input"),t.type="submit",t.value="Open",t.title="Open song",t.onclick=function(e){e.preventDefault();var t=null;if(a.checked){var n=H(s.value);t=F(n&&n.data&&n.data[0])}else for(var i=0;i<o.length;i++)if(e=o[i],e.checked){for(var r=0;r<gDemoSongs.length;r++)if(gDemoSongs[r].name===e.value){t=gDemoSongs[r].data?gDemoSongs[r].data:F(gDemoSongs[r].base64);break}break}t&&dt(t),at()},n.appendChild(t),n.appendChild(document.createTextNode(" ")),t=document.createElement("input"),t.type="submit",t.value="Cancel",t.onclick=function(){return at(),!1},n.appendChild(t),e.appendChild(n),rt()},ut=function(){var e=document.getElementById("dialog");e.innerHTML="";var t,n;t=document.createElement("h3"),t.appendChild(document.createTextNode("Save song")),e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("Data URL (copy/paste, bookmark, mail etc):")),e.appendChild(t),t=document.createElement("p"),n=document.createElement("a");var i=X(Be(k)),o=i.length<70?i:i.slice(0,67)+"...";n.href=i,n.title=i,n.appendChild(document.createTextNode(o)),t.appendChild(n),e.appendChild(t);var r=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Save binary",t.title="Save the song as a binary file.",t.onclick=function(){var e="data:application/octet-stream;base64,"+btoa(Be(k));return window.open(e),at(),!1},r.appendChild(t),t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return at(),!1},r.appendChild(t),e.appendChild(r),rt()},lt=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("img"),t.src=r+"logo-big.png",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("an HTML5 synth music tracker")),e.appendChild(t),t=document.createElement("p"),t.innerHTML='Licensed under the <a href="LICENSE">GPL v3</a> license (get the <a href="http://gitorious.org/soundbox/soundbox">source</a>).',t.style.fontStyle="italic",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("To get started, open a demo song.")),e.appendChild(t),t=document.createElement("a"),t.href="help.html",t.appendChild(document.createTextNode("Help")),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createElement("br"));var n=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return at(),!1},n.appendChild(t),e.appendChild(n),rt()},ft=function(e){e.preventDefault(),lt()},ht=function(e){return k=_e(),ze(),Ne(),$e(),je(),et(),Re(d),He(0,0),Xe(0,0),Je(0),!1},mt=function(e){e.preventDefault(),ct()},pt=function(e){ot(),ut(),e.preventDefault()},vt=function(e){e.preventDefault(),ot();var t=function(e){var t=new Blob([e],{type:"application/octet-stream"});saveAs(t,"SoundBox-music.wav")};wt(t)},gt=function(e){ot();var t="data:text/javascript;base64,"+btoa(xe(k));return window.open(t),!1},Et=function(e){document.getElementById("statusText").innerHTML=e},wt=function(e,t){st("Generating sound...");var n=new Date;Y=new CPlayer,Y.generate(k,t,function(t){var i=document.getElementById("progressBar");if(i.style.width=Math.floor(200*t)+"px",t>=1){var o=Y.createWave(),r=new Date;Et("Generation time: "+(r.getTime()-n.getTime())/1e3+"s"),at(),e(o)}})},yt=function(){St(),M&&(M.pause(),S.reset())},_t=-1,Bt=0,It=0,bt=0,Lt=0,xt=!1,Ct=0,Tt=0,Dt=function(e,t){for(var n=44100*e/k.rowLen,i=Math.floor(n),o=Math.floor(i/k.patternLen)+Bt,r=i%k.patternLen,a=0;a<k.patternLen;++a){for(var s=o,d=r-a;0>d;){if(--s,Bt>s)return-1;d+=k.patternLen}for(var c=k.songData[t].p[s]-1,u=0;4>u;u++)if(c>=0&&k.songData[t].c[c].n[d+u*k.patternLen]>0)return(a+(n-i))*k.rowLen}return-1},Ut=function(e){var t=document.getElementById("playGfxCanvas"),n=A.width>0?A.width:t.width,i=A.height>0?A.height:51,o=t.getContext("2d");if(o){o.drawImage(A,0,0);var r=0,a=0;if(xt&&e>=0){var s,d,c,u=Y.getData(e,1e3),l=0,f=0,h=0,m=0;for(s=1;s<u.length;s+=2)d=u[s-1],c=u[s],l=.8*d+.1*l-.3*h,f=.8*c+.1*f-.3*m,h=d,m=c,r+=l*l,a+=f*f;r=.2*Math.sqrt(r/u.length)+.8*Ct,a=.2*Math.sqrt(a/u.length)+.8*Tt,Ct=r,Tt=a}var p=r>0?1.3+.5*Math.log(r):-1e3;p=-1>p?-1:p>1?1:p,p*=.57;var v=a>0?1.3+.5*Math.log(a):-1e3;for(v=-1>v?-1:v>1?1:v,v*=.57,o.strokeStyle="rgb(0,0,0)",o.beginPath(),o.moveTo(.25*n,2.1*i),o.lineTo(.25*n+1.8*i*Math.sin(p),2.1*i-1.8*i*Math.cos(p)),o.stroke(),o.beginPath(),o.moveTo(.75*n,2.1*i),o.lineTo(.75*n+1.8*i*Math.sin(v),2.1*i-1.8*i*Math.cos(v)),o.stroke(),o.fillStyle="rgb(0,0,0)",o.fillRect(0,i,n,20),s=0;8>s;++s){var g=Math.round(26+23*s);if(o.drawImage(P,g,i),s>=bt&&Lt>=s){var E=k.songData[s].i[re],w=k.songData[s].i[ae],y=k.songData[s].i[se];E=E*E*4,y=w*w*4+y*y*4;var _=E+y;1e4>_&&(_=1e4,y=_-E);var B=Dt(e,s);if(B>=0&&_>B){var I;I=E>B?B/E:1-(B-E)/y,o.globalAlpha=I*I,o.drawImage(O,g,i),o.globalAlpha=1}}}}},kt=function(){if(null!=M){var e,t,n=S.currentTime();if(M.ended||M.duration&&M.duration-n<.1)return St(),p=0,g=0,$e(),B=0,I=0,void je();var i=Math.floor(44100*n/k.rowLen),o=Math.floor(i/k.patternLen)+Bt,r=i%k.patternLen,a=o!=w,s=a||r!=p;if(a)for(o>=0&&(w=o,_=o,Ne(!0,!0)),e=0;u>e;++e)t=document.getElementById("spr"+e),t.className=e==o?"playpos":"";if(s)for(r>=0&&(p=r,g=r,$e(!0,!a),B=r,I=r,je(!0,!a)),e=0;e<k.patternLen;++e)t=document.getElementById("ppr"+e),t.className=e==r?"playpos":"";Ut(n)}},Mt=function(){w=Bt,_=Bt,y=E,Ne(!0,!0),$e(),je(),xt=!0,_t=setInterval(kt,16)},St=function(){if(xt){-1!==_t&&(clearInterval(_t),_t=-1);var e;for(e=0;u>e;++e)document.getElementById("spr"+e).className="";for(e=0;e<k.patternLen;++e)document.getElementById("ppr"+e).className="";Ut(-1),xt=!1}},Yt=function(e){e||(e=window.event),e.preventDefault(),yt(),ot(),Bt=0,It=k.endPattern-2,bt=0,Lt=7;var t=function(e){if(null==M)return void alert("Audio element unavailable.");try{Mt(),M.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),S.reset(),M.play()}catch(t){alert("Error playing: "+t.message)}};wt(t)},At=function(e){e||(e=window.event),e.preventDefault(),yt(),ot();var t={firstRow:w,lastRow:_,firstCol:E,lastCol:y};Bt=w,It=_,bt=E,Lt=y;var n=function(e){if(null==M)return void alert("Audio element unavailable.");try{Mt(),M.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),M.play(),S.reset()}catch(t){alert("Error playing: "+t.message)}};wt(n,t)},Pt=function(e){return e||(e=window.event),e.preventDefault(),null==M?void alert("Audio element unavailable."):void yt()},Ot=function(e){return Re(a),!0},Rt=function(e){return Re(a),!0},zt=function(e){return Re(a),!0},Nt=function(e){if(e||(e=window.event),e.preventDefault(),E==y){U=[];for(var t=k.songData[E],n=0;n<=t.i.length;++n)U[n]=t.i[n]}},$t=function(e){if(e||(e=window.event),e.preventDefault(),E==y&&U.length>0){var t=k.songData[E];t.i=[];for(var n=0;n<=U.length;++n)t.i[n]=U[n]}et(!0)},qt=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){T=[];for(var n=p;g>=n;++n){for(var i=[],o=m;v>=o;++o)i.push(k.songData[E].c[t].n[n+o*k.patternLen]);T.push(i)}}}},jt=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){for(var n=p,i=0;n<k.patternLen&&i<T.length;++n,++i)for(var o=m,r=0;4>o&&r<T[i].length;++o,++r)k.songData[E].c[t].n[n+o*k.patternLen]=T[i][r];$e()}}},Ht=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){for(var n=p;g>=n;++n)for(var i=m;v>=i;++i){var o=k.songData[E].c[t].n[n+i*k.patternLen];o>0&&(k.songData[E].c[t].n[n+i*k.patternLen]=o+1)}$e()}}},Ft=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){for(var n=p;g>=n;++n)for(var i=m;v>=i;++i){var o=k.songData[E].c[t].n[n+i*k.patternLen];o>1&&(k.songData[E].c[t].n[n+i*k.patternLen]=o-1)}$e()}}},Xt=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){for(var n=p;g>=n;++n)for(var i=m;v>=i;++i){var o=k.songData[E].c[t].n[n+i*k.patternLen];o>0&&(k.songData[E].c[t].n[n+i*k.patternLen]=o+12)}$e()}}},Wt=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){for(var n=p;g>=n;++n)for(var i=m;v>=i;++i){var o=k.songData[E].c[t].n[n+i*k.patternLen];o>12&&(k.songData[E].c[t].n[n+i*k.patternLen]=o-12)}$e()}}},Jt=function(e){e||(e=window.event),e.preventDefault(),C=[];for(var t=w;_>=t;++t){for(var n=[],i=E;y>=i;++i)n.push(k.songData[i].p[t]);C.push(n)}},Gt=function(e){e||(e=window.event),e.preventDefault();for(var t=w,n=0;u>t&&n<C.length;++t,++n)for(var i=E,o=0;8>i&&o<C[n].length;++i,++o)k.songData[i].p[t]=C[n][o];Ne()},Vt=function(e){e||(e=window.event),e.preventDefault();for(var t=w;_>=t;++t)for(var n=E;y>=n;++n){var i=k.songData[n].p[t];l>i&&(k.songData[n].p[t]=i+1)}Ne(),$e(),je()},Qt=function(e){e||(e=window.event),e.preventDefault();for(var t=w;_>=t;++t)for(var n=E;y>=n;++n){var i=k.songData[n].p[t];i>0&&(k.songData[n].p[t]=i-1)}Ne(),$e(),je()},Zt=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){D=[];for(var n=B;I>=n;++n){var i=[];i.push(k.songData[E].c[t].f[n]),i.push(k.songData[E].c[t].f[n+k.patternLen]),D.push(i)}}}},Kt=function(e){if(e||(e=window.event),e.preventDefault(),w==_&&E==y){var t=k.songData[E].p[w]-1;if(t>=0){for(var n=B,i=0;n<k.patternLen&&i<D.length;++n,++i){var o=D[i];k.songData[E].c[t].f[n]=o[0],k.songData[E].c[t].f[n+k.patternLen]=o[1]}je()}}},en=function(e){if(e||(e=window.event),E==y){var t=Ae(e),n=-1;"osc1_xenv"===t.id?n=Z:"osc2_xenv"===t.id?n=ie:"lfo_fxfreq"===t.id&&(n=le);var i;if(n>=0&&(i=k.songData[E].i[n]?0:1,k.songData[E].i[n]=i),f==c&&w==_&&B==I&&n){var o=k.songData[E].p[w]-1;o>=0&&(k.songData[E].c[o].f[B]=n+1,k.songData[E].c[o].f[B+k.patternLen]=i,je())}et(!0),Oe(),e.preventDefault()}},tn=function(e){if(e||(e=window.event),E==y){var t=Ae(e),n=0;if("osc1_wave_sin"===t.id?n=0:"osc1_wave_sqr"===t.id?n=1:"osc1_wave_saw"===t.id?n=2:"osc1_wave_tri"===t.id&&(n=3),f==c&&w==_&&B==I){var i=k.songData[E].p[w]-1;i>=0&&(k.songData[E].c[i].f[B]=G+1,k.songData[E].c[i].f[B+k.patternLen]=n,je())}k.songData[E].i[G]=n,et(),Oe(),e.preventDefault()}},nn=function(e){if(e||(e=window.event),E==y){var t=Ae(e),n=0;if("osc2_wave_sin"===t.id?n=0:"osc2_wave_sqr"===t.id?n=1:"osc2_wave_saw"===t.id?n=2:"osc2_wave_tri"===t.id&&(n=3),f==c&&w==_&&B==I){var i=k.songData[E].p[w]-1;i>=0&&(k.songData[E].c[i].f[B]=K+1,k.songData[E].c[i].f[B+k.patternLen]=n,je())}k.songData[E].i[K]=n,et(!0),Oe(),e.preventDefault()}},on=function(e){if(e||(e=window.event),E==y){var t=Ae(e),n=0;if("lfo_wave_sin"===t.id?n=0:"lfo_wave_sqr"===t.id?n=1:"lfo_wave_saw"===t.id?n=2:"lfo_wave_tri"===t.id&&(n=3),f==c&&w==_&&B==I){var i=k.songData[E].p[w]-1;i>=0&&(k.songData[E].c[i].f[B]=de+1,k.songData[E].c[i].f[B+k.patternLen]=n,je())}k.songData[E].i[de]=n,et(!0),Oe(),e.preventDefault()}},rn=function(e){if(e||(e=window.event),E==y){var t=Ae(e),n=2;if("fx_filt_hp"===t.id?n=1:"fx_filt_lp"===t.id?n=2:"fx_filt_bp"===t.id&&(n=3),f==c&&w==_&&B==I){var i=k.songData[E].p[w]-1;i>=0&&(k.songData[E].c[i].f[B]=fe+1,k.songData[E].c[i].f[B+k.patternLen]=n,je())}k.songData[E].i[fe]=n,et(!0),Oe(),e.preventDefault()}},an=function(e){e||(e=window.event),e.preventDefault(),8>h&&(h++,document.getElementById("keyboardOctave").innerHTML=""+h)},sn=function(e){e||(e=window.event),e.preventDefault(),h>1&&(h--,document.getElementById("keyboardOctave").innerHTML=""+h)},dn=function(e){if(e||(e=window.event),E==y){var t=Ae(e),n=t.options[t.selectedIndex].value;if(""!==n&&(n=parseInt(n))){for(var i=gInstrumentPresets[n],o=0;o<i.i.length;++o)k.songData[E].i[o]=i.i[o];et(!1),e.preventDefault()}}},cn=function(e){e||(e=window.event);var t=Pe(e,!0),n=0;if(t[1]<68)for(var i=0;i<N.length;i+=2)if(t[0]>=N[i]-10&&t[0]<=N[i]+10){n=N[i+1];break}if(!n){n=2*Math.floor(14*t[0]/420);var o=0;n>=20&&o++,n>=14&&o++,n>=6&&o++,n-=o}Ve(n+12*h)&&e.preventDefault()},un=function(e){if(e||(e=window.event),e.preventDefault(),!xt){var t=Ae(e),n=parseInt(t.id.slice(3));Je(n),x=!0}Re(c)},ln=function(e){if(x){e||(e=window.event);var t=Ae(e),n=parseInt(t.id.slice(3));Ge(n),e.preventDefault()}},fn=function(e){if(x){e||(e=window.event);var t=Ae(e),n=parseInt(t.id.slice(3));Ge(n),x=!1,e.preventDefault()}},hn=function(e){if(e||(e=window.event),e.preventDefault(),!xt){var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));He(n,i),L=!0}Re(d)},mn=function(e){if(L){e||(e=window.event);var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Fe(n,i),e.preventDefault()}},pn=function(e){if(L){e||(e=window.event);var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Fe(n,i),L=!1,e.preventDefault()}},vn=function(e){e||(e=window.event);var t,n=Ae(e),i=parseInt(n.id.slice(2,3));t=xt?w:parseInt(n.id.slice(4));var o=i!=E||E!=y;Xe(i,t),xt||(b=!0),Re(s),$e(),je(),et(o),e.preventDefault()},gn=function(e){if(b){e||(e=window.event);var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));We(n,i),$e(),je(),et(!0),e.preventDefault()}},En=function(e){if(b){e||(e=window.event);var t=Ae(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4)),o=n!=y||E!=y;We(n,i),b=!1,$e(),je(),et(o),e.preventDefault()}},wn=null,yn=function(e){E==y&&(e||(e=window.event),wn=Ae(e),Oe(),e.preventDefault())},_n=function(e){if(e||(e=window.event),wn){var t=Pe(e,!1),n=Ye(wn.parentNode),i=t[0]-6-n[0];i=0>i?0:i>191?1:i/191,wn.sliderProps.nonLinear&&(i*=i);var o=wn.sliderProps.min,r=wn.sliderProps.max;i=Math.round(o+(r-o)*i);var a=-1;"osc1_vol"==wn.id?a=V:"osc1_semi"==wn.id?a=Q:"osc2_vol"==wn.id?a=ee:"osc2_semi"==wn.id?a=te:"osc2_det"==wn.id?a=ne:"noise_vol"==wn.id?a=oe:"env_att"==wn.id?a=re:"env_sust"==wn.id?a=ae:"env_rel"==wn.id?a=se:"lfo_amt"==wn.id?a=ce:"lfo_freq"==wn.id?a=ue:"fx_freq"==wn.id?a=he:"fx_res"==wn.id?a=me:"fx_dist"==wn.id?a=pe:"fx_drive"==wn.id?a=ve:"fx_pan_amt"==wn.id?a=ge:"fx_pan_freq"==wn.id?a=Ee:"fx_dly_amt"==wn.id?a=we:"fx_dly_time"==wn.id&&(a=ye);var s=k.songData[E];if(f==c&&B==I&&w==_&&E==y){var d=k.songData[E].p[w]-1;d>=0&&(k.songData[E].c[d].f[B]=a+1,k.songData[E].c[d].f[B+k.patternLen]=i,je())}a>=0&&(s.i[a]=i),R.updateInstr(s.i),Qe(wn,i),Ke(),e.preventDefault()}},Bn=function(e){return wn?(wn=null,!1):!0},In=function(e){e||(e=window.event);var t,n,i,o=document.activeElement===document.getElementById("bpm")||document.activeElement===document.getElementById("rpp");if(f==s&&E==y&&w==_){if(e.keyCode>=48&&e.keyCode<=57)return k.songData[E].p[w]=e.keyCode-47,Ne(),$e(),je(),!1;if(e.keyCode>=64&&e.keyCode<=90)return k.songData[E].p[w]=e.keyCode-54,Ne(),$e(),je(),!1}if(f!=s&&!o){switch(i=-1,e.keyCode){case 90:i=0;break;case 83:i=1;break;case 88:i=2;break;case 68:i=3;break;case 67:i=4;break;case 86:i=5;break;case 71:i=6;break;case 66:i=7;break;case 72:i=8;break;case 78:i=9;break;case 74:i=10;break;case 77:i=11;break;case 188:i=12;break;case 76:i=13;break;case 190:i=14;break;case 186:i=15;break;case 191:i=16;break;case 81:i=12;break;case 50:i=13;break;case 87:i=14;break;case 51:i=15;break;case 69:i=16;break;case 82:i=17;break;case 53:i=18;break;case 84:i=19;break;case 54:i=20;break;case 89:i=21;break;case 55:i=22;break;case 85:i=23;break;case 73:i=24;break;case 57:i=25;break;case 79:i=26;break;case 48:i=27;break;case 80:i=28}if(i>=0&&Ve(i+12*h))return!1}var r;switch(e.keyCode){case 39:if(f==s)return Xe((E+1)%8,w),$e(),je(),et(!0),!1;if(f==d)return He((m+1)%4,p),!1;break;case 37:if(f==s)return Xe((E-1+8)%8,w),$e(),je(),et(!0),!1;if(f==d)return He((m-1+4)%4,p),!1;break;case 40:if(f==s)return Xe(E,(w+1)%u),$e(),je(),!1;if(f==d)return He(m,(p+1)%k.patternLen),!1;if(f==c)return Je((B+1)%k.patternLen),!1;break;case 38:if(f==s)return Xe(E,(w-1+u)%u),$e(),je(),!1;if(f==d)return He(m,(p-1+k.patternLen)%k.patternLen),!1;if(f==c)return Je((B-1+k.patternLen)%k.patternLen),!1;break;case 36:if(f==s)return Xe(E,0),$e(),je(),!1;if(f==d)return He(m,0),!1;if(f==c)return Je(0),!1;break;case 35:if(f==s)return Xe(E,u-1),$e(),je(),!1;if(f==d)return He(m,k.patternLen-1),!1;if(f==c)return Je(k.patternLen-1),!1;break;case 32:if(f!=a)return At(e),!1;break;case 8:case 46:if(f==s){for(t=w;_>=t;++t)for(n=E;y>=n;++n)k.songData[n].p[t]=0;return Ne(),$e(),je(),!1}if(f==d){if(w==_&&E==y){if(r=k.songData[E].p[w]-1,r>=0){for(t=p;g>=t;++t)for(n=m;v>=n;++n)k.songData[E].c[r].n[t+n*k.patternLen]=0;p==g&&He(m,(p+1)%k.patternLen),$e()}return!1}}else if(f==c&&w==_&&E==y){if(r=k.songData[E].p[w]-1,r>=0){for(t=B;I>=t;++t)k.songData[E].c[r].f[t]=0,k.songData[E].c[r].f[t+k.patternLen]=0;B==I&&Je((B+1)%k.patternLen),je()}return!1}break;case 13:o&&(tt(),it(),document.getElementById("bpm").blur(),document.getElementById("rpp").blur())}return!0},bn=function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;if(1!=t.length)return void alert("Only open one file at a time.");var n=t[0],i=new FileReader;i.onload=function(e){dt(F(e.target.result))},i.readAsDataURL(n)},Ln=function(){document.onmousedown=null,document.addEventListener("mousemove",_n,!1),document.addEventListener("touchmove",_n,!1),document.addEventListener("mouseup",Bn,!1),document.addEventListener("touchend",Bn,!1),document.onkeydown=In;var e=document.body.parentNode;e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("drop",bn,!1)},xn=function(){document.onmousedown=function(){return!0},document.onmousemove=null,document.onmouseup=null,document.onkeydown=null},Cn=function(){for(var e,t,n,i=document.getElementById("sequencer-table"),o=0;u>o;o++){e=document.createElement("tr"),o%4===0&&(e.className="beat"),t=document.createElement("th"),t.id="spr"+o,t.textContent=""+o,e.appendChild(t);for(var r=0;8>r;r++)n=document.createElement("td"),n.id="sc"+r+"r"+o,n.textContent=" ",n.addEventListener("mousedown",vn,!1),n.addEventListener("mouseover",gn,!1),n.addEventListener("mouseup",En,!1),e.appendChild(n);i.appendChild(e)}},Tn=function(e){for(var t=1;t<e.children.length&&"beat"!==e.children[t].className;)t++;return t},Dn=function(){var e=J(),t=4;return k.patternLen%3===0?t=3:k.patternLen%4===0?t=4:k.patternLen%2===0?t=2:k.patternLen%5===0&&(t=5),e/t>=40&&k.patternLen>24&&k.patternLen%(2*t)===0&&(t*=2),t},Un=function(){var e=Dn(),t=document.getElementById("pattern-table");if(t.children.length!==k.patternLen||Tn(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,i,o,r=0;r<k.patternLen;r++){n=document.createElement("tr"),r%e===0&&(n.className="beat"),i=document.createElement("th"),i.id="ppr"+r,i.textContent=""+r,n.appendChild(i);for(var a=0;4>a;a++)o=document.createElement("td"),o.id="pc"+a+"r"+r,o.textContent=" ",o.addEventListener("mousedown",hn,!1),o.addEventListener("mouseover",mn,!1),o.addEventListener("mouseup",pn,!1),n.appendChild(o);t.appendChild(n)}}},kn=function(){var e=Dn(),t=document.getElementById("fxtrack-table");if(t.children.length!==k.patternLen||Tn(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,i,o=0;o<k.patternLen;o++)n=document.createElement("tr"),o%e===0&&(n.className="beat"),i=document.createElement("td"),i.id="fxr"+o,i.textContent=String.fromCharCode(160),i.addEventListener("mousedown",un,!1),i.addEventListener("mouseover",ln,!1),i.addEventListener("mouseup",fn,!1),n.appendChild(i),t.appendChild(n)}};this.init=function(){$(".knob").knob({inline:!1,width:50,height:50,bgColor:"#2b3e50",fgColor:"#df691a",inputColor:"#ebebeb",angleOffset:-125,angleArc:250}),e=j(window.location.href),t=H(window.location.href),Me(r+"progress.gif"),Me(r+"box-uncheck.png"),Me(r+"box-uncheck.png"),Me(r+"wave-sin.png"),Me(r+"wave-sin-sel.png"),Me(r+"wave-saw.png"),Me(r+"wave-saw-sel.png"),Me(r+"wave-sqr.png"),Me(r+"wave-sqr-sel.png"),Me(r+"wave-tri.png"),Me(r+"wave-tri-sel.png"),Me(r+"filt-lp.png"),Me(r+"filt-lp-sel.png"),Me(r+"filt-hp.png"),Me(r+"filt-hp-sel.png"),Me(r+"filt-bp.png"),Me(r+"filt-bp-sel.png"),Me(r+"filt-n.png"),Me(r+"filt-n-sel.png"),Se(),A.onload=function(){Ut(-1)},P.onload=function(){Ut(-1)},A.src=r+"playGfxBg.png",P.src=r+"led-off.png",O.src=r+"led-on.png",Cn(),document.getElementById("osc1_vol").sliderProps={min:0,max:255},document.getElementById("osc1_semi").sliderProps={min:92,max:164},document.getElementById("osc2_vol").sliderProps={min:0,max:255},document.getElementById("osc2_semi").sliderProps={min:92,max:164},document.getElementById("osc2_det").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("noise_vol").sliderProps={min:0,max:255},document.getElementById("env_att").sliderProps={min:0,max:255},document.getElementById("env_sust").sliderProps={min:0,max:255},document.getElementById("env_rel").sliderProps={min:0,max:255},document.getElementById("lfo_amt").sliderProps={min:0,max:255},document.getElementById("lfo_freq").sliderProps={min:0,max:16},document.getElementById("fx_freq").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_res").sliderProps={min:0,max:254},document.getElementById("fx_dly_amt").sliderProps={min:0,max:255},document.getElementById("fx_dly_time").sliderProps={min:0,max:16},document.getElementById("fx_pan_amt").sliderProps={min:0,max:255},document.getElementById("fx_pan_freq").sliderProps={min:0,max:16},document.getElementById("fx_dist").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_drive").sliderProps={min:0,max:255};try{M=new Audio,S.setAudioElement(M),M.addEventListener("canplay",function(){this.play()},!0)}catch(n){M=null}var i=F(t&&t.data&&t.data[0]),o=i?Le(i):null;k=o?o:_e(),ze(),Ne(),$e(),je(),et(!0),Re(d),Xe(0,0),He(0,0),document.getElementById("logo").onmousedown=ft,document.getElementById("newSong").onmousedown=ht,document.getElementById("openSong").onmousedown=mt,document.getElementById("saveSong").onmousedown=pt,document.getElementById("exportJS").onmousedown=gt,document.getElementById("exportWAV").onmousedown=vt,document.getElementById("playSong").onmousedown=Yt,document.getElementById("playRange").onmousedown=At,document.getElementById("stopPlaying").onmousedown=Pt,document.getElementById("about").onmousedown=ft,document.getElementById("bpm").onfocus=Ot,document.getElementById("rpp").onfocus=Rt,document.getElementById("sequencerCopy").onmousedown=Jt,document.getElementById("sequencerPaste").onmousedown=Gt,document.getElementById("sequencerPatUp").onmousedown=Vt,document.getElementById("sequencerPatDown").onmousedown=Qt,document.getElementById("patternCopy").onmousedown=qt,document.getElementById("patternPaste").onmousedown=jt,document.getElementById("patternNoteUp").onmousedown=Ht,document.getElementById("patternNoteDown").onmousedown=Ft,document.getElementById("patternOctaveUp").onmousedown=Xt,document.getElementById("patternOctaveDown").onmousedown=Wt,document.getElementById("fxCopy").onmousedown=Zt,document.getElementById("fxPaste").onmousedown=Kt,document.getElementById("instrPreset").onfocus=zt,document.getElementById("instrPreset").onchange=dn,document.getElementById("osc1_wave_sin").addEventListener("mousedown",tn,!1),
document.getElementById("osc1_wave_sin").addEventListener("touchstart",tn,!1),document.getElementById("osc1_wave_sqr").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_sqr").addEventListener("touchstart",tn,!1),document.getElementById("osc1_wave_saw").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_saw").addEventListener("touchstart",tn,!1),document.getElementById("osc1_wave_tri").addEventListener("mousedown",tn,!1),document.getElementById("osc1_wave_tri").addEventListener("touchstart",tn,!1),document.getElementById("osc1_vol").addEventListener("mousedown",yn,!1),document.getElementById("osc1_vol").addEventListener("touchstart",yn,!1),document.getElementById("osc1_semi").addEventListener("mousedown",yn,!1),document.getElementById("osc1_semi").addEventListener("touchstart",yn,!1),document.getElementById("osc1_xenv").addEventListener("mousedown",en,!1),document.getElementById("osc1_xenv").addEventListener("touchstart",en,!1),document.getElementById("osc2_wave_sin").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_sin").addEventListener("touchstart",nn,!1),document.getElementById("osc2_wave_sqr").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_sqr").addEventListener("touchstart",nn,!1),document.getElementById("osc2_wave_saw").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_saw").addEventListener("touchstart",nn,!1),document.getElementById("osc2_wave_tri").addEventListener("mousedown",nn,!1),document.getElementById("osc2_wave_tri").addEventListener("touchstart",nn,!1),document.getElementById("osc2_vol").addEventListener("mousedown",yn,!1),document.getElementById("osc2_vol").addEventListener("touchstart",yn,!1),document.getElementById("osc2_semi").addEventListener("mousedown",yn,!1),document.getElementById("osc2_semi").addEventListener("touchstart",yn,!1),document.getElementById("osc2_det").addEventListener("mousedown",yn,!1),document.getElementById("osc2_det").addEventListener("touchstart",yn,!1),document.getElementById("osc2_xenv").addEventListener("mousedown",en,!1),document.getElementById("osc2_xenv").addEventListener("touchstart",en,!1),document.getElementById("noise_vol").addEventListener("mousedown",yn,!1),document.getElementById("noise_vol").addEventListener("touchstart",yn,!1),document.getElementById("env_att").addEventListener("mousedown",yn,!1),document.getElementById("env_att").addEventListener("touchstart",yn,!1),document.getElementById("env_sust").addEventListener("mousedown",yn,!1),document.getElementById("env_sust").addEventListener("touchstart",yn,!1),document.getElementById("env_rel").addEventListener("mousedown",yn,!1),document.getElementById("env_rel").addEventListener("touchstart",yn,!1),document.getElementById("lfo_wave_sin").addEventListener("mousedown",on,!1),document.getElementById("lfo_wave_sin").addEventListener("touchstart",on,!1),document.getElementById("lfo_wave_sqr").addEventListener("mousedown",on,!1),document.getElementById("lfo_wave_sqr").addEventListener("touchstart",on,!1),document.getElementById("lfo_wave_saw").addEventListener("mousedown",on,!1),document.getElementById("lfo_wave_saw").addEventListener("touchstart",on,!1),document.getElementById("lfo_wave_tri").addEventListener("mousedown",on,!1),document.getElementById("lfo_wave_tri").addEventListener("touchstart",on,!1),document.getElementById("lfo_amt").addEventListener("mousedown",yn,!1),document.getElementById("lfo_amt").addEventListener("touchstart",yn,!1),document.getElementById("lfo_freq").addEventListener("mousedown",yn,!1),document.getElementById("lfo_freq").addEventListener("touchstart",yn,!1),document.getElementById("lfo_fxfreq").addEventListener("mousedown",en,!1),document.getElementById("lfo_fxfreq").addEventListener("touchstart",en,!1),document.getElementById("fx_filt_lp").addEventListener("mousedown",rn,!1),document.getElementById("fx_filt_lp").addEventListener("touchstart",rn,!1),document.getElementById("fx_filt_hp").addEventListener("mousedown",rn,!1),document.getElementById("fx_filt_hp").addEventListener("touchstart",rn,!1),document.getElementById("fx_filt_bp").addEventListener("mousedown",rn,!1),document.getElementById("fx_filt_bp").addEventListener("touchstart",rn,!1),document.getElementById("fx_freq").addEventListener("mousedown",yn,!1),document.getElementById("fx_freq").addEventListener("touchstart",yn,!1),document.getElementById("fx_res").addEventListener("mousedown",yn,!1),document.getElementById("fx_res").addEventListener("touchstart",yn,!1),document.getElementById("fx_dly_amt").addEventListener("mousedown",yn,!1),document.getElementById("fx_dly_amt").addEventListener("touchstart",yn,!1),document.getElementById("fx_dly_time").addEventListener("mousedown",yn,!1),document.getElementById("fx_dly_time").addEventListener("touchstart",yn,!1),document.getElementById("fx_pan_amt").addEventListener("mousedown",yn,!1),document.getElementById("fx_pan_amt").addEventListener("touchstart",yn,!1),document.getElementById("fx_pan_freq").addEventListener("mousedown",yn,!1),document.getElementById("fx_pan_freq").addEventListener("touchstart",yn,!1),document.getElementById("fx_dist").addEventListener("mousedown",yn,!1),document.getElementById("fx_dist").addEventListener("touchstart",yn,!1),document.getElementById("fx_drive").addEventListener("mousedown",yn,!1),document.getElementById("fx_drive").addEventListener("touchstart",yn,!1),document.getElementById("octaveDown").addEventListener("mousedown",sn,!1),document.getElementById("octaveDown").addEventListener("touchstart",sn,!1),document.getElementById("octaveUp").addEventListener("mousedown",an,!1),document.getElementById("octaveUp").addEventListener("touchstart",an,!1),document.getElementById("keyboard").addEventListener("mousedown",cn,!1),document.getElementById("keyboard").addEventListener("touchstart",cn,!1),document.getElementById("instrCopy").onmousedown=Nt,document.getElementById("instrPaste").onmousedown=$t,ke(),Ln(),i||lt(),R.start(),R.updateRowLen(k.rowLen)}};