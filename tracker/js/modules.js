/**
 * This file is part of ReSampled SoundBox.
 *
 * Based on SoundBox by Marcus Geelnard (c) 2011-2013
 * 2015 pointofpresence
 * ReSampled.SoundBox (resampled-sound-box) - Online music tracker
 * @version v0.0.1
 * @build Tue Jul 28 2015 20:17:05
 * @link https://github.com/pointofpresence/resampled-sound-box
 * @license GPL-3.0
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 * 1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 * 2. Altered source versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 * 3. This notice may not be removed or altered from any source
 *    distribution.
 */
function rle_encode(e){var t,n,r,o,a="";for(t=0;t<e.length;){for(r=e.charCodeAt(t),n=1;255>n&&t+n<e.length&&(o=e.charCodeAt(t+n),o==r);n++);n>3?(a+=String.fromCharCode(254),a+=String.fromCharCode(n),a+=String.fromCharCode(r)):(a+=String.fromCharCode(r),254==r&&(a+=String.fromCharCode(0)),n=1),t+=n}return a}function rle_decode(e){var t,n,r,o,a="";for(t=0;t<e.length;){if(r=e.charCodeAt(t++),254===r){if(1>t)break;if(o=e.charCodeAt(t++),0!=o){if(1>t)break;for(r=e.charCodeAt(t++),n=0;o>n;n++)a+=String.fromCharCode(r);continue}}a+=String.fromCharCode(r)}return a}function gui_init(){try{var e=new CGUI;e.init()}catch(t){alert("Unexpected error: "+t.message)}}gDemoSongs=[{name:"sway",description:" SWAY by m @ Bits'n'Bites, from the 4k demo <a href=\"http://pouet.net/prod.php?which=59203\">SWAY</a>",data:String.fromCharCode(83,66,111,120,8,2,237,154,65,107,19,65,20,199,255,179,51,179,141,166,49,197,82,161,66,48,80,164,122,235,65,177,7,193,67,114,244,86,61,89,232,161,158,84,12,38,177,32,107,183,75,65,171,165,39,167,244,32,4,161,244,27,120,20,84,122,243,43,120,242,27,120,241,30,103,179,219,180,221,100,119,74,117,179,89,120,191,201,236,219,183,111,19,94,38,111,231,237,155,236,251,25,224,170,245,216,3,255,225,65,99,87,112,40,24,159,253,214,250,163,236,7,182,100,22,211,112,161,165,110,192,68,33,104,246,5,12,195,113,182,60,221,55,221,117,215,27,182,143,148,153,54,216,23,12,246,88,255,177,170,173,171,177,239,107,32,117,138,37,195,9,215,78,248,225,68,252,114,144,15,154,161,116,35,122,211,109,56,77,119,45,245,248,41,197,30,239,181,98,37,198,94,197,77,84,48,91,206,58,126,74,197,233,114,130,185,172,125,124,145,96,63,140,139,159,213,156,196,79,195,129,211,208,175,56,57,246,241,239,194,109,234,87,84,182,61,120,109,52,95,129,32,146,232,190,100,232,62,7,131,176,231,124,221,186,196,216,252,125,169,247,88,15,171,191,119,44,135,162,250,91,53,68,87,99,63,16,138,98,129,32,8,130,200,37,59,65,191,43,46,214,241,69,130,253,222,66,245,153,156,18,58,111,91,220,226,194,207,238,220,111,128,236,33,204,217,112,55,162,143,34,75,154,234,214,185,179,101,115,21,241,95,141,234,78,36,85,255,149,82,227,238,127,214,119,82,38,255,235,103,26,123,117,180,81,81,61,15,241,67,16,68,62,177,190,123,186,239,92,6,158,182,182,241,78,50,171,176,60,179,184,43,31,22,120,176,170,62,216,98,62,169,145,243,145,104,230,220,255,172,199,255,138,193,44,147,237,139,116,45,18,4,65,156,15,142,13,240,250,6,216,79,33,110,176,59,130,89,181,214,235,175,53,123,222,95,68,247,243,54,15,165,159,193,153,240,27,55,215,85,42,131,154,252,127,16,239,191,82,121,241,61,207,36,196,15,253,249,65,16,4,17,199,35,15,88,241,38,129,73,212,122,69,122,183,140,234,18,127,43,122,25,156,7,25,60,148,128,144,34,174,182,250,164,39,219,143,186,119,122,114,175,175,239,135,122,218,79,94,73,211,242,98,45,217,156,228,127,71,111,221,49,255,33,51,31,127,227,61,163,201,255,125,28,4,82,139,253,1,61,109,76,225,51,107,176,119,66,127,59,161,191,81,61,99,254,241,234,32,8,98,172,107,242,15,59,96,191,60,61,205,46,99,133,127,150,140,95,223,186,87,219,227,29,187,127,138,95,151,7,213,121,144,197,99,166,228,104,166,216,28,241,55,41,26,150,119,151,13,115,213,155,211,234,246,201,204,189,62,10,255,13,182,149,4,123,5,217,63,163,110,90,93,191,101,200,36,38,255,183,13,246,118,138,227,15,195,248,15,137,159,1,76,119,130,107,52,25,17,4,113,94,186,79,152,238,96,144,19,7,65,77,14,107,106,73,222,62,122,68,253,248,81,245,193,35,167,160,229,79,130,32,8,130,24,61,127,1)},{name:"rechord",description:" re:chord by m @ Bits'n'Bites, from the 4k demo <a href=\"http://www.pouet.net/prod.php?which=60915\">re:chord</a>",base64:"U0JveAgC7ZpRa9NQFMfPzU0ycZ0gOEWYo6CC4AaDPakPPgk-TPDBtz34oEMRQcZkdJTZMEdLSUhDQrexSV_9AH6BoU9-Cz-DH8B6bpKmN0nTTGVNiueXnp5zc9v03Jvb_O9N254HWFR-GaD0jSsA2vICIEoFKuv32COFJTauii2IYAQ1OcJH3Y_rMIjKzrYc4WPTj7dgWqjBW9mw099hz0e2PdlsKpXx5cvL6fIb7PbIsPs38Bxs4Bl45Vux-SdJ5k8QBFEc_Csq-anB8dpVvQvPZhiff8iqK3xJlVXcf6WqoYIHcfCcxszxTsLbCe_l-LHXXj6-vmrkH6Od4c2MfK3Qd0LvJryTKJ8npuM5MbM9W7Zz175_fH_bdu2YWY4lzOy4HWFl_yYV3f85wz8aq1l0j3vHMTv6dCTs8KR3IoyulQRRXlDF0d4zgCdX15QdnSkLvVurDXVFHSj2UM2Hqj5KyWuJ8qRX4nM59QdnXpMHbIZ-q6D853LyX6PBSxAEQQglBwNVHJerfQ2u-1P7_k-4MahlyugNa7IP6XmpJbR3plV1SYjy90Q82OXRWCEIgiBKSR_X4_0PqMyqfseX9kug3Lx9MVTyELFfioGNEPJWjk0rQf6tFg0VgiAIopRr8pcG8O-GBqDp9-GbzvgiKEuevqMHK_JgZS7fWc_6lbyBeufAYczbki87u9DEPLuS3wcLfQPLnSnInyAIgvhPldy1gP0w_L_LPOdfNMYftNRrB9zQQ9Xmvo7zQL1VTdX0GbGlj-RkfIK4LW1PoCWzOfXrf3i8LmYeWDEqPpvTtgs5beuiTdP8wwEzGkMi8grs77-hjaPcjfW_gzNBMad1cSbolr7_90MLqOMMNo18Y2pvRL2Z8dpJsOfPxofzciOMPmbkPGhrU9rXjJ3PdJsIoqyw09cMnr4A9liFz0LPFZ3pq7vRZY1Jz0GU3CMrNkEQBEEQk-U3"},{name:"spacedust",description:" Space Dust by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,154,79,107,19,65,24,198,159,249,179,187,145,52,22,69,161,32,74,160,74,35,30,75,209,67,123,170,244,228,69,208,91,15,241,28,197,67,23,33,68,210,96,13,41,161,151,176,233,178,49,13,1,79,138,31,64,240,32,185,121,240,11,136,159,192,111,161,179,219,77,92,154,29,247,160,197,157,240,254,178,79,158,77,38,153,188,51,236,206,203,187,155,147,21,224,6,175,186,96,19,183,0,44,99,21,27,130,241,157,143,27,247,14,197,129,180,109,238,48,198,69,82,18,176,66,71,10,94,224,191,9,252,227,64,231,56,103,74,25,237,119,50,218,253,225,96,52,28,4,67,157,35,231,244,252,126,224,247,61,95,231,121,143,191,131,70,164,69,164,219,239,4,121,143,241,127,159,191,197,140,19,120,121,53,223,199,127,81,173,64,197,200,147,251,145,135,35,43,149,112,19,75,106,231,130,146,133,91,8,23,81,134,181,240,171,21,165,219,32,136,191,64,76,92,165,22,7,94,84,134,124,199,98,188,248,238,210,122,77,28,56,97,107,156,193,229,84,22,108,156,238,207,247,212,232,152,61,19,205,174,217,241,215,219,139,21,127,207,55,43,126,195,15,127,52,105,49,36,8,99,225,213,35,165,150,196,21,199,217,196,35,155,137,171,159,156,7,95,228,19,153,200,228,243,74,233,169,49,219,204,172,173,154,179,173,137,174,129,235,90,125,182,213,209,14,61,166,141,30,70,120,79,135,58,65,16,196,162,242,211,101,74,96,144,118,116,249,138,95,100,172,188,98,253,46,218,25,103,124,234,179,71,74,71,94,134,242,142,62,118,83,70,160,27,151,217,241,19,4,65,16,89,236,158,106,83,58,215,163,50,252,199,87,148,159,90,142,156,182,51,22,93,75,231,44,129,38,103,120,113,238,155,119,207,228,76,98,122,252,4,65,16,196,34,35,182,92,136,215,225,125,242,146,93,139,106,242,37,20,30,62,179,171,118,242,83,225,159,221,166,178,52,61,141,207,188,30,197,126,18,61,251,248,96,64,77,110,50,111,53,243,63,136,231,63,239,244,52,239,135,227,48,225,222,64,214,125,242,6,8,130,32,206,41,147,99,31,226,254,62,216,119,41,43,236,174,202,213,219,123,47,63,111,219,107,103,235,110,161,74,113,62,85,86,54,212,121,238,171,239,20,31,143,35,55,54,209,155,30,63,65,16,4,145,193,164,165,116,116,25,223,106,123,93,118,104,51,94,216,189,86,238,91,143,11,127,250,82,90,50,127,158,241,67,175,104,174,9,130,32,8,226,159,243,11)},{name:"8bit",description:" 8 Bit One by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,219,49,107,219,64,20,7,240,119,58,217,130,144,216,201,226,146,33,32,98,74,218,177,93,186,52,99,200,84,58,36,75,72,134,102,78,178,9,99,227,202,85,13,65,180,8,19,115,56,24,211,16,98,2,249,16,89,252,141,2,25,187,56,119,82,228,154,243,112,14,4,91,46,255,31,247,116,122,150,100,206,135,204,227,140,220,120,67,84,224,3,143,248,32,32,34,103,185,36,183,100,13,137,220,109,190,97,51,139,89,234,133,180,55,17,151,189,81,107,181,133,140,206,168,253,138,90,157,80,157,35,35,237,155,50,90,99,253,188,181,59,221,81,139,90,237,110,116,33,70,45,148,113,174,206,145,145,246,106,206,162,177,30,0,0,96,30,172,192,35,235,135,87,36,218,43,255,228,77,89,191,223,221,89,238,65,238,208,73,106,184,170,226,106,203,141,239,20,106,121,83,203,235,250,5,149,108,205,196,185,150,7,90,94,211,47,240,178,53,254,208,112,188,142,155,29,0,224,255,172,228,223,60,21,43,68,199,31,191,179,223,14,227,111,247,45,55,180,143,248,75,43,121,207,144,95,107,249,149,150,247,181,252,102,198,51,209,53,228,250,120,255,24,198,123,61,227,241,247,12,199,77,227,233,227,203,0,0,176,144,248,223,136,248,167,128,211,26,95,125,79,123,114,77,254,120,203,118,190,228,215,243,234,232,191,74,110,126,167,122,178,14,111,80,195,151,251,141,120,201,237,171,165,108,173,42,247,107,153,159,137,90,178,14,247,201,175,203,125,63,94,114,203,207,84,165,106,69,238,87,113,171,0,0,64,54,13,61,38,131,24,217,249,114,188,72,47,48,230,166,7,153,68,86,188,53,18,73,196,77,76,230,98,81,39,40,249,28,66,224,86,1,0,128,108,10,146,248,108,47,109,210,125,142,216,67,72,238,105,110,213,78,43,121,98,154,146,39,198,67,76,228,0,0,0,240,234,226,39,222,130,160,72,228,20,182,232,216,102,252,67,143,206,78,236,175,246,243,170,252,249,247,245,41,10,57,158,93,7,0,0,152,189,129,151,4,57,165,221,184,180,171,127,161,97,90,0,0,0,22,195,19)},{name:"4chordsong",description:" 4 Chord Song by m @ Bits'n'Bites, chord test inspired by <a href=\"http://www.youtube.com/watch?v=5pidokakU4I\">Axis of Awsome</a>",data:String.fromCharCode(83,66,111,120,8,2,237,153,65,107,19,81,16,199,231,189,151,77,2,105,14,90,8,138,72,115,80,170,168,24,76,3,70,237,161,164,90,176,74,245,166,168,72,169,199,80,2,45,24,66,36,123,168,49,100,27,82,210,96,212,196,80,20,36,8,222,252,0,30,252,22,130,31,64,4,63,130,190,236,190,109,195,146,237,174,77,163,151,255,111,102,24,246,205,16,102,103,55,12,239,237,167,179,68,19,252,134,78,124,81,23,68,39,194,115,52,45,24,127,190,196,227,122,224,36,39,98,140,9,226,140,145,47,74,125,89,43,229,10,36,101,181,176,86,36,41,185,98,46,79,82,178,249,156,65,150,148,149,84,148,108,40,169,43,169,42,177,243,237,188,134,146,154,18,59,223,206,139,202,26,246,179,139,210,230,165,37,165,101,164,205,12,248,57,31,245,239,119,239,27,213,202,22,141,72,212,99,61,229,18,207,140,220,127,11,247,254,91,184,247,127,175,206,225,22,221,237,127,70,245,255,186,180,132,122,30,9,185,122,158,0,0,0,28,20,241,109,155,248,186,30,36,10,70,22,104,94,78,242,196,179,200,185,219,193,227,65,198,184,226,112,38,249,184,239,196,158,24,110,126,153,110,209,85,229,211,202,95,51,253,34,93,246,81,127,163,213,54,181,241,242,181,169,205,86,219,212,102,171,99,234,184,38,185,205,2,94,86,0,0,0,67,224,73,185,39,191,160,203,105,157,138,117,233,81,136,137,163,211,20,79,104,179,26,27,192,207,48,47,41,95,80,190,168,124,94,249,178,195,87,28,222,222,219,85,29,215,198,238,158,209,162,230,184,182,55,195,17,151,186,236,245,83,46,241,148,163,126,55,202,30,113,195,35,94,247,136,71,60,226,15,240,178,2,0,0,24,2,251,162,247,141,17,77,76,94,162,87,26,19,167,219,137,116,86,36,133,25,101,150,249,161,108,212,77,45,87,107,166,86,140,186,169,21,99,203,84,231,164,207,57,38,61,0,0,0,0,254,30,241,93,151,195,116,157,104,50,44,166,232,67,128,241,99,119,143,172,220,209,158,6,213,164,231,140,11,30,240,241,75,239,149,239,42,191,163,124,103,96,189,165,178,186,244,209,244,77,149,213,161,222,200,119,18,243,56,158,94,153,58,88,253,61,31,245,247,232,243,184,31,84,204,35,62,243,191,251,239,245,117,32,59,226,153,70,11,127,86,0,0,24,62,201,223,173,50,246,88,238,203,179,20,222,161,165,16,19,247,223,240,248,25,109,205,26,222,76,217,8,108,163,201,0,0,0,192,24,217,180,236,119,183,219,165,164,220,129,95,249,69,203,247,216,91,245,105,156,249,30,228,47,208,74,0,0,0,224,223,211,63,93,255,33,247,228,244,53,242,147,102,195,196,181,205,155,233,39,218,195,208,94,138,191,89,238,117,58,90,66,175,1,0,0,128,67,231,15)}],gInstrumentPresets=[{name:"====[LEADS]===="},{name:"Softy",i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,195,6,1,2,135,0,0,32,147,6,121,6]},{name:"Classic 8-bit",i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,69,3,1,1,23,167,0,32,77,6,25,6]},{name:"Square",i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,2,255,0,0,32,47,3,146,2]},{name:"Bell",i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,2,255,0,0,32,47,3,157,2]},{name:"Filter Bass 1",i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,195,4,1,3,50,184,119,244,147,6,84,6]},{name:"====[PADS]===="},{name:"Base string",i:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,2,5,0,0,32,0,0,24,8]},{name:"Base string (dist)",i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,136,5,1,2,8,92,21,32,148,5,85,8]},{name:"Evil brass",i:[3,146,140,0,1,224,128,3,0,0,92,0,95,3,179,5,1,2,124,135,11,32,150,3,157,6]},{name:"====[DRUMS]===="},{name:"Bass drum 1",i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,2,14,0,0,32,0,0,0,0]},{name:"Bass drum 2",i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,1,39,76,5,0,0]},{name:"Bass drum 3",i:[0,255,116,1,0,255,116,0,1,14,4,6,45,0,0,0,0,2,136,15,0,32,0,0,66,6]},{name:"Base tom",i:[0,192,104,1,0,80,99,0,0,0,4,0,66,3,0,0,0,1,0,1,2,32,37,4,0,0]},{name:"Snare 1",i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,60,4,1,2,255,0,0,32,61,5,32,6]},{name:"Snare 2",i:[0,221,128,1,0,210,128,0,1,255,4,6,62,0,64,7,1,3,255,15,0,32,20,0,24,6]},{name:"Snare 3",i:[3,0,128,0,3,68,128,0,1,218,4,4,40,1,55,4,1,2,67,115,124,190,67,6,39,1]},{name:"Hihat 1",i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,187,5,0,1,239,135,0,32,108,5,16,4]},{name:"Hihat 2",i:[2,40,140,1,0,0,140,0,0,255,5,0,48,0,0,0,0,3,161,192,0,32,0,0,71,1]},{name:"Open hihat",i:[0,0,128,0,0,0,128,0,0,125,0,1,59,0,0,0,0,1,193,171,0,29,39,3,88,3]},{name:"Smash",i:[0,214,104,1,0,204,104,0,1,229,4,40,21,0,231,6,1,3,183,15,0,32,232,4,74,6]},{name:"Pipe hit",i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,96,3,1,3,94,79,0,32,84,2,12,4]},{name:"====[F/X]===="},{name:"Wind",i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,51,2,1,2,58,239,0,32,88,1,157,2]},{name:"Long beat",i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,2,255,0,2,32,83,5,25,1]},{name:"Siren",i:[1,0,128,0,1,0,128,0,0,255,158,100,158,3,67,4,1,3,57,254,85,171,88,1,157,2]}];var CPlayer=function(){var e,t,n=new Worker("tracker/js/player-worker.js");n.onmessage=function(n){"progress"===n.data.cmd&&(t=n.data.buffer,e&&e(n.data.progress))},this.generate=function(t,r,o){e=o,n.postMessage({cmd:"generate",song:t,opts:r})},this.createWave=function(){var e=t,n=e.length,r=2*n-8,o=r-36,a=44,i=new Uint8Array(a+2*n);i.set([82,73,70,70,255&r,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&o,o>>8&255,o>>16&255,o>>24&255]);for(var d=0,s=a;n>d;++d){var c=e[d];c=-32767>c?-32767:c>32767?32767:c,i[s++]=255&c,i[s++]=c>>8&255}return i},this.getData=function(e,n){for(var r=2*Math.floor(44100*e),o=new Array(n),a=t,i=0;2*n>i;i+=1){var d=r+i;o[i]=e>0&&d<a.length?a[d]/32768:0}return o}},CJammer=function(){var e,t,n,r,o,a,i,d,s,c=8,u=[],f=131072,l=function(e){return Math.sin(6.283184*e)},m=function(e){return 2*(e%1)-1},p=function(e){return.5>e%1?1:-1},g=function(e){var t=e%1*4;return 2>t?t-1:3-t},v=function(e){return 174.614115728/d*Math.pow(2,(e-128)/12)},h=[l,p,m,g],E=function(a,i){var m,p,g,v,E,w,_,y=i.length;for(g=0;y>g;++g)a[g]=0,i[g]=0;for(m=0;c>m;++m){var B=u[m];if(void 0!=B){var I=h[B.instr[0]],L=B.instr[1],b=B.instr[3],T=h[B.instr[4]],D=B.instr[5],x=B.instr[8],U=B.instr[9],C=Math.round(B.instr[10]*B.instr[10]*4*s),Y=Math.round(B.instr[11]*B.instr[11]*4*s),k=Math.round(B.instr[12]*B.instr[12]*4*s),M=1/k,S=B.o1f,A=B.o2f,R=B.o1t,z=B.o2t,P=C+Y+k-B.env;for(y>=P?u[m]=void 0:P=y,p=B.env,g=0;P>g;p++,g++)E=1,C>p?E=p/C:p>=C+Y&&(E-=(p-C-Y)*M),v=S,b&&(v*=E*E),R+=v,w=I(R)*L,v=A,x&&(v*=E*E),z+=v,w+=T(z)*D,U&&(w+=(2*Math.random()-1)*U),i[g]+=.002441481*w*E;B.env=p,B.o1t=R,B.o2t=z}}var O,N,q,j=n.pos,F=n.low,X=n.band,H=n.filterActive,J=n.dlyPos,G=f-1,W=h[e[13]],V=e[14]/512,Q=Math.pow(2,e[15]-9)/t,Z=e[16],K=e[17],$=43.23529*e[18]*3.141592/d,ee=1-e[19]/255,te=1e-5*e[20]*32767,ne=e[21]/32,re=e[22]/512,oe=6.283184*Math.pow(2,e[23]-9)/t,ae=e[24]/255,ie=e[25]*t>>1;for(ie>=f&&(ie=f-1),p=0;y>p;p++)g=2*(j+p),w=i[p],w||H?(_=$,Z&&(_*=W(Q*g)*V+.5),_=1.5*Math.sin(_),F+=_*X,N=ee*(w-X)-F,X+=_*N,w=3==K?X:1==K?N:F,te&&(w*=te,w=1>w?w>-1?l(.25*w):-1:1,w/=te),w*=ne,H=w*w>1e-5,v=Math.sin(oe*g)*re+.5,O=w*(1-v),w*=v):O=0,q=J-ie&G,O+=o[q]*ae,w+=r[q]*ae,r[J]=O,o[J]=w,J=J+1&G,a[p]=O,i[p]=w;for(j+=y;j>2048*t;)j-=2048*t;n.pos=j,n.low=F,n.band=X,n.filterActive=H,n.dlyPos=J};this.start=function(){if(window.AudioContext)a=new AudioContext;else{if(!window.webkitAudioContext)return void(a=void 0);a=new webkitAudioContext,a.createScriptProcessor=a.createJavaScriptNode}d=a.sampleRate,s=d/44100,n={pos:0,low:0,band:0,filterActive:!1,dlyPos:0},r=new Float32Array(f),o=new Float32Array(f),i=a.createScriptProcessor(2048,0,2),i.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);E(t,n)},i.connect(a.destination)},this.stop=function(){},this.updateInstr=function(t){e=[];for(var n=0;n<t.length;++n)e.push(t[n])},this.updateRowLen=function(e){t=Math.round(e*s)},this.addNote=function(t){var n,r=(new Date).getTime(),o={startT:r,env:0,o1t:0,o2t:0,o1f:v(t+e[2]-128),o2f:v(t+e[6]-128)*(1+8e-4*e[7]),instr:new Array(13)};for(n=0;13>n;++n)o.instr[n]=e[n];var a=0,i=-100;for(n=0;c>n;++n){if(void 0==u[n])return void(u[n]=o);var d=r-u[n].startT;d>i&&(a=n,i=d)}u[a]=o}};if(function(){function e(){this.fc=0,this.dl=0}function t(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function n(e,t,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r}function r(){this.next=null,this.len=0,this.ptr=[],this.off=0}function o(n){var r;if(n?1>n?n=1:n>9&&(n=9):n=We,pe=n,H=!1,ue=!1,null===Tt){for(j=F=X=null,Tt=[],V=[],Q=[],Z=[],K=[],he=[],r=0;Lt>r;r++)he[r]=new e;for(Ee=[],r=0;2*wt+1>r;r++)Ee[r]=new e;for(we=[],r=0;Et+2>r;r++)we[r]=new e;for(_e=[],r=0;wt>r;r++)_e[r]=new e;for(ye=[],r=0;2*_t+1>r;r++)ye[r]=new e;Be=new t,Ie=new t,Le=new t,be=[],Te=[],Ue=[],Ce=[],Ye=[],ke=[],Me=[],Se=[]}}function a(e){e.next=j,j=e}function i(){var e;return null!==j?(e=j,j=j.next):e=new r,e.next=null,e.len=e.off=0,e}function d(e){return K[Xe+e]}function s(e,t){return K[Xe+e]=t}function c(e){Tt[G+J++]=e,G+J===Ze&&N()}function u(e){e&=65535,Ze-2>G+J?(Tt[G+J++]=255&e,Tt[G+J++]=e>>>8):(c(255&e),c(e>>>8))}function f(){ne=(ne<<bt^255&V[se+$e-1])&it,re=d(ne),K[se&dt]=re,s(ne,se)}function l(e,t){z(t[e].fc,t[e].dl)}function m(e){return 255&(256>e?Ye[e]:Ye[256+(e>>7)])}function p(e,t,n){return e[t].fc<e[n].fc||e[t].fc===e[n].fc&&Ue[t]<=Ue[n]}function g(e,t,n){var r;for(r=0;n>r&&Fe<je.length;r++)e[t+r]=255&je[Fe++];return r}function v(){var e;for(e=0;at>e;e++)K[Xe+e]=0;if(me=Yt[pe].max_lazy,ge=Yt[pe].good_length,Ve||(ve=Yt[pe].nice_length),le=Yt[pe].max_chain,se=0,te=0,fe=g(V,0,2*Xe),0>=fe)return ue=!0,void(fe=0);for(ue=!1;ut>fe&&!ue;)E();for(ne=0,e=0;$e-1>e;e++)ne=(ne<<bt^255&V[e])&it}function h(e){var t,n,r,o,a=le,i=se,d=de,s=se>ft?se-ft:st,c=se+et,u=V[i+d-1],f=V[i+d];de>=ge&&(a>>=2);do if(t=e,V[t+d]===f&&V[t+d-1]===u&&V[t]===V[i]&&V[++t]===V[i+1]){for(i+=2,t++;c>i;){for(o=!1,r=0;8>r;r+=1)if(i+=1,t+=1,V[i]!==V[t]){o=!0;break}if(o)break}if(n=et-(c-i),i=c-et,n>d){if(ce=e,d=n,Ve){if(n>=et)break}else if(n>=ve)break;u=V[i+d-1],f=V[i+d]}}while((e=K[e&dt])>s&&0!==--a);return d}function E(){var e,t,n=Ke-fe-se;if(-1===n)n--;else if(se>=Xe+ft){for(e=0;Xe>e;e++)V[e]=V[e+Xe];for(ce-=Xe,se-=Xe,te-=Xe,e=0;at>e;e++)t=d(e),s(e,t>=Xe?t-Xe:st);for(e=0;Xe>e;e++)t=K[e],K[e]=t>=Xe?t-Xe:st;n+=Xe}ue||(e=g(V,se+fe,n),0>=e?ue=!0:fe+=e)}function w(){for(;0!==fe&&null===F;){var e;if(f(),re!==st&&ft>=se-re&&(ie=h(re),ie>fe&&(ie=fe)),ie>=$e)if(e=A(se-ce,ie-$e),fe-=ie,me>=ie){ie--;do se++,f();while(0!==--ie);se++}else se+=ie,ie=0,ne=255&V[se],ne=(ne<<bt^255&V[se+1])&it;else e=A(0,255&V[se]),fe--,se++;for(e&&(S(0),te=se);ut>fe&&!ue;)E()}}function _(){for(;0!==fe&&null===F;){if(f(),de=ie,oe=ce,ie=$e-1,re!==st&&me>de&&ft>=se-re&&(ie=h(re),ie>fe&&(ie=fe),ie===$e&&se-ce>ct&&ie--),de>=$e&&de>=ie){var e;e=A(se-1-oe,de-$e),fe-=de-1,de-=2;do se++,f();while(0!==--de);ae=!1,ie=$e-1,se++,e&&(S(0),te=se)}else ae?(A(0,255&V[se-1])&&(S(0),te=se),se++,fe--):(ae=!0,se++,fe--);for(;ut>fe&&!ue;)E()}}function y(){ue||($=0,ee=0,L(),v(),F=null,J=0,G=0,3>=pe?(de=$e-1,ie=0):(ie=$e-1,ae=!1),W=!1)}function B(e,t,n){var r;return H||(y(),H=!0,0!==fe)?(r=I(e,t,n),r===n?n:W?r:(3>=pe?w():_(),0===fe&&(ae&&A(0,255&V[se-1]),S(1),W=!0),r+I(e,r+t,n-r))):(W=!0,0)}function I(e,t,n){var r,o,i;for(r=0;null!==F&&n>r;){for(o=n-r,o>F.len&&(o=F.len),i=0;o>i;i++)e[t+r+i]=F.ptr[F.off+i];if(F.off+=o,F.len-=o,r+=o,0===F.len){var d;d=F,F=F.next,a(d)}}if(r===n)return r;if(J>G){for(o=n-r,o>J-G&&(o=J-G),i=0;o>i;i++)e[t+r+i]=Tt[G+i];G+=o,r+=o,J===G&&(J=G=0)}return r}function L(){var e,t,n,r,o;if(0===_e[0].dl){for(Be.dyn_tree=he,Be.static_tree=we,Be.extra_bits=Dt,Be.extra_base=vt+1,Be.elems=Et,Be.max_length=mt,Be.max_code=0,Ie.dyn_tree=Ee,Ie.static_tree=_e,Ie.extra_bits=xt,Ie.extra_base=0,Ie.elems=wt,Ie.max_length=mt,Ie.max_code=0,Le.dyn_tree=ye,Le.static_tree=null,Le.extra_bits=Ut,Le.extra_base=0,Le.elems=_t,Le.max_length=pt,Le.max_code=0,n=0,r=0;gt-1>r;r++)for(ke[r]=n,e=0;e<1<<Dt[r];e++)Ce[n++]=r;for(Ce[n-1]=r,o=0,r=0;16>r;r++)for(Me[r]=o,e=0;e<1<<xt[r];e++)Ye[o++]=r;for(o>>=7;wt>r;r++)for(Me[r]=o<<7,e=0;e<1<<xt[r]-7;e++)Ye[256+o++]=r;for(t=0;mt>=t;t++)be[t]=0;for(e=0;143>=e;)we[e++].dl=8,be[8]++;for(;255>=e;)we[e++].dl=9,be[9]++;for(;279>=e;)we[e++].dl=7,be[7]++;for(;287>=e;)we[e++].dl=8,be[8]++;for(x(we,Et+1),e=0;wt>e;e++)_e[e].dl=5,_e[e].fc=P(e,5);b()}}function b(){var e;for(e=0;Et>e;e++)he[e].fc=0;for(e=0;wt>e;e++)Ee[e].fc=0;for(e=0;_t>e;e++)ye[e].fc=0;he[ht].fc=1,Ne=qe=0,Ae=Re=ze=0,Pe=0,Oe=1}function T(e,t){for(var n=Te[t],r=t<<1;De>=r&&(De>r&&p(e,Te[r+1],Te[r])&&r++,!p(e,n,Te[r]));)Te[t]=Te[r],t=r,r<<=1;Te[t]=n}function D(e){var t,n,r,o,a,i,d=e.dyn_tree,s=e.extra_bits,c=e.extra_base,u=e.max_code,f=e.max_length,l=e.static_tree,m=0;for(o=0;mt>=o;o++)be[o]=0;for(d[Te[xe]].dl=0,t=xe+1;Lt>t;t++)n=Te[t],o=d[d[n].dl].dl+1,o>f&&(o=f,m++),d[n].dl=o,n>u||(be[o]++,a=0,n>=c&&(a=s[n-c]),i=d[n].fc,Ne+=i*(o+a),null!==l&&(qe+=i*(l[n].dl+a)));if(0!==m){do{for(o=f-1;0===be[o];)o--;be[o]--,be[o+1]+=2,be[f]--,m-=2}while(m>0);for(o=f;0!==o;o--)for(n=be[o];0!==n;)r=Te[--t],r>u||(d[r].dl!==o&&(Ne+=(o-d[r].dl)*d[r].fc,d[r].fc=o),n--)}}function x(e,t){var n,r,o=[],a=0;for(n=1;mt>=n;n++)a=a+be[n-1]<<1,o[n]=a;for(r=0;t>=r;r++){var i=e[r].dl;0!==i&&(e[r].fc=P(o[i]++,i))}}function U(e){var t,n,r=e.dyn_tree,o=e.static_tree,a=e.elems,i=-1,d=a;for(De=0,xe=Lt,t=0;a>t;t++)0!==r[t].fc?(Te[++De]=i=t,Ue[t]=0):r[t].dl=0;for(;2>De;){var s=Te[++De]=2>i?++i:0;r[s].fc=1,Ue[s]=0,Ne--,null!==o&&(qe-=o[s].dl)}for(e.max_code=i,t=De>>1;t>=1;t--)T(r,t);do t=Te[lt],Te[lt]=Te[De--],T(r,lt),n=Te[lt],Te[--xe]=t,Te[--xe]=n,r[d].fc=r[t].fc+r[n].fc,Ue[d]=Ue[t]>Ue[n]+1?Ue[t]:Ue[n]+1,r[t].dl=r[n].dl=d,Te[lt]=d++,T(r,lt);while(De>=2);Te[--xe]=Te[lt],D(e),x(r,i)}function C(e,t){var n,r,o=-1,a=e[0].dl,i=0,d=7,s=4;for(0===a&&(d=138,s=3),e[t+1].dl=65535,n=0;t>=n;n++)r=a,a=e[n+1].dl,++i<d&&r===a||(s>i?ye[r].fc+=i:0!==r?(r!==o&&ye[r].fc++,ye[yt].fc++):10>=i?ye[Bt].fc++:ye[It].fc++,i=0,o=r,0===a?(d=138,s=3):r===a?(d=6,s=3):(d=7,s=4))}function Y(e,t){var n,r,o=-1,a=e[0].dl,i=0,d=7,s=4;for(0===a&&(d=138,s=3),n=0;t>=n;n++)if(r=a,a=e[n+1].dl,!(++i<d&&r===a)){if(s>i){do l(r,ye);while(0!==--i)}else 0!==r?(r!==o&&(l(r,ye),i--),l(yt,ye),z(i-3,2)):10>=i?(l(Bt,ye),z(i-3,3)):(l(It,ye),z(i-11,7));i=0,o=r,0===a?(d=138,s=3):r===a?(d=6,s=3):(d=7,s=4)}}function k(){var e;for(C(he,Be.max_code),C(Ee,Ie.max_code),U(Le),e=_t-1;e>=3&&0===ye[Ct[e]].dl;e--);return Ne+=3*(e+1)+5+5+4,e}function M(e,t,n){var r;for(z(e-257,5),z(t-1,5),z(n-4,4),r=0;n>r;r++)z(ye[Ct[r]].dl,3);Y(he,e-1),Y(Ee,t-1)}function S(e){var t,n,r,o,a;if(o=se-te,Se[ze]=Pe,U(Be),U(Ie),r=k(),t=Ne+3+7>>3,n=qe+3+7>>3,t>=n&&(t=n),t>=o+4&&te>=0)for(z((He<<1)+e,3),O(),u(o),u(~o),a=0;o>a;a++)c(V[te+a]);else n===t?(z((Je<<1)+e,3),R(we,_e)):(z((Ge<<1)+e,3),M(Be.max_code+1,Ie.max_code+1,r+1),R(he,Ee));b(),0!==e&&O()}function A(e,t){if(Z[Ae++]=t,0===e?he[t].fc++:(e--,he[Ce[t]+vt+1].fc++,Ee[m(e)].fc++,Q[Re++]=e,Pe|=Oe),Oe<<=1,0===(7&Ae)&&(Se[ze++]=Pe,Pe=0,Oe=1),pe>2&&0===(4095&Ae)){var n,r=8*Ae,o=se-te;for(n=0;wt>n;n++)r+=Ee[n].fc*(5+xt[n]);if(r>>=3,Re<parseInt(Ae/2,10)&&r<parseInt(o/2,10))return!0}return Ae===nt-1||Re===ot}function R(e,t){var n,r,o,a,i=0,d=0,s=0,c=0;if(0!==Ae)do 0===(7&i)&&(c=Se[s++]),r=255&Z[i++],0===(1&c)?l(r,e):(o=Ce[r],l(o+vt+1,e),a=Dt[o],0!==a&&(r-=ke[o],z(r,a)),n=Q[d++],o=m(n),l(o,t),a=xt[o],0!==a&&(n-=Me[o],z(n,a))),c>>=1;while(Ae>i);l(ht,e)}function z(e,t){ee>kt-t?($|=e<<ee,u($),$=e>>kt-ee,ee+=t-kt):($|=e<<ee,ee+=t)}function P(e,t){var n=0;do n|=1&e,e>>=1,n<<=1;while(--t>0);return n>>1}function O(){ee>8?u($):ee>0&&c($),$=0,ee=0}function N(){var e,t;if(0!==J){for(e=i(),null===F?F=X=e:X=X.next=e,e.len=J-G,t=0;t<e.len;t++)e.ptr[t]=Tt[G+t];J=G=0}}function q(e,t){var n,r,a;if("string"==typeof e)for(a=e,e=[],n=0;n<a.length;n++)e[n]=a.charCodeAt(n);je=e,Fe=0,"undefined"==typeof t&&(t=We),o(t),r=[];do n=B(r,r.length,1024);while(n>0);for(je=null,a="",n=0;n<r.length;n++)a+=String.fromCharCode(r[n]);return a}var j,F,X,H,J,G,W,V,Q,Z,K,$,ee,te,ne,re,oe,ae,ie,de,se,ce,ue,fe,le,me,pe,ge,ve,he,Ee,we,_e,ye,Be,Ie,Le,be,Te,De,xe,Ue,Ce,Ye,ke,Me,Se,Ae,Re,ze,Pe,Oe,Ne,qe,je,Fe,Xe=32768,He=0,Je=1,Ge=2,We=6,Ve=!1,Qe=32768,Ze=8192,Ke=2*Xe,$e=3,et=258,tt=16,nt=8192,rt=15,ot=nt,at=1<<rt,it=at-1,dt=Xe-1,st=0,ct=4096,ut=et+$e+1,ft=Xe-ut,lt=1,mt=15,pt=7,gt=29,vt=256,ht=256,Et=vt+1+gt,wt=30,_t=19,yt=16,Bt=17,It=18,Lt=2*Et+1,bt=parseInt((rt+$e-1)/$e,10),Tt=null;nt>Qe&&console.error("error: INBUFSIZ is too small"),Xe<<1>1<<tt&&console.error("error: WSIZE is too large"),rt>tt-1&&console.error("error: HASH_BITS is too large"),(8>rt||258!==et)&&console.error("error: Code too clever");var Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],xt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ut=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Yt=[new n(0,0,0,0),new n(4,4,8,4),new n(4,5,16,8),new n(4,6,32,32),new n(4,4,16,16),new n(8,16,32,32),new n(8,16,128,128),new n(8,32,128,256),new n(32,128,258,1024),new n(32,258,258,4096)],kt=16;window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.deflate=q}(),function(){function e(){this.next=null,this.list=null}function t(){this.e=0,this.b=0,this.n=0,this.t=null}function n(n,r,o,a,i,d){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var s,c,u,f,l,m,p,g,v,h,E,w,_,y,B,I,L,b=[],T=[],D=new t,x=[],U=[],C=[];for(L=this.root=null,m=0;m<this.BMAX+1;m++)b[m]=0;for(m=0;m<this.BMAX+1;m++)T[m]=0;for(m=0;m<this.BMAX;m++)x[m]=null;for(m=0;m<this.N_MAX;m++)U[m]=0;for(m=0;m<this.BMAX+1;m++)C[m]=0;c=r>256?n[256]:this.BMAX,v=n,h=0,m=r;do b[v[h]]++,h++;while(--m>0);if(b[0]===r)return this.root=null,this.m=0,void(this.status=0);for(p=1;p<=this.BMAX&&0===b[p];p++);for(g=p,p>d&&(d=p),m=this.BMAX;0!==m&&0===b[m];m--);for(f=m,d>m&&(d=m),y=1<<p;m>p;p++,y<<=1)if((y-=b[p])<0)return this.status=2,void(this.m=d);if((y-=b[m])<0)return this.status=2,void(this.m=d);for(b[m]+=y,C[1]=p=0,v=b,h=1,_=2;--m>0;)C[_++]=p+=v[h++];v=n,h=0,m=0;do 0!==(p=v[h++])&&(U[C[p]++]=m);while(++m<r);for(r=C[f],C[0]=m=0,v=U,h=0,l=-1,w=T[0]=0,E=null,B=0,null;f>=g;g++)for(s=b[g];s-->0;){for(;g>w+T[1+l];){if(w+=T[1+l],l++,B=(B=f-w)>d?d:B,(u=1<<(p=g-w))>s+1)for(u-=s+1,_=g;++p<B&&!((u<<=1)<=b[++_]);)u-=b[_];for(w+p>c&&c>w&&(p=c-w),B=1<<p,T[1+l]=p,E=[],I=0;B>I;I++)E[I]=new t;L=L?L.next=new e:this.root=new e,L.next=null,L.list=E,x[l]=E,l>0&&(C[l]=m,D.b=T[l],D.e=16+p,D.t=E,p=(m&(1<<w)-1)>>w-T[l],x[l-1][p].e=D.e,x[l-1][p].b=D.b,x[l-1][p].n=D.n,x[l-1][p].t=D.t)}for(D.b=g-w,h>=r?D.e=99:v[h]<o?(D.e=v[h]<256?16:15,D.n=v[h++]):(D.e=i[v[h]-o],D.n=a[v[h++]-o]),u=1<<g-w,p=m>>w;B>p;p+=u)E[p].e=D.e,E[p].b=D.b,E[p].n=D.n,E[p].t=D.t;for(p=1<<g-1;0!==(m&p);p>>=1)m^=p;for(m^=p;(m&(1<<w)-1)!==C[l];)w-=T[l],l--}this.m=T[1],this.status=0!==y&&1!==f?1:0}function r(){return U.length===C?-1:255&U[C++]}function o(e){for(;e>_;)w|=r()<<_,_+=8}function a(e){return w&P[e]}function i(e){w>>=e,_-=e}function d(e,t,n){var r,d,s;if(0===n)return 0;for(s=0;;){for(o(D),d=b.list[a(D)],r=d.e;r>16;){if(99===r)return-1;i(d.b),r-=16,o(r),d=d.t[a(r)],r=d.e}if(i(d.b),16!==r){if(15===r)break;for(o(r),I=d.n+a(r),i(r),o(x),d=T.list[a(x)],r=d.e;r>16;){if(99===r)return-1;i(d.b),r-=16,o(r),d=d.t[a(r)],r=d.e}for(i(d.b),o(r),L=g-d.n-a(r),i(r);I>0&&n>s;)I--,L&=Y-1,g&=Y-1,e[t+s++]=p[g++]=p[L++];if(s===n)return n}else if(g&=Y-1,e[t+s++]=p[g++]=d.n,s===n)return n}return y=-1,s}function s(e,t,n){var r;if(r=7&_,i(r),o(16),r=a(16),i(16),o(16),r!==(65535&~w))return-1;for(i(16),I=r,r=0;I>0&&n>r;)I--,g&=Y-1,o(8),e[t+r++]=p[g++]=a(8),i(8);return 0===I&&(y=-1),r}function c(e,t,r){if(!z){var o,a,i=[];for(o=0;144>o;o++)i[o]=8;for(null;256>o;o++)i[o]=9;for(null;280>o;o++)i[o]=7;for(null;288>o;o++)i[o]=8;if(h=7,a=new n(i,288,257,O,N,h),0!==a.status)return console.error("HufBuild error: "+a.status),-1;for(z=a.root,h=a.m,o=0;30>o;o++)i[o]=5;if(E=5,a=new n(i,30,0,q,j,E),a.status>1)return z=null,console.error("HufBuild error: "+a.status),-1;v=a.root,E=a.m}return b=z,T=v,D=h,x=E,d(e,t,r)}function u(e,t,r){var s,c,u,f,l,m,p,g,v,h=[];for(s=0;316>s;s++)h[s]=0;if(o(5),p=257+a(5),i(5),o(5),g=1+a(5),i(5),o(4),m=4+a(4),i(4),p>286||g>30)return-1;for(c=0;m>c;c++)o(3),h[F[c]]=a(3),i(3);for(null;19>c;c++)h[F[c]]=0;if(D=7,v=new n(h,19,19,null,null,D),0!==v.status)return-1;for(b=v.root,D=v.m,f=p+g,s=u=0;f>s;)if(o(D),l=b.list[a(D)],c=l.b,i(c),c=l.n,16>c)h[s++]=u=c;else if(16===c){if(o(2),c=3+a(2),i(2),s+c>f)return-1;for(;c-->0;)h[s++]=u}else if(17===c){if(o(3),c=3+a(3),i(3),s+c>f)return-1;for(;c-->0;)h[s++]=0;u=0}else{if(o(7),c=11+a(7),i(7),s+c>f)return-1;for(;c-->0;)h[s++]=0;u=0}if(D=A,v=new n(h,p,257,O,N,D),0===D&&(v.status=1),0!==v.status&&1!==v.status)return-1;for(b=v.root,D=v.m,s=0;g>s;s++)h[s]=h[s+p];return x=R,v=new n(h,g,0,q,j,x),T=v.root,x=v.m,0===x&&p>257?-1:0!==v.status?-1:d(e,t,r)}function f(){p||(p=[]),g=0,w=0,_=0,y=-1,B=!1,I=L=0,b=null}function l(e,t,n){var r,f;for(r=0;n>r;){if(B&&-1===y)return r;if(I>0){if(y!==k)for(;I>0&&n>r;)I--,L&=Y-1,g&=Y-1,e[t+r++]=p[g++]=p[L++];else{for(;I>0&&n>r;)I--,g&=Y-1,o(8),e[t+r++]=p[g++]=a(8),i(8);0===I&&(y=-1)}if(r===n)return r}if(-1===y){if(B)break;o(1),0!==a(1)&&(B=!0),i(1),o(2),y=a(2),i(2),b=null,I=0}switch(y){case k:f=s(e,t+r,n-r);break;case M:f=b?d(e,t+r,n-r):c(e,t+r,n-r);break;case S:f=b?d(e,t+r,n-r):u(e,t+r,n-r);break;default:f=-1}if(-1===f)return B?0:-1;r+=f}return r}function m(e){var t,n,r=[];if("string"==typeof e)for(n=e,e=[],t=0;t<n.length;t++)e[t]=n.charCodeAt(t);f(),U=e,C=0;do t=l(r,r.length,1024);while(t>0);for(U=null,n="",t=0;t<r.length;t++)n+=String.fromCharCode(r[t]);return n}var p,g,v,h,E,w,_,y,B,I,L,b,T,D,x,U,C,Y=32768,k=0,M=1,S=2,A=9,R=6,z=null,P=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],O=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.inflate=m}(),"function"!=typeof Blob||"undefined"==typeof URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},o=n.prototype,a=r.prototype,i=e.FileReaderSync,d=function(e){this.code=this[this.name=e]},s="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=s.length,u=e.URL||e.webkitURL||e,f=u.createObjectURL,l=u.revokeObjectURL,m=u,p=e.btoa,g=e.atob,v=!1,h=function(e){v=!e},E=e.ArrayBuffer,w=e.Uint8Array;for(r.fake=a.fake=!0;c--;)d.prototype[s[c]]=c+1;try{w&&h.apply(0,new w(3528e4))}catch(_){}return u.createObjectURL||(m=e.URL={}),m.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof r?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):p?t+";base64,"+p(e.data):t+","+encodeURIComponent(e.data)):f?f.call(u,e):void 0},m.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&l&&l.call(u,e);

},o.append=function(e){var n=this.data;if(w&&(e instanceof E||e instanceof w))if(v)n.push(String.fromCharCode.apply(String,new w(e)));else{for(var o="",a=new w(e),s=0,c=a.length;c>s;s++)o+=String.fromCharCode(a[s]);n.push(o)}else if("Blob"===t(e)||"File"===t(e)){if(!i)throw new d("NOT_READABLE_ERR");var u=new i;n.push(u.readAsBinaryString(e))}else e instanceof r?"base64"===e.encoding&&g?n.push(g(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},a.slice=function(e,t,n){var o=arguments.length;return 3>o&&(n=null),new r(this.data.slice(e,o>1?t:this.data.length),n,this.encoding)},a.toString=function(){return"[object Blob]"},n}(e);return function(e,n){var r=n?n.type||"":"",o=new t;if(e)for(var a=0,i=e.length;i>a;a++)o.append(e[a]);return o.getBlob(r)}}(self);var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in o,i=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},d=e.webkitRequestFileSystem,s=e.requestFileSystem||d||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",f=0,l=[],m=function(){for(var e=l.length;e--;){var t=l[e];"string"==typeof t?r.revokeObjectURL(t):t.remove()}l.length=0},p=function(e,t,n){t=[].concat(t);for(var r=t.length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(a){c(a)}}},g=function(t,r){var c,m,g,v=this,h=t.type,E=!1,w=function(){var e=n().createObjectURL(t);return l.push(e),e},_=function(){p(v,"writestart progress write writeend".split(" "))},y=function(){(E||!c)&&(c=w(t)),m?m.location.href=c:window.open(c,"_blank"),v.readyState=v.DONE,_()},B=function(e){return function(){return v.readyState!==v.DONE?e.apply(this,arguments):void 0}},I={create:!0,exclusive:!1};return v.readyState=v.INIT,r||(r="download"),a?(c=w(t),o.href=c,o.download=r,i(o),v.readyState=v.DONE,void _()):(e.chrome&&h&&h!==u&&(g=t.slice||t.webkitSlice,t=g.call(t,0,t.size,u),E=!0),d&&"download"!==r&&(r+=".download"),(h===u||d)&&(m=e),s?(f+=t.size,void s(e.TEMPORARY,f,B(function(e){e.root.getDirectory("saved",I,B(function(e){var n=function(){e.getFile(r,I,B(function(e){e.createWriter(B(function(n){n.onwriteend=function(t){m.location.href=e.toURL(),l.push(e),v.readyState=v.DONE,p(v,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&y()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=v["on"+e]}),n.write(t),v.abort=function(){n.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),y)}),y)};e.getFile(r,{create:!1},B(function(e){e.remove(),n()}),B(function(e){e.code===e.NOT_FOUND_ERR?n():y()}))}),y)}),y)):void y())},v=g.prototype,h=function(e,t){return new g(e,t)};return v.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,e.addEventListener("unload",m,!1),h}(self);!function(e){"use strict";function t(){}function n(){this.inputInUse=!1,this.outputInUse=!1;var e=document.createElement("object");e.id="_Jazz"+Math.random()+"ie",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",this.activeX=e;var t=document.createElement("object");t.id="_Jazz"+Math.random(),t.type="audio/x-jazz",e.appendChild(t),this.objRef=t;var n=document.createElement("p");n.appendChild(document.createTextNode("This page requires the "));var r=document.createElement("a");r.appendChild(document.createTextNode("Jazz plugin")),r.href="http://jazz-soft.net/",n.appendChild(r),n.appendChild(document.createTextNode(".")),t.appendChild(n);var o=document.getElementById("MIDIPlugin");if(!o){var o=document.createElement("div");o.id="MIDIPlugin",o.style.position="absolute",o.style.visibility="hidden",o.style.left="-9999px",o.style.top="-9999px",document.body.appendChild(o)}o.appendChild(e),this._Jazz=this.objRef.isJazz?this.objRef:this.activeX.isJazz?this.activeX:null,this._Jazz&&(this._Jazz._jazzTimeZero=this._Jazz.Time(),this._Jazz._perfTimeZero=window.performance.now())}function r(){this._jazzInstances=new Array,this._jazzInstances.push(new n),this._promise=new t,this._jazzInstances[0]._Jazz?(this._Jazz=this._jazzInstances[0]._Jazz,window.setTimeout(d.bind(this),3)):window.setTimeout(o.bind(this),3)}function o(){this._promise&&this._promise.fail({code:1})}function a(){this.jazz.MidiOutLong(this.data)}var i,r,d,s,c,u;t.prototype.then=function(e,t){this.accept=e,this.reject=t},t.prototype.succeed=function(e){this.accept&&this.accept(e)},t.prototype.fail=function(e){this.reject&&this.reject(e)},i=function(){var e=new r;return e._promise},d=function(){this._promise&&this._promise.succeed(this)},r.prototype.inputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiInList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new s(this,e[n],n);return t},r.prototype.outputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiOutList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new c(this,e[n],n);return t},s=function(e,t,r){this._listeners=[],this._midiAccess=e,this._index=r,this._inLongSysexMessage=!1,this._sysexBuffer=new Uint8Array,this.id=""+r+"."+t,this.manufacturer="",this.name=t,this.type="input",this.version="",this.onmidimessage=null;for(var o=null,a=0;a<e._jazzInstances.length&&!o;a++)e._jazzInstances[a].inputInUse||(o=e._jazzInstances[a]);o||(o=new n,e._jazzInstances.push(o)),o.inputInUse=!0,this._jazzInstance=o._Jazz,this._input=this._jazzInstance.MidiInOpen(this._index,u.bind(this))},s.prototype.addEventListener=function(e,t,n){if("midimessage"===e){for(var r=0;r<this._listeners.length;r++)if(this._listeners[r]==t)return;this._listeners.push(t)}},s.prototype.removeEventListener=function(e,t,n){if("midimessage"===e)for(var r=0;r<this._listeners.length;r++)if(this._listeners[r]==t)return void this._listeners.splice(r,1)},s.prototype.preventDefault=function(){this._pvtDef=!0},s.prototype.dispatchEvent=function(e){this._pvtDef=!1;for(var t=0;t<this._listeners.length;t++)this._listeners[t].handleEvent?this._listeners[t].handleEvent.bind(this)(e):this._listeners[t].bind(this)(e);return this.onmidimessage&&this.onmidimessage(e),this._pvtDef},s.prototype.appendToSysexBuffer=function(e){var t=this._sysexBuffer.length,n=new Uint8Array(t+e.length);n.set(this._sysexBuffer),n.set(e,t),this._sysexBuffer=n},s.prototype.bufferLongSysex=function(e,t){for(var n=t;n<e.length;){if(247==e[n])return n++,this.appendToSysexBuffer(e.slice(t,n)),n;n++}return this.appendToSysexBuffer(e.slice(t,n)),this._inLongSysexMessage=!0,n},u=function(e,t){var n,r=0,o=!1;for(n=0;n<t.length;n+=r){if(this._inLongSysexMessage){if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;o=!0}else switch(o=!1,240&t[n]){case 128:case 144:case 160:case 176:case 224:r=3;break;case 192:case 208:r=2;break;case 240:switch(t[n]){case 240:if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;o=!0;break;case 241:case 243:r=2;break;case 242:r=3;break;default:r=1}}var a=document.createEvent("Event");a.initEvent("midimessage",!1,!1),a.receivedTime=parseFloat(e.toString())+this._jazzInstance._perfTimeZero,o||this._inLongSysexMessage?(a.data=new Uint8Array(this._sysexBuffer),this._sysexBuffer.length=0,this._inLongSysexMessage=!1):a.data=new Uint8Array(t.slice(n,r+n)),this.dispatchEvent(a)}},c=function(e,t,r){this._listeners=[],this._midiAccess=e,this._index=r,this.id=""+r+"."+t,this.manufacturer="",this.name=t,this.type="output",this.version="";for(var o=null,a=0;a<e._jazzInstances.length&&!o;a++)e._jazzInstances[a].outputInUse||(o=e._jazzInstances[a]);o||(o=new n,e._jazzInstances.push(o)),o.outputInUse=!0,this._jazzInstance=o._Jazz,this._jazzInstance.MidiOutOpen(this.name)},c.prototype.send=function(e,t){var n=0;if(0===e.length)return!1;if(t&&(n=Math.floor(t-window.performance.now())),t&&n>1){var r=new Object;r.jazz=this._jazzInstance,r.data=e,window.setTimeout(a.bind(r),n)}else this._jazzInstance.MidiOutLong(e);return!0},window.navigator.requestMIDIAccess||(window.navigator.requestMIDIAccess=i)}(window),function(e){function t(){for(var t=["moz","webkit","o","ms"],n=t.length,r={value:function(e){return function(){return Date.now()-e}}(Date.now())};n>=0;n--)if(t[n]+"Now"in e.performance)return r.value=function(t){return function(){e.performance[t]()}}(t[n]+"Now"),r;return"timing"in e.performance&&"connectStart"in e.performance.timing&&(r.value=function(e){return function(){Date.now()-e}}(e.performance.timing.connectStart)),r}var n,r={};"performance"in e&&"now"in e.performance||("performance"in e||Object.defineProperty(e,"performance",{get:function(){return r}}),n=t(),Object.defineProperty(e.performance,"now",n))}(window);var CBinParser=function(e){var t=e,n=0;this.getUBYTE=function(){return 255&t.charCodeAt(n++)},this.getUSHORT=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8;return n+=2,e},this.getULONG=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;return n+=4,e},this.getFLOAT=function(){var e=this.getULONG();if(0==e)return 0;var t=2147483648&e,n=e>>23&255,r=1+(8388607&e)/8388608,o=r*Math.pow(2,n-127);return t?-o:o},this.getTail=function(){var e=t.slice(n);return n=t.length,e}},CBinWriter=function(){var e="";this.putUBYTE=function(t){e+=String.fromCharCode(t)},this.putUSHORT=function(t){e+=String.fromCharCode(255&t,t>>8&255)},this.putULONG=function(t){e+=String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},this.putFLOAT=function(e){var t=0;if(0!=e){var n=0;0>e&&(n=2147483648,e=-e);for(var r=150;8388608>e;)e*=2,r--;for(;e>=16777216;)e/=2,r++;t=n|(255&r)<<23|8388607&e}this.putULONG(t)},this.append=function(t){e+=t},this.getData=function(){return e}},CAudioTimer=function(){var e=null,t=0,n=[0,0,0,0,0,0],r=0;this.setAudioElement=function(t){e=t},this.currentTime=function(){if(!e)return 0;var o,a=.001*(new Date).getTime(),i=a-t,d=e.currentTime,s=d-i;if(.01>d||s>.2||-.2>s)for(i=d,t=a-i,o=0;o<n.length;o++)n[o]=0;var c=0;for(o=0;o<n.length;o++)c+=n[o];return c/=n.length,n[r]=s,r=(r+1)%n.length,i+c},this.reset=function(){t=.001*(new Date).getTime();for(var e=0;e<n.length;e++)n[e]=0}},CGUI=function(){var e,t,n,r,o,a="tracker/image/gui/",i=0,d=1,s=2,c=3,u=128,f=36,l=s,m=5,p=0,g=0,v=0,h=0,E=0,w=0,_=0,y=0,B=0,I=0,L=!1,b=!1,T=!1,D=[],x=[],U=[],C=[],Y={},k=null,M=new CAudioTimer,S=new CPlayer,A=new Image,R=new Image,z=new Image,P=new CJammer,O=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],N=[26,1,63,3,116,6,150,8,184,10,238,13,274,15,327,18,362,20,394,22],q=[],j=function(e){var t=e.indexOf("?");return e.slice(0,t>=0?t:e.length)},F=function(e){var t=e.indexOf("?")+1,n=e.indexOf("#")+1||e.length+1,r=e.slice(t,n-1),o={};if(r===e||""===r)return o;for(var a=r.replace(/\+/g," ").split("&"),i=0;i<a.length;i++){var d=a[i].split("="),s=decodeURIComponent(d[0]),c=decodeURIComponent(d[1]);s in o||(o[s]=[]),o[s].push(2===d.length?c:null)}return o},X=function(e){var t=void 0;if(e){var n=e,r="";if(0==n.indexOf("data:")){var o=n.indexOf("base64,");o>0&&(r=n.substr(o+7))}else for(var a=0;a<n.length;++a){var i=n[a];"-"===i&&(i="+"),"_"===i&&(i="/"),r+=i}try{t=atob(r)}catch(d){t=void 0}}return t},H=function(t){for(var n=btoa(t),r="",o=0;o<n.length;++o){var a=n[o];"+"===a&&(a="-"),"/"===a&&(a="_"),"="===a&&(a=""),r+=a}return e+"?data="+r},J=function(e){return Math.round(661500/e)},G=function(){return Math.round(661500/Y.rowLen)},W=0,V=1,Q=2,Z=3,K=4,$=5,ee=6,te=7,ne=8,re=9,oe=10,ae=11,ie=12,de=13,se=14,ce=15,ue=16,fe=17,le=18,me=19,pe=20,ge=21,ve=22,he=23,Ee=24,we=25,_e=function(){var e,t,n,r,o,a={};a.rowLen=J(120),a.endPattern=2,a.patternLen=32;var i;for(e=0;e<gInstrumentPresets.length;++e)if(gInstrumentPresets[e].i){i=gInstrumentPresets[e];break}for(a.songData=[],e=0;8>e;e++){for(r={},r.i=[],t=0;t<=i.i.length;++t)r.i[t]=i.i[t];for(r.p=[],t=0;u>t;t++)r.p[t]=0;for(r.c=[],t=0;f>t;t++){for(o={},o.n=[],n=0;n<4*a.patternLen;n++)o.n[n]=0;for(o.f=[],n=0;n<2*a.patternLen;n++)o.f[n]=0;r.c[t]=o}a.songData[e]=r}return a.songData[0].p[0]=1,a},ye=function(e){var t=new CBinWriter;t.putULONG(e.rowLen),t.putUBYTE(e.endPattern-2),t.putUBYTE(e.patternLen);var n,r,o,a,i;for(n=0;8>n;n++){for(a=e.songData[n],t.putUBYTE(a.i[W]),t.putUBYTE(a.i[V]),t.putUBYTE(a.i[Q]),t.putUBYTE(a.i[Z]),t.putUBYTE(a.i[K]),t.putUBYTE(a.i[$]),t.putUBYTE(a.i[ee]),t.putUBYTE(a.i[te]),t.putUBYTE(a.i[ne]),t.putUBYTE(a.i[re]),t.putUBYTE(a.i[oe]),t.putUBYTE(a.i[ae]),t.putUBYTE(a.i[ie]),t.putUBYTE(a.i[de]),t.putUBYTE(a.i[se]),t.putUBYTE(a.i[ce]),t.putUBYTE(a.i[ue]),t.putUBYTE(a.i[fe]),t.putUBYTE(a.i[le]),t.putUBYTE(a.i[me]),t.putUBYTE(a.i[pe]),t.putUBYTE(a.i[ge]),t.putUBYTE(a.i[ve]),t.putUBYTE(a.i[he]),t.putUBYTE(a.i[Ee]),t.putUBYTE(a.i[we]),r=0;u>r;r++)t.putUBYTE(a.p[r]);for(r=0;f>r;r++){for(i=a.c[r],o=0;o<4*e.patternLen;o++)t.putUBYTE(i.n[o]);for(o=0;o<2*e.patternLen;o++)t.putUBYTE(i.f[o])}}var d,s,c=t.getData(),l=0;for(n=9;n>0;n--)if(d=RawDeflate.deflate(c,n),s=RawDeflate.inflate(d),c===s){l=2;break}return 0==l&&(d=rle_encode(t.getData()),s=rle_decode(d),c===s?l=1:d=c),t=new CBinWriter,t.putULONG(2020557395),t.putUBYTE(10),t.putUBYTE(l),t.append(d),t.getData()},Be=function(e){var t=new CBinParser(e),n={},r=t.getULONG(),o=t.getUBYTE();if(2020557395!=r||1>o||o>10)return void 0;if(o>=8){var a,i=t.getUBYTE(),d=t.getTail();switch(i){default:case 0:a=d;break;case 1:a=rle_decode(d);break;case 2:a=RawDeflate.inflate(d)}t=new CBinParser(a)}n.rowLen=t.getULONG(),n.endPattern=t.getUBYTE()+2,n.patternLen=o>=10?t.getUBYTE():32,n.songData=[];var s,c,l,m,p;for(s=0;8>s;s++){m={},m.i=[],6>o?(m.i[Q]=t.getUBYTE(),m.i[Z]=t.getUBYTE(),m.i[V]=t.getUBYTE(),m.i[W]=t.getUBYTE()):(m.i[W]=t.getUBYTE(),m.i[V]=t.getUBYTE(),m.i[Q]=t.getUBYTE(),m.i[Z]=t.getUBYTE()),6>o?(m.i[ee]=t.getUBYTE(),m.i[te]=t.getUBYTE(),m.i[ne]=t.getUBYTE(),m.i[$]=t.getUBYTE(),m.i[K]=t.getUBYTE()):(m.i[K]=t.getUBYTE(),m.i[$]=t.getUBYTE(),m.i[ee]=t.getUBYTE(),m.i[te]=t.getUBYTE(),m.i[ne]=t.getUBYTE()),m.i[re]=t.getUBYTE(),5>o?(m.i[oe]=Math.round(Math.sqrt(t.getULONG())/2),m.i[ae]=Math.round(Math.sqrt(t.getULONG())/2),m.i[ie]=Math.round(Math.sqrt(t.getULONG())/2)):(m.i[oe]=t.getUBYTE(),m.i[ae]=t.getUBYTE(),m.i[ie]=t.getUBYTE()),6>o?(m.i[fe]=t.getUBYTE(),m.i[le]=5>o?Math.round(t.getUSHORT()/43.23529):t.getUBYTE(),m.i[me]=t.getUBYTE(),m.i[we]=t.getUBYTE(),m.i[Ee]=t.getUBYTE(),m.i[he]=t.getUBYTE(),m.i[ve]=t.getUBYTE(),m.i[pe]=t.getUBYTE(),m.i[ge]=t.getUBYTE(),m.i[ue]=t.getUBYTE(),m.i[ce]=t.getUBYTE(),m.i[se]=t.getUBYTE(),m.i[de]=t.getUBYTE()):(m.i[de]=t.getUBYTE(),m.i[se]=t.getUBYTE(),m.i[ce]=t.getUBYTE(),m.i[ue]=t.getUBYTE(),m.i[fe]=t.getUBYTE(),m.i[le]=t.getUBYTE(),m.i[me]=t.getUBYTE(),m.i[pe]=t.getUBYTE(),m.i[ge]=t.getUBYTE(),m.i[ve]=t.getUBYTE(),m.i[he]=t.getUBYTE(),m.i[Ee]=t.getUBYTE(),m.i[we]=t.getUBYTE());var g=9>o?48:u;for(m.p=[],c=0;g>c;c++)m.p[c]=t.getUBYTE();for(c=g;u>c;c++)m.p[c]=0;var v=9>o?10:f;for(m.c=[],c=0;v>c;c++){if(p={},p.n=[],1==o)for(l=0;l<n.patternLen;l++)p.n[l]=t.getUBYTE(),p.n[l+n.patternLen]=0,p.n[l+2*n.patternLen]=0,p.n[l+3*n.patternLen]=0;else for(l=0;l<4*n.patternLen;l++)p.n[l]=t.getUBYTE();if(p.f=[],4>o)for(l=0;l<2*n.patternLen;l++)p.f[l]=0;else for(l=0;l<2*n.patternLen;l++)p.f[l]=t.getUBYTE();m.c[c]=p}for(c=v;f>c;c++){for(p={},p.n=[],l=0;l<4*n.patternLen;l++)p.n[l]=0;for(p.f=[],l=0;l<2*n.patternLen;l++)p.f[l]=0;m.c[c]=p}3>o&&(2==m.i[W]&&(m.i[V]=Math.round(m.i[V]/2)),2==m.i[K]&&(m.i[$]=Math.round(m.i[$]/2)),2==m.i[de]&&(m.i[se]=Math.round(m.i[se]/2)),m.i[ge]=m.i[ge]<224?m.i[ge]+32:255),7>o&&(m.i[me]=255-m.i[me]),n.songData[s]=m}return n},Ie=function(e){if(3333!=e.length)return void 0;if((255&e.charCodeAt(3332))>48)return void 0;var t=new CBinParser(e),n={};n.rowLen=t.getULONG(),n.patternLen=32,n.songData=[];var r,o,a,i,d,s;for(r=0;8>r;r++){for(i={},i.i=[],i.i[Q]=12*(t.getUBYTE()-8)+128,i.i[Q]+=t.getUBYTE(),t.getUBYTE(),i.i[Z]=t.getUBYTE(),i.i[V]=t.getUBYTE(),i.i[W]=t.getUBYTE(),i.i[ee]=12*(t.getUBYTE()-8)+128,i.i[ee]+=t.getUBYTE(),i.i[te]=t.getUBYTE(),i.i[ne]=t.getUBYTE(),i.i[$]=t.getUBYTE(),i.i[K]=t.getUBYTE(),i.i[re]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),i.i[oe]=Math.round(Math.sqrt(t.getULONG())/2),i.i[ae]=Math.round(Math.sqrt(t.getULONG())/2),i.i[ie]=Math.round(Math.sqrt(t.getULONG())/2),s=t.getUBYTE(),i.i[fe]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),i.i[le]=Math.round(t.getFLOAT()/43.23529),i.i[me]=255-t.getUBYTE(),i.i[we]=t.getUBYTE(),i.i[Ee]=t.getUBYTE(),i.i[he]=t.getUBYTE(),i.i[ve]=t.getUBYTE(),i.i[pe]=0,i.i[ge]=32,t.getUBYTE(),i.i[ue]=t.getUBYTE(),i.i[ce]=t.getUBYTE(),i.i[se]=t.getUBYTE(),i.i[de]=t.getUBYTE(),i.p=[],o=0;48>o;o++)i.p[o]=t.getUBYTE();for(o=48;u>o;o++)i.p[o]=0;for(i.c=[],o=0;10>o;o++){for(d={},d.n=[],a=0;32>a;a++)d.n[a]=t.getUBYTE(),d.n[a+32]=0,d.n[a+64]=0,d.n[a+96]=0;for(d.f=[],a=0;64>a;a++)d.f[a]=0;i.c[o]=d}for(o=10;f>o;o++){for(d={},d.n=[],a=0;128>a;a++)d.n[a]=0;for(d.f=[],a=0;64>a;a++)d.f[a]=0;i.c[o]=d}t.getUBYTE(),t.getUBYTE(),(i.i[fe]<1||i.i[fe]>3)&&(i.i[fe]=2,i.i[le]=255),i.i[V]*=s/255,i.i[$]*=s/255,i.i[re]*=s/255,2==i.i[W]&&(i.i[V]/=2),2==i.i[K]&&(i.i[$]/=2),2==i.i[de]&&(i.i[se]/=2),i.i[V]=Math.round(i.i[V]),i.i[$]=Math.round(i.i[$]),i.i[re]=Math.round(i.i[re]),i.i[se]=Math.round(i.i[se]),n.songData[r]=i}return n.endPattern=t.getUBYTE()+2,n},Le=function(e){var t=Be(e);return t||(t=Ie(e)),t?t:void alert("Song format not recognized.")},be=function(e){var t,n,r,o,a="";for(a+="    // This music has been exported by SoundBox. You can use it with\n",a+="    // http://sb.bitsnbites.eu/player-small.js in your own product.\n\n",a+="    // See http://sb.bitsnbites.eu/demo.html for an example of how to\n",a+="    // use it in a demo.\n\n",a+="    // Song data\n",a+="    var song = {\n",a+="      songData: [\n",t=0;8>t;t++){var i=e.songData[t];a+="        { // Instrument "+t+"\n",a+="          i: [\n",a+="          "+i.i[W]+", // OSC1_WAVEFORM\n",a+="          "+i.i[V]+", // OSC1_VOL\n",a+="          "+i.i[Q]+", // OSC1_SEMI\n",a+="          "+i.i[Z]+", // OSC1_XENV\n",a+="          "+i.i[K]+", // OSC2_WAVEFORM\n",a+="          "+i.i[$]+", // OSC2_VOL\n",a+="          "+i.i[ee]+", // OSC2_SEMI\n",a+="          "+i.i[te]+", // OSC2_DETUNE\n",a+="          "+i.i[ne]+", // OSC2_XENV\n",a+="          "+i.i[re]+", // NOISE_VOL\n",a+="          "+i.i[oe]+", // ENV_ATTACK\n",a+="          "+i.i[ae]+", // ENV_SUSTAIN\n",a+="          "+i.i[ie]+", // ENV_RELEASE\n",a+="          "+i.i[de]+", // LFO_WAVEFORM\n",a+="          "+i.i[se]+", // LFO_AMT\n",a+="          "+i.i[ce]+", // LFO_FREQ\n",a+="          "+i.i[ue]+", // LFO_FX_FREQ\n",a+="          "+i.i[fe]+", // FX_FILTER\n",a+="          "+i.i[le]+", // FX_FREQ\n",a+="          "+i.i[me]+", // FX_RESONANCE\n",a+="          "+i.i[pe]+", // FX_DIST\n",a+="          "+i.i[ge]+", // FX_DRIVE\n",a+="          "+i.i[ve]+", // FX_PAN_AMT\n",a+="          "+i.i[he]+", // FX_PAN_FREQ\n",a+="          "+i.i[Ee]+", // FX_DELAY_AMT\n",a+="          "+i.i[we]+" // FX_DELAY_TIME\n",a+="          ],\n",a+="          // Patterns\n",a+="          p: [";var d=e.endPattern-2,s=0,c=0;for(n=0;d>=n;n++)o=i.p[n],o>s&&(s=o),o&&(c=n);for(n=0;c>=n;n++)o=i.p[n],o&&(a+=o),c>n&&(a+=",");for(a+="],\n",a+="          // Columns\n",a+="          c: [\n",n=0;s>n;n++){for(a+="            {n: [",c=0,r=0;r<4*e.patternLen;r++)i.c[n].n[r]&&(c=r);for(r=0;c>=r;r++){var u=i.c[n].n[r];u&&(a+=u),c>r&&(a+=",")}for(a+="],\n",a+="             f: [",c=0,r=0;r<2*e.patternLen;r++)i.c[n].f[r]&&(c=r);for(r=0;c>=r;r++){var f=i.c[n].f[r];f&&(a+=f),c>r&&(a+=",")}a+="]}",s-1>n&&(a+=","),a+="\n"}a+="          ]\n",a+="        }",7>t&&(a+=","),a+="\n"}return a+="      ],\n",a+="      rowLen: "+e.rowLen+",   // In sample lengths\n",a+="      patternLen: "+e.patternLen+",  // Rows per pattern\n",a+="      endPattern: "+e.endPattern+"  // End pattern\n",a+="    };\n"},Te=function(e){var t=e.data[0]>>4,n=15&e.data[0],r=e.data[1],o=e.data[2];9!=n&&9==t&&o>0&&Ve(r-12)},De=function(e){o=r.inputs()[n.selectedIndex],o.onmidimessage=Te},xe=function(e){r=e;var t,a="function"==typeof r.inputs?r.inputs():[],i=0;for(t=0;t<a.length;t++){var d=a[t].name.toString().toLowerCase();if(-1!=d.indexOf("keyboard")){i=t;break}}if(n.options.length=0,a.length){for(t=0;t<a.length;t++)n.options[t]=new Option(a[t].name,a[t].fingerprint,t==i,t==i);o=a[i],o.onmidimessage=Te,n.onchange=De,n.style.display="inline"}},Ue=function(e){},Ce=function(){navigator.requestMIDIAccess&&(n=document.getElementById("midiInput"),navigator.requestMIDIAccess().then(xe,Ue))},Ye=function(e){var t=new Image;t.src=e,q.push(t)},ke=function(){for(var e,t,n=document.getElementById("instrPreset"),r=0;r<gInstrumentPresets.length;++r)t=gInstrumentPresets[r],e=document.createElement("option"),e.value=t.i?""+r:"",e.appendChild(document.createTextNode(t.name)),n.appendChild(e)},Me=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},Se=function(e){var t=null;return e||(e=window.event),e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t},Ae=function(e,t){var n=[0,0];if(e.pageX&&e.pageY?n=[e.pageX,e.pageY]:e.clientX&&e.clientY?n=[e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.clientY+document.body.scrollTop+document.documentElement.scrollTop]:e.touches&&e.touches.length>0&&(n=[e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop]),!t)return n;var r=Me(Se(e));return[n[0]-r[0],n[1]-r[1]]},Re=function(){document.getElementById("bpm").blur(),document.getElementById("rpp").blur(),document.getElementById("instrPreset").blur()},ze=function(e){e!==l&&(l=e,document.getElementById("sequencer").className=l==d?"edit":"",document.getElementById("pattern").className=l==s?"edit":"",document.getElementById("fxtrack").className=l==c?"edit":"",l!=i&&(Re(),et(),nt()))},Pe=function(){document.getElementById("bpm").value=G(),document.getElementById("rpp").value=Y.patternLen},Oe=function(e,t){for(var n,r=0;u>r;++r)for(var o=0;8>o;++o){if(n=document.getElementById("sc"+o+"r"+r),!t){var a=Y.songData[o].p[r];n.innerHTML=a>0?""+(10>=a?a-1:String.fromCharCode(64+a-10)):""}n.className=r>=w&&y>=r&&o>=E&&_>=o?"selected":""}if(e&&(n=document.getElementById("spr"+w),n.scrollIntoView)){var i=document.getElementById("sequencer"),d=n.offsetTop-i.scrollTop;(0>d||d+10>i.offsetHeight)&&n.scrollIntoView(0>d)}},Ne=function(e,t){Un();for(var n,r=E==_&&w==y,o=r?Y.songData[E].p[w]-1:-1,a=0;a<Y.patternLen;++a)for(var i=0;4>i;++i){if(n=document.getElementById("pc"+i+"r"+a),!t){var d="";if(o>=0){var s=Y.songData[E].c[o].n[a+i*Y.patternLen]-87;s>0&&(d=O[s%12]+Math.floor(s/12))}n.innerHTML!=d&&(n.innerHTML=d)}n.className=a>=g&&h>=a&&i>=p&&v>=i?"selected":""}if(e&r&&(n=document.getElementById("pc0r"+g),n.scrollIntoView)){var c=document.getElementById("pattern"),u=n.offsetTop-c.scrollTop;(0>u||u+10>c.offsetHeight)&&n.scrollIntoView(0>u)}},qe=function(e,t){for(var n=e.toString(16).toUpperCase(),r=t-n.length,o=0;r>o;++o)n="0"+n;return n},je=function(e,t){Cn();for(var n,r=E==_&&w==y,o=r?Y.songData[E].p[w]-1:-1,a=0;a<Y.patternLen;++a){if(n=document.getElementById("fxr"+a),!t){var i=":";if(o>=0){var d=Y.songData[E].c[o].f[a];if(d){var s=Y.songData[E].c[o].f[a+Y.patternLen];i=qe(d,2)+":"+qe(s,2)}}n.innerHTML!=i&&(n.innerHTML=i)}n.className=a>=B&&I>=a?"selected":""}if(e&r&&(n=document.getElementById("fxr"+B),n.scrollIntoView)){var c=document.getElementById("fxtrack"),u=n.offsetTop-c.scrollTop;(0>u||u+10>c.offsetHeight)&&n.scrollIntoView(0>u)}},Fe=function(e,t){p=e,g=t,v=e,h=t;for(var n=0;n<Y.patternLen;++n)for(var r=0;4>r;++r){var o=document.getElementById("pc"+r+"r"+n);o.className=n==t&&r==e?"selected":""}Ne(!0,!0)},Xe=function(e,t){v=e>=p?e:p,h=t>=g?t:g;for(var n=0;n<Y.patternLen;++n)for(var r=0;4>r;++r){var o=document.getElementById("pc"+r+"r"+n);o.className=n>=g&&h>=n&&r>=p&&v>=r?"selected":""}Ne(!1,!0)},He=function(e,t){E=e,w=t,_=e,y=t,Oe(!0,!0)},Je=function(e,t){_=e>=E?e:E,y=t>=w?t:w,Oe(!1,!0)},Ge=function(e){B=e,I=e;for(var t=0;t<Y.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=B&&I>=t?"selected":""}je(!0,!0)},We=function(e){I=e>=B?e:B;for(var t=0;t<Y.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=B&&I>=t?"selected":""}je(!1,!0)},Ve=function(e){var t=e+87;if(P.addNote(t),l==s&&E==_&&w==y&&p==v&&g==h){var n=Y.songData[E].p[w]-1;if(n>=0)return Y.songData[E].c[n].n[g+p*Y.patternLen]=t,Fe(p,(g+1)%Y.patternLen),Ne(),!0}return!1},Qe=function(e,t){var n=e.sliderProps,r=(t-n.min)/(n.max-n.min);r=0>r?0:r>1?1:r,n.nonLinear&&(r=Math.sqrt(r)),e.style.marginLeft=Math.round(191*r)+"px"},Ze=function(e,t){e.src=t?a+"box-check.png":a+"box-uncheck.png"},Ke=function(){var e=document.getElementById("instrPreset");e.selectedIndex=0},$e=function(e){var t=Y.songData[E];document.getElementById("osc1_wave_sin").src=0==t.i[W]?a+"wave-sin-sel.png":a+"wave-sin.png",document.getElementById("osc1_wave_sqr").src=1==t.i[W]?a+"wave-sqr-sel.png":a+"wave-sqr.png",document.getElementById("osc1_wave_saw").src=2==t.i[W]?a+"wave-saw-sel.png":a+"wave-saw.png",document.getElementById("osc1_wave_tri").src=3==t.i[W]?a+"wave-tri-sel.png":a+"/wave-tri.png",Qe(document.getElementById("osc1_vol"),t.i[V]),Qe(document.getElementById("osc1_semi"),t.i[Q]),Ze(document.getElementById("osc1_xenv"),t.i[Z]),document.getElementById("osc2_wave_sin").src=0==t.i[K]?a+"wave-sin-sel.png":a+"wave-sin.png",document.getElementById("osc2_wave_sqr").src=1==t.i[K]?a+"wave-sqr-sel.png":a+"wave-sqr.png",document.getElementById("osc2_wave_saw").src=2==t.i[K]?a+"wave-saw-sel.png":a+"wave-saw.png",document.getElementById("osc2_wave_tri").src=3==t.i[K]?a+"wave-tri-sel.png":a+"wave-tri.png",Qe(document.getElementById("osc2_vol"),t.i[$]),Qe(document.getElementById("osc2_semi"),t.i[ee]),Qe(document.getElementById("osc2_det"),t.i[te]),Ze(document.getElementById("osc2_xenv"),t.i[ne]),Qe(document.getElementById("noise_vol"),t.i[re]),Qe(document.getElementById("env_att"),t.i[oe]),Qe(document.getElementById("env_sust"),t.i[ae]),Qe(document.getElementById("env_rel"),t.i[ie]),document.getElementById("lfo_wave_sin").src=0==t.i[de]?a+"wave-sin-sel.png":a+"wave-sin.png",document.getElementById("lfo_wave_sqr").src=1==t.i[de]?a+"wave-sqr-sel.png":a+"wave-sqr.png",document.getElementById("lfo_wave_saw").src=2==t.i[de]?a+"wave-saw-sel.png":a+"wave-saw.png",document.getElementById("lfo_wave_tri").src=3==t.i[de]?a+"wave-tri-sel.png":a+"wave-tri.png",Qe(document.getElementById("lfo_amt"),t.i[se]),Qe(document.getElementById("lfo_freq"),t.i[ce]),Ze(document.getElementById("lfo_fxfreq"),t.i[ue]),document.getElementById("fx_filt_lp").src=2==t.i[fe]?a+"filt-lp-sel.png":a+"filt-lp.png",document.getElementById("fx_filt_hp").src=1==t.i[fe]?a+"filt-hp-sel.png":a+"filt-hp.png",document.getElementById("fx_filt_bp").src=3==t.i[fe]?a+"filt-bp-sel.png":a+"filt-bp.png",Qe(document.getElementById("fx_freq"),t.i[le]),Qe(document.getElementById("fx_res"),t.i[me]),Qe(document.getElementById("fx_dly_amt"),t.i[Ee]),Qe(document.getElementById("fx_dly_time"),t.i[we]),Qe(document.getElementById("fx_pan_amt"),t.i[ve]),Qe(document.getElementById("fx_pan_freq"),t.i[he]),Qe(document.getElementById("fx_dist"),t.i[pe]),Qe(document.getElementById("fx_drive"),t.i[ge]),e&&Ke(),P.updateInstr(t.i)},et=function(){var e=parseInt(document.getElementById("bpm").value);e&&e>=10&&1e3>=e&&(Y.rowLen=J(e),P.updateRowLen(Y.rowLen))},tt=function(e){if(Y.patternLen!==e){wt();var t,n,r,o,a,i;for(t=0;8>t;t++)for(n=0;f>n;n++){for(o=Y.songData[t].c[n],a=[],i=[],r=0;4*e>r;r++)a[r]=0;for(r=0;2*e>r;r++)i[r]=0;for(r=0;r<Math.min(Y.patternLen,e);r++)a[r]=o.n[r],a[r+e]=o.n[r+Y.patternLen],a[r+2*e]=o.n[r+2*Y.patternLen],a[r+3*e]=o.n[r+3*Y.patternLen],i[r]=o.f[r],i[r+e]=o.f[r+Y.patternLen];o.n=a,o.f=i}Y.patternLen=e}},nt=function(){var e=parseInt(document.getElementById("rpp").value);e&&e>=1&&256>=e&&(tt(e),Un(),Cn(),Ne(),je())},rt=function(){var e,t,n;for(Y.endPattern=u+1,e=u-1;e>=0;--e){for(n=!0,t=0;8>t;++t)if(Y.songData[t].p[e]>0){n=!1;break}if(!n)break;Y.endPattern--}et()},ot=function(){var e=document.getElementById("cover");e.style.visibility="visible",e=document.getElementById("dialog"),e.style.visibility="visible",bn()},at=function(){var e=document.getElementById("cover");e.style.visibility="hidden",e=document.getElementById("dialog"),e.style.visibility="hidden",Ln()},it=function(e){var t=document.getElementById("dialog");t.innerHTML="";var n,r;n=document.createElement("img"),n.src=a+"progress.gif",t.appendChild(n),n=document.createTextNode(e),t.appendChild(n),n=document.createElement("div"),n.id="progressBarParent",t.appendChild(n),r=document.createElement("div"),r.id="progressBar",n.appendChild(r),ot()},dt=function(e){var t=Le(e);t&&(wt(),Y=t,Pe(),Oe(),Ne(),je(),$e(!0))},st=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("h3"),t.appendChild(document.createTextNode("Open song")),e.appendChild(t),e.appendChild(document.createElement("br"));var n=document.createElement("form"),r=document.createElement("div");r.style.textAlign="left",r.style.marginLeft="30px",r.style.lineHeight="1.8em";for(var o=[],a=0;a<gDemoSongs.length;a++)t=document.createElement("input"),t.type="radio",t.name="radiogroup1",t.value=gDemoSongs[a].name,0===a&&(t.checked=!0),o.push(t),r.appendChild(t),t=document.createElement("span"),t.innerHTML=gDemoSongs[a].description,r.appendChild(t),r.appendChild(document.createElement("br"));var i=document.createElement("input");i.type="radio",i.name="radiogroup1",i.value="custom",r.appendChild(i),r.appendChild(document.createTextNode(" Data URL: "));var d=document.createElement("input");d.type="text",d.size="45",d.title="Paste a saved song data URL here",d.onchange=function(){i.checked=!0},d.onkeydown=d.onchange,d.onclick=d.onchange,r.appendChild(d),n.appendChild(r),t=document.createElement("p"),t.appendChild(document.createTextNode("Hint: You can also drag'n'drop binary files into the editor.")),n.appendChild(t),n.appendChild(document.createElement("br")),t=document.createElement("input"),t.type="submit",t.value="Open",t.title="Open song",t.onclick=function(e){e.preventDefault();var t=null;if(i.checked){var n=F(d.value);t=X(n&&n.data&&n.data[0])}else for(var r=0;r<o.length;r++)if(e=o[r],e.checked){for(var a=0;a<gDemoSongs.length;a++)if(gDemoSongs[a].name===e.value){t=gDemoSongs[a].data?gDemoSongs[a].data:X(gDemoSongs[a].base64);break}break}t&&dt(t),at()},n.appendChild(t),n.appendChild(document.createTextNode(" ")),t=document.createElement("input"),t.type="submit",t.value="Cancel",t.onclick=function(){return at(),!1},n.appendChild(t),e.appendChild(n),ot()},ct=function(){var e=document.getElementById("dialog");e.innerHTML="";var t,n;t=document.createElement("h3"),t.appendChild(document.createTextNode("Save song")),e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("Data URL (copy/paste, bookmark, mail etc):")),e.appendChild(t),t=document.createElement("p"),n=document.createElement("a");var r=H(ye(Y)),o=r.length<70?r:r.slice(0,67)+"...";n.href=r,n.title=r,n.appendChild(document.createTextNode(o)),t.appendChild(n),e.appendChild(t);var a=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Save binary",t.title="Save the song as a binary file.",t.onclick=function(){var e="data:application/octet-stream;base64,"+btoa(ye(Y));return window.open(e),at(),!1},a.appendChild(t),t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return at(),!1},a.appendChild(t),e.appendChild(a),ot()},ut=function(){var e=document.getElementById("dialog");

e.innerHTML="";var t;t=document.createElement("img"),t.src=a+"logo-big.png",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("an HTML5 synth music tracker")),e.appendChild(t),t=document.createElement("p"),t.innerHTML='Licensed under the <a href="LICENSE">GPL v3</a> license (get the <a href="http://gitorious.org/soundbox/soundbox">source</a>).',t.style.fontStyle="italic",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("To get started, open a demo song.")),e.appendChild(t),t=document.createElement("a"),t.href="help.html",t.appendChild(document.createTextNode("Help")),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createElement("br"));var n=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return at(),!1},n.appendChild(t),e.appendChild(n),ot()},ft=function(e){e.preventDefault(),ut()},lt=function(e){return Y=_e(),Pe(),Oe(),Ne(),je(),$e(),ze(s),Fe(0,0),He(0,0),Ge(0),!1},mt=function(e){e.preventDefault(),st()},pt=function(e){rt(),ct(),e.preventDefault()},gt=function(e){e.preventDefault(),rt();var t=function(e){var t=new Blob([e],{type:"application/octet-stream"});saveAs(t,"SoundBox-music.wav")};Et(t)},vt=function(e){rt();var t="data:text/javascript;base64,"+btoa(be(Y));return window.open(t),!1},ht=function(e){document.getElementById("statusText").innerHTML=e},Et=function(e,t){it("Generating sound...");var n=new Date;S=new CPlayer,S.generate(Y,t,function(t){var r=document.getElementById("progressBar");if(r.style.width=Math.floor(200*t)+"px",t>=1){var o=S.createWave(),a=new Date;ht("Generation time: "+(a.getTime()-n.getTime())/1e3+"s"),at(),e(o)}})},wt=function(){kt(),k&&(k.pause(),M.reset())},_t=-1,yt=0,Bt=0,It=0,Lt=0,bt=!1,Tt=0,Dt=0,xt=function(e,t){for(var n=44100*e/Y.rowLen,r=Math.floor(n),o=Math.floor(r/Y.patternLen)+yt,a=r%Y.patternLen,i=0;i<Y.patternLen;++i){for(var d=o,s=a-i;0>s;){if(--d,yt>d)return-1;s+=Y.patternLen}for(var c=Y.songData[t].p[d]-1,u=0;4>u;u++)if(c>=0&&Y.songData[t].c[c].n[s+u*Y.patternLen]>0)return(i+(n-r))*Y.rowLen}return-1},Ut=function(e){var t=document.getElementById("playGfxCanvas"),n=A.width>0?A.width:t.width,r=A.height>0?A.height:51,o=t.getContext("2d");if(o){o.drawImage(A,0,0);var a=0,i=0;if(bt&&e>=0){var d,s,c,u=S.getData(e,1e3),f=0,l=0,m=0,p=0;for(d=1;d<u.length;d+=2)s=u[d-1],c=u[d],f=.8*s+.1*f-.3*m,l=.8*c+.1*l-.3*p,m=s,p=c,a+=f*f,i+=l*l;a=.2*Math.sqrt(a/u.length)+.8*Tt,i=.2*Math.sqrt(i/u.length)+.8*Dt,Tt=a,Dt=i}var g=a>0?1.3+.5*Math.log(a):-1e3;g=-1>g?-1:g>1?1:g,g*=.57;var v=i>0?1.3+.5*Math.log(i):-1e3;for(v=-1>v?-1:v>1?1:v,v*=.57,o.strokeStyle="rgb(0,0,0)",o.beginPath(),o.moveTo(.25*n,2.1*r),o.lineTo(.25*n+1.8*r*Math.sin(g),2.1*r-1.8*r*Math.cos(g)),o.stroke(),o.beginPath(),o.moveTo(.75*n,2.1*r),o.lineTo(.75*n+1.8*r*Math.sin(v),2.1*r-1.8*r*Math.cos(v)),o.stroke(),o.fillStyle="rgb(0,0,0)",o.fillRect(0,r,n,20),d=0;8>d;++d){var h=Math.round(26+23*d);if(o.drawImage(R,h,r),d>=It&&Lt>=d){var E=Y.songData[d].i[oe],w=Y.songData[d].i[ae],_=Y.songData[d].i[ie];E=E*E*4,_=w*w*4+_*_*4;var y=E+_;1e4>y&&(y=1e4,_=y-E);var B=xt(e,d);if(B>=0&&y>B){var I;I=E>B?B/E:1-(B-E)/_,o.globalAlpha=I*I,o.drawImage(z,h,r),o.globalAlpha=1}}}}},Ct=function(){if(null!=k){var e,t,n=M.currentTime();if(k.ended||k.duration&&k.duration-n<.1)return kt(),g=0,h=0,Ne(),B=0,I=0,void je();var r=Math.floor(44100*n/Y.rowLen),o=Math.floor(r/Y.patternLen)+yt,a=r%Y.patternLen,i=o!=w,d=i||a!=g;if(i)for(o>=0&&(w=o,y=o,Oe(!0,!0)),e=0;u>e;++e)t=document.getElementById("spr"+e),t.className=e==o?"playpos":"";if(d)for(a>=0&&(g=a,h=a,Ne(!0,!i),B=a,I=a,je(!0,!i)),e=0;e<Y.patternLen;++e)t=document.getElementById("ppr"+e),t.className=e==a?"playpos":"";Ut(n)}},Yt=function(){w=yt,y=yt,_=E,Oe(!0,!0),Ne(),je(),bt=!0,_t=setInterval(Ct,16)},kt=function(){if(bt){-1!==_t&&(clearInterval(_t),_t=-1);var e;for(e=0;u>e;++e)document.getElementById("spr"+e).className="";for(e=0;e<Y.patternLen;++e)document.getElementById("ppr"+e).className="";Ut(-1),bt=!1}},Mt=function(e){e||(e=window.event),e.preventDefault(),wt(),rt(),yt=0,Bt=Y.endPattern-2,It=0,Lt=7;var t=function(e){if(null==k)return void alert("Audio element unavailable.");try{Yt(),k.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),M.reset(),k.play()}catch(t){alert("Error playing: "+t.message)}};Et(t)},St=function(e){e||(e=window.event),e.preventDefault(),wt(),rt();var t={firstRow:w,lastRow:y,firstCol:E,lastCol:_};yt=w,Bt=y,It=E,Lt=_;var n=function(e){if(null==k)return void alert("Audio element unavailable.");try{Yt(),k.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),k.play(),M.reset()}catch(t){alert("Error playing: "+t.message)}};Et(n,t)},At=function(e){return e||(e=window.event),e.preventDefault(),null==k?void alert("Audio element unavailable."):void wt()},Rt=function(e){return ze(i),!0},zt=function(e){return ze(i),!0},Pt=function(e){return ze(i),!0},Ot=function(e){if(e||(e=window.event),e.preventDefault(),E==_){C=[];for(var t=Y.songData[E],n=0;n<=t.i.length;++n)C[n]=t.i[n]}},Nt=function(e){if(e||(e=window.event),e.preventDefault(),E==_&&C.length>0){var t=Y.songData[E];t.i=[];for(var n=0;n<=C.length;++n)t.i[n]=C[n]}$e(!0)},qt=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){x=[];for(var n=g;h>=n;++n){for(var r=[],o=p;v>=o;++o)r.push(Y.songData[E].c[t].n[n+o*Y.patternLen]);x.push(r)}}}},jt=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){for(var n=g,r=0;n<Y.patternLen&&r<x.length;++n,++r)for(var o=p,a=0;4>o&&a<x[r].length;++o,++a)Y.songData[E].c[t].n[n+o*Y.patternLen]=x[r][a];Ne()}}},Ft=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){for(var n=g;h>=n;++n)for(var r=p;v>=r;++r){var o=Y.songData[E].c[t].n[n+r*Y.patternLen];o>0&&(Y.songData[E].c[t].n[n+r*Y.patternLen]=o+1)}Ne()}}},Xt=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){for(var n=g;h>=n;++n)for(var r=p;v>=r;++r){var o=Y.songData[E].c[t].n[n+r*Y.patternLen];o>1&&(Y.songData[E].c[t].n[n+r*Y.patternLen]=o-1)}Ne()}}},Ht=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){for(var n=g;h>=n;++n)for(var r=p;v>=r;++r){var o=Y.songData[E].c[t].n[n+r*Y.patternLen];o>0&&(Y.songData[E].c[t].n[n+r*Y.patternLen]=o+12)}Ne()}}},Jt=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){for(var n=g;h>=n;++n)for(var r=p;v>=r;++r){var o=Y.songData[E].c[t].n[n+r*Y.patternLen];o>12&&(Y.songData[E].c[t].n[n+r*Y.patternLen]=o-12)}Ne()}}},Gt=function(e){e||(e=window.event),e.preventDefault(),D=[];for(var t=w;y>=t;++t){for(var n=[],r=E;_>=r;++r)n.push(Y.songData[r].p[t]);D.push(n)}},Wt=function(e){e||(e=window.event),e.preventDefault();for(var t=w,n=0;u>t&&n<D.length;++t,++n)for(var r=E,o=0;8>r&&o<D[n].length;++r,++o)Y.songData[r].p[t]=D[n][o];Oe()},Vt=function(e){e||(e=window.event),e.preventDefault();for(var t=w;y>=t;++t)for(var n=E;_>=n;++n){var r=Y.songData[n].p[t];f>r&&(Y.songData[n].p[t]=r+1)}Oe(),Ne(),je()},Qt=function(e){e||(e=window.event),e.preventDefault();for(var t=w;y>=t;++t)for(var n=E;_>=n;++n){var r=Y.songData[n].p[t];r>0&&(Y.songData[n].p[t]=r-1)}Oe(),Ne(),je()},Zt=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){U=[];for(var n=B;I>=n;++n){var r=[];r.push(Y.songData[E].c[t].f[n]),r.push(Y.songData[E].c[t].f[n+Y.patternLen]),U.push(r)}}}},Kt=function(e){if(e||(e=window.event),e.preventDefault(),w==y&&E==_){var t=Y.songData[E].p[w]-1;if(t>=0){for(var n=B,r=0;n<Y.patternLen&&r<U.length;++n,++r){var o=U[r];Y.songData[E].c[t].f[n]=o[0],Y.songData[E].c[t].f[n+Y.patternLen]=o[1]}je()}}},$t=function(e){if(e||(e=window.event),E==_){var t=Se(e),n=-1;"osc1_xenv"===t.id?n=Z:"osc2_xenv"===t.id?n=ne:"lfo_fxfreq"===t.id&&(n=ue);var r;if(n>=0&&(r=Y.songData[E].i[n]?0:1,Y.songData[E].i[n]=r),l==c&&w==y&&B==I&&n){var o=Y.songData[E].p[w]-1;o>=0&&(Y.songData[E].c[o].f[B]=n+1,Y.songData[E].c[o].f[B+Y.patternLen]=r,je())}$e(!0),Re(),e.preventDefault()}},en=function(e){if(e||(e=window.event),E==_){var t=Se(e),n=0;if("osc1_wave_sin"===t.id?n=0:"osc1_wave_sqr"===t.id?n=1:"osc1_wave_saw"===t.id?n=2:"osc1_wave_tri"===t.id&&(n=3),l==c&&w==y&&B==I){var r=Y.songData[E].p[w]-1;r>=0&&(Y.songData[E].c[r].f[B]=W+1,Y.songData[E].c[r].f[B+Y.patternLen]=n,je())}Y.songData[E].i[W]=n,$e(),Re(),e.preventDefault()}},tn=function(e){if(e||(e=window.event),E==_){var t=Se(e),n=0;if("osc2_wave_sin"===t.id?n=0:"osc2_wave_sqr"===t.id?n=1:"osc2_wave_saw"===t.id?n=2:"osc2_wave_tri"===t.id&&(n=3),l==c&&w==y&&B==I){var r=Y.songData[E].p[w]-1;r>=0&&(Y.songData[E].c[r].f[B]=K+1,Y.songData[E].c[r].f[B+Y.patternLen]=n,je())}Y.songData[E].i[K]=n,$e(!0),Re(),e.preventDefault()}},nn=function(e){if(e||(e=window.event),E==_){var t=Se(e),n=0;if("lfo_wave_sin"===t.id?n=0:"lfo_wave_sqr"===t.id?n=1:"lfo_wave_saw"===t.id?n=2:"lfo_wave_tri"===t.id&&(n=3),l==c&&w==y&&B==I){var r=Y.songData[E].p[w]-1;r>=0&&(Y.songData[E].c[r].f[B]=de+1,Y.songData[E].c[r].f[B+Y.patternLen]=n,je())}Y.songData[E].i[de]=n,$e(!0),Re(),e.preventDefault()}},rn=function(e){if(e||(e=window.event),E==_){var t=Se(e),n=2;if("fx_filt_hp"===t.id?n=1:"fx_filt_lp"===t.id?n=2:"fx_filt_bp"===t.id&&(n=3),l==c&&w==y&&B==I){var r=Y.songData[E].p[w]-1;r>=0&&(Y.songData[E].c[r].f[B]=fe+1,Y.songData[E].c[r].f[B+Y.patternLen]=n,je())}Y.songData[E].i[fe]=n,$e(!0),Re(),e.preventDefault()}},on=function(e){e||(e=window.event),e.preventDefault(),8>m&&(m++,document.getElementById("keyboardOctave").innerHTML=""+m)},an=function(e){e||(e=window.event),e.preventDefault(),m>1&&(m--,document.getElementById("keyboardOctave").innerHTML=""+m)},dn=function(e){if(e||(e=window.event),E==_){var t=Se(e),n=t.options[t.selectedIndex].value;if(""!==n&&(n=parseInt(n))){for(var r=gInstrumentPresets[n],o=0;o<r.i.length;++o)Y.songData[E].i[o]=r.i[o];$e(!1),e.preventDefault()}}},sn=function(e){e||(e=window.event);var t=Ae(e,!0),n=0;if(t[1]<68)for(var r=0;r<N.length;r+=2)if(t[0]>=N[r]-10&&t[0]<=N[r]+10){n=N[r+1];break}if(!n){n=2*Math.floor(14*t[0]/420);var o=0;n>=20&&o++,n>=14&&o++,n>=6&&o++,n-=o}Ve(n+12*m)&&e.preventDefault()},cn=function(e){if(e||(e=window.event),e.preventDefault(),!bt){var t=Se(e),n=parseInt(t.id.slice(3));Ge(n),T=!0}ze(c)},un=function(e){if(T){e||(e=window.event);var t=Se(e),n=parseInt(t.id.slice(3));We(n),e.preventDefault()}},fn=function(e){if(T){e||(e=window.event);var t=Se(e),n=parseInt(t.id.slice(3));We(n),T=!1,e.preventDefault()}},ln=function(e){if(e||(e=window.event),e.preventDefault(),!bt){var t=Se(e),n=parseInt(t.id.slice(2,3)),r=parseInt(t.id.slice(4));Fe(n,r),b=!0}ze(s)},mn=function(e){if(b){e||(e=window.event);var t=Se(e),n=parseInt(t.id.slice(2,3)),r=parseInt(t.id.slice(4));Xe(n,r),e.preventDefault()}},pn=function(e){if(b){e||(e=window.event);var t=Se(e),n=parseInt(t.id.slice(2,3)),r=parseInt(t.id.slice(4));Xe(n,r),b=!1,e.preventDefault()}},gn=function(e){e||(e=window.event);var t,n=Se(e),r=parseInt(n.id.slice(2,3));t=bt?w:parseInt(n.id.slice(4));var o=r!=E||E!=_;He(r,t),bt||(L=!0),ze(d),Ne(),je(),$e(o),e.preventDefault()},vn=function(e){if(L){e||(e=window.event);var t=Se(e),n=parseInt(t.id.slice(2,3)),r=parseInt(t.id.slice(4));Je(n,r),Ne(),je(),$e(!0),e.preventDefault()}},hn=function(e){if(L){e||(e=window.event);var t=Se(e),n=parseInt(t.id.slice(2,3)),r=parseInt(t.id.slice(4)),o=n!=_||E!=_;Je(n,r),L=!1,Ne(),je(),$e(o),e.preventDefault()}},En=null,wn=function(e){E==_&&(e||(e=window.event),En=Se(e),Re(),e.preventDefault())},_n=function(e){if(e||(e=window.event),En){var t=Ae(e,!1),n=Me(En.parentNode),r=t[0]-6-n[0];r=0>r?0:r>191?1:r/191,En.sliderProps.nonLinear&&(r*=r);var o=En.sliderProps.min,a=En.sliderProps.max;r=Math.round(o+(a-o)*r);var i=-1;"osc1_vol"==En.id?i=V:"osc1_semi"==En.id?i=Q:"osc2_vol"==En.id?i=$:"osc2_semi"==En.id?i=ee:"osc2_det"==En.id?i=te:"noise_vol"==En.id?i=re:"env_att"==En.id?i=oe:"env_sust"==En.id?i=ae:"env_rel"==En.id?i=ie:"lfo_amt"==En.id?i=se:"lfo_freq"==En.id?i=ce:"fx_freq"==En.id?i=le:"fx_res"==En.id?i=me:"fx_dist"==En.id?i=pe:"fx_drive"==En.id?i=ge:"fx_pan_amt"==En.id?i=ve:"fx_pan_freq"==En.id?i=he:"fx_dly_amt"==En.id?i=Ee:"fx_dly_time"==En.id&&(i=we);var d=Y.songData[E];if(l==c&&B==I&&w==y&&E==_){var s=Y.songData[E].p[w]-1;s>=0&&(Y.songData[E].c[s].f[B]=i+1,Y.songData[E].c[s].f[B+Y.patternLen]=r,je())}i>=0&&(d.i[i]=r),P.updateInstr(d.i),Qe(En,r),Ke(),e.preventDefault()}},yn=function(e){return En?(En=null,!1):!0},Bn=function(e){e||(e=window.event);var t,n,r,o=document.activeElement===document.getElementById("bpm")||document.activeElement===document.getElementById("rpp");if(l==d&&E==_&&w==y){if(e.keyCode>=48&&e.keyCode<=57)return Y.songData[E].p[w]=e.keyCode-47,Oe(),Ne(),je(),!1;if(e.keyCode>=64&&e.keyCode<=90)return Y.songData[E].p[w]=e.keyCode-54,Oe(),Ne(),je(),!1}if(l!=d&&!o){switch(r=-1,e.keyCode){case 90:r=0;break;case 83:r=1;break;case 88:r=2;break;case 68:r=3;break;case 67:r=4;break;case 86:r=5;break;case 71:r=6;break;case 66:r=7;break;case 72:r=8;break;case 78:r=9;break;case 74:r=10;break;case 77:r=11;break;case 188:r=12;break;case 76:r=13;break;case 190:r=14;break;case 186:r=15;break;case 191:r=16;break;case 81:r=12;break;case 50:r=13;break;case 87:r=14;break;case 51:r=15;break;case 69:r=16;break;case 82:r=17;break;case 53:r=18;break;case 84:r=19;break;case 54:r=20;break;case 89:r=21;break;case 55:r=22;break;case 85:r=23;break;case 73:r=24;break;case 57:r=25;break;case 79:r=26;break;case 48:r=27;break;case 80:r=28}if(r>=0&&Ve(r+12*m))return!1}var a;switch(e.keyCode){case 39:if(l==d)return He((E+1)%8,w),Ne(),je(),$e(!0),!1;if(l==s)return Fe((p+1)%4,g),!1;break;case 37:if(l==d)return He((E-1+8)%8,w),Ne(),je(),$e(!0),!1;if(l==s)return Fe((p-1+4)%4,g),!1;break;case 40:if(l==d)return He(E,(w+1)%u),Ne(),je(),!1;if(l==s)return Fe(p,(g+1)%Y.patternLen),!1;if(l==c)return Ge((B+1)%Y.patternLen),!1;break;case 38:if(l==d)return He(E,(w-1+u)%u),Ne(),je(),!1;if(l==s)return Fe(p,(g-1+Y.patternLen)%Y.patternLen),!1;if(l==c)return Ge((B-1+Y.patternLen)%Y.patternLen),!1;break;case 36:if(l==d)return He(E,0),Ne(),je(),!1;if(l==s)return Fe(p,0),!1;if(l==c)return Ge(0),!1;break;case 35:if(l==d)return He(E,u-1),Ne(),je(),!1;if(l==s)return Fe(p,Y.patternLen-1),!1;if(l==c)return Ge(Y.patternLen-1),!1;break;case 32:if(l!=i)return St(e),!1;break;case 8:case 46:if(l==d){for(t=w;y>=t;++t)for(n=E;_>=n;++n)Y.songData[n].p[t]=0;return Oe(),Ne(),je(),!1}if(l==s){if(w==y&&E==_){if(a=Y.songData[E].p[w]-1,a>=0){for(t=g;h>=t;++t)for(n=p;v>=n;++n)Y.songData[E].c[a].n[t+n*Y.patternLen]=0;g==h&&Fe(p,(g+1)%Y.patternLen),Ne()}return!1}}else if(l==c&&w==y&&E==_){if(a=Y.songData[E].p[w]-1,a>=0){for(t=B;I>=t;++t)Y.songData[E].c[a].f[t]=0,Y.songData[E].c[a].f[t+Y.patternLen]=0;B==I&&Ge((B+1)%Y.patternLen),je()}return!1}break;case 13:o&&(et(),nt(),document.getElementById("bpm").blur(),document.getElementById("rpp").blur())}return!0},In=function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;if(1!=t.length)return void alert("Only open one file at a time.");var n=t[0],r=new FileReader;r.onload=function(e){dt(X(e.target.result))},r.readAsDataURL(n)},Ln=function(){document.onmousedown=null,document.addEventListener("mousemove",_n,!1),document.addEventListener("touchmove",_n,!1),document.addEventListener("mouseup",yn,!1),document.addEventListener("touchend",yn,!1),document.onkeydown=Bn;var e=document.body.parentNode;e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("drop",In,!1)},bn=function(){document.onmousedown=function(){return!0},document.onmousemove=null,document.onmouseup=null,document.onkeydown=null},Tn=function(){for(var e,t,n,r=document.getElementById("sequencer-table"),o=0;u>o;o++){e=document.createElement("tr"),o%4===0&&(e.className="beat"),t=document.createElement("th"),t.id="spr"+o,t.textContent=""+o,e.appendChild(t);for(var a=0;8>a;a++)n=document.createElement("td"),n.id="sc"+a+"r"+o,n.textContent=" ",n.addEventListener("mousedown",gn,!1),n.addEventListener("mouseover",vn,!1),n.addEventListener("mouseup",hn,!1),e.appendChild(n);r.appendChild(e)}},Dn=function(e){for(var t=1;t<e.children.length&&"beat"!==e.children[t].className;)t++;return t},xn=function(){var e=G(),t=4;return Y.patternLen%3===0?t=3:Y.patternLen%4===0?t=4:Y.patternLen%2===0?t=2:Y.patternLen%5===0&&(t=5),e/t>=40&&Y.patternLen>24&&Y.patternLen%(2*t)===0&&(t*=2),t},Un=function(){var e=xn(),t=document.getElementById("pattern-table");if(t.children.length!==Y.patternLen||Dn(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,r,o,a=0;a<Y.patternLen;a++){n=document.createElement("tr"),a%e===0&&(n.className="beat"),r=document.createElement("th"),r.id="ppr"+a,r.textContent=""+a,n.appendChild(r);for(var i=0;4>i;i++)o=document.createElement("td"),o.id="pc"+i+"r"+a,o.textContent=" ",o.addEventListener("mousedown",ln,!1),o.addEventListener("mouseover",mn,!1),o.addEventListener("mouseup",pn,!1),n.appendChild(o);t.appendChild(n)}}},Cn=function(){var e=xn(),t=document.getElementById("fxtrack-table");if(t.children.length!==Y.patternLen||Dn(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,r,o=0;o<Y.patternLen;o++)n=document.createElement("tr"),o%e===0&&(n.className="beat"),r=document.createElement("td"),r.id="fxr"+o,r.textContent=String.fromCharCode(160),r.addEventListener("mousedown",cn,!1),r.addEventListener("mouseover",un,!1),r.addEventListener("mouseup",fn,!1),n.appendChild(r),t.appendChild(n)}};this.init=function(){e=j(window.location.href),t=F(window.location.href),Ye(a+"progress.gif"),Ye(a+"box-uncheck.png"),Ye(a+"box-uncheck.png"),Ye(a+"wave-sin.png"),Ye(a+"wave-sin-sel.png"),Ye(a+"wave-saw.png"),Ye(a+"wave-saw-sel.png"),Ye(a+"wave-sqr.png"),Ye(a+"wave-sqr-sel.png"),Ye(a+"wave-tri.png"),Ye(a+"wave-tri-sel.png"),Ye(a+"filt-lp.png"),Ye(a+"filt-lp-sel.png"),Ye(a+"filt-hp.png"),Ye(a+"filt-hp-sel.png"),Ye(a+"filt-bp.png"),Ye(a+"filt-bp-sel.png"),Ye(a+"filt-n.png"),Ye(a+"filt-n-sel.png"),ke(),A.onload=function(){Ut(-1)},R.onload=function(){Ut(-1)},A.src=a+"playGfxBg.png",R.src=a+"led-off.png",z.src=a+"led-on.png",Tn(),document.getElementById("osc1_vol").sliderProps={min:0,max:255},document.getElementById("osc1_semi").sliderProps={min:92,max:164},document.getElementById("osc2_vol").sliderProps={min:0,max:255},document.getElementById("osc2_semi").sliderProps={min:92,max:164},document.getElementById("osc2_det").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("noise_vol").sliderProps={min:0,max:255},document.getElementById("env_att").sliderProps={min:0,max:255},document.getElementById("env_sust").sliderProps={min:0,max:255},document.getElementById("env_rel").sliderProps={min:0,max:255},document.getElementById("lfo_amt").sliderProps={min:0,max:255},document.getElementById("lfo_freq").sliderProps={min:0,max:16},document.getElementById("fx_freq").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_res").sliderProps={min:0,max:254},document.getElementById("fx_dly_amt").sliderProps={min:0,max:255},document.getElementById("fx_dly_time").sliderProps={min:0,max:16},document.getElementById("fx_pan_amt").sliderProps={min:0,max:255},document.getElementById("fx_pan_freq").sliderProps={min:0,max:16},document.getElementById("fx_dist").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_drive").sliderProps={min:0,max:255};try{k=new Audio,M.setAudioElement(k),k.addEventListener("canplay",function(){this.play()},!0)}catch(n){k=null}var r=X(t&&t.data&&t.data[0]),o=r?Le(r):null;Y=o?o:_e(),Pe(),Oe(),Ne(),je(),$e(!0),ze(s),He(0,0),Fe(0,0),document.getElementById("logo").onmousedown=ft,document.getElementById("newSong").onmousedown=lt,document.getElementById("openSong").onmousedown=mt,document.getElementById("saveSong").onmousedown=pt,document.getElementById("exportJS").onmousedown=vt,document.getElementById("exportWAV").onmousedown=gt,document.getElementById("playSong").onmousedown=Mt,document.getElementById("playRange").onmousedown=St,document.getElementById("stopPlaying").onmousedown=At,document.getElementById("about").onmousedown=ft,document.getElementById("bpm").onfocus=Rt,document.getElementById("rpp").onfocus=zt,document.getElementById("sequencerCopy").onmousedown=Gt,document.getElementById("sequencerPaste").onmousedown=Wt,document.getElementById("sequencerPatUp").onmousedown=Vt,document.getElementById("sequencerPatDown").onmousedown=Qt,document.getElementById("patternCopy").onmousedown=qt,document.getElementById("patternPaste").onmousedown=jt,document.getElementById("patternNoteUp").onmousedown=Ft,document.getElementById("patternNoteDown").onmousedown=Xt,document.getElementById("patternOctaveUp").onmousedown=Ht,document.getElementById("patternOctaveDown").onmousedown=Jt,document.getElementById("fxCopy").onmousedown=Zt,document.getElementById("fxPaste").onmousedown=Kt,document.getElementById("instrPreset").onfocus=Pt,document.getElementById("instrPreset").onchange=dn,document.getElementById("osc1_wave_sin").addEventListener("mousedown",en,!1),document.getElementById("osc1_wave_sin").addEventListener("touchstart",en,!1),document.getElementById("osc1_wave_sqr").addEventListener("mousedown",en,!1),document.getElementById("osc1_wave_sqr").addEventListener("touchstart",en,!1),document.getElementById("osc1_wave_saw").addEventListener("mousedown",en,!1),document.getElementById("osc1_wave_saw").addEventListener("touchstart",en,!1),document.getElementById("osc1_wave_tri").addEventListener("mousedown",en,!1),document.getElementById("osc1_wave_tri").addEventListener("touchstart",en,!1),document.getElementById("osc1_vol").addEventListener("mousedown",wn,!1),document.getElementById("osc1_vol").addEventListener("touchstart",wn,!1),document.getElementById("osc1_semi").addEventListener("mousedown",wn,!1),document.getElementById("osc1_semi").addEventListener("touchstart",wn,!1),document.getElementById("osc1_xenv").addEventListener("mousedown",$t,!1),document.getElementById("osc1_xenv").addEventListener("touchstart",$t,!1),document.getElementById("osc2_wave_sin").addEventListener("mousedown",tn,!1),document.getElementById("osc2_wave_sin").addEventListener("touchstart",tn,!1),document.getElementById("osc2_wave_sqr").addEventListener("mousedown",tn,!1),document.getElementById("osc2_wave_sqr").addEventListener("touchstart",tn,!1),document.getElementById("osc2_wave_saw").addEventListener("mousedown",tn,!1),document.getElementById("osc2_wave_saw").addEventListener("touchstart",tn,!1),document.getElementById("osc2_wave_tri").addEventListener("mousedown",tn,!1),document.getElementById("osc2_wave_tri").addEventListener("touchstart",tn,!1),document.getElementById("osc2_vol").addEventListener("mousedown",wn,!1),document.getElementById("osc2_vol").addEventListener("touchstart",wn,!1),document.getElementById("osc2_semi").addEventListener("mousedown",wn,!1),document.getElementById("osc2_semi").addEventListener("touchstart",wn,!1),document.getElementById("osc2_det").addEventListener("mousedown",wn,!1),document.getElementById("osc2_det").addEventListener("touchstart",wn,!1),document.getElementById("osc2_xenv").addEventListener("mousedown",$t,!1),document.getElementById("osc2_xenv").addEventListener("touchstart",$t,!1),document.getElementById("noise_vol").addEventListener("mousedown",wn,!1),document.getElementById("noise_vol").addEventListener("touchstart",wn,!1),document.getElementById("env_att").addEventListener("mousedown",wn,!1),document.getElementById("env_att").addEventListener("touchstart",wn,!1),document.getElementById("env_sust").addEventListener("mousedown",wn,!1),document.getElementById("env_sust").addEventListener("touchstart",wn,!1),document.getElementById("env_rel").addEventListener("mousedown",wn,!1),document.getElementById("env_rel").addEventListener("touchstart",wn,!1),document.getElementById("lfo_wave_sin").addEventListener("mousedown",nn,!1),document.getElementById("lfo_wave_sin").addEventListener("touchstart",nn,!1),document.getElementById("lfo_wave_sqr").addEventListener("mousedown",nn,!1),document.getElementById("lfo_wave_sqr").addEventListener("touchstart",nn,!1),document.getElementById("lfo_wave_saw").addEventListener("mousedown",nn,!1),document.getElementById("lfo_wave_saw").addEventListener("touchstart",nn,!1),document.getElementById("lfo_wave_tri").addEventListener("mousedown",nn,!1),document.getElementById("lfo_wave_tri").addEventListener("touchstart",nn,!1),document.getElementById("lfo_amt").addEventListener("mousedown",wn,!1),document.getElementById("lfo_amt").addEventListener("touchstart",wn,!1),document.getElementById("lfo_freq").addEventListener("mousedown",wn,!1),document.getElementById("lfo_freq").addEventListener("touchstart",wn,!1),document.getElementById("lfo_fxfreq").addEventListener("mousedown",$t,!1),document.getElementById("lfo_fxfreq").addEventListener("touchstart",$t,!1),document.getElementById("fx_filt_lp").addEventListener("mousedown",rn,!1),document.getElementById("fx_filt_lp").addEventListener("touchstart",rn,!1),document.getElementById("fx_filt_hp").addEventListener("mousedown",rn,!1),document.getElementById("fx_filt_hp").addEventListener("touchstart",rn,!1),document.getElementById("fx_filt_bp").addEventListener("mousedown",rn,!1),document.getElementById("fx_filt_bp").addEventListener("touchstart",rn,!1),document.getElementById("fx_freq").addEventListener("mousedown",wn,!1),document.getElementById("fx_freq").addEventListener("touchstart",wn,!1),document.getElementById("fx_res").addEventListener("mousedown",wn,!1),document.getElementById("fx_res").addEventListener("touchstart",wn,!1),document.getElementById("fx_dly_amt").addEventListener("mousedown",wn,!1),document.getElementById("fx_dly_amt").addEventListener("touchstart",wn,!1),document.getElementById("fx_dly_time").addEventListener("mousedown",wn,!1),document.getElementById("fx_dly_time").addEventListener("touchstart",wn,!1),document.getElementById("fx_pan_amt").addEventListener("mousedown",wn,!1),document.getElementById("fx_pan_amt").addEventListener("touchstart",wn,!1),document.getElementById("fx_pan_freq").addEventListener("mousedown",wn,!1),document.getElementById("fx_pan_freq").addEventListener("touchstart",wn,!1),document.getElementById("fx_dist").addEventListener("mousedown",wn,!1),document.getElementById("fx_dist").addEventListener("touchstart",wn,!1),document.getElementById("fx_drive").addEventListener("mousedown",wn,!1),document.getElementById("fx_drive").addEventListener("touchstart",wn,!1),document.getElementById("octaveDown").addEventListener("mousedown",an,!1),document.getElementById("octaveDown").addEventListener("touchstart",an,!1),document.getElementById("octaveUp").addEventListener("mousedown",on,!1),document.getElementById("octaveUp").addEventListener("touchstart",on,!1),document.getElementById("keyboard").addEventListener("mousedown",sn,!1),document.getElementById("keyboard").addEventListener("touchstart",sn,!1),document.getElementById("instrCopy").onmousedown=Ot,document.getElementById("instrPaste").onmousedown=Nt,Ce(),Ln(),r||ut(),P.start(),P.updateRowLen(Y.rowLen)}};