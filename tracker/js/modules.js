/**
 * This file is part of ReSampled SoundBox.
 *
 * Based on SoundBox by Marcus Geelnard (c) 2011-2013
 * 2015 pointofpresence
 * ReSampled.SoundBox (resampled-sound-box) - Online music tracker
 *
 * @version v0.0.1
 * @build Wed Aug 05 2015 21:22:35
 * @link https://github.com/pointofpresence/resampled-sound-box
 * @license GPL-3.0
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 * 1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 * 2. Altered source versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 * 3. This notice may not be removed or altered from any source
 *    distribution.
 */
function rle_encode(e){var t,n,i,r,a="";for(t=0;t<e.length;){for(i=e.charCodeAt(t),n=1;255>n&&t+n<e.length&&(r=e.charCodeAt(t+n),r==i);n++);n>3?(a+=String.fromCharCode(254),a+=String.fromCharCode(n),a+=String.fromCharCode(i)):(a+=String.fromCharCode(i),254==i&&(a+=String.fromCharCode(0)),n=1),t+=n}return a}function rle_decode(e){var t,n,i,r,a="";for(t=0;t<e.length;){if(i=e.charCodeAt(t++),254===i){if(1>t)break;if(r=e.charCodeAt(t++),0!=r){if(1>t)break;for(i=e.charCodeAt(t++),n=0;r>n;n++)a+=String.fromCharCode(i);continue}}a+=String.fromCharCode(i)}return a}function gui_init(){try{var e=new CGUI;e.init()}catch(t){alert("Unexpected error: "+t.message)}}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={},n=Math.max,i=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var i;for(i in t)n.o[i]=t[i];n._carve().init(),n._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var i=e(this);n.i[t]=i,n.v[t]=n.o.parse(i.val()),i.bind("change blur",function(){var e={};e[t]=i.val(),n.val(n._validate(e))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var i=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return this.t=t.c.t(e),i(e),t.c.d.bind("touchmove.k",i).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var i=function(e){var t=n.xy2val(e.pageX,e.pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return i(e),t.c.d.bind("mousemove.k",i).bind("keyup.k",function(e){if(27===e.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(e){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){var t=~~((0>e?-.5:.5)+e/this.o.step)*this.o.step;return Math.round(100*t)/100},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){return null==e?this.v:(e=this.o.parse(e),void(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1||(this.cv=this.o.stopper?n(i(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())))},this.xy2val=function(e,t){var r,a;return r=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(r=this.angleArc-r-this.PI2),this.angleArc!=this.PI2&&0>r&&r>-.5?r=0:0>r&&(r+=this.PI2),a=r*(this.o.max-this.o.min)/this.angleArc+this.o.min,this.o.stopper&&(a=n(i(a,this.o.max),this.o.min)),a},this.listen=function(){var t,r,a,o,s=this,c=function(e){e.preventDefault();var a=e.originalEvent,o=a.detail||a.wheelDeltaX,c=a.detail||a.wheelDeltaY,d=s._validate(s.o.parse(s.$.val()))+(o>0||c>0?s.o.step:0>o||0>c?-s.o.step:0);d=n(i(d,s.o.max),s.o.min),s.val(d,!1),s.rH&&(clearTimeout(t),t=setTimeout(function(){s.rH(d),t=null},100),r||(r=setTimeout(function(){t&&s.rH(d),r=null},200)))},d=1,l={37:-s.o.step,38:s.o.step,39:s.o.step,40:-s.o.step};this.$.bind("keydown",function(t){var r=t.keyCode;if(r>=96&&105>=r&&(r=t.keyCode=r-48),a=parseInt(String.fromCharCode(r)),isNaN(a)&&(13!==r&&8!==r&&9!==r&&189!==r&&(190!==r||s.$.val().match(/\./))&&t.preventDefault(),e.inArray(r,[37,38,39,40])>-1)){t.preventDefault();var c=s.o.parse(s.$.val())+l[r]*d;s.o.stopper&&(c=n(i(c,s.o.max),s.o.min)),s.change(s._validate(c)),s._draw(),o=window.setTimeout(function(){d*=2},30)}}).bind("keyup",function(e){isNaN(a)?o&&(window.clearTimeout(o),o=null,d=1,s.val(s.$.val())):s.$.val()>s.o.max&&s.$.val(s.o.max)||s.$.val()<s.o.min&&s.$.val(s.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",c),this.$.bind("mousewheel DOMMouseScroll",c)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e,t=this.g,n=this.arc(this.cv),i=1;t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,"none"!==this.o.bgColor&&(t.beginPath(),t.strokeStyle=this.o.bgColor,t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),t.stroke()),this.o.displayPrevious&&(e=this.arc(this.v),t.beginPath(),t.strokeStyle=this.pColor,t.arc(this.xy,this.xy,this.radius,e.s,e.e,e.d),t.stroke(),i=this.cv==this.v),t.beginPath(),t.strokeStyle=i?this.o.fgColor:this.fgColor,t.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),t.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var i=new t.Dial;i.o=n,i.$=e(this),i.run()}).parent()}}),function(e){var t={change:e.noop},n={change:function(t){e(this).on("change",function(){e(this).next("output").val(e(this).val()),t()})},init:function(n){var i=e.extend(t,n||{});return this.each(function(){{var t=e(this),n=t.data("config")||{};e.extend(i,n)}t.wrap(e("<div/>",{"class":"rs-slider"})),t.after(e("<output/>",{"class":"rangevalue"})),t.next("output").val(parseInt(t.val()))})}};e.fn.rsSlider=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist in jQuery.rsSlider"):n.init.apply(this,arguments)}}(jQuery),gDemoSongs=[{name:"sway",description:" SWAY by m @ Bits'n'Bites, from the 4k demo <a href=\"http://pouet.net/prod.php?which=59203\">SWAY</a>",data:String.fromCharCode(83,66,111,120,8,2,237,154,65,107,19,65,20,199,255,179,51,179,141,166,49,197,82,161,66,48,80,164,122,235,65,177,7,193,67,114,244,86,61,89,232,161,158,84,12,38,177,32,107,183,75,65,171,165,39,167,244,32,4,161,244,27,120,20,84,122,243,43,120,242,27,120,241,30,103,179,219,180,221,100,119,74,117,179,89,120,191,201,236,219,183,111,19,94,38,111,231,237,155,236,251,25,224,170,245,216,3,255,225,65,99,87,112,40,24,159,253,214,250,163,236,7,182,100,22,211,112,161,165,110,192,68,33,104,246,5,12,195,113,182,60,221,55,221,117,215,27,182,143,148,153,54,216,23,12,246,88,255,177,170,173,171,177,239,107,32,117,138,37,195,9,215,78,248,225,68,252,114,144,15,154,161,116,35,122,211,109,56,77,119,45,245,248,41,197,30,239,181,98,37,198,94,197,77,84,48,91,206,58,126,74,197,233,114,130,185,172,125,124,145,96,63,140,139,159,213,156,196,79,195,129,211,208,175,56,57,246,241,239,194,109,234,87,84,182,61,120,109,52,95,129,32,146,232,190,100,232,62,7,131,176,231,124,221,186,196,216,252,125,169,247,88,15,171,191,119,44,135,162,250,91,53,68,87,99,63,16,138,98,129,32,8,130,200,37,59,65,191,43,46,214,241,69,130,253,222,66,245,153,156,18,58,111,91,220,226,194,207,238,220,111,128,236,33,204,217,112,55,162,143,34,75,154,234,214,185,179,101,115,21,241,95,141,234,78,36,85,255,149,82,227,238,127,214,119,82,38,255,235,103,26,123,117,180,81,81,61,15,241,67,16,68,62,177,190,123,186,239,92,6,158,182,182,241,78,50,171,176,60,179,184,43,31,22,120,176,170,62,216,98,62,169,145,243,145,104,230,220,255,172,199,255,138,193,44,147,237,139,116,45,18,4,65,156,15,142,13,240,250,6,216,79,33,110,176,59,130,89,181,214,235,175,53,123,222,95,68,247,243,54,15,165,159,193,153,240,27,55,215,85,42,131,154,252,127,16,239,191,82,121,241,61,207,36,196,15,253,249,65,16,4,17,199,35,15,88,241,38,129,73,212,122,69,122,183,140,234,18,127,43,122,25,156,7,25,60,148,128,144,34,174,182,250,164,39,219,143,186,119,122,114,175,175,239,135,122,218,79,94,73,211,242,98,45,217,156,228,127,71,111,221,49,255,33,51,31,127,227,61,163,201,255,125,28,4,82,139,253,1,61,109,76,225,51,107,176,119,66,127,59,161,191,81,61,99,254,241,234,32,8,98,172,107,242,15,59,96,191,60,61,205,46,99,133,127,150,140,95,223,186,87,219,227,29,187,127,138,95,151,7,213,121,144,197,99,166,228,104,166,216,28,241,55,41,26,150,119,151,13,115,213,155,211,234,246,201,204,189,62,10,255,13,182,149,4,123,5,217,63,163,110,90,93,191,101,200,36,38,255,183,13,246,118,138,227,15,195,248,15,137,159,1,76,119,130,107,52,25,17,4,113,94,186,79,152,238,96,144,19,7,65,77,14,107,106,73,222,62,122,68,253,248,81,245,193,35,167,160,229,79,130,32,8,130,24,61,127,1)},{name:"rechord",description:" re:chord by m @ Bits'n'Bites, from the 4k demo <a href=\"http://www.pouet.net/prod.php?which=60915\">re:chord</a>",base64:"U0JveAgC7ZpRa9NQFMfPzU0ycZ0gOEWYo6CC4AaDPakPPgk-TPDBtz34oEMRQcZkdJTZMEdLSUhDQrexSV_9AH6BoU9-Cz-DH8B6bpKmN0nTTGVNiueXnp5zc9v03Jvb_O9N254HWFR-GaD0jSsA2vICIEoFKuv32COFJTauii2IYAQ1OcJH3Y_rMIjKzrYc4WPTj7dgWqjBW9mw099hz0e2PdlsKpXx5cvL6fIb7PbIsPs38Bxs4Bl45Vux-SdJ5k8QBFEc_Csq-anB8dpVvQvPZhiff8iqK3xJlVXcf6WqoYIHcfCcxszxTsLbCe_l-LHXXj6-vmrkH6Od4c2MfK3Qd0LvJryTKJ8npuM5MbM9W7Zz175_fH_bdu2YWY4lzOy4HWFl_yYV3f85wz8aq1l0j3vHMTv6dCTs8KR3IoyulQRRXlDF0d4zgCdX15QdnSkLvVurDXVFHSj2UM2Hqj5KyWuJ8qRX4nM59QdnXpMHbIZ-q6D853LyX6PBSxAEQQglBwNVHJerfQ2u-1P7_k-4MahlyugNa7IP6XmpJbR3plV1SYjy90Q82OXRWCEIgiBKSR_X4_0PqMyqfseX9kug3Lx9MVTyELFfioGNEPJWjk0rQf6tFg0VgiAIopRr8pcG8O-GBqDp9-GbzvgiKEuevqMHK_JgZS7fWc_6lbyBeufAYczbki87u9DEPLuS3wcLfQPLnSnInyAIgvhPldy1gP0w_L_LPOdfNMYftNRrB9zQQ9Xmvo7zQL1VTdX0GbGlj-RkfIK4LW1PoCWzOfXrf3i8LmYeWDEqPpvTtgs5beuiTdP8wwEzGkMi8grs77-hjaPcjfW_gzNBMad1cSbolr7_90MLqOMMNo18Y2pvRL2Z8dpJsOfPxofzciOMPmbkPGhrU9rXjJ3PdJsIoqyw09cMnr4A9liFz0LPFZ3pq7vRZY1Jz0GU3CMrNkEQBEEQk-U3"},{name:"spacedust",description:" Space Dust by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,154,79,107,19,65,24,198,159,249,179,187,145,52,22,69,161,32,74,160,74,35,30,75,209,67,123,170,244,228,69,208,91,15,241,28,197,67,23,33,68,210,96,13,41,161,151,176,233,178,49,13,1,79,138,31,64,240,32,185,121,240,11,136,159,192,111,161,179,219,77,92,154,29,247,160,197,157,240,254,178,79,158,77,38,153,188,51,236,206,203,187,155,147,21,224,6,175,186,96,19,183,0,44,99,21,27,130,241,157,143,27,247,14,197,129,180,109,238,48,198,69,82,18,176,66,71,10,94,224,191,9,252,227,64,231,56,103,74,25,237,119,50,218,253,225,96,52,28,4,67,157,35,231,244,252,126,224,247,61,95,231,121,143,191,131,70,164,69,164,219,239,4,121,143,241,127,159,191,197,140,19,120,121,53,223,199,127,81,173,64,197,200,147,251,145,135,35,43,149,112,19,75,106,231,130,146,133,91,8,23,81,134,181,240,171,21,165,219,32,136,191,64,76,92,165,22,7,94,84,134,124,199,98,188,248,238,210,122,77,28,56,97,107,156,193,229,84,22,108,156,238,207,247,212,232,152,61,19,205,174,217,241,215,219,139,21,127,207,55,43,126,195,15,127,52,105,49,36,8,99,225,213,35,165,150,196,21,199,217,196,35,155,137,171,159,156,7,95,228,19,153,200,228,243,74,233,169,49,219,204,172,173,154,179,173,137,174,129,235,90,125,182,213,209,14,61,166,141,30,70,120,79,135,58,65,16,196,162,242,211,101,74,96,144,118,116,249,138,95,100,172,188,98,253,46,218,25,103,124,234,179,71,74,71,94,134,242,142,62,118,83,70,160,27,151,217,241,19,4,65,16,89,236,158,106,83,58,215,163,50,252,199,87,148,159,90,142,156,182,51,22,93,75,231,44,129,38,103,120,113,238,155,119,207,228,76,98,122,252,4,65,16,196,34,35,182,92,136,215,225,125,242,146,93,139,106,242,37,20,30,62,179,171,118,242,83,225,159,221,166,178,52,61,141,207,188,30,197,126,18,61,251,248,96,64,77,110,50,111,53,243,63,136,231,63,239,244,52,239,135,227,48,225,222,64,214,125,242,6,8,130,32,206,41,147,99,31,226,254,62,216,119,41,43,236,174,202,213,219,123,47,63,111,219,107,103,235,110,161,74,113,62,85,86,54,212,121,238,171,239,20,31,143,35,55,54,209,155,30,63,65,16,4,145,193,164,165,116,116,25,223,106,123,93,118,104,51,94,216,189,86,238,91,143,11,127,250,82,90,50,127,158,241,67,175,104,174,9,130,32,8,226,159,243,11)},{name:"8bit",description:" 8 Bit One by m @ Bits'n'Bites",data:String.fromCharCode(83,66,111,120,8,2,237,219,49,107,219,64,20,7,240,119,58,217,130,144,216,201,226,146,33,32,98,74,218,177,93,186,52,99,200,84,58,36,75,72,134,102,78,178,9,99,227,202,85,13,65,180,8,19,115,56,24,211,16,98,2,249,16,89,252,141,2,25,187,56,119,82,228,154,243,112,14,4,91,46,255,31,247,116,122,150,100,206,135,204,227,140,220,120,67,84,224,3,143,248,32,32,34,103,185,36,183,100,13,137,220,109,190,97,51,139,89,234,133,180,55,17,151,189,81,107,181,133,140,206,168,253,138,90,157,80,157,35,35,237,155,50,90,99,253,188,181,59,221,81,139,90,237,110,116,33,70,45,148,113,174,206,145,145,246,106,206,162,177,30,0,0,96,30,172,192,35,235,135,87,36,218,43,255,228,77,89,191,223,221,89,238,65,238,208,73,106,184,170,226,106,203,141,239,20,106,121,83,203,235,250,5,149,108,205,196,185,150,7,90,94,211,47,240,178,53,254,208,112,188,142,155,29,0,224,255,172,228,223,60,21,43,68,199,31,191,179,223,14,227,111,247,45,55,180,143,248,75,43,121,207,144,95,107,249,149,150,247,181,252,102,198,51,209,53,228,250,120,255,24,198,123,61,227,241,247,12,199,77,227,233,227,203,0,0,176,144,248,223,136,248,167,128,211,26,95,125,79,123,114,77,254,120,203,118,190,228,215,243,234,232,191,74,110,126,167,122,178,14,111,80,195,151,251,141,120,201,237,171,165,108,173,42,247,107,153,159,137,90,178,14,247,201,175,203,125,63,94,114,203,207,84,165,106,69,238,87,113,171,0,0,64,54,13,61,38,131,24,217,249,114,188,72,47,48,230,166,7,153,68,86,188,53,18,73,196,77,76,230,98,81,39,40,249,28,66,224,86,1,0,128,108,10,146,248,108,47,109,210,125,142,216,67,72,238,105,110,213,78,43,121,98,154,146,39,198,67,76,228,0,0,0,240,234,226,39,222,130,160,72,228,20,182,232,216,102,252,67,143,206,78,236,175,246,243,170,252,249,247,245,41,10,57,158,93,7,0,0,152,189,129,151,4,57,165,221,184,180,171,127,161,97,90,0,0,0,22,195,19)},{name:"4chordsong",description:" 4 Chord Song by m @ Bits'n'Bites, chord test inspired by <a href=\"http://www.youtube.com/watch?v=5pidokakU4I\">Axis of Awsome</a>",data:String.fromCharCode(83,66,111,120,8,2,237,153,65,107,19,81,16,199,231,189,151,77,2,105,14,90,8,138,72,115,80,170,168,24,76,3,70,237,161,164,90,176,74,245,166,168,72,169,199,80,2,45,24,66,36,123,168,49,100,27,82,210,96,212,196,80,20,36,8,222,252,0,30,252,22,130,31,64,4,63,130,190,236,190,109,195,146,237,174,77,163,151,255,111,102,24,246,205,16,102,103,55,12,239,237,167,179,68,19,252,134,78,124,81,23,68,39,194,115,52,45,24,127,190,196,227,122,224,36,39,98,140,9,226,140,145,47,74,125,89,43,229,10,36,101,181,176,86,36,41,185,98,46,79,82,178,249,156,65,150,148,149,84,148,108,40,169,43,169,42,177,243,237,188,134,146,154,18,59,223,206,139,202,26,246,179,139,210,230,165,37,165,101,164,205,12,248,57,31,245,239,119,239,27,213,202,22,141,72,212,99,61,229,18,207,140,220,127,11,247,254,91,184,247,127,175,206,225,22,221,237,127,70,245,255,186,180,132,122,30,9,185,122,158,0,0,0,28,20,241,109,155,248,186,30,36,10,70,22,104,94,78,242,196,179,200,185,219,193,227,65,198,184,226,112,38,249,184,239,196,158,24,110,126,153,110,209,85,229,211,202,95,51,253,34,93,246,81,127,163,213,54,181,241,242,181,169,205,86,219,212,102,171,99,234,184,38,185,205,2,94,86,0,0,0,67,224,73,185,39,191,160,203,105,157,138,117,233,81,136,137,163,211,20,79,104,179,26,27,192,207,48,47,41,95,80,190,168,124,94,249,178,195,87,28,222,222,219,85,29,215,198,238,158,209,162,230,184,182,55,195,17,151,186,236,245,83,46,241,148,163,126,55,202,30,113,195,35,94,247,136,71,60,226,15,240,178,2,0,0,24,2,251,162,247,141,17,77,76,94,162,87,26,19,167,219,137,116,86,36,133,25,101,150,249,161,108,212,77,45,87,107,166,86,140,186,169,21,99,203,84,231,164,207,57,38,61,0,0,0,0,254,30,241,93,151,195,116,157,104,50,44,166,232,67,128,241,99,119,143,172,220,209,158,6,213,164,231,140,11,30,240,241,75,239,149,239,42,191,163,124,103,96,189,165,178,186,244,209,244,77,149,213,161,222,200,119,18,243,56,158,94,153,58,88,253,61,31,245,247,232,243,184,31,84,204,35,62,243,191,251,239,245,117,32,59,226,153,70,11,127,86,0,0,24,62,201,223,173,50,246,88,238,203,179,20,222,161,165,16,19,247,223,240,248,25,109,205,26,222,76,217,8,108,163,201,0,0,0,192,24,217,180,236,119,183,219,165,164,220,129,95,249,69,203,247,216,91,245,105,156,249,30,228,47,208,74,0,0,0,224,223,211,63,93,255,33,247,228,244,53,242,147,102,195,196,181,205,155,233,39,218,195,208,94,138,191,89,238,117,58,90,66,175,1,0,0,128,67,231,15)}],gInstrumentPresets=[{name:"====[LEADS]===="},{name:"Softy",i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,195,6,1,2,135,0,0,32,147,6,121,6]},{name:"Classic 8-bit",i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,69,3,1,1,23,167,0,32,77,6,25,6]},{name:"Square",i:[1,255,128,0,1,154,128,9,0,0,7,5,52,0,0,0,0,2,255,0,0,32,47,3,146,2]},{name:"Bell",i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,2,255,0,0,32,47,3,157,2]},{name:"Filter Bass 1",i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,195,4,1,3,50,184,119,244,147,6,84,6]},{name:"====[PADS]===="},{name:"Base string",i:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,2,5,0,0,32,0,0,24,8]},{name:"Base string (dist)",i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,136,5,1,2,8,92,21,32,148,5,85,8]},{name:"Evil brass",i:[3,146,140,0,1,224,128,3,0,0,92,0,95,3,179,5,1,2,124,135,11,32,150,3,157,6]},{name:"====[DRUMS]===="},{name:"Bass drum 1",i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,2,14,0,0,32,0,0,0,0]},{name:"Bass drum 2",i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,2,14,0,1,39,76,5,0,0]},{name:"Bass drum 3",i:[0,255,116,1,0,255,116,0,1,14,4,6,45,0,0,0,0,2,136,15,0,32,0,0,66,6]},{name:"Base tom",i:[0,192,104,1,0,80,99,0,0,0,4,0,66,3,0,0,0,1,0,1,2,32,37,4,0,0]},{name:"Snare 1",i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,60,4,1,2,255,0,0,32,61,5,32,6]},{name:"Snare 2",i:[0,221,128,1,0,210,128,0,1,255,4,6,62,0,64,7,1,3,255,15,0,32,20,0,24,6]},{name:"Snare 3",i:[3,0,128,0,3,68,128,0,1,218,4,4,40,1,55,4,1,2,67,115,124,190,67,6,39,1]},{name:"Hihat 1",i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,187,5,0,1,239,135,0,32,108,5,16,4]},{name:"Hihat 2",i:[2,40,140,1,0,0,140,0,0,255,5,0,48,0,0,0,0,3,161,192,0,32,0,0,71,1]},{name:"Open hihat",i:[0,0,128,0,0,0,128,0,0,125,0,1,59,0,0,0,0,1,193,171,0,29,39,3,88,3]},{name:"Smash",i:[0,214,104,1,0,204,104,0,1,229,4,40,21,0,231,6,1,3,183,15,0,32,232,4,74,6]},{name:"Pipe hit",i:[3,255,128,0,0,255,140,0,0,127,2,2,23,0,96,3,1,3,94,79,0,32,84,2,12,4]},{name:"====[F/X]===="},{name:"Wind",i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,51,2,1,2,58,239,0,32,88,1,157,2]},{name:"Long beat",i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,2,255,0,2,32,83,5,25,1]},{name:"Siren",i:[1,0,128,0,1,0,128,0,0,255,158,100,158,3,67,4,1,3,57,254,85,171,88,1,157,2]}];var CPlayer=function(){var e,t,n=new Worker("tracker/js/player-worker.js");n.onmessage=function(n){"progress"===n.data.cmd&&(t=n.data.buffer,e&&e(n.data.progress))},this.generate=function(t,i,r){e=r,n.postMessage({cmd:"generate",song:t,opts:i})},this.createWave=function(){var e=t,n=e.length,i=2*n-8,r=i-36,a=44,o=new Uint8Array(a+2*n);o.set([82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&r,r>>8&255,r>>16&255,r>>24&255]);for(var s=0,c=a;n>s;++s){var d=e[s];d=-32767>d?-32767:d>32767?32767:d,o[c++]=255&d,o[c++]=d>>8&255}return o},this.getData=function(e,n){for(var i=2*Math.floor(44100*e),r=new Array(n),a=t,o=0;2*n>o;o+=1){var s=i+o;r[o]=e>0&&s<a.length?a[s]/32768:0}return r}},CJammer=function(){var e,t,n,i,r,a,o,s,c,d=8,l=[],u=131072,f=function(e){return Math.sin(6.283184*e)},h=function(e){return 2*(e%1)-1},p=function(e){return.5>e%1?1:-1},m=function(e){var t=e%1*4;return 2>t?t-1:3-t},g=function(e){return 174.614115728/s*Math.pow(2,(e-128)/12)},v=[f,p,h,m],w=function(a,o){var h,p,m,g,w,E,y,B=o.length;for(m=0;B>m;++m)a[m]=0,o[m]=0;for(h=0;d>h;++h){var _=l[h];if(void 0!=_){var b=v[_.instr[0]],I=_.instr[1],x=_.instr[3],T=v[_.instr[4]],C=_.instr[5],L=_.instr[8],D=_.instr[9],U=Math.round(_.instr[10]*_.instr[10]*4*c),k=Math.round(_.instr[11]*_.instr[11]*4*c),S=Math.round(_.instr[12]*_.instr[12]*4*c),M=1/S,Y=_.o1f,A=_.o2f,P=_.o1t,O=_.o2t,R=U+k+S-_.env;for(B>=R?l[h]=void 0:R=B,p=_.env,m=0;R>m;p++,m++)w=1,U>p?w=p/U:p>=U+k&&(w-=(p-U-k)*M),g=Y,x&&(g*=w*w),P+=g,E=b(P)*I,g=A,L&&(g*=w*w),O+=g,E+=T(O)*C,D&&(E+=(2*Math.random()-1)*D),o[m]+=.002441481*E*w;_.env=p,_.o1t=P,_.o2t=O}}var $,N,z,j=n.pos,H=n.low,F=n.band,q=n.filterActive,X=n.dlyPos,W=u-1,J=v[e[13]],G=e[14]/512,V=Math.pow(2,e[15]-9)/t,Q=e[16],Z=e[17],K=43.23529*e[18]*3.141592/s,ee=1-e[19]/255,te=1e-5*e[20]*32767,ne=e[21]/32,ie=e[22]/512,re=6.283184*Math.pow(2,e[23]-9)/t,ae=e[24]/255,oe=e[25]*t>>1;for(oe>=u&&(oe=u-1),p=0;B>p;p++)m=2*(j+p),E=o[p],E||q?(y=K,Q&&(y*=J(V*m)*G+.5),y=1.5*Math.sin(y),H+=y*F,N=ee*(E-F)-H,F+=y*N,E=3==Z?F:1==Z?N:H,te&&(E*=te,E=1>E?E>-1?f(.25*E):-1:1,E/=te),E*=ne,q=E*E>1e-5,g=Math.sin(re*m)*ie+.5,$=E*(1-g),E*=g):$=0,z=X-oe&W,$+=r[z]*ae,E+=i[z]*ae,i[X]=$,r[X]=E,X=X+1&W,a[p]=$,o[p]=E;for(j+=B;j>2048*t;)j-=2048*t;n.pos=j,n.low=H,n.band=F,n.filterActive=q,n.dlyPos=X};this.start=function(){if(window.AudioContext)a=new AudioContext;else{if(!window.webkitAudioContext)return void(a=void 0);a=new webkitAudioContext,a.createScriptProcessor=a.createJavaScriptNode}s=a.sampleRate,c=s/44100,n={pos:0,low:0,band:0,filterActive:!1,dlyPos:0},i=new Float32Array(u),r=new Float32Array(u),o=a.createScriptProcessor(2048,0,2),o.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1);w(t,n)},o.connect(a.destination)},this.stop=function(){},this.updateInstr=function(t){e=[];for(var n=0;n<t.length;++n)e.push(t[n])},this.updateRowLen=function(e){t=Math.round(e*c)},this.addNote=function(t){var n,i=(new Date).getTime(),r={startT:i,env:0,o1t:0,o2t:0,o1f:g(t+e[2]-128),o2f:g(t+e[6]-128)*(1+8e-4*e[7]),instr:new Array(13)};for(n=0;13>n;++n)r.instr[n]=e[n];var a=0,o=-100;for(n=0;d>n;++n){if(void 0==l[n])return void(l[n]=r);var s=i-l[n].startT;s>o&&(a=n,o=s)}l[a]=r}};if(function(){function e(){this.fc=0,this.dl=0}function t(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function n(e,t,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i}function i(){this.next=null,this.len=0,this.ptr=[],this.off=0}function r(n){var i;if(n?1>n?n=1:n>9&&(n=9):n=Je,pe=n,q=!1,le=!1,null===Tt){for(j=H=F=null,Tt=[],G=[],V=[],Q=[],Z=[],ve=[],i=0;It>i;i++)ve[i]=new e;for(we=[],i=0;2*Et+1>i;i++)we[i]=new e;for(Ee=[],i=0;wt+2>i;i++)Ee[i]=new e;for(ye=[],i=0;Et>i;i++)ye[i]=new e;for(Be=[],i=0;2*yt+1>i;i++)Be[i]=new e;_e=new t,be=new t,Ie=new t,xe=[],Te=[],De=[],Ue=[],ke=[],Se=[],Me=[],Ye=[]}}function a(e){e.next=j,j=e}function o(){var e;return null!==j?(e=j,j=j.next):e=new i,e.next=null,e.len=e.off=0,e}function s(e){return Z[Fe+e]}function c(e,t){return Z[Fe+e]=t}function d(e){Tt[W+X++]=e,W+X===Qe&&N()}function l(e){e&=65535,Qe-2>W+X?(Tt[W+X++]=255&e,Tt[W+X++]=e>>>8):(d(255&e),d(e>>>8))}function u(){ne=(ne<<xt^255&G[ce+Ke-1])&ot,ie=s(ne),Z[ce&st]=ie,c(ne,ce)}function f(e,t){O(t[e].fc,t[e].dl)}function h(e){return 255&(256>e?ke[e]:ke[256+(e>>7)])}function p(e,t,n){return e[t].fc<e[n].fc||e[t].fc===e[n].fc&&De[t]<=De[n]}function m(e,t,n){var i;for(i=0;n>i&&He<je.length;i++)e[t+i]=255&je[He++];return i}function g(){var e;for(e=0;at>e;e++)Z[Fe+e]=0;if(he=kt[pe].max_lazy,me=kt[pe].good_length,Ge||(ge=kt[pe].nice_length),fe=kt[pe].max_chain,ce=0,te=0,ue=m(G,0,2*Fe),0>=ue)return le=!0,void(ue=0);for(le=!1;lt>ue&&!le;)w();for(ne=0,e=0;Ke-1>e;e++)ne=(ne<<xt^255&G[e])&ot}function v(e){var t,n,i,r,a=fe,o=ce,s=se,c=ce>ut?ce-ut:ct,d=ce+et,l=G[o+s-1],u=G[o+s];se>=me&&(a>>=2);do if(t=e,G[t+s]===u&&G[t+s-1]===l&&G[t]===G[o]&&G[++t]===G[o+1]){for(o+=2,t++;d>o;){for(r=!1,i=0;8>i;i+=1)if(o+=1,t+=1,G[o]!==G[t]){r=!0;break}if(r)break}if(n=et-(d-o),o=d-et,n>s){if(de=e,s=n,Ge){if(n>=et)break}else if(n>=ge)break;l=G[o+s-1],u=G[o+s]}}while((e=Z[e&st])>c&&0!==--a);return s}function w(){var e,t,n=Ze-ue-ce;if(-1===n)n--;else if(ce>=Fe+ut){for(e=0;Fe>e;e++)G[e]=G[e+Fe];for(de-=Fe,ce-=Fe,te-=Fe,e=0;at>e;e++)t=s(e),c(e,t>=Fe?t-Fe:ct);for(e=0;Fe>e;e++)t=Z[e],Z[e]=t>=Fe?t-Fe:ct;n+=Fe}le||(e=m(G,ce+ue,n),0>=e?le=!0:ue+=e)}function E(){for(;0!==ue&&null===H;){var e;if(u(),ie!==ct&&ut>=ce-ie&&(oe=v(ie),oe>ue&&(oe=ue)),oe>=Ke)if(e=A(ce-de,oe-Ke),ue-=oe,he>=oe){oe--;do ce++,u();while(0!==--oe);ce++}else ce+=oe,oe=0,ne=255&G[ce],ne=(ne<<xt^255&G[ce+1])&ot;else e=A(0,255&G[ce]),ue--,ce++;for(e&&(Y(0),te=ce);lt>ue&&!le;)w()}}function y(){for(;0!==ue&&null===H;){if(u(),se=oe,re=de,oe=Ke-1,ie!==ct&&he>se&&ut>=ce-ie&&(oe=v(ie),oe>ue&&(oe=ue),oe===Ke&&ce-de>dt&&oe--),se>=Ke&&se>=oe){var e;e=A(ce-1-re,se-Ke),ue-=se-1,se-=2;do ce++,u();while(0!==--se);ae=!1,oe=Ke-1,ce++,e&&(Y(0),te=ce)}else ae?(A(0,255&G[ce-1])&&(Y(0),te=ce),ce++,ue--):(ae=!0,ce++,ue--);for(;lt>ue&&!le;)w()}}function B(){le||(K=0,ee=0,I(),g(),H=null,X=0,W=0,3>=pe?(se=Ke-1,oe=0):(oe=Ke-1,ae=!1),J=!1)}function _(e,t,n){var i;return q||(B(),q=!0,0!==ue)?(i=b(e,t,n),i===n?n:J?i:(3>=pe?E():y(),0===ue&&(ae&&A(0,255&G[ce-1]),Y(1),J=!0),i+b(e,i+t,n-i))):(J=!0,0)}function b(e,t,n){var i,r,o;for(i=0;null!==H&&n>i;){for(r=n-i,r>H.len&&(r=H.len),o=0;r>o;o++)e[t+i+o]=H.ptr[H.off+o];if(H.off+=r,H.len-=r,i+=r,0===H.len){var s;s=H,H=H.next,a(s)}}if(i===n)return i;if(X>W){for(r=n-i,r>X-W&&(r=X-W),o=0;r>o;o++)e[t+i+o]=Tt[W+o];W+=r,i+=r,X===W&&(X=W=0)}return i}function I(){var e,t,n,i,r;if(0===ye[0].dl){for(_e.dyn_tree=ve,_e.static_tree=Ee,_e.extra_bits=Ct,_e.extra_base=gt+1,_e.elems=wt,_e.max_length=ht,_e.max_code=0,be.dyn_tree=we,be.static_tree=ye,be.extra_bits=Lt,be.extra_base=0,be.elems=Et,be.max_length=ht,be.max_code=0,Ie.dyn_tree=Be,Ie.static_tree=null,Ie.extra_bits=Dt,Ie.extra_base=0,Ie.elems=yt,Ie.max_length=pt,Ie.max_code=0,n=0,i=0;mt-1>i;i++)for(Se[i]=n,e=0;e<1<<Ct[i];e++)Ue[n++]=i;for(Ue[n-1]=i,r=0,i=0;16>i;i++)for(Me[i]=r,e=0;e<1<<Lt[i];e++)ke[r++]=i;for(r>>=7;Et>i;i++)for(Me[i]=r<<7,e=0;e<1<<Lt[i]-7;e++)ke[256+r++]=i;for(t=0;ht>=t;t++)xe[t]=0;for(e=0;143>=e;)Ee[e++].dl=8,xe[8]++;for(;255>=e;)Ee[e++].dl=9,xe[9]++;for(;279>=e;)Ee[e++].dl=7,xe[7]++;for(;287>=e;)Ee[e++].dl=8,
xe[8]++;for(L(Ee,wt+1),e=0;Et>e;e++)ye[e].dl=5,ye[e].fc=R(e,5);x()}}function x(){var e;for(e=0;wt>e;e++)ve[e].fc=0;for(e=0;Et>e;e++)we[e].fc=0;for(e=0;yt>e;e++)Be[e].fc=0;ve[vt].fc=1,Ne=ze=0,Ae=Pe=Oe=0,Re=0,$e=1}function T(e,t){for(var n=Te[t],i=t<<1;Ce>=i&&(Ce>i&&p(e,Te[i+1],Te[i])&&i++,!p(e,n,Te[i]));)Te[t]=Te[i],t=i,i<<=1;Te[t]=n}function C(e){var t,n,i,r,a,o,s=e.dyn_tree,c=e.extra_bits,d=e.extra_base,l=e.max_code,u=e.max_length,f=e.static_tree,h=0;for(r=0;ht>=r;r++)xe[r]=0;for(s[Te[Le]].dl=0,t=Le+1;It>t;t++)n=Te[t],r=s[s[n].dl].dl+1,r>u&&(r=u,h++),s[n].dl=r,n>l||(xe[r]++,a=0,n>=d&&(a=c[n-d]),o=s[n].fc,Ne+=o*(r+a),null!==f&&(ze+=o*(f[n].dl+a)));if(0!==h){do{for(r=u-1;0===xe[r];)r--;xe[r]--,xe[r+1]+=2,xe[u]--,h-=2}while(h>0);for(r=u;0!==r;r--)for(n=xe[r];0!==n;)i=Te[--t],i>l||(s[i].dl!==r&&(Ne+=(r-s[i].dl)*s[i].fc,s[i].fc=r),n--)}}function L(e,t){var n,i,r=[],a=0;for(n=1;ht>=n;n++)a=a+xe[n-1]<<1,r[n]=a;for(i=0;t>=i;i++){var o=e[i].dl;0!==o&&(e[i].fc=R(r[o]++,o))}}function D(e){var t,n,i=e.dyn_tree,r=e.static_tree,a=e.elems,o=-1,s=a;for(Ce=0,Le=It,t=0;a>t;t++)0!==i[t].fc?(Te[++Ce]=o=t,De[t]=0):i[t].dl=0;for(;2>Ce;){var c=Te[++Ce]=2>o?++o:0;i[c].fc=1,De[c]=0,Ne--,null!==r&&(ze-=r[c].dl)}for(e.max_code=o,t=Ce>>1;t>=1;t--)T(i,t);do t=Te[ft],Te[ft]=Te[Ce--],T(i,ft),n=Te[ft],Te[--Le]=t,Te[--Le]=n,i[s].fc=i[t].fc+i[n].fc,De[s]=De[t]>De[n]+1?De[t]:De[n]+1,i[t].dl=i[n].dl=s,Te[ft]=s++,T(i,ft);while(Ce>=2);Te[--Le]=Te[ft],C(e),L(i,o)}function U(e,t){var n,i,r=-1,a=e[0].dl,o=0,s=7,c=4;for(0===a&&(s=138,c=3),e[t+1].dl=65535,n=0;t>=n;n++)i=a,a=e[n+1].dl,++o<s&&i===a||(c>o?Be[i].fc+=o:0!==i?(i!==r&&Be[i].fc++,Be[Bt].fc++):10>=o?Be[_t].fc++:Be[bt].fc++,o=0,r=i,0===a?(s=138,c=3):i===a?(s=6,c=3):(s=7,c=4))}function k(e,t){var n,i,r=-1,a=e[0].dl,o=0,s=7,c=4;for(0===a&&(s=138,c=3),n=0;t>=n;n++)if(i=a,a=e[n+1].dl,!(++o<s&&i===a)){if(c>o){do f(i,Be);while(0!==--o)}else 0!==i?(i!==r&&(f(i,Be),o--),f(Bt,Be),O(o-3,2)):10>=o?(f(_t,Be),O(o-3,3)):(f(bt,Be),O(o-11,7));o=0,r=i,0===a?(s=138,c=3):i===a?(s=6,c=3):(s=7,c=4)}}function S(){var e;for(U(ve,_e.max_code),U(we,be.max_code),D(Ie),e=yt-1;e>=3&&0===Be[Ut[e]].dl;e--);return Ne+=3*(e+1)+5+5+4,e}function M(e,t,n){var i;for(O(e-257,5),O(t-1,5),O(n-4,4),i=0;n>i;i++)O(Be[Ut[i]].dl,3);k(ve,e-1),k(we,t-1)}function Y(e){var t,n,i,r,a;if(r=ce-te,Ye[Oe]=Re,D(_e),D(be),i=S(),t=Ne+3+7>>3,n=ze+3+7>>3,t>=n&&(t=n),t>=r+4&&te>=0)for(O((qe<<1)+e,3),$(),l(r),l(~r),a=0;r>a;a++)d(G[te+a]);else n===t?(O((Xe<<1)+e,3),P(Ee,ye)):(O((We<<1)+e,3),M(_e.max_code+1,be.max_code+1,i+1),P(ve,we));x(),0!==e&&$()}function A(e,t){if(Q[Ae++]=t,0===e?ve[t].fc++:(e--,ve[Ue[t]+gt+1].fc++,we[h(e)].fc++,V[Pe++]=e,Re|=$e),$e<<=1,0===(7&Ae)&&(Ye[Oe++]=Re,Re=0,$e=1),pe>2&&0===(4095&Ae)){var n,i=8*Ae,r=ce-te;for(n=0;Et>n;n++)i+=we[n].fc*(5+Lt[n]);if(i>>=3,Pe<parseInt(Ae/2,10)&&i<parseInt(r/2,10))return!0}return Ae===nt-1||Pe===rt}function P(e,t){var n,i,r,a,o=0,s=0,c=0,d=0;if(0!==Ae)do 0===(7&o)&&(d=Ye[c++]),i=255&Q[o++],0===(1&d)?f(i,e):(r=Ue[i],f(r+gt+1,e),a=Ct[r],0!==a&&(i-=Se[r],O(i,a)),n=V[s++],r=h(n),f(r,t),a=Lt[r],0!==a&&(n-=Me[r],O(n,a))),d>>=1;while(Ae>o);f(vt,e)}function O(e,t){ee>St-t?(K|=e<<ee,l(K),K=e>>St-ee,ee+=t-St):(K|=e<<ee,ee+=t)}function R(e,t){var n=0;do n|=1&e,e>>=1,n<<=1;while(--t>0);return n>>1}function $(){ee>8?l(K):ee>0&&d(K),K=0,ee=0}function N(){var e,t;if(0!==X){for(e=o(),null===H?H=F=e:F=F.next=e,e.len=X-W,t=0;t<e.len;t++)e.ptr[t]=Tt[W+t];X=W=0}}function z(e,t){var n,i,a;if("string"==typeof e)for(a=e,e=[],n=0;n<a.length;n++)e[n]=a.charCodeAt(n);je=e,He=0,"undefined"==typeof t&&(t=Je),r(t),i=[];do n=_(i,i.length,1024);while(n>0);for(je=null,a="",n=0;n<i.length;n++)a+=String.fromCharCode(i[n]);return a}var j,H,F,q,X,W,J,G,V,Q,Z,K,ee,te,ne,ie,re,ae,oe,se,ce,de,le,ue,fe,he,pe,me,ge,ve,we,Ee,ye,Be,_e,be,Ie,xe,Te,Ce,Le,De,Ue,ke,Se,Me,Ye,Ae,Pe,Oe,Re,$e,Ne,ze,je,He,Fe=32768,qe=0,Xe=1,We=2,Je=6,Ge=!1,Ve=32768,Qe=8192,Ze=2*Fe,Ke=3,et=258,tt=16,nt=8192,it=15,rt=nt,at=1<<it,ot=at-1,st=Fe-1,ct=0,dt=4096,lt=et+Ke+1,ut=Fe-lt,ft=1,ht=15,pt=7,mt=29,gt=256,vt=256,wt=gt+1+mt,Et=30,yt=19,Bt=16,_t=17,bt=18,It=2*wt+1,xt=parseInt((it+Ke-1)/Ke,10),Tt=null;nt>Ve&&console.error("error: INBUFSIZ is too small"),Fe<<1>1<<tt&&console.error("error: WSIZE is too large"),it>tt-1&&console.error("error: HASH_BITS is too large"),(8>it||258!==et)&&console.error("error: Code too clever");var Ct=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Dt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],kt=[new n(0,0,0,0),new n(4,4,8,4),new n(4,5,16,8),new n(4,6,32,32),new n(4,4,16,16),new n(8,16,32,32),new n(8,16,128,128),new n(8,32,128,256),new n(32,128,258,1024),new n(32,258,258,4096)],St=16;window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.deflate=z}(),function(){function e(){this.next=null,this.list=null}function t(){this.e=0,this.b=0,this.n=0,this.t=null}function n(n,i,r,a,o,s){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var c,d,l,u,f,h,p,m,g,v,w,E,y,B,_,b,I,x=[],T=[],C=new t,L=[],D=[],U=[];for(I=this.root=null,h=0;h<this.BMAX+1;h++)x[h]=0;for(h=0;h<this.BMAX+1;h++)T[h]=0;for(h=0;h<this.BMAX;h++)L[h]=null;for(h=0;h<this.N_MAX;h++)D[h]=0;for(h=0;h<this.BMAX+1;h++)U[h]=0;d=i>256?n[256]:this.BMAX,g=n,v=0,h=i;do x[g[v]]++,v++;while(--h>0);if(x[0]===i)return this.root=null,this.m=0,void(this.status=0);for(p=1;p<=this.BMAX&&0===x[p];p++);for(m=p,p>s&&(s=p),h=this.BMAX;0!==h&&0===x[h];h--);for(u=h,s>h&&(s=h),B=1<<p;h>p;p++,B<<=1)if((B-=x[p])<0)return this.status=2,void(this.m=s);if((B-=x[h])<0)return this.status=2,void(this.m=s);for(x[h]+=B,U[1]=p=0,g=x,v=1,y=2;--h>0;)U[y++]=p+=g[v++];g=n,v=0,h=0;do 0!==(p=g[v++])&&(D[U[p]++]=h);while(++h<i);for(i=U[u],U[0]=h=0,g=D,v=0,f=-1,E=T[0]=0,w=null,_=0,null;u>=m;m++)for(c=x[m];c-->0;){for(;m>E+T[1+f];){if(E+=T[1+f],f++,_=(_=u-E)>s?s:_,(l=1<<(p=m-E))>c+1)for(l-=c+1,y=m;++p<_&&!((l<<=1)<=x[++y]);)l-=x[y];for(E+p>d&&d>E&&(p=d-E),_=1<<p,T[1+f]=p,w=[],b=0;_>b;b++)w[b]=new t;I=I?I.next=new e:this.root=new e,I.next=null,I.list=w,L[f]=w,f>0&&(U[f]=h,C.b=T[f],C.e=16+p,C.t=w,p=(h&(1<<E)-1)>>E-T[f],L[f-1][p].e=C.e,L[f-1][p].b=C.b,L[f-1][p].n=C.n,L[f-1][p].t=C.t)}for(C.b=m-E,v>=i?C.e=99:g[v]<r?(C.e=g[v]<256?16:15,C.n=g[v++]):(C.e=o[g[v]-r],C.n=a[g[v++]-r]),l=1<<m-E,p=h>>E;_>p;p+=l)w[p].e=C.e,w[p].b=C.b,w[p].n=C.n,w[p].t=C.t;for(p=1<<m-1;0!==(h&p);p>>=1)h^=p;for(h^=p;(h&(1<<E)-1)!==U[f];)E-=T[f],f--}this.m=T[1],this.status=0!==B&&1!==u?1:0}function i(){return D.length===U?-1:255&D[U++]}function r(e){for(;e>y;)E|=i()<<y,y+=8}function a(e){return E&R[e]}function o(e){E>>=e,y-=e}function s(e,t,n){var i,s,c;if(0===n)return 0;for(c=0;;){for(r(C),s=x.list[a(C)],i=s.e;i>16;){if(99===i)return-1;o(s.b),i-=16,r(i),s=s.t[a(i)],i=s.e}if(o(s.b),16!==i){if(15===i)break;for(r(i),b=s.n+a(i),o(i),r(L),s=T.list[a(L)],i=s.e;i>16;){if(99===i)return-1;o(s.b),i-=16,r(i),s=s.t[a(i)],i=s.e}for(o(s.b),r(i),I=m-s.n-a(i),o(i);b>0&&n>c;)b--,I&=k-1,m&=k-1,e[t+c++]=p[m++]=p[I++];if(c===n)return n}else if(m&=k-1,e[t+c++]=p[m++]=s.n,c===n)return n}return B=-1,c}function c(e,t,n){var i;if(i=7&y,o(i),r(16),i=a(16),o(16),r(16),i!==(65535&~E))return-1;for(o(16),b=i,i=0;b>0&&n>i;)b--,m&=k-1,r(8),e[t+i++]=p[m++]=a(8),o(8);return 0===b&&(B=-1),i}function d(e,t,i){if(!O){var r,a,o=[];for(r=0;144>r;r++)o[r]=8;for(null;256>r;r++)o[r]=9;for(null;280>r;r++)o[r]=7;for(null;288>r;r++)o[r]=8;if(v=7,a=new n(o,288,257,$,N,v),0!==a.status)return console.error("HufBuild error: "+a.status),-1;for(O=a.root,v=a.m,r=0;30>r;r++)o[r]=5;if(w=5,a=new n(o,30,0,z,j,w),a.status>1)return O=null,console.error("HufBuild error: "+a.status),-1;g=a.root,w=a.m}return x=O,T=g,C=v,L=w,s(e,t,i)}function l(e,t,i){var c,d,l,u,f,h,p,m,g,v=[];for(c=0;316>c;c++)v[c]=0;if(r(5),p=257+a(5),o(5),r(5),m=1+a(5),o(5),r(4),h=4+a(4),o(4),p>286||m>30)return-1;for(d=0;h>d;d++)r(3),v[H[d]]=a(3),o(3);for(null;19>d;d++)v[H[d]]=0;if(C=7,g=new n(v,19,19,null,null,C),0!==g.status)return-1;for(x=g.root,C=g.m,u=p+m,c=l=0;u>c;)if(r(C),f=x.list[a(C)],d=f.b,o(d),d=f.n,16>d)v[c++]=l=d;else if(16===d){if(r(2),d=3+a(2),o(2),c+d>u)return-1;for(;d-->0;)v[c++]=l}else if(17===d){if(r(3),d=3+a(3),o(3),c+d>u)return-1;for(;d-->0;)v[c++]=0;l=0}else{if(r(7),d=11+a(7),o(7),c+d>u)return-1;for(;d-->0;)v[c++]=0;l=0}if(C=A,g=new n(v,p,257,$,N,C),0===C&&(g.status=1),0!==g.status&&1!==g.status)return-1;for(x=g.root,C=g.m,c=0;m>c;c++)v[c]=v[c+p];return L=P,g=new n(v,m,0,z,j,L),T=g.root,L=g.m,0===L&&p>257?-1:0!==g.status?-1:s(e,t,i)}function u(){p||(p=[]),m=0,E=0,y=0,B=-1,_=!1,b=I=0,x=null}function f(e,t,n){var i,u;for(i=0;n>i;){if(_&&-1===B)return i;if(b>0){if(B!==S)for(;b>0&&n>i;)b--,I&=k-1,m&=k-1,e[t+i++]=p[m++]=p[I++];else{for(;b>0&&n>i;)b--,m&=k-1,r(8),e[t+i++]=p[m++]=a(8),o(8);0===b&&(B=-1)}if(i===n)return i}if(-1===B){if(_)break;r(1),0!==a(1)&&(_=!0),o(1),r(2),B=a(2),o(2),x=null,b=0}switch(B){case S:u=c(e,t+i,n-i);break;case M:u=x?s(e,t+i,n-i):d(e,t+i,n-i);break;case Y:u=x?s(e,t+i,n-i):l(e,t+i,n-i);break;default:u=-1}if(-1===u)return _?0:-1;i+=u}return i}function h(e){var t,n,i=[];if("string"==typeof e)for(n=e,e=[],t=0;t<n.length;t++)e[t]=n.charCodeAt(t);u(),D=e,U=0;do t=f(i,i.length,1024);while(t>0);for(D=null,n="",t=0;t<i.length;t++)n+=String.fromCharCode(i[t]);return n}var p,m,g,v,w,E,y,B,_,b,I,x,T,C,L,D,U,k=32768,S=0,M=1,Y=2,A=9,P=6,O=null,R=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],$=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];window.RawDeflate||(window.RawDeflate={}),window.RawDeflate.inflate=h}(),"function"!=typeof Blob||"undefined"==typeof URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},r=n.prototype,a=i.prototype,o=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},c="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),d=c.length,l=e.URL||e.webkitURL||e,u=l.createObjectURL,f=l.revokeObjectURL,h=l,p=e.btoa,m=e.atob,g=!1,v=function(e){g=!e},w=e.ArrayBuffer,E=e.Uint8Array;for(i.fake=a.fake=!0;d--;)s.prototype[c[d]]=d+1;try{E&&v.apply(0,new E(3528e4))}catch(y){}return l.createObjectURL||(h=e.URL={}),h.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):p?t+";base64,"+p(e.data):t+","+encodeURIComponent(e.data)):u?u.call(l,e):void 0},h.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&f&&f.call(l,e)},r.append=function(e){var n=this.data;if(E&&(e instanceof w||e instanceof E))if(g)n.push(String.fromCharCode.apply(String,new E(e)));else{for(var r="",a=new E(e),c=0,d=a.length;d>c;c++)r+=String.fromCharCode(a[c]);n.push(r)}else if("Blob"===t(e)||"File"===t(e)){if(!o)throw new s("NOT_READABLE_ERR");var l=new o;n.push(l.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&m?n.push(m(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},r.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},r.toString=function(){return"[object BlobBuilder]"},a.slice=function(e,t,n){var r=arguments.length;return 3>r&&(n=null),new i(this.data.slice(e,r>1?t:this.data.length),n,this.encoding)},a.toString=function(){return"[object Blob]"},n}(e);return function(e,n){var i=n?n.type||"":"",r=new t;if(e)for(var a=0,o=e.length;o>a;a++)r.append(e[a]);return r.getBlob(i)}}(self);var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in r,o=function(n){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},s=e.webkitRequestFileSystem,c=e.requestFileSystem||s||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",u=0,f=[],h=function(){for(var e=f.length;e--;){var t=f[e];"string"==typeof t?i.revokeObjectURL(t):t.remove()}f.length=0},p=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var r=e["on"+t[i]];if("function"==typeof r)try{r.call(e,n||e)}catch(a){d(a)}}},m=function(t,i){var d,h,m,g=this,v=t.type,w=!1,E=function(){var e=n().createObjectURL(t);return f.push(e),e},y=function(){p(g,"writestart progress write writeend".split(" "))},B=function(){(w||!d)&&(d=E(t)),h?h.location.href=d:window.open(d,"_blank"),g.readyState=g.DONE,y()},_=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},b={create:!0,exclusive:!1};return g.readyState=g.INIT,i||(i="download"),a?(d=E(t),r.href=d,r.download=i,o(r),g.readyState=g.DONE,void y()):(e.chrome&&v&&v!==l&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,l),w=!0),s&&"download"!==i&&(i+=".download"),(v===l||s)&&(h=e),c?(u+=t.size,void c(e.TEMPORARY,u,_(function(e){e.root.getDirectory("saved",b,_(function(e){var n=function(){e.getFile(i,b,_(function(e){e.createWriter(_(function(n){n.onwriteend=function(t){h.location.href=e.toURL(),f.push(e),g.readyState=g.DONE,p(g,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&B()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=g["on"+e]}),n.write(t),g.abort=function(){n.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),B)}),B)};e.getFile(i,{create:!1},_(function(e){e.remove(),n()}),_(function(e){e.code===e.NOT_FOUND_ERR?n():B()}))}),B)}),B)):void B())},g=m.prototype,v=function(e,t){return new m(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",h,!1),v}(self);!function(e){"use strict";function t(){}function n(){this.inputInUse=!1,this.outputInUse=!1;var e=document.createElement("object");e.id="_Jazz"+Math.random()+"ie",e.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",this.activeX=e;var t=document.createElement("object");t.id="_Jazz"+Math.random(),t.type="audio/x-jazz",e.appendChild(t),this.objRef=t;var n=document.createElement("p");n.appendChild(document.createTextNode("This page requires the "));var i=document.createElement("a");i.appendChild(document.createTextNode("Jazz plugin")),i.href="http://jazz-soft.net/",n.appendChild(i),n.appendChild(document.createTextNode(".")),t.appendChild(n);var r=document.getElementById("MIDIPlugin");if(!r){var r=document.createElement("div");r.id="MIDIPlugin",r.style.position="absolute",r.style.visibility="hidden",r.style.left="-9999px",r.style.top="-9999px",document.body.appendChild(r)}r.appendChild(e),this._Jazz=this.objRef.isJazz?this.objRef:this.activeX.isJazz?this.activeX:null,this._Jazz&&(this._Jazz._jazzTimeZero=this._Jazz.Time(),this._Jazz._perfTimeZero=window.performance.now())}function i(){this._jazzInstances=new Array,this._jazzInstances.push(new n),this._promise=new t,this._jazzInstances[0]._Jazz?(this._Jazz=this._jazzInstances[0]._Jazz,window.setTimeout(s.bind(this),3)):window.setTimeout(r.bind(this),3)}function r(){this._promise&&this._promise.fail({code:1})}function a(){this.jazz.MidiOutLong(this.data)}var o,i,s,c,d,l;t.prototype.then=function(e,t){this.accept=e,this.reject=t},t.prototype.succeed=function(e){this.accept&&this.accept(e)},t.prototype.fail=function(e){this.reject&&this.reject(e)},o=function(){var e=new i;return e._promise},s=function(){this._promise&&this._promise.succeed(this)},i.prototype.inputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiInList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new c(this,e[n],n);return t},i.prototype.outputs=function(){if(!this._Jazz)return null;for(var e=this._Jazz.MidiOutList(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=new d(this,e[n],n);return t},c=function(e,t,i){this._listeners=[],this._midiAccess=e,this._index=i,this._inLongSysexMessage=!1,this._sysexBuffer=new Uint8Array,this.id=""+i+"."+t,this.manufacturer="",this.name=t,this.type="input",this.version="",this.onmidimessage=null;for(var r=null,a=0;a<e._jazzInstances.length&&!r;a++)e._jazzInstances[a].inputInUse||(r=e._jazzInstances[a]);r||(r=new n,e._jazzInstances.push(r)),r.inputInUse=!0,this._jazzInstance=r._Jazz,this._input=this._jazzInstance.MidiInOpen(this._index,l.bind(this))},c.prototype.addEventListener=function(e,t,n){if("midimessage"===e){for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]==t)return;this._listeners.push(t)}},c.prototype.removeEventListener=function(e,t,n){if("midimessage"===e)for(var i=0;i<this._listeners.length;i++)if(this._listeners[i]==t)return void this._listeners.splice(i,1)},c.prototype.preventDefault=function(){this._pvtDef=!0},c.prototype.dispatchEvent=function(e){this._pvtDef=!1;for(var t=0;t<this._listeners.length;t++)this._listeners[t].handleEvent?this._listeners[t].handleEvent.bind(this)(e):this._listeners[t].bind(this)(e);return this.onmidimessage&&this.onmidimessage(e),this._pvtDef},c.prototype.appendToSysexBuffer=function(e){var t=this._sysexBuffer.length,n=new Uint8Array(t+e.length);n.set(this._sysexBuffer),n.set(e,t),this._sysexBuffer=n},c.prototype.bufferLongSysex=function(e,t){for(var n=t;n<e.length;){if(247==e[n])return n++,this.appendToSysexBuffer(e.slice(t,n)),n;n++}return this.appendToSysexBuffer(e.slice(t,n)),this._inLongSysexMessage=!0,n},l=function(e,t){var n,i=0,r=!1;for(n=0;n<t.length;n+=i){if(this._inLongSysexMessage){if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;r=!0}else switch(r=!1,240&t[n]){case 128:case 144:case 160:case 176:case 224:i=3;break;case 192:case 208:i=2;break;case 240:switch(t[n]){case 240:if(n=this.bufferLongSysex(t,n),247!=t[n-1])return;r=!0;break;case 241:case 243:i=2;break;case 242:i=3;break;default:i=1}}var a=document.createEvent("Event");a.initEvent("midimessage",!1,!1),a.receivedTime=parseFloat(e.toString())+this._jazzInstance._perfTimeZero,r||this._inLongSysexMessage?(a.data=new Uint8Array(this._sysexBuffer),this._sysexBuffer.length=0,this._inLongSysexMessage=!1):a.data=new Uint8Array(t.slice(n,i+n)),this.dispatchEvent(a)}},d=function(e,t,i){this._listeners=[],this._midiAccess=e,this._index=i,this.id=""+i+"."+t,this.manufacturer="",this.name=t,this.type="output",this.version="";for(var r=null,a=0;a<e._jazzInstances.length&&!r;a++)e._jazzInstances[a].outputInUse||(r=e._jazzInstances[a]);r||(r=new n,e._jazzInstances.push(r)),r.outputInUse=!0,this._jazzInstance=r._Jazz,this._jazzInstance.MidiOutOpen(this.name)},d.prototype.send=function(e,t){var n=0;if(0===e.length)return!1;if(t&&(n=Math.floor(t-window.performance.now())),t&&n>1){var i=new Object;i.jazz=this._jazzInstance,i.data=e,window.setTimeout(a.bind(i),n)}else this._jazzInstance.MidiOutLong(e);return!0},window.navigator.requestMIDIAccess||(window.navigator.requestMIDIAccess=o)}(window),function(e){function t(){for(var t=["moz","webkit","o","ms"],n=t.length,i={value:function(e){return function(){return Date.now()-e}}(Date.now())};n>=0;n--)if(t[n]+"Now"in e.performance)return i.value=function(t){return function(){e.performance[t]()}}(t[n]+"Now"),i;return"timing"in e.performance&&"connectStart"in e.performance.timing&&(i.value=function(e){return function(){Date.now()-e}}(e.performance.timing.connectStart)),i}var n,i={};"performance"in e&&"now"in e.performance||("performance"in e||Object.defineProperty(e,"performance",{get:function(){return i}}),n=t(),Object.defineProperty(e.performance,"now",n))}(window);var CBinParser=function(e){var t=e,n=0;this.getUBYTE=function(){return 255&t.charCodeAt(n++)},this.getUSHORT=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8;return n+=2,e},this.getULONG=function(){var e=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;return n+=4,e},this.getFLOAT=function(){var e=this.getULONG();if(0==e)return 0;var t=2147483648&e,n=e>>23&255,i=1+(8388607&e)/8388608,r=i*Math.pow(2,n-127);return t?-r:r},this.getTail=function(){var e=t.slice(n);return n=t.length,e}},CBinWriter=function(){var e="";this.putUBYTE=function(t){e+=String.fromCharCode(t)},this.putUSHORT=function(t){e+=String.fromCharCode(255&t,t>>8&255)},this.putULONG=function(t){e+=String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},this.putFLOAT=function(e){var t=0;if(0!=e){var n=0;0>e&&(n=2147483648,e=-e);for(var i=150;8388608>e;)e*=2,i--;for(;e>=16777216;)e/=2,i++;t=n|(255&i)<<23|8388607&e}this.putULONG(t)},this.append=function(t){e+=t},this.getData=function(){return e}},CAudioTimer=function(){var e=null,t=0,n=[0,0,0,0,0,0],i=0;this.setAudioElement=function(t){e=t},this.currentTime=function(){if(!e)return 0;var r,a=.001*(new Date).getTime(),o=a-t,s=e.currentTime,c=s-o;if(.01>s||c>.2||-.2>c)for(o=s,t=a-o,r=0;r<n.length;r++)n[r]=0;var d=0;for(r=0;r<n.length;r++)d+=n[r];return d/=n.length,n[i]=c,i=(i+1)%n.length,o+d},this.reset=function(){t=.001*(new Date).getTime();for(var e=0;e<n.length;e++)n[e]=0}},CGUI=function(){function e(){}var t,n,i,r,a,o="tracker/image/gui/",s=0,c=1,d=2,l=3,u=128,f=36,h=d,p=5,m=0,g=0,v=0,w=0,E=0,y=0,B=0,_=0,b=0,I=0,x=!1,T=!1,C=!1,L=[],D=[],U=[],k=[],S={},M=null,Y=new CAudioTimer,A=new CPlayer,P=new Image,O=new Image,R=new Image,N=new CJammer,z=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],j=[26,1,63,3,116,6,150,8,184,10,238,13,274,15,327,18,362,20,394,22],H=[],F=function(e){var t=e.indexOf("?");return e.slice(0,t>=0?t:e.length)},q=function(e){var t=e.indexOf("?")+1,n=e.indexOf("#")+1||e.length+1,i=e.slice(t,n-1),r={};if(i===e||""===i)return r;for(var a=i.replace(/\+/g," ").split("&"),o=0;o<a.length;o++){var s=a[o].split("="),c=decodeURIComponent(s[0]),d=decodeURIComponent(s[1]);c in r||(r[c]=[]),r[c].push(2===s.length?d:null)}return r},X=function(e){var t=void 0;if(e){var n=e,i="";if(0==n.indexOf("data:")){var r=n.indexOf("base64,");r>0&&(i=n.substr(r+7))}else for(var a=0;a<n.length;++a){var o=n[a];"-"===o&&(o="+"),"_"===o&&(o="/"),i+=o}try{t=atob(i)}catch(s){t=void 0}}return t},W=function(e){for(var n=btoa(e),i="",r=0;r<n.length;++r){var a=n[r];"+"===a&&(a="-"),"/"===a&&(a="_"),"="===a&&(a=""),i+=a}return t+"?data="+i},J=function(e){return Math.round(661500/e)},G=function(){return Math.round(661500/S.rowLen)},V=0,Q=1,Z=2,K=3,ee=4,te=5,ne=6,ie=7,re=8,ae=9,oe=10,se=11,ce=12,de=13,le=14,ue=15,fe=16,he=17,pe=18,me=19,ge=20,ve=21,we=22,Ee=23,ye=24,Be=25,_e=function(){var e,t,n,i,r,a={};a.rowLen=J(120),a.endPattern=2,a.patternLen=32;var o;for(e=0;e<gInstrumentPresets.length;++e)if(gInstrumentPresets[e].i){o=gInstrumentPresets[e];break}for(a.songData=[],e=0;8>e;e++){for(i={},i.i=[],t=0;t<=o.i.length;++t)i.i[t]=o.i[t];for(i.p=[],t=0;u>t;t++)i.p[t]=0;for(i.c=[],t=0;f>t;t++){for(r={},r.n=[],n=0;n<4*a.patternLen;n++)r.n[n]=0;for(r.f=[],n=0;n<2*a.patternLen;n++)r.f[n]=0;i.c[t]=r}a.songData[e]=i}return a.songData[0].p[0]=1,a},be=function(e){var t=new CBinWriter;t.putULONG(e.rowLen),t.putUBYTE(e.endPattern-2),t.putUBYTE(e.patternLen);var n,i,r,a,o;for(n=0;8>n;n++){for(a=e.songData[n],t.putUBYTE(a.i[V]),t.putUBYTE(a.i[Q]),t.putUBYTE(a.i[Z]),t.putUBYTE(a.i[K]),t.putUBYTE(a.i[ee]),t.putUBYTE(a.i[te]),t.putUBYTE(a.i[ne]),t.putUBYTE(a.i[ie]),t.putUBYTE(a.i[re]),t.putUBYTE(a.i[ae]),t.putUBYTE(a.i[oe]),t.putUBYTE(a.i[se]),t.putUBYTE(a.i[ce]),t.putUBYTE(a.i[de]),t.putUBYTE(a.i[le]),t.putUBYTE(a.i[ue]),t.putUBYTE(a.i[fe]),t.putUBYTE(a.i[he]),t.putUBYTE(a.i[pe]),t.putUBYTE(a.i[me]),t.putUBYTE(a.i[ge]),t.putUBYTE(a.i[ve]),t.putUBYTE(a.i[we]),t.putUBYTE(a.i[Ee]),t.putUBYTE(a.i[ye]),t.putUBYTE(a.i[Be]),i=0;u>i;i++)t.putUBYTE(a.p[i]);for(i=0;f>i;i++){for(o=a.c[i],r=0;r<4*e.patternLen;r++)t.putUBYTE(o.n[r]);for(r=0;r<2*e.patternLen;r++)t.putUBYTE(o.f[r])}}var s,c,d=t.getData(),l=0;for(n=9;n>0;n--)if(s=RawDeflate.deflate(d,n),c=RawDeflate.inflate(s),d===c){l=2;break}return 0==l&&(s=rle_encode(t.getData()),c=rle_decode(s),d===c?l=1:s=d),t=new CBinWriter,t.putULONG(2020557395),t.putUBYTE(10),t.putUBYTE(l),t.append(s),t.getData()},Ie=function(e){var t=new CBinParser(e),n={},i=t.getULONG(),r=t.getUBYTE();if(2020557395!=i||1>r||r>10)return void 0;if(r>=8){var a,o=t.getUBYTE(),s=t.getTail();switch(o){default:case 0:a=s;break;case 1:a=rle_decode(s);break;case 2:a=RawDeflate.inflate(s)}t=new CBinParser(a)}n.rowLen=t.getULONG(),n.endPattern=t.getUBYTE()+2,n.patternLen=r>=10?t.getUBYTE():32,n.songData=[];var c,d,l,h,p;for(c=0;8>c;c++){h={},h.i=[],6>r?(h.i[Z]=t.getUBYTE(),h.i[K]=t.getUBYTE(),h.i[Q]=t.getUBYTE(),h.i[V]=t.getUBYTE()):(h.i[V]=t.getUBYTE(),h.i[Q]=t.getUBYTE(),h.i[Z]=t.getUBYTE(),h.i[K]=t.getUBYTE()),6>r?(h.i[ne]=t.getUBYTE(),h.i[ie]=t.getUBYTE(),h.i[re]=t.getUBYTE(),h.i[te]=t.getUBYTE(),h.i[ee]=t.getUBYTE()):(h.i[ee]=t.getUBYTE(),h.i[te]=t.getUBYTE(),h.i[ne]=t.getUBYTE(),h.i[ie]=t.getUBYTE(),h.i[re]=t.getUBYTE()),h.i[ae]=t.getUBYTE(),5>r?(h.i[oe]=Math.round(Math.sqrt(t.getULONG())/2),h.i[se]=Math.round(Math.sqrt(t.getULONG())/2),h.i[ce]=Math.round(Math.sqrt(t.getULONG())/2)):(h.i[oe]=t.getUBYTE(),h.i[se]=t.getUBYTE(),h.i[ce]=t.getUBYTE()),6>r?(h.i[he]=t.getUBYTE(),h.i[pe]=5>r?Math.round(t.getUSHORT()/43.23529):t.getUBYTE(),h.i[me]=t.getUBYTE(),h.i[Be]=t.getUBYTE(),h.i[ye]=t.getUBYTE(),h.i[Ee]=t.getUBYTE(),h.i[we]=t.getUBYTE(),h.i[ge]=t.getUBYTE(),h.i[ve]=t.getUBYTE(),h.i[fe]=t.getUBYTE(),h.i[ue]=t.getUBYTE(),h.i[le]=t.getUBYTE(),h.i[de]=t.getUBYTE()):(h.i[de]=t.getUBYTE(),h.i[le]=t.getUBYTE(),h.i[ue]=t.getUBYTE(),h.i[fe]=t.getUBYTE(),h.i[he]=t.getUBYTE(),h.i[pe]=t.getUBYTE(),h.i[me]=t.getUBYTE(),h.i[ge]=t.getUBYTE(),h.i[ve]=t.getUBYTE(),h.i[we]=t.getUBYTE(),h.i[Ee]=t.getUBYTE(),h.i[ye]=t.getUBYTE(),h.i[Be]=t.getUBYTE());var m=9>r?48:u;for(h.p=[],d=0;m>d;d++)h.p[d]=t.getUBYTE();for(d=m;u>d;d++)h.p[d]=0;var g=9>r?10:f;for(h.c=[],d=0;g>d;d++){if(p={},p.n=[],1==r)for(l=0;l<n.patternLen;l++)p.n[l]=t.getUBYTE(),p.n[l+n.patternLen]=0,p.n[l+2*n.patternLen]=0,p.n[l+3*n.patternLen]=0;else for(l=0;l<4*n.patternLen;l++)p.n[l]=t.getUBYTE();if(p.f=[],4>r)for(l=0;l<2*n.patternLen;l++)p.f[l]=0;else for(l=0;l<2*n.patternLen;l++)p.f[l]=t.getUBYTE();h.c[d]=p}for(d=g;f>d;d++){for(p={},p.n=[],l=0;l<4*n.patternLen;l++)p.n[l]=0;for(p.f=[],l=0;l<2*n.patternLen;l++)p.f[l]=0;h.c[d]=p}3>r&&(2==h.i[V]&&(h.i[Q]=Math.round(h.i[Q]/2)),2==h.i[ee]&&(h.i[te]=Math.round(h.i[te]/2)),2==h.i[de]&&(h.i[le]=Math.round(h.i[le]/2)),h.i[ve]=h.i[ve]<224?h.i[ve]+32:255),7>r&&(h.i[me]=255-h.i[me]),n.songData[c]=h}return n},xe=function(e){if(3333!=e.length)return void 0;if((255&e.charCodeAt(3332))>48)return void 0;var t=new CBinParser(e),n={};n.rowLen=t.getULONG(),n.patternLen=32,n.songData=[];var i,r,a,o,s,c;for(i=0;8>i;i++){for(o={},o.i=[],o.i[Z]=12*(t.getUBYTE()-8)+128,o.i[Z]+=t.getUBYTE(),t.getUBYTE(),o.i[K]=t.getUBYTE(),o.i[Q]=t.getUBYTE(),o.i[V]=t.getUBYTE(),o.i[ne]=12*(t.getUBYTE()-8)+128,o.i[ne]+=t.getUBYTE(),o.i[ie]=t.getUBYTE(),o.i[re]=t.getUBYTE(),o.i[te]=t.getUBYTE(),o.i[ee]=t.getUBYTE(),o.i[ae]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),o.i[oe]=Math.round(Math.sqrt(t.getULONG())/2),o.i[se]=Math.round(Math.sqrt(t.getULONG())/2),o.i[ce]=Math.round(Math.sqrt(t.getULONG())/2),c=t.getUBYTE(),o.i[he]=t.getUBYTE(),t.getUBYTE(),t.getUBYTE(),o.i[pe]=Math.round(t.getFLOAT()/43.23529),o.i[me]=255-t.getUBYTE(),o.i[Be]=t.getUBYTE(),o.i[ye]=t.getUBYTE(),o.i[Ee]=t.getUBYTE(),o.i[we]=t.getUBYTE(),o.i[ge]=0,o.i[ve]=32,t.getUBYTE(),o.i[fe]=t.getUBYTE(),o.i[ue]=t.getUBYTE(),o.i[le]=t.getUBYTE(),o.i[de]=t.getUBYTE(),o.p=[],r=0;48>r;r++)o.p[r]=t.getUBYTE();for(r=48;u>r;r++)o.p[r]=0;for(o.c=[],r=0;10>r;r++){for(s={},s.n=[],a=0;32>a;a++)s.n[a]=t.getUBYTE(),s.n[a+32]=0,s.n[a+64]=0,s.n[a+96]=0;for(s.f=[],a=0;64>a;a++)s.f[a]=0;o.c[r]=s}for(r=10;f>r;r++){for(s={},s.n=[],a=0;128>a;a++)s.n[a]=0;for(s.f=[],a=0;64>a;a++)s.f[a]=0;o.c[r]=s}t.getUBYTE(),t.getUBYTE(),(o.i[he]<1||o.i[he]>3)&&(o.i[he]=2,o.i[pe]=255),o.i[Q]*=c/255,o.i[te]*=c/255,o.i[ae]*=c/255,2==o.i[V]&&(o.i[Q]/=2),2==o.i[ee]&&(o.i[te]/=2),2==o.i[de]&&(o.i[le]/=2),o.i[Q]=Math.round(o.i[Q]),o.i[te]=Math.round(o.i[te]),o.i[ae]=Math.round(o.i[ae]),o.i[le]=Math.round(o.i[le]),n.songData[i]=o}return n.endPattern=t.getUBYTE()+2,n},Te=function(e){var t=Ie(e);return t||(t=xe(e)),t?t:void alert("Song format not recognized.")},Ce=function(e){var t,n,i,r,a="";for(a+="    // This music has been exported by SoundBox. You can use it with\n",a+="    // http://sb.bitsnbites.eu/player-small.js in your own product.\n\n",a+="    // See http://sb.bitsnbites.eu/demo.html for an example of how to\n",a+="    // use it in a demo.\n\n",a+="    // Song data\n",a+="    var song = {\n",a+="      songData: [\n",t=0;8>t;t++){var o=e.songData[t];a+="        { // Instrument "+t+"\n",a+="          i: [\n",a+="          "+o.i[V]+", // OSC1_WAVEFORM\n",a+="          "+o.i[Q]+", // OSC1_VOL\n",a+="          "+o.i[Z]+", // OSC1_SEMI\n",a+="          "+o.i[K]+", // OSC1_XENV\n",a+="          "+o.i[ee]+", // OSC2_WAVEFORM\n",a+="          "+o.i[te]+", // OSC2_VOL\n",a+="          "+o.i[ne]+", // OSC2_SEMI\n",a+="          "+o.i[ie]+", // OSC2_DETUNE\n",a+="          "+o.i[re]+", // OSC2_XENV\n",a+="          "+o.i[ae]+", // NOISE_VOL\n",a+="          "+o.i[oe]+", // ENV_ATTACK\n",a+="          "+o.i[se]+", // ENV_SUSTAIN\n",a+="          "+o.i[ce]+", // ENV_RELEASE\n",a+="          "+o.i[de]+", // LFO_WAVEFORM\n",a+="          "+o.i[le]+", // LFO_AMT\n",a+="          "+o.i[ue]+", // LFO_FREQ\n",a+="          "+o.i[fe]+", // LFO_FX_FREQ\n",a+="          "+o.i[he]+", // FX_FILTER\n",a+="          "+o.i[pe]+", // FX_FREQ\n",a+="          "+o.i[me]+", // FX_RESONANCE\n",a+="          "+o.i[ge]+", // FX_DIST\n",a+="          "+o.i[ve]+", // FX_DRIVE\n",a+="          "+o.i[we]+", // FX_PAN_AMT\n",a+="          "+o.i[Ee]+", // FX_PAN_FREQ\n",a+="          "+o.i[ye]+", // FX_DELAY_AMT\n",a+="          "+o.i[Be]+" // FX_DELAY_TIME\n",a+="          ],\n",a+="          // Patterns\n",a+="          p: [";var s=e.endPattern-2,c=0,d=0;for(n=0;s>=n;n++)r=o.p[n],r>c&&(c=r),r&&(d=n);for(n=0;d>=n;n++)r=o.p[n],r&&(a+=r),d>n&&(a+=",");for(a+="],\n",a+="          // Columns\n",a+="          c: [\n",n=0;c>n;n++){for(a+="            {n: [",d=0,i=0;i<4*e.patternLen;i++)o.c[n].n[i]&&(d=i);for(i=0;d>=i;i++){var l=o.c[n].n[i];l&&(a+=l),d>i&&(a+=",")}for(a+="],\n",a+="             f: [",d=0,i=0;i<2*e.patternLen;i++)o.c[n].f[i]&&(d=i);for(i=0;d>=i;i++){var u=o.c[n].f[i];u&&(a+=u),d>i&&(a+=",")}a+="]}",c-1>n&&(a+=","),a+="\n"}a+="          ]\n",a+="        }",7>t&&(a+=","),a+="\n"}return a+="      ],\n",a+="      rowLen: "+e.rowLen+",   // In sample lengths\n",a+="      patternLen: "+e.patternLen+",  // Rows per pattern\n",a+="      endPattern: "+e.endPattern+"  // End pattern\n",a+="    };\n"},Le=function(e){var t=e.data[0]>>4,n=15&e.data[0],i=e.data[1],r=e.data[2];9!=n&&9==t&&r>0&&Qe(i-12)},De=function(e){a=r.inputs()[i.selectedIndex],a.onmidimessage=Le},Ue=function(e){r=e;var t,n="function"==typeof r.inputs?r.inputs():[],o=0;for(t=0;t<n.length;t++){var s=n[t].name.toString().toLowerCase();if(-1!=s.indexOf("keyboard")){o=t;break}}if(i.options.length=0,n.length){for(t=0;t<n.length;t++)i.options[t]=new Option(n[t].name,n[t].fingerprint,t==o,t==o);a=n[o],a.onmidimessage=Le,i.onchange=De,i.style.display="inline"}},ke=function(e){},Se=function(){navigator.requestMIDIAccess&&(i=document.getElementById("midiInput"),
navigator.requestMIDIAccess().then(Ue,ke))},Me=function(e){var t=new Image;t.src=e,H.push(t)},Ye=function(){for(var e,t,n=document.getElementById("instrPreset"),i=0;i<gInstrumentPresets.length;++i)t=gInstrumentPresets[i],e=document.createElement("option"),e.value=t.i?""+i:"",e.appendChild(document.createTextNode(t.name)),n.appendChild(e)},Ae=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},Pe=function(e){var t=null;return e||(e=window.event),e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t},Oe=function(e,t){var n=[0,0];if(e.pageX&&e.pageY?n=[e.pageX,e.pageY]:e.clientX&&e.clientY?n=[e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.clientY+document.body.scrollTop+document.documentElement.scrollTop]:e.touches&&e.touches.length>0&&(n=[e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop]),!t)return n;var i=Ae(Pe(e));return[n[0]-i[0],n[1]-i[1]]},Re=function(){document.getElementById("bpm").blur(),document.getElementById("rpp").blur(),document.getElementById("instrPreset").blur()},$e=function(e){e!==h&&(h=e,document.getElementById("sequencer").className=h==c?"edit":"",document.getElementById("pattern").className=h==d?"edit":"",document.getElementById("fxtrack").className=h==l?"edit":"",h!=s&&(Re(),it(),at()))},Ne=function(){document.getElementById("bpm").value=G(),document.getElementById("rpp").value=S.patternLen},ze=function(e,t){for(var n,i=0;u>i;++i)for(var r=0;8>r;++r){if(n=document.getElementById("sc"+r+"r"+i),!t){var a=S.songData[r].p[i];n.innerHTML=a>0?""+(10>=a?a-1:String.fromCharCode(64+a-10)):""}n.className=i>=y&&_>=i&&r>=E&&B>=r?"selected":""}if(e&&(n=document.getElementById("spr"+y),n.scrollIntoView)){var o=document.getElementById("sequencer"),s=n.offsetTop-o.scrollTop;(0>s||s+10>o.offsetHeight)&&n.scrollIntoView(0>s)}},je=function(e,t){Sn();for(var n,i=E==B&&y==_,r=i?S.songData[E].p[y]-1:-1,a=0;a<S.patternLen;++a)for(var o=0;4>o;++o){if(n=document.getElementById("pc"+o+"r"+a),!t){var s="";if(r>=0){var c=S.songData[E].c[r].n[a+o*S.patternLen]-87;c>0&&(s=z[c%12]+Math.floor(c/12))}n.innerHTML!=s&&(n.innerHTML=s)}n.className=a>=g&&w>=a&&o>=m&&v>=o?"selected":""}if(e&i&&(n=document.getElementById("pc0r"+g),n.scrollIntoView)){var d=document.getElementById("pattern"),l=n.offsetTop-d.scrollTop;(0>l||l+10>d.offsetHeight)&&n.scrollIntoView(0>l)}},He=function(e,t){for(var n=e.toString(16).toUpperCase(),i=t-n.length,r=0;i>r;++r)n="0"+n;return n},Fe=function(e,t){Mn();for(var n,i=E==B&&y==_,r=i?S.songData[E].p[y]-1:-1,a=0;a<S.patternLen;++a){if(n=document.getElementById("fxr"+a),!t){var o=":";if(r>=0){var s=S.songData[E].c[r].f[a];if(s){var c=S.songData[E].c[r].f[a+S.patternLen];o=He(s,2)+":"+He(c,2)}}n.innerHTML!=o&&(n.innerHTML=o)}n.className=a>=b&&I>=a?"selected":""}if(e&i&&(n=document.getElementById("fxr"+b),n.scrollIntoView)){var d=document.getElementById("fxtrack"),l=n.offsetTop-d.scrollTop;(0>l||l+10>d.offsetHeight)&&n.scrollIntoView(0>l)}},qe=function(e,t){m=e,g=t,v=e,w=t;for(var n=0;n<S.patternLen;++n)for(var i=0;4>i;++i){var r=document.getElementById("pc"+i+"r"+n);r.className=n==t&&i==e?"selected":""}je(!0,!0)},Xe=function(e,t){v=e>=m?e:m,w=t>=g?t:g;for(var n=0;n<S.patternLen;++n)for(var i=0;4>i;++i){var r=document.getElementById("pc"+i+"r"+n);r.className=n>=g&&w>=n&&i>=m&&v>=i?"selected":""}je(!1,!0)},We=function(e,t){E=e,y=t,B=e,_=t,ze(!0,!0)},Je=function(e,t){B=e>=E?e:E,_=t>=y?t:y,ze(!1,!0)},Ge=function(e){b=e,I=e;for(var t=0;t<S.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=b&&I>=t?"selected":""}Fe(!0,!0)},Ve=function(e){I=e>=b?e:b;for(var t=0;t<S.patternLen;++t){var n=document.getElementById("fxr"+t);n.className=t>=b&&I>=t?"selected":""}Fe(!1,!0)},Qe=function(e){var t=e+87;if(N.addNote(t),h==d&&E==B&&y==_&&m==v&&g==w){var n=S.songData[E].p[y]-1;if(n>=0)return S.songData[E].c[n].n[g+m*S.patternLen]=t,qe(m,(g+1)%S.patternLen),je(),!0}return!1},Ze=function(e,t,n){n||(e.value=t)},Ke=function(e,t){$(e).prop("checked",!!t)},et=function(){var e=document.getElementById("instrPreset");e.selectedIndex=0},tt=function(e,t){$("[name='"+e+"'][value='"+t+"']").attr("checked","checked").parent().addClass("active").siblings().removeClass("active")},nt=function(e){var t=S.songData[E];tt("osc1_wave",t.i[V]),Ze(document.getElementById("osc1_vol"),t.i[Q]),Ze(document.getElementById("osc1_semi"),t.i[Z]),Ke(document.getElementById("osc1_xenv"),t.i[K]),tt("osc2_wave",t.i[ee]),Ze(document.getElementById("osc2_vol"),t.i[te]),Ze(document.getElementById("osc2_semi"),t.i[ne]),Ze(document.getElementById("osc2_det"),t.i[ie]),Ke(document.getElementById("osc2_xenv"),t.i[re]),Ze(document.getElementById("noise_vol"),t.i[ae]),Ze(document.getElementById("env_att"),t.i[oe]),Ze(document.getElementById("env_sust"),t.i[se]),Ze(document.getElementById("env_rel"),t.i[ce]),tt("lfo_wave",t.i[de]),Ze(document.getElementById("lfo_amt"),t.i[le]),Ze(document.getElementById("lfo_freq"),t.i[ue]),Ke(document.getElementById("lfo_fxfreq"),t.i[fe]),tt("fx_filt",t.i[he]),Ze(document.getElementById("fx_freq"),t.i[pe]),Ze(document.getElementById("fx_res"),t.i[me]),Ze(document.getElementById("fx_dly_amt"),t.i[ye]),Ze(document.getElementById("fx_dly_time"),t.i[Be]),Ze(document.getElementById("fx_pan_amt"),t.i[we]),Ze(document.getElementById("fx_pan_freq"),t.i[Ee]),Ze(document.getElementById("fx_dist"),t.i[ge]),Ze(document.getElementById("fx_drive"),t.i[ve]),e&&et(),N.updateInstr(t.i)},it=function(){var e=parseInt(document.getElementById("bpm").value);e&&e>=10&&1e3>=e&&(S.rowLen=J(e),N.updateRowLen(S.rowLen))},rt=function(e){if(S.patternLen!==e){_t();var t,n,i,r,a,o;for(t=0;8>t;t++)for(n=0;f>n;n++){for(r=S.songData[t].c[n],a=[],o=[],i=0;4*e>i;i++)a[i]=0;for(i=0;2*e>i;i++)o[i]=0;for(i=0;i<Math.min(S.patternLen,e);i++)a[i]=r.n[i],a[i+e]=r.n[i+S.patternLen],a[i+2*e]=r.n[i+2*S.patternLen],a[i+3*e]=r.n[i+3*S.patternLen],o[i]=r.f[i],o[i+e]=r.f[i+S.patternLen];r.n=a,r.f=o}S.patternLen=e}},at=function(){var e=parseInt(document.getElementById("rpp").value);e&&e>=1&&256>=e&&(rt(e),Sn(),Mn(),je(),Fe())},ot=function(){var e,t,n;for(S.endPattern=u+1,e=u-1;e>=0;--e){for(n=!0,t=0;8>t;++t)if(S.songData[t].p[e]>0){n=!1;break}if(!n)break;S.endPattern--}it()},st=function(){var e=document.getElementById("cover");e.style.visibility="visible",e=document.getElementById("dialog"),e.style.visibility="visible",Ln()},ct=function(){var e=document.getElementById("cover");e.style.visibility="hidden",e=document.getElementById("dialog"),e.style.visibility="hidden",Cn()},dt=function(e){var t=document.getElementById("dialog");t.innerHTML="";var n,i;n=document.createElement("img"),n.src=o+"progress.gif",t.appendChild(n),n=document.createTextNode(e),t.appendChild(n),n=document.createElement("div"),n.id="progressBarParent",t.appendChild(n),i=document.createElement("div"),i.id="progressBar",n.appendChild(i),st()},lt=function(e){var t=Te(e);t&&(_t(),S=t,Ne(),ze(),je(),Fe(),nt(!0))},ut=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("h3"),t.appendChild(document.createTextNode("Open song")),e.appendChild(t),e.appendChild(document.createElement("br"));var n=document.createElement("form"),i=document.createElement("div");i.style.textAlign="left",i.style.marginLeft="30px",i.style.lineHeight="1.8em";for(var r=[],a=0;a<gDemoSongs.length;a++)t=document.createElement("input"),t.type="radio",t.name="radiogroup1",t.value=gDemoSongs[a].name,0===a&&(t.checked=!0),r.push(t),i.appendChild(t),t=document.createElement("span"),t.innerHTML=gDemoSongs[a].description,i.appendChild(t),i.appendChild(document.createElement("br"));var o=document.createElement("input");o.type="radio",o.name="radiogroup1",o.value="custom",i.appendChild(o),i.appendChild(document.createTextNode(" Data URL: "));var s=document.createElement("input");s.type="text",s.size="45",s.title="Paste a saved song data URL here",s.onchange=function(){o.checked=!0},s.onkeydown=s.onchange,s.onclick=s.onchange,i.appendChild(s),n.appendChild(i),t=document.createElement("p"),t.appendChild(document.createTextNode("Hint: You can also drag'n'drop binary files into the editor.")),n.appendChild(t),n.appendChild(document.createElement("br")),t=document.createElement("input"),t.type="submit",t.value="Open",t.title="Open song",t.onclick=function(e){e.preventDefault();var t=null;if(o.checked){var n=q(s.value);t=X(n&&n.data&&n.data[0])}else for(var i=0;i<r.length;i++)if(e=r[i],e.checked){for(var a=0;a<gDemoSongs.length;a++)if(gDemoSongs[a].name===e.value){t=gDemoSongs[a].data?gDemoSongs[a].data:X(gDemoSongs[a].base64);break}break}t&&lt(t),ct()},n.appendChild(t),n.appendChild(document.createTextNode(" ")),t=document.createElement("input"),t.type="submit",t.value="Cancel",t.onclick=function(){return ct(),!1},n.appendChild(t),e.appendChild(n),st()},ft=function(){var e=document.getElementById("dialog");e.innerHTML="";var t,n;t=document.createElement("h3"),t.appendChild(document.createTextNode("Save song")),e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("Data URL (copy/paste, bookmark, mail etc):")),e.appendChild(t),t=document.createElement("p"),n=document.createElement("a");var i=W(be(S)),r=i.length<70?i:i.slice(0,67)+"...";n.href=i,n.title=i,n.appendChild(document.createTextNode(r)),t.appendChild(n),e.appendChild(t);var a=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Save binary",t.title="Save the song as a binary file.",t.onclick=function(){var e="data:application/octet-stream;base64,"+btoa(be(S));return window.open(e),ct(),!1},a.appendChild(t),t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return ct(),!1},a.appendChild(t),e.appendChild(a),st()},ht=function(){var e=document.getElementById("dialog");e.innerHTML="";var t;t=document.createElement("img"),t.src=o+"logo-big.png",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("an HTML5 synth music tracker")),e.appendChild(t),t=document.createElement("p"),t.innerHTML='Licensed under the <a href="LICENSE">GPL v3</a> license (get the <a href="http://gitorious.org/soundbox/soundbox">source</a>).',t.style.fontStyle="italic",e.appendChild(t),t=document.createElement("p"),t.appendChild(document.createTextNode("To get started, open a demo song.")),e.appendChild(t),t=document.createElement("a"),t.href="help.html",t.appendChild(document.createTextNode("Help")),e.appendChild(t),e.appendChild(document.createElement("br")),e.appendChild(document.createElement("br"));var n=document.createElement("form");t=document.createElement("input"),t.type="submit",t.value="Close",t.onclick=function(){return ct(),!1},n.appendChild(t),e.appendChild(n),st()},pt=function(e){e.preventDefault(),ht()},mt=function(e){return S=_e(),Ne(),ze(),je(),Fe(),nt(),$e(d),qe(0,0),We(0,0),Ge(0),!1},gt=function(e){e.preventDefault(),ut()},vt=function(e){ot(),ft(),e.preventDefault()},wt=function(e){e.preventDefault(),ot();var t=function(e){var t=new Blob([e],{type:"application/octet-stream"});saveAs(t,"SoundBox-music.wav")};Bt(t)},Et=function(e){ot();var t="data:text/javascript;base64,"+btoa(Ce(S));return window.open(t),!1},yt=function(e){document.getElementById("statusText").innerHTML=e},Bt=function(e,t){dt("Generating sound...");var n=new Date;A=new CPlayer,A.generate(S,t,function(t){var i=document.getElementById("progressBar");if(i.style.width=Math.floor(200*t)+"px",t>=1){var r=A.createWave(),a=new Date;yt("Generation time: "+(a.getTime()-n.getTime())/1e3+"s"),ct(),e(r)}})},_t=function(){At(),M&&(M.pause(),Y.reset())},bt=-1,It=0,xt=0,Tt=0,Ct=0,Lt=!1,Dt=0,Ut=0,kt=function(e,t){for(var n=44100*e/S.rowLen,i=Math.floor(n),r=Math.floor(i/S.patternLen)+It,a=i%S.patternLen,o=0;o<S.patternLen;++o){for(var s=r,c=a-o;0>c;){if(--s,It>s)return-1;c+=S.patternLen}for(var d=S.songData[t].p[s]-1,l=0;4>l;l++)if(d>=0&&S.songData[t].c[d].n[c+l*S.patternLen]>0)return(o+(n-i))*S.rowLen}return-1},St=function(e){var t=document.getElementById("playGfxCanvas"),n=P.width>0?P.width:t.width,i=P.height>0?P.height:51,r=t.getContext("2d");if(r){r.drawImage(P,0,0);var a=0,o=0;if(Lt&&e>=0){var s,c,d,l=A.getData(e,1e3),u=0,f=0,h=0,p=0;for(s=1;s<l.length;s+=2)c=l[s-1],d=l[s],u=.8*c+.1*u-.3*h,f=.8*d+.1*f-.3*p,h=c,p=d,a+=u*u,o+=f*f;a=.2*Math.sqrt(a/l.length)+.8*Dt,o=.2*Math.sqrt(o/l.length)+.8*Ut,Dt=a,Ut=o}var m=a>0?1.3+.5*Math.log(a):-1e3;m=-1>m?-1:m>1?1:m,m*=.57;var g=o>0?1.3+.5*Math.log(o):-1e3;for(g=-1>g?-1:g>1?1:g,g*=.57,r.strokeStyle="rgb(0,0,0)",r.beginPath(),r.moveTo(.25*n,2.1*i),r.lineTo(.25*n+1.8*i*Math.sin(m),2.1*i-1.8*i*Math.cos(m)),r.stroke(),r.beginPath(),r.moveTo(.75*n,2.1*i),r.lineTo(.75*n+1.8*i*Math.sin(g),2.1*i-1.8*i*Math.cos(g)),r.stroke(),r.fillStyle="rgb(0,0,0)",r.fillRect(0,i,n,20),s=0;8>s;++s){var v=Math.round(26+23*s);if(r.drawImage(O,v,i),s>=Tt&&Ct>=s){var w=S.songData[s].i[oe],E=S.songData[s].i[se],y=S.songData[s].i[ce];w=w*w*4,y=E*E*4+y*y*4;var B=w+y;1e4>B&&(B=1e4,y=B-w);var _=kt(e,s);if(_>=0&&B>_){var b;b=w>_?_/w:1-(_-w)/y,r.globalAlpha=b*b,r.drawImage(R,v,i),r.globalAlpha=1}}}}},Mt=function(){if(null!=M){var e,t,n=Y.currentTime();if(M.ended||M.duration&&M.duration-n<.1)return At(),g=0,w=0,je(),b=0,I=0,void Fe();var i=Math.floor(44100*n/S.rowLen),r=Math.floor(i/S.patternLen)+It,a=i%S.patternLen,o=r!=y,s=o||a!=g;if(o)for(r>=0&&(y=r,_=r,ze(!0,!0)),e=0;u>e;++e)t=document.getElementById("spr"+e),t.className=e==r?"playpos":"";if(s)for(a>=0&&(g=a,w=a,je(!0,!o),b=a,I=a,Fe(!0,!o)),e=0;e<S.patternLen;++e)t=document.getElementById("ppr"+e),t.className=e==a?"playpos":"";St(n)}},Yt=function(){y=It,_=It,B=E,ze(!0,!0),je(),Fe(),Lt=!0,bt=setInterval(Mt,16)},At=function(){if(Lt){-1!==bt&&(clearInterval(bt),bt=-1);var e;for(e=0;u>e;++e)document.getElementById("spr"+e).className="";for(e=0;e<S.patternLen;++e)document.getElementById("ppr"+e).className="";St(-1),Lt=!1}},Pt=function(e){e||(e=window.event),e.preventDefault(),_t(),ot(),It=0,xt=S.endPattern-2,Tt=0,Ct=7;var t=function(e){if(null==M)return void alert("Audio element unavailable.");try{Yt(),M.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),Y.reset(),M.play()}catch(t){alert("Error playing: "+t.message)}};Bt(t)},Ot=function(e){e||(e=window.event),e.preventDefault(),_t(),ot();var t={firstRow:y,lastRow:_,firstCol:E,lastCol:B};It=y,xt=_,Tt=E,Ct=B;var n=function(e){if(null==M)return void alert("Audio element unavailable.");try{Yt(),M.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),M.play(),Y.reset()}catch(t){alert("Error playing: "+t.message)}};Bt(n,t)},Rt=function(e){return e||(e=window.event),e.preventDefault(),null==M?void alert("Audio element unavailable."):void _t()},$t=function(e){return $e(s),!0},Nt=function(e){return $e(s),!0},zt=function(e){return $e(s),!0},jt=function(e){if(e=e||window.event,e.preventDefault(),E==B){k=[];for(var t=S.songData[E],n=0;n<=t.i.length;++n)k[n]=t.i[n]}},Ht=function(e){if(e=e||window.event,e.preventDefault(),E==B&&k.length>0){var t=S.songData[E];t.i=[];for(var n=0;n<=k.length;++n)t.i[n]=k[n]}nt(!0)},Ft=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){D=[];for(var n=g;w>=n;++n){for(var i=[],r=m;v>=r;++r)i.push(S.songData[E].c[t].n[n+r*S.patternLen]);D.push(i)}}}},qt=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){for(var n=g,i=0;n<S.patternLen&&i<D.length;++n,++i)for(var r=m,a=0;4>r&&a<D[i].length;++r,++a)S.songData[E].c[t].n[n+r*S.patternLen]=D[i][a];je()}}},Xt=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){for(var n=g;w>=n;++n)for(var i=m;v>=i;++i){var r=S.songData[E].c[t].n[n+i*S.patternLen];r>0&&(S.songData[E].c[t].n[n+i*S.patternLen]=r+1)}je()}}},Wt=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){for(var n=g;w>=n;++n)for(var i=m;v>=i;++i){var r=S.songData[E].c[t].n[n+i*S.patternLen];r>1&&(S.songData[E].c[t].n[n+i*S.patternLen]=r-1)}je()}}},Jt=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){for(var n=g;w>=n;++n)for(var i=m;v>=i;++i){var r=S.songData[E].c[t].n[n+i*S.patternLen];r>0&&(S.songData[E].c[t].n[n+i*S.patternLen]=r+12)}je()}}},Gt=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){for(var n=g;w>=n;++n)for(var i=m;v>=i;++i){var r=S.songData[E].c[t].n[n+i*S.patternLen];r>12&&(S.songData[E].c[t].n[n+i*S.patternLen]=r-12)}je()}}},Vt=function(e){e=e||window.event,e.preventDefault(),L=[];for(var t=y;_>=t;++t){for(var n=[],i=E;B>=i;++i)n.push(S.songData[i].p[t]);L.push(n)}},Qt=function(e){e=e||window.event,e.preventDefault();for(var t=y,n=0;u>t&&n<L.length;++t,++n)for(var i=E,r=0;8>i&&r<L[n].length;++i,++r)S.songData[i].p[t]=L[n][r];ze()},Zt=function(e){e=e||window.event,e.preventDefault();for(var t=y;_>=t;++t)for(var n=E;B>=n;++n){var i=S.songData[n].p[t];f>i&&(S.songData[n].p[t]=i+1)}ze(),je(),Fe()},Kt=function(e){e=e||window.event,e.preventDefault();for(var t=y;_>=t;++t)for(var n=E;B>=n;++n){var i=S.songData[n].p[t];i>0&&(S.songData[n].p[t]=i-1)}ze(),je(),Fe()},en=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){U=[];for(var n=b;I>=n;++n){var i=[];i.push(S.songData[E].c[t].f[n]),i.push(S.songData[E].c[t].f[n+S.patternLen]),U.push(i)}}}},tn=function(e){if(e=e||window.event,e.preventDefault(),y==_&&E==B){var t=S.songData[E].p[y]-1;if(t>=0){for(var n=b,i=0;n<S.patternLen&&i<U.length;++n,++i){var r=U[i];S.songData[E].c[t].f[n]=r[0],S.songData[E].c[t].f[n+S.patternLen]=r[1]}Fe()}}},nn=function(e){if(e=e||window.event,e.preventDefault(),E==B){var t=Pe(e),n=-1;"osc1_xenv"===t.id?n=K:"osc2_xenv"===t.id?n=re:"lfo_fxfreq"===t.id&&(n=fe);var i;if(n>=0&&(i=+$(t).is(":checked"),S.songData[E].i[n]=i),h==l&&y==_&&b==I&&n){var r=S.songData[E].p[y]-1;r>=0&&(S.songData[E].c[r].f[b]=n+1,S.songData[E].c[r].f[b+S.patternLen]=i,Fe())}nt(!0),Re()}},rn=function(e){if(e=e||window.event,e.preventDefault(),E==B){var t=e.currentTarget.value;if(h==l&&y==_&&b==I){var n=S.songData[E].p[y]-1;n>=0&&(S.songData[E].c[n].f[b]=V+1,S.songData[E].c[n].f[b+S.patternLen]=t,Fe())}S.songData[E].i[V]=t,nt(),Re()}},an=function(e){if(e=e||window.event,e.preventDefault(),E==B){var t=e.currentTarget.value;if(h==l&&y==_&&b==I){var n=S.songData[E].p[y]-1;n>=0&&(S.songData[E].c[n].f[b]=ee+1,S.songData[E].c[n].f[b+S.patternLen]=t,Fe())}S.songData[E].i[ee]=t,nt(!0),Re()}},on=function(e){if(e=e||window.event,e.preventDefault(),E==B){var t=e.currentTarget.value;if(h==l&&y==_&&b==I){var n=S.songData[E].p[y]-1;n>=0&&(S.songData[E].c[n].f[b]=de+1,S.songData[E].c[n].f[b+S.patternLen]=t,Fe())}S.songData[E].i[de]=t,nt(!0),Re()}},sn=function(e){if(e=e||window.event,e.preventDefault(),E==B){var t=e.currentTarget.value;if(h==l&&y==_&&b==I){var n=S.songData[E].p[y]-1;n>=0&&(S.songData[E].c[n].f[b]=he+1,S.songData[E].c[n].f[b+S.patternLen]=t,Fe())}S.songData[E].i[he]=t,nt(!0),Re()}},cn=function(e){e=e||window.event,e.preventDefault(),8>p&&(p++,document.getElementById("keyboardOctave").innerHTML=""+p)},dn=function(e){e=e||window.event,e.preventDefault(),p>1&&(p--,document.getElementById("keyboardOctave").innerHTML=""+p)},ln=function(e){if(e=e||window.event,e.preventDefault(),E==B){var t=Pe(e),n=t.options[t.selectedIndex].value;if(""!==n&&(n=parseInt(n))){for(var i=gInstrumentPresets[n],r=0;r<i.i.length;++r)S.songData[E].i[r]=i.i[r];nt(!1)}}},un=function(e){e=e||window.event;var t=Oe(e,!0),n=0;if(t[1]<68)for(var i=0;i<j.length;i+=2)if(t[0]>=j[i]-10&&t[0]<=j[i]+10){n=j[i+1];break}if(!n){n=2*Math.floor(14*t[0]/420);var r=0;n>=20&&r++,n>=14&&r++,n>=6&&r++,n-=r}Qe(n+12*p)&&e.preventDefault()},fn=function(e){if(e||(e=window.event),e.preventDefault(),!Lt){var t=Pe(e),n=parseInt(t.id.slice(3));Ge(n),C=!0}$e(l)},hn=function(e){if(C){e=e||window.event,e.preventDefault();var t=Pe(e),n=parseInt(t.id.slice(3));Ve(n)}},pn=function(e){if(C){e=e||window.event,e.preventDefault();var t=Pe(e),n=parseInt(t.id.slice(3));Ve(n),C=!1}},mn=function(e){if(e=e||window.event,e.preventDefault(),!Lt){var t=Pe(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));qe(n,i),T=!0}$e(d)},gn=function(e){if(T){e=e||window.event,e.preventDefault();var t=Pe(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Xe(n,i)}},vn=function(e){if(T){e=e||window.event,e.preventDefault();var t=Pe(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Xe(n,i),T=!1}},wn=function(e){e=e||window.event,e.preventDefault();var t,n=Pe(e),i=parseInt(n.id.slice(2,3));t=Lt?y:parseInt(n.id.slice(4));var r=i!=E||E!=B;We(i,t),Lt||(x=!0),$e(c),je(),Fe(),nt(r)},En=function(e){if(x){e=e||window.event,e.preventDefault();var t=Pe(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4));Je(n,i),je(),Fe(),nt(!0)}},yn=function(e){if(x){e=e||window.event,e.preventDefault();var t=Pe(e),n=parseInt(t.id.slice(2,3)),i=parseInt(t.id.slice(4)),r=n!=B||E!=B;Je(n,i),x=!1,je(),Fe(),nt(r)}},Bn=null,_n=function(e){E==B&&(e=e||window.event,Bn=Pe(e),Re())},bn=function(e){if(e=e||window.event,e.preventDefault(),Bn){var t=Oe(e,!1),n=Ae(Bn.parentNode),i=t[0]-6-n[0];i=0>i?0:i>191?1:i/191,Bn.sliderProps.nonLinear&&(i*=i);var r=Bn.sliderProps.min,a=Bn.sliderProps.max;i=Math.round(r+(a-r)*i),"INPUT"==Bn.tagName&&(i=Bn.value);var o=-1;"osc1_vol"==Bn.id?o=Q:"osc1_semi"==Bn.id?o=Z:"osc2_vol"==Bn.id?o=te:"osc2_semi"==Bn.id?o=ne:"osc2_det"==Bn.id?o=ie:"noise_vol"==Bn.id?o=ae:"env_att"==Bn.id?o=oe:"env_sust"==Bn.id?o=se:"env_rel"==Bn.id?o=ce:"lfo_amt"==Bn.id?o=le:"lfo_freq"==Bn.id?o=ue:"fx_freq"==Bn.id?o=pe:"fx_res"==Bn.id?o=me:"fx_dist"==Bn.id?o=ge:"fx_drive"==Bn.id?o=ve:"fx_pan_amt"==Bn.id?o=we:"fx_pan_freq"==Bn.id?o=Ee:"fx_dly_amt"==Bn.id?o=ye:"fx_dly_time"==Bn.id&&(o=Be);var s=S.songData[E];if(h==l&&b==I&&y==_&&E==B){var c=S.songData[E].p[y]-1;c>=0&&(S.songData[E].c[c].f[b]=o+1,S.songData[E].c[c].f[b+S.patternLen]=i,Fe())}o>=0&&(s.i[o]=i),N.updateInstr(s.i),et()}},In=function(e){},xn=function(e){e=e||window.event;var t,n,i,r=document.activeElement===document.getElementById("bpm")||document.activeElement===document.getElementById("rpp");if(h==c&&E==B&&y==_){if(e.keyCode>=48&&e.keyCode<=57)return S.songData[E].p[y]=e.keyCode-47,ze(),je(),Fe(),!1;if(e.keyCode>=64&&e.keyCode<=90)return S.songData[E].p[y]=e.keyCode-54,ze(),je(),Fe(),!1}if(h!=c&&!r){switch(i=-1,e.keyCode){case 90:i=0;break;case 83:i=1;break;case 88:i=2;break;case 68:i=3;break;case 67:i=4;break;case 86:i=5;break;case 71:i=6;break;case 66:i=7;break;case 72:i=8;break;case 78:i=9;break;case 74:i=10;break;case 77:i=11;break;case 188:i=12;break;case 76:i=13;break;case 190:i=14;break;case 186:i=15;break;case 191:i=16;break;case 81:i=12;break;case 50:i=13;break;case 87:i=14;break;case 51:i=15;break;case 69:i=16;break;case 82:i=17;break;case 53:i=18;break;case 84:i=19;break;case 54:i=20;break;case 89:i=21;break;case 55:i=22;break;case 85:i=23;break;case 73:i=24;break;case 57:i=25;break;case 79:i=26;break;case 48:i=27;break;case 80:i=28}if(i>=0&&Qe(i+12*p))return!1}var a;switch(e.keyCode){case 39:if(h==c)return We((E+1)%8,y),je(),Fe(),nt(!0),!1;if(h==d)return qe((m+1)%4,g),!1;break;case 37:if(h==c)return We((E-1+8)%8,y),je(),Fe(),nt(!0),!1;if(h==d)return qe((m-1+4)%4,g),!1;break;case 40:if(h==c)return We(E,(y+1)%u),je(),Fe(),!1;if(h==d)return qe(m,(g+1)%S.patternLen),!1;if(h==l)return Ge((b+1)%S.patternLen),!1;break;case 38:if(h==c)return We(E,(y-1+u)%u),je(),Fe(),!1;if(h==d)return qe(m,(g-1+S.patternLen)%S.patternLen),!1;if(h==l)return Ge((b-1+S.patternLen)%S.patternLen),!1;break;case 36:if(h==c)return We(E,0),je(),Fe(),!1;if(h==d)return qe(m,0),!1;if(h==l)return Ge(0),!1;break;case 35:if(h==c)return We(E,u-1),je(),Fe(),!1;if(h==d)return qe(m,S.patternLen-1),!1;if(h==l)return Ge(S.patternLen-1),!1;break;case 32:if(h!=s)return Ot(e),!1;break;case 8:case 46:if(h==c){for(t=y;_>=t;++t)for(n=E;B>=n;++n)S.songData[n].p[t]=0;return ze(),je(),Fe(),!1}if(h==d){if(y==_&&E==B){if(a=S.songData[E].p[y]-1,a>=0){for(t=g;w>=t;++t)for(n=m;v>=n;++n)S.songData[E].c[a].n[t+n*S.patternLen]=0;g==w&&qe(m,(g+1)%S.patternLen),je()}return!1}}else if(h==l&&y==_&&E==B){if(a=S.songData[E].p[y]-1,a>=0){for(t=b;I>=t;++t)S.songData[E].c[a].f[t]=0,S.songData[E].c[a].f[t+S.patternLen]=0;b==I&&Ge((b+1)%S.patternLen),Fe()}return!1}break;case 13:r&&(it(),at(),document.getElementById("bpm").blur(),document.getElementById("rpp").blur())}return!0},Tn=function(e){e=e||window.event,e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;if(t.length&&1!=t.length)return void alert("Only open one file at a time.");var n=t[0],i=new FileReader;i.onload=function(e){lt(X(e.target.result))},i.readAsDataURL(n)},Cn=function(){document.onmousedown=null,document.addEventListener("mousemove",bn,!1),document.addEventListener("touchmove",bn,!1),document.addEventListener("mouseup",In,!1),document.addEventListener("touchend",In,!1),document.onkeydown=xn;var e=document.body.parentNode;e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("drop",Tn,!1)},Ln=function(){document.onmousedown=function(){return!0},document.onmousemove=null,document.onmouseup=null,document.onkeydown=null},Dn=function(){for(var e,t,n,i=document.getElementById("sequencer-table"),r=0;u>r;r++){e=document.createElement("tr"),r%4===0&&(e.className="beat"),t=document.createElement("th"),t.id="spr"+r,t.textContent=""+r,e.appendChild(t);for(var a=0;8>a;a++)n=document.createElement("td"),n.id="sc"+a+"r"+r,n.textContent=" ",n.addEventListener("mousedown",wn,!1),n.addEventListener("mouseover",En,!1),n.addEventListener("mouseup",yn,!1),e.appendChild(n);i.appendChild(e)}},Un=function(e){for(var t=1;t<e.children.length&&"beat"!==e.children[t].className;)t++;return t},kn=function(){var e=G(),t=4;return S.patternLen%3===0?t=3:S.patternLen%4===0?t=4:S.patternLen%2===0?t=2:S.patternLen%5===0&&(t=5),e/t>=40&&S.patternLen>24&&S.patternLen%(2*t)===0&&(t*=2),t},Sn=function(){var e=kn(),t=document.getElementById("pattern-table");if(t.children.length!==S.patternLen||Un(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,i,r,a=0;a<S.patternLen;a++){n=document.createElement("tr"),a%e===0&&(n.className="beat"),i=document.createElement("th"),i.id="ppr"+a,i.textContent=""+a,n.appendChild(i);for(var o=0;4>o;o++)r=document.createElement("td"),r.id="pc"+o+"r"+a,r.textContent=" ",r.addEventListener("mousedown",mn,!1),r.addEventListener("mouseover",gn,!1),r.addEventListener("mouseup",vn,!1),n.appendChild(r);t.appendChild(n)}}},Mn=function(){var e=kn(),t=document.getElementById("fxtrack-table");if(t.children.length!==S.patternLen||Un(t)!==e){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n,i,r=0;r<S.patternLen;r++)n=document.createElement("tr"),r%e===0&&(n.className="beat"),i=document.createElement("td"),i.id="fxr"+r,i.textContent=String.fromCharCode(160),i.addEventListener("mousedown",fn,!1),i.addEventListener("mouseover",hn,!1),i.addEventListener("mouseup",pn,!1),n.appendChild(i),t.appendChild(n)}};this.init=function(){$(".knob").knob({inline:!1,width:50,height:50,bgColor:"#2b3e50",fgColor:"#df691a",inputColor:"#ebebeb",angleOffset:-125,angleArc:250,cursor:10}),$("input[type=range]").rsSlider({}),t=F(window.location.href),n=q(window.location.href),Me(o+"progress.gif"),Ye(),P.onload=function(){St(-1)},O.onload=function(){St(-1)},P.src=o+"playGfxBg.png",O.src=o+"led-off.png",R.src=o+"led-on.png",Dn(),document.getElementById("osc1_vol").sliderProps={min:0,max:255},document.getElementById("osc1_semi").sliderProps={min:92,max:164},document.getElementById("osc2_vol").sliderProps={min:0,max:255},document.getElementById("osc2_semi").sliderProps={min:92,max:164},document.getElementById("osc2_det").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("noise_vol").sliderProps={min:0,max:255},document.getElementById("env_att").sliderProps={min:0,max:255},document.getElementById("env_sust").sliderProps={min:0,max:255},document.getElementById("env_rel").sliderProps={min:0,max:255},document.getElementById("lfo_amt").sliderProps={min:0,max:255},document.getElementById("lfo_freq").sliderProps={min:0,max:16},document.getElementById("fx_freq").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_res").sliderProps={min:0,max:254},document.getElementById("fx_dist").sliderProps={min:0,max:255,nonLinear:!0},document.getElementById("fx_drive").sliderProps={min:0,max:255},document.getElementById("fx_pan_amt").sliderProps={min:0,max:255},document.getElementById("fx_pan_freq").sliderProps={min:0,max:16},document.getElementById("fx_dly_amt").sliderProps={min:0,max:255},document.getElementById("fx_dly_time").sliderProps={min:0,max:16};try{M=new Audio,Y.setAudioElement(M),M.addEventListener("canplay",function(){this.play()},!0)}catch(i){M=null}var r=X(n&&n.data&&n.data[0]),a=r?Te(r):null;S=a?a:_e(),Ne(),ze(),je(),Fe(),nt(!0),$e(d),We(0,0),qe(0,0),$("#logo").on("click",pt),$("#newSong").on("click",mt),$("#openSong").on("click",gt),$("#openMidi").on("click",e),$("#saveSong").on("click",vt),$("#exportJS").on("click",Et),$("#exportWAV").on("click",wt),$("#playSong").on("click",Pt),$("#playRange").on("click",Ot),$("#stopPlaying").on("click",Rt),$("#about").on("click",pt),document.getElementById("bpm").onfocus=$t,document.getElementById("rpp").onfocus=Nt,document.getElementById("sequencerCopy").onmousedown=Vt,document.getElementById("sequencerPaste").onmousedown=Qt,document.getElementById("sequencerPatUp").onmousedown=Zt,document.getElementById("sequencerPatDown").onmousedown=Kt,document.getElementById("patternCopy").onmousedown=Ft,document.getElementById("patternPaste").onmousedown=qt,document.getElementById("patternNoteUp").onmousedown=Xt,document.getElementById("patternNoteDown").onmousedown=Wt,document.getElementById("patternOctaveUp").onmousedown=Jt,document.getElementById("patternOctaveDown").onmousedown=Gt,document.getElementById("fxCopy").onmousedown=en,document.getElementById("fxPaste").onmousedown=tn,document.getElementById("instrPreset").onfocus=zt,document.getElementById("instrPreset").onchange=ln,$("[name=osc1_wave]").on("change",rn),$("#osc1_vol").rsSlider("change",_n),$("#osc1_semi").rsSlider("change",_n),$("#osc1_xenv").on("change",nn),$("[name=osc2_wave]").on("change",an),$("#osc2_vol").rsSlider("change",_n),$("#osc2_semi").rsSlider("change",_n),$("#osc2_det").rsSlider("change",_n),$("#osc2_xenv").on("change",nn),$("#noise_vol").rsSlider("change",_n),$("#env_att").rsSlider("change",_n),$("#env_sust").rsSlider("change",_n),$("#env_rel").rsSlider("change",_n),$("[name=lfo_wave]").on("change",on),$("#lfo_amt").rsSlider("change",_n),$("#lfo_freq").rsSlider("change",_n),$("#lfo_fxfreq").on("change",nn),$("[name=fx_filt]").on("change",sn),$("#fx_freq").rsSlider("change",_n),$("#fx_res").rsSlider("change",_n),$("#fx_dly_amt").rsSlider("change",_n),$("#fx_dly_time").rsSlider("change",_n),$("#fx_pan_amt").rsSlider("change",_n),$("#fx_pan_freq").rsSlider("change",_n),$("#fx_dist").rsSlider("change",_n),$("#fx_drive").rsSlider("change",_n),document.getElementById("octaveDown").addEventListener("mousedown",dn,!1),document.getElementById("octaveDown").addEventListener("touchstart",dn,!1),document.getElementById("octaveUp").addEventListener("mousedown",cn,!1),document.getElementById("octaveUp").addEventListener("touchstart",cn,!1),document.getElementById("keyboard").addEventListener("mousedown",un,!1),document.getElementById("keyboard").addEventListener("touchstart",un,!1),document.getElementById("instrCopy").onmousedown=jt,document.getElementById("instrPaste").onmousedown=Ht,Se(),Cn(),r||ht(),N.start(),N.updateRowLen(S.rowLen)}};